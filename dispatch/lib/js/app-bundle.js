!function(){"use strict";var e=angular.module("app",["ui.router","ngCookies","ui.bootstrap","ngAnimate","ngDialog","isteven-multi-select","ng-bootstrap-datepicker","ui.bootstrap.datetimepicker","anguFixedHeaderTable","pascalprecht.translate","angulartics","angulartics.google.analytics","ui.mention","ngFloatingScroll","angular.filter","selectize"]).config(r).run(t);function r(e,r,t,o,a){a.interceptors.push("HttpInterceptor"),o.classNameFilter(/angular-animate/),t.useSanitizeValueStrategy("escape"),t.preferredLanguage("en_US"),t.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}),r.otherwise("/"),e.state("home",{url:"/",templateUrl:"app/home/home.view.html",resolve:{access:["AuthGuard",function(e){return e.guard()}]}}).state("login",{url:"/login",controller:"LoginController",templateUrl:"app/login/login.view.html",controllerAs:"vm"}).state("register",{url:"/register",controller:"RegisterController",templateUrl:"app/register/register.view.html",controllerAs:"vm"}).state("serviceAreas",{url:"/serviceAreas",controller:"ServiceAreasController",templateUrl:"app/serviceAreas/serviceAreas.view.html",controllerAs:"vm"}).state("dispatcher",{url:"/dispatcher",controller:"DispatcherController",templateUrl:"app/dispatcher/dispatcher.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.dispatcher)}]}}).state("glreport",{url:"/glreport",controller:"GLController",templateUrl:"app/gl/gl.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.invoicing)}]}}).state("orders",{url:"/orders",controller:"OrdersController",templateUrl:"app/orders/orders.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.orders)}]}}).state("registration",{url:"/registration",controller:"RegistrationController",templateUrl:"app/registration/registration.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.registration)}]}}).state("affiliation",{url:"/affiliation",controller:"AffiliationController",templateUrl:"app/affiliation/affiliation.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.affliation)}]}}).state("consolidator",{url:"/consolidator",controller:"ConsolidatorController",templateUrl:"app/consolidator/consolidator.demo.html",controllerAs:"vm"}).state("approver",{url:"/approver",controller:"ApproverController",templateUrl:"app/approver/approver.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.approver)}]}}).state("tracker",{url:"/tracker",controller:"TrackerController",templateUrl:"app/tracker/tracker.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.map)}]}}).state("uploader",{url:"/uploader",controller:"DataloaderController",templateUrl:"app/dataloader/dataloader.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.reports.upload)}]}}).state("reportwizard",{url:"/reportwizard",controller:"ReportWizardController",templateUrl:"app/reportwizard/reportwizard.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.reports.wizard)}]}}).state("carrierInfo",{url:"/carrierInfo/:companyId",controller:"CarrierInfoController",templateUrl:"app/carrierInfo/carrierInfo.view.html",controllerAs:"vm",resolve:{CarrierService:"CarrierService",company:function(e,r){r.companyId;return e.GetCompany(r.companyId)}}}).state("carrier",{abstract:!0,url:"/carrier",templateUrl:"app/carrier/carrier.view.html",controller:"CarrierController",controllerAs:"vm"}).state("carrier.profile",{url:"/profile",templateUrl:"app/carrier/profile.view.html"}).state("carrier.address",{url:"/address",templateUrl:"app/carrier/address.view.html"}).state("carrier.users",{url:"/users",templateUrl:"app/carrier/users.view.html"}).state("carrier.photos",{url:"/photos",templateUrl:"app/carrier/photos.view.html"}).state("carrier.services",{url:"/services",templateUrl:"app/carrier/services.view.html"}).state("carrier.equipments",{url:"/equipments",templateUrl:"app/carrier/equipments.view.html"}).state("carrier.pod",{url:"/pod",templateUrl:"app/carrier/pod.view.html"}).state("carrier.rates",{url:"/rates",templateUrl:"app/carrier/rates.view.html"}).state("shipper",{abstract:!0,url:"/shipper",templateUrl:"app/shipper/shipper.view.html",controller:"ShipperController",controllerAs:"vm"}).state("shipper.profile",{url:"/profile",templateUrl:"app/shipper/profile.view.html"}).state("shipper.address",{url:"/address",templateUrl:"app/shipper/address.view.html"}).state("shipper.client",{url:"/client",templateUrl:"app/shipper/client.view.html"}).state("shipper.photos",{url:"/photos",templateUrl:"app/shipper/photos.view.html"}).state("shipper.branches",{url:"/branches",templateUrl:"app/shipper/branches.view.html"}).state("forgot",{url:"/forgotPassword",controller:"ForgotController",templateUrl:"app/forgot/forgot.view.html",controllerAs:"vm"}).state("password",{url:"/password",controller:"PasswordController",templateUrl:"app/password/password.view.html",controllerAs:"vm"}).state("analytics",{url:"/analytics",controller:"AnalyticsController",templateUrl:"app/analytics/analytics.view.html",controllerAs:"vm"}).state("approval",{url:"/rewards/approval",controller:"ApprovalController",templateUrl:"app/rewards/approval.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.rewards)}]}}).state("truckloadconsolidator",{url:"/truckloadconsolidator",controller:"TruckloadConsolidatorController",templateUrl:"app/truckloadconsolidator/truckloadconsolidator.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.truckloadconsolidator)}]}}).state("controltower",{url:"/controltower",controller:"ControlTowerController",templateUrl:"app/controltower/controltower.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.controltower)}]}}).state("route-optimizer",{url:"/route-optimizer",controller:"RouteOptimizerController",templateUrl:"app/route-optimizer/route-optimizer.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.route_optimizer)}]}}).state("routing",{url:"/routing",controller:"RoutingController",templateUrl:"app/routing/routing.view.html",controllerAs:"vm"}).state("epod",{url:"/epod/review",controller:"EpodReviewController",templateUrl:"app/epod/review.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.epodreview)}]}}).state("report-epod",{url:"/report/epod",controller:"EpodReportController",templateUrl:"app/epod/report.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.reports.epodreports)}]}}).state("freight-billing",{url:"/freight-billing",controller:"FreightBillingController",templateUrl:"app/invoice/freight-billing.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.invoicing)}]}}).state("delivery-order-summary",{url:"/delivery-order-summary",controller:"DeliveryOrderSummaryController",templateUrl:"app/invoice/delivery-order-summary.view.html",controllerAs:"vm",resolve:{access:["AuthGuard","Role",function(e,r){return e.guard(r.access.invoicing)}]}}).state("invoice2",{url:"/invoice2",controller:"GLController",templateUrl:"app/gl/gl.view.html",controllerAs:"vm"}).state("denied",{url:"/denied",templateUrl:"app/denied.view.html",resolve:{access:["AuthGuard",function(e){return e.guard()}]}}).state("noanalytics",{url:"/noanalytics",templateUrl:"app/analytics/noanalytics.view.html",resolve:{access:["AuthGuard",function(e){return e.guard()}]}}).state("backhaul",{url:"/backhaul",controller:"BackhaulController",templateUrl:"app/backhaul/backhaul.view.html",controllerAs:"vm",resolve:{access:["AuthGuard",function(e){return e.guard()}]}}).state("bayqueue",{url:"/bayqueue",controller:"BayqueueController",templateUrl:"app/bayqueue/bayqueue.view.html",controllerAs:"vm",resolve:{access:["AuthGuard",function(e){return e.guard()}]}}),toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"2000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}}function t(i,s,e,r,n,c,t,o,a,u,p,d,l){i.guard=e,i.role=r,i.globals=o.get("globals")||{},s.loadCurrentUser(),i.globals.currentUser?a.defaults.headers.common.Authorization="Basic "+i.globals.currentUser.authdata:t.path("/login"),i.showChat=function(e){s.currentUser.provider&&s.currentUser.provider.chatAvailable?e?$("#conversejs").is(":visible")?($("#conversejs").hide(),$("#conversationsToggle").show()):($("#conversejs").show(),$("#conversationsToggle").hide()):async function(e,r){var t=e.param.token;window.currentUser=e,$("#conversejs").hide(),$("#conversations").hide(),$("#conversationsToggle").hide(),r.get("/integration-api/service/xmpp-authenticate?token="+t+"&type=dispatch").then(function(e){if(!window.globalConverse)try{converse.plugins.add("openchat",{initialize:function(){var e=this._converse;window.localStorage.getItem("currentUser")||(window.localStorage.setItem("currentUser",JSON.stringify(window.currentUser)),delete window.currentUser),Promise.all([e.api.waitUntil("rosterContactsFetched"),e.api.waitUntil("chatBoxesFetched")]).then(function(){window.globalConverse=e,setTimeout(function(){$("#toggle-controlbox")&&$("#toggle-controlbox")[0].click(),$(".toggle-chatbox-button").each(function(e,r){r.click()}),$("#toggle-minimized-chats")&&$("#toggle-minimized-chats")[0].click()},1e3)}),window.globalConverse=e,setTimeout(function(){$(".toggle-chatbox-button").each(function(e,r){r.click()}),$("#toggle-minimized-chats")&&new Promise(function(e,r){setTimeout(function(){$("#toggle-minimized-chats")[0].click(),$(".minimized-chats-flyout")&&($(".minimized-chats-flyout").addClass("collapsed"),$("#toggle-minimized-chats")[0].click(),e())},1e3)}).then(function(){setTimeout(function(){$("#conversejs").fadeIn(),$("#conversations").show()},1500),setTimeout(function(){window.globalConverse.controlboxtoggle._domEvents[0].el.click()},1550)})},1e3),window.globalConverse=e}})}catch(e){}var r=[];e.data.rooms.forEach(e=>{r.push({jid:e})}),converse.initialize({authentication:"login",cache_otr_key:!1,allow_otr:!0,auto_login:!0,auto_register_muc_nickname:!0,muc_disable_moderator_commands:!1,allow_muc_invitations:!0,allow_non_roster_messaging:!0,muc_instant_rooms:!0,auto_list_rooms:!0,muc_nickname_from_jid:!0,muc_respect_autojoin:!0,auto_join_on_invite:!0,hide_open_bookmarks:!0,notify_all_room_messages:!0,show_controlbox_by_default:!1,show_controlbox_by_default:!1,auto_reconnect:!0,auto_subscribe:!0,ping_interval:100,bosh_service_url:e.data.bosh_service_url,keepalive:!0,hide_muc_server:!0,play_sounds:!0,allow_muc:!0,sticky_controlbox:!1,muc_show_join_leave:!1,fullname:"Test",credentials_url:e.data.credentials_url,whitelisted_plugins:["openchat"],debug:!1})})}(s.currentUser,a):e&&toastr.warning("Sorry, chat isn't available in your account.")},i.showdash=function(e){if(void 0===i.analytics){if(void 0===s.currentUser.analytics)return;i.analytics=s.currentUser.analytics}e=i.analytics[e];console.log("show dash",e),i.dashmenu=e,window.location.href="#/analytics"},i.logout=function(){s.resetCurrentUser(),window.location.reload()},i.$on("$stateChangeSuccess",function(e,r,t,o,a){var l;s.isLoggedIn()?(i.isSuperAdmin=s.currentUser.isSuperAdmin,i.isAnalytics=s.currentUser.isAnalytics,i.analytics=s.currentUser.analytics,console.log(new Date+" toState.name:"+r.name+"; UserService.currentUser.isPasswordWeak:"+s.currentUser.isPasswordWeak,s.currentUser),l=r.name,-1===$.inArray(l,["/login","/logout","/register","/forgotPassword"])&&(s.currentUser.isPasswordWeak?"password"!==r.name&&"logout"!==r.name&&"login"!==r.name&&(toastr.warning("Password change is required"),p.go("password")):i.isCarrier?i.isCarrierRegistrationComplete||r.name.startsWith("carrier.")||p.go("carrier.profile"):!i.isShipper||i.isShipperRegistrationComplete||r.name.startsWith("shipper.")||p.go("shipper.profile")),jQuery("#headerow").show(),jQuery("#sideMenu").show(),0==$("#conversejs").length&&i.showChat(!1),i.header_bar="header dark-bg",i.sidebar_closed="",i.globals.user=s.currentUser,i.isActivityProcessing=!0,n.getNotificationCount().then(function(e){i.isActivityProcessing=!1,i.notificationCount=e}),i.notificationTimer||(i.notificationTimer=d(function(){i.isActivityProcessing||(i.isActivityProcessing=!0,n.getNotificationCount().then(function(e){i.isActivityProcessing=!1,i.notificationCount=e}))},12e4))):(c.ClearCredentials(),i.notificationTimer&&d.cancel(i.notificationTimer),i.notificationTimer=void 0,jQuery("#conversejs").remove(),jQuery("#headerow").hide(),jQuery("#sideMenu").hide(),i.header_bar="top-menu-hidden",i.sidebar_closed="sidebar-closed")}),i.$on("$stateNotFound",function(e,r,t,o){u.error("The requested state was not found: ",r),u.error("fromState:",t),u.error("fromParams:",o),u.error("done"),p.go("home")}),i.$on("$stateChangeError",function(e,r,t,o,a,l){u.error("An error occured while changing states: ",l),u.error("event:",e),u.error("toState:",r),u.error("toParams:",t),u.error("fromState:",o),u.error("fromParams:",a),u.error("done"),p.go("home")})}r.$inject=["$stateProvider","$urlRouterProvider","$translateProvider","$animateProvider","$httpProvider"],t.$inject=["$rootScope","UserService","AuthGuard","Role","ActivityService","AuthenticationService","$location","$cookieStore","$http","$log","$state","$interval"],e.directive("starRating",function(){return{restrict:"A",template:'<ul class="rating">\t<li ng-repeat="star in stars" ng-class="star" ng-click="toggle($index)">★</li></ul>',scope:{ratingValue:"=",max:"=",onRatingSelected:"&"},link:function(o,e,r){o.toggle=function(e){o.ratingValue=e+1,o.onRatingSelected({rating:e+1})},o.$watch("ratingValue",function(e,r){if(r){o.stars=[];for(var t=0;t<o.max;t++)o.stars.push({filled:t<o.ratingValue})}})}}})}();
!function(){"use strict";angular.module("app").factory("DateHelper",[function(){return{initializeDatePicker:function(t){$("#"+t).focus(),$("#"+t).datepicker({format:"yyyy/mm/dd",todayHighlight:!0,autoclose:!0})},getDateFirstAndLastDay:function(t,e){var a=(n=new Date).getFullYear(),n=n.getMonth(),o=new Date(a,n,1),a=new Date(a,n+1,0);$("#"+t).val(moment(o).format("YYYY/MM/DD")),$("#"+e).val(moment(a).format("YYYY/MM/DD"))},formatDate:function(t,e){return moment(t).format(e)}}}])}();
!function(){"use strict";angular.module("app").factory("OpTableHelper",[function(){var t=!0,u={objList:[],currentPage:1,numPerPage:5,selectedNumPerPage:5,pageNavArr:[]};return u.setObjectList=function(e){u.objList=e,u.totalPage=Math.ceil(u.objList.length/u.numPerPage),u.currentPage=1,u.selectPage(u.currentPage)},u.changeNumPerPage=function(){u.numPerPage="all"===u.selectedNumPerPage?u.objList.length:parseInt(u.selectedNumPerPage),u.totalPage=Math.ceil(u.objList.length/u.numPerPage),u.currentPage=1,u.selectPage(u.currentPage)},u.sortColumn=function(e){u.orderDirectionAccordingTo=t?"+"+e:"-"+e,t=!t},u.selectPage=function(e){var t=(r=e*u.numPerPage)-u.numPerPage,r=r>u.objList.length?u.objList.length:r,t=(u.displayedItems=u.objList.slice(t,r),u.currentPage=e,u.currentPage),a=u.totalPage,n=[];if(a<=5){if(2<a)for(var g=2;g<a;g++)n.push(g)}else if(t<=4)for(g=2;g<=5;g++)n.push(g);else if(a-4<t)for(g=a-4;g<=a-1;g++)n.push(g);else n.push(t-1),n.push(t),n.push(t+1);u.pageNavArr=n},u.previousPage=function(){u.selectPage(--u.currentPage)},u.nextPage=function(){u.selectPage(++u.currentPage)},u.getDisplayedItemCount=function(){var e=u.currentPage*u.numPerPage;return e-u.numPerPage+1+" to "+(e>u.objList.length?u.objList.length:e)},u}])}();
!function(){"use strict";function r(e){var t=this;function n(){var r;return t.currentUser=(r=e.localStorage.getItem("currentUser"))?JSON.parse(r):{},void 0!==t.currentUser&&t.currentUser!=={}&&void 0!==t.currentUser.userName}return{request:function(r){return n()&&(r.headers["x-openport-token"]=t.currentUser.token.accessToken),r}}}angular.module("app").factory("HttpInterceptor",r),r.$inject=["$window"]}();
!function(){"use strict";function S(e,_,i){function o(S){return e.hasRole(S)||e.isSuperAdmin(e.currentUser)}return{guard:function(S){var T=_.defer(),r=!1;return e.isLoggedIn()||(r=!0,i.path("/login")),void 0===S||o(S)||(r=!0,i.path("/denied")),r||T.resolve(),T.promise},isPermittedPage:o}}angular.module("app").value("Role",{access:{dispatcher:["TMS_DISPATCHER"],registration:["TMS_DISPATCHER"],analytics:["TMS_DISPATCHER","TMS_ANALYTICS"],map:["TMS_DISPATCHER"],upload:["TMS_DISPATCHER"],invoicing:["TMS_FBS","TMS_BILL"],reports:{all:["TMS_DISPATCHER","TMS_EPOD_MGR","TMS_PAGE_REPORT","TMS_FBS"],wizard:["TMS_DISPATCHER","TMS_PAGE_REPORT"],epodreports:["TMS_DISPATCHER","TMS_EPOD_MGR","TMS_PAGE_REPORT"]},orders:["TMS_DISPATCHER"],affliation:[],admin:[],rewards:["TMS_DISPATCHER","TMS_INVOICE","TMS_REWARDS"],epodreview:["TMS_DISPATCHER","TMS_EPOD_REVIEW"],truckloadconsolidator:["TMS_VPO"],route_optimizer:["TMS_OPTIMIZER"],lq:{vendors:["LQ_USER"],fborders:["LQ_USER"],fbsummaries:["LQ_USER"],budgets:["LQ_USER"]},approver:["TMS_CUST_ADMIN"],controltower:["TMS_CTRL_TOWER"]},action:{edit_shipment:"TMS_SHPMNT_EDIT",distributor:"TMS_DISTRIBUTOR"}}).factory("AuthGuard",S),S.$inject=["UserService","$q","$location"]}();
!function(){"use strict";angular.module("app").directive("ngMagnify",function(){return{restrict:"EA",replace:!0,template:'<div class="magnify-container" data-ng-style="getContainerStyle()"><div class="magnify-glass" data-ng-style="getGlassStyle()"></div><img class="magnify-image" data-ng-src="{{ imageSrc }}"/></div>',scope:{imageSrc:"@",imageWidth:"=",imageHeight:"=",glassWidth:"=",glassHeight:"="},link:function(g,e){var s,o,h,i,c=e.find("div"),a=e.find("img");"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||(e.on("mousemove",function(t){s=angular.extend(g.getOffset(e[0]),{width:e[0].offsetWidth,height:e[0].offsetHeight,imageWidth:a[0].offsetWidth,imageHeight:a[0].offsetHeight,glassWidth:c[0].offsetWidth,glassHeight:c[0].offsetHeight}),(i=g.magnify(t))&&c.css(i)}).on("mouseout",function(){c.on("mouseleave",function(){c.css({opacity:0,filter:"alpha(opacity=0)"})})}),g.magnify=function(t){var e,i,a,n;if(o||h)return e=t.pageX?t.pageX-s.left:t.x,t=t.pageY?t.pageY-s.top:t.y,e<s.width&&t<s.height&&0<e&&0<t?(c.css({opacity:1,"z-index":1,filter:"alpha(opacity=100)"}),i=-1*Math.round(e/s.imageWidth*o-s.glassWidth/2),a=-1*Math.round(t/s.imageHeight*h-s.glassHeight/2),{left:e-s.glassWidth/2+"px",top:t-s.glassHeight/2+"px",backgroundPosition:i+"px "+a+"px"}):void c.css({opacity:0,"z-index":-1,filter:"alpha(opacity=0)"});(n=new Image).onload=function(){o=n.width,h=n.height},n.src=g.imageSrc},g.getOffset=function(t){var e=document.documentElement,t=t.getBoundingClientRect();return{top:t.top+window.pageYOffset-e.clientTop,left:t.left+window.pageXOffset-e.clientLeft}},g.getContainerStyle=function(){return{width:g.imageWidth?g.imageWidth+"px":"",height:g.imageHeight?g.imageHeight+"px":""}},g.getGlassStyle=function(){return{background:'#FFFFFF url("'+g.imageSrc+'") no-repeat',width:g.glassWidth?g.glassWidth+"px":"",height:g.glassHeight?g.glassHeight+"px":""}})}}})}();
!function(){"use strict";angular.module("app").directive("sortable",function(){return{restrict:"C",link:function(n,a){n.isSortAsc=!1,a.append(angular.element('<span class="fa fa-angle-down"></span>')),a.bind("click",function(){n.isSortAsc=!n.isSortAsc,angular.element(this).children().removeClass().addClass(n.isSortAsc?"fa fa-angle-up":"fa fa-angle-down")})}}})}();
!function(){"use strict";angular.module("app").directive("roleaccess",["UserService","Role",function(s,n){return{restrict:"A",scope:{roleaccess:"@"},link:function(e,r){var o,e=e.roleaccess.split(",");r.hide();for(o of e){var i=n.action[o];if(void 0!==i)for(var c of s.currentUser.roles)if(i===c.role){-1===o.indexOf("!")?r.show():r.hide();break}}}}}])}();
!function(){"use strict";angular.module("app").directive("limitToRange",function(){return{scope:{isdecimal:"@",allownegative:"@"},link:function(a,n,l){n.on("keydown keyup",function(e){Number(n.val())>Number(l.max)&&46!=e.keyCode&&8!=e.keyCode?(e.preventDefault(),n.val(l.max)):Number(n.val()<Number(l.min))&&46!=e.keyCode&&8!=e.keyCode&&189!=e.keyCode&&109!=e.keyCode?(e.preventDefault(),n.val(l.min)):189!=e.keyCode&&109!=e.keyCode||a.allownegative||(e.preventDefault(),0===n.val().length&&n.val(l.min)),a.isdecimal&&"false"!=a.isdecimal||190!=e.keyCode&&110!=e.keyCode||e.preventDefault(),65<=e.keyCode&&e.keyCode<=90&&e.preventDefault()})}}})}();
!function(){"use strict";angular.module("app").directive("activity",["ActivityService","UserService","$rootScope","$timeout",function(e,o,s,i){return{restrict:"E",scope:{isShown:"="},templateUrl:"./app/directives/activitycenter/activity.view.html",link:function(n,t){n.notifications=[],n.notificationSettings=[],n.isProcessing=!1,n.isSettings=!1,n.selectedGroupFilter="all",n.selectedTimeFilter="today";function i(){n.isShown&&(n.notifications=[],n.isProcessing=!0,e.getNotifications(n.selectedTimeFilter,n.selectedGroupFilter).then(function(i){n.notifications=i=void 0===i?[]:i,n.isProcessing=!1}))}n.$watch("isShown",function(){n.notifications=[],n.isShown?(n.isProcessing=!0,i()):void 0!==n.isShown&&void 0!==o.currentUser&&o.currentUser!=={}&&void 0!==o.currentUser.userName&&(s.notificationCount=0,e.getNotificationCount().then(function(i){s.notificationCount=i}))}),n.$watch("selectedTimeFilter",function(){i()}),n.$watch("selectedGroupFilter",function(){i()}),n.isExcluded=function(i){i.excluded=!i.excluded},n.openSettings=function(){n.notificationSettings=[],n.isProcessing=!0,e.getNotificationSettings().then(function(i){n.notificationSettings=i=void 0===i?[]:i,n.isProcessing=!1}),n.isSettings=!0},n.closeSettings=function(){e.saveNotificationSettings(n.notificationSettings).then(function(i){n.isProcessing=!1}),n.isSettings=!1,i()},n.markAllAsRead=function(){n.isProcessing=!0,e.markAllAsRead(n.notifications).then(function(i){for(var t=0;t<n.notifications.length;t++)n.notifications[t].read=!0;n.isProcessing=!1})},n.markAsRead=function(i){n.isProcessing=!0;var t=n.notifications[i].notificationId;n.notifications[i].read=!n.notifications[i].read,n.notifications[i].read?e.markAsRead(t).then(function(i){n.isProcessing=!1}):e.markAsUnread(t).then(function(i){n.isProcessing=!1})},$(document).bind("click",function(i){0<t.find(i.target).length||"notifications"!=i.target.id&&n.$evalAsync(function(){void 0!==n.isShown&&n.isShown&&(n.isShown=!1)})})}}}])}();
!function(){"use strict";angular.module("common.services",["ngResource"])}();
!function(){"use strict";function e(a,t,o,e,n,r){var s={Login:function(e,r,t,o){a.post("/tms-api/users/authenticate",{username:e,password:r,hostname:t}).success(function(e){n.currentUser=e.user,console.log("User service",n.currentUser),e.success=1,o(e)}).error(function(e,r,t){e.success=0,n.currentUser=void 0,"LOGIN_ATTEMPT_EXCEEDS"===e.message?e.message="Your account has been locked due to too many failed attempts. Please use Forgot Password feature to reset your password":e.message="Authentication failed",o(e)})}};return s.OAuthLogin=function(e,r,t){var o={headers:{"App-Code":"OPT_DEFAULT","Content-Type":"application/x-www-form-urlencoded",Authorization:""}},n=i.encode("openport-client:openport-secret"),e={username:e,password:r,grant_type:"password"};o.headers.Authorization="Base "+n,a({method:"POST",url:"/insight-oauth/oauth/token",headers:{"App-Code":"OPT_DEFAULT","Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+n},transformRequest:function(e){var r,t=[];for(r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},data:e}).then(t,function(e){return function(){return{success:!1,message:e}}}("Error on logging in oauth"))},s.SetCredentials=function(e,r){r=i.encode(e+":"+r);o.globals={currentUser:{username:e,authdata:r}},a.defaults.headers.common.Authorization="Basic "+r,t.put("globals",o.globals),o.globals.user=n.currentUser,n.storeCurrentUser()},s.ClearCredentials=function(){o.globals={},t.remove("globals"),n.resetCurrentUser(),n.currentUser={},a.defaults.headers.common.Authorization="Basic",o.header_bar="top-menu-hidden",o.sidebar_closed="sidebar-closed",o.isSuperAdmin=!1,o.isShipper=!1,o.isShipperRegistrationComplete=null,o.isCarrierRegistrationComplete=null},s}angular.module("app").factory("AuthenticationService",e),e.$inject=["$http","$cookieStore","$rootScope","$timeout","UserService","$log"];var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var r,t,o,n,a,s="",i="",c=0;o=(r=e.charCodeAt(c++))>>2,n=(3&r)<<4|(r=e.charCodeAt(c++))>>4,a=(15&r)<<2|(t=e.charCodeAt(c++))>>6,i=63&t,isNaN(r)?a=i=64:isNaN(t)&&(i=64),s=s+this.keyStr.charAt(o)+this.keyStr.charAt(n)+this.keyStr.charAt(a)+this.keyStr.charAt(i),a=i="",c<e.length;);return s},decode:function(e){var r,t,o,n,a,s,i="",c=0;for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");o=this.keyStr.indexOf(e.charAt(c++)),r=(15&(n=this.keyStr.indexOf(e.charAt(c++))))<<4|(a=this.keyStr.indexOf(e.charAt(c++)))>>2,t=(3&a)<<6|(s=this.keyStr.indexOf(e.charAt(c++))),i+=String.fromCharCode(o<<2|n>>4),64!=a&&(i+=String.fromCharCode(r)),64!=s&&(i+=String.fromCharCode(t)),c<e.length;);return i}}}();
!function(){"use strict";function e(r,t){var u={};function n(e){return e.data&&!e.data.success&&(e.data.success=!0),e.data}function s(e){return e.data.success=!1,e.data}function o(){var e=u.currentUser;return!(void 0===e||e==={}||void 0===e.userName)}return u.GetAll=function(){return r.get("/tms-api/users").then(n,s)},u.GetById=function(e){return r.get("/tms-api/users/"+e).then(n,s)},u.GetByUsername=function(e){return r.get("/tms-api/users/"+e).then(n,s)},u.Create=function(e){return r.post("/tms-api/users",e).then(n,s)},u.Update=function(e){return r.put("/tms-api/users/"+e.userId,e).then(n,s)},u.Register=function(e){return r.post("/tms-api/users/register",e).then(n,s)},u.ValidateCompany=function(e){return r.get("/tms-api/users/validatecompany/"+e).then(n,s)},u.ValidateUser=function(e){return r.get("/tms-api/users/validateuser/"+e).then(n,s)},u.UpdatePassword=function(e){return console.log("user",e),r.post("/tms-api/users/updatepassword",e).then(n,s)},u.FetchProvider=function(e){return r.get("/tms-api/users/provider/"+e).then(n,s)},u.currentUser=this.currentUser,u.ForgotPassword=function(e){return r.post("/tms-api/users/forgotPassword",e).then(n,n)},u.getTaggableUsers=function(){return r.get("/tms-api/conversation/getUsers/"+u.currentUser.partnerCd,{headers:{"x-openport-token":u.currentUser.token.accessToken}}).then(n,s)},u.getSystemUser=function(){return r.get("/tms-api/users/systemuser").then(n,s)},u.storeCurrentUser=function(){t.localStorage.setItem("currentUser",JSON.stringify(u.currentUser))},u.loadCurrentUser=function(){var e=t.localStorage.getItem("currentUser");u.currentUser=e?JSON.parse(e):{},console.log(u.currentUser)},u.resetCurrentUser=function(){t.localStorage.removeItem("currentUser")},u.hasRole=function(e){if(o())for(var r=u.currentUser.roles,t=0;t<e.length;t++){var n,s=e[t];for(n in r)if(r[n].role.toUpperCase()===s.toUpperCase())return!0}return!1},u.isLoggedIn=o,u.isSuperAdmin=function(e){return void 0!==e&&e.isSuperAdmin||!1},u}angular.module("app").factory("UserService",e),e.$inject=["$http","$window"]}();
!function(){"use strict";function e(r,t){var e={CreateProfile:function(e){return r.post("/market-api/truckers/profile",e).then(n,i("Error Carrier profile"))},GetCountry:function(){return r.get("/market-api/truckers").then(n,i("Error country list "))},CreateCompanyAddress:function(e){return r.post("/market-api/truckers/upsertcompanyaddress",e).then(n,i("Error shipper address update "))},GetCompany:function(e){return r.get("/market-api/truckers/company/"+e).then(n,i("Error shipper address update "))},GetDocumentType:function(){return r.get("/market-api/truckers/documents/documentId","").then(n,i("Error getting document type"))},GetClients:function(e){return r.get("/market-api/truckers/clients/"+e).then(n,i("Error getting clients"))},DeleteClient:function(e){return r.post("/market-api/truckers/client/"+e).then(n,i("Error Carrier profile"))},DeleteDocument:function(e){return r.post("/market-api/truckers/document/"+e).then(n,i("Error Deleting Document ID:"+e))},DeleteCompanyEquipment:function(e){return r.post("/market-api/truckers/asset/"+e).then(n,i("Error Deleting Company ID:"+e))},GetCompanyUser:function(e){return r.get("/market-api/truckers/companyuser/"+e).then(n,i("Error getting clients"))},GetLanguages:function(){return r.get("/market-api/truckers/languages","").then(n,i("Error getting document type"))},AddCompanyUser:function(e){return t.debug("Add usersis:",e),r.post("/market-api/truckers/companyusers",e).then(n,i("Error Creating user"))},GetServiceArea:function(e){return r.get("/market-api/truckers/regions/"+e).then(n,i("Error getting document type"))},GetEquipmentTypes:function(){return r.get("/market-api/truckers/equipmenttypes/equipmentId","").then(n,i("Error getting document type"))},CreateCompanyEquipment:function(e){return t.debug("Equipment",e),r.post("/market-api/truckers/equipment",e).then(n,i("Error Carrier profile"))},UpdateCompanyEquipmentOnly:function(e){return r.post("/market-api/truckers/updatecompanyequipmentonly",e).then(n,i("Error Company Equipment"))},CreateService:function(e){return r.post("/market-api/truckers/insertservice",e).then(n,i("Error Creating service"))},UpdateCompanyUser:function(e){return r.post("/market-api/truckers/updatecompanyuser",e).then(n,i("Error Company User"))},InsertCompanyUser:function(e){return r.post("/market-api/truckers/insertcompanyuser",e).then(n,i("Error Company Equipment"))},GetCompanyAddress:function(e){return r.get("/market-api/truckers/companyAddress/"+e).then(n,i("Error fetching corporate address:"+e))},InsertCompanyAddress:function(e){return r.post("/market-api/truckers/insertcompanyaddress",e).then(n,i("Error Creating service"))},UpdateCompanyAddress:function(e){return r.post("/market-api/truckers/updatecompanyaddress",e).then(n,i("Error Creating service"))},GetCompanyServices:function(e){return r.get("/market-api/truckers/currentservices/"+e).then(n,i("Error fetching company services:"+e))},GetCompanyServiceArea:function(e){return r.get("/market-api/truckers/currentservicearea/"+e).then(n,i("Error fetching company services:"+e))},GetCompanyEquipment:function(e){return r.get("/market-api/truckers/currentequipment/"+e).then(n,i("Error fetching company services:"+e))},InsertCompanyServices:function(e){return r.post("/market-api/truckers/insertcompanyservices",e).then(n,i("Error Creating service"))},InsertCompanyServiceArea:function(e){return r.post("/market-api/truckers/insertcompanyservicearea",e).then(n,i("Error Creating service"))},GetCompanyProfile:function(e){return r.get("/market-api/truckers/profiles/"+e).then(n,i("Error fetching Company ID:"+e))},CreateFileDocumentType:function(e){return r.post("/market-api/truckers/createfiledocumenttype",e).then(n,i("Error File Document Type"))},CreateCompanyProfile:function(e){return r.post("/market-api/truckers/companyprofile",e).then(n,i("Error Carrier profile"))},CreateCompanyServiceAreas:function(e){return r.post("/market-api/truckers/serviceareas",e).then(n,i("Error Creating service"))},DeleteCompanyServiceAreas:function(e){return r.post("/market-api/truckers/deleteserviceareas",e).then(n,i("Error Creating service"))},GetPhotos:function(e){return r.get("/market-api/truckers/photos/"+e).then(n,i("Error fetching photos:"+e))},SetServiceAreas:function(e){return r.post("/market-api/truckers/setserviceareas",e).then(n,i("Error Creating service"))},SetServices:function(e){return r.post("/market-api/truckers/setservices",e).then(n,i("Error Creating service"))},GetServices:function(e){return console.log("Company",e),r.get("/market-api/truckers/transportservices/"+e).then(n,i("Error getting document type"))}};return e;function n(e){return e.data}function i(e){return function(){return{success:!1,message:e}}}}angular.module("app").factory("CarrierService",e),e.$inject=["$http","$log"]}();
!function(){"use strict";function r(u){var r={CreateCompany:function(r){return u.post("/market-api/shippers/upsertcompany",r).then(h,l("Error CreateCompany"))},CreateCompanyAddress:function(r){return u.post("/market-api/shippers/upsertcompanyaddress",r).then(h,l("Error CreateCompanyAddress "))},CreateCompanyClient:function(r){return u.post("/market-api/shippers/upsertcompanyclient/",r).then(h,l("Error CreateCompanyClient "))},GetCountry:function(){return u.get("/market-api/shippers/country").then(h,l("Error GetCountry "))},GetStatus:function(){return u.get("/market-api/shippers/status").then(h,l("Error GetStatus"))},GetCompanyById:function(r){return u.get("/market-api/shippers/"+r).then(h,l("Error GetCompanyById "))},UpdateCompanyBranchAddress:function(r){return u.post("/market-api/shippers/updatecmpnybranch",r).then(h,l("Error UpdateCompanyBranchAddress "))},CreateCompanyBranchAddress:function(r){return u.post("/market-api/shippers/createcmpnybranch",r).then(h,l("Error CreateCompanyBranchAddress "))},DeleteCompanyBranchAddress:function(r){return u.post("/market-api/shippers/deletecmpnybranch",r).then(h,l("Error DeleteCompanyBranchAddress "))},UpdateWizardStepNbr:function(r){return u.post("/market-api/shippers/updatewizardstepnbr",r).then(h,l("Error UpdateWizardStepNbr "))},GetShipmentByCompanyById:function(r){return u.get("/market-api/shippers/shipments/"+r).then(h,l("Error GetShipmentByCompanyById"))},GetShipmentsByLocation:function(r){return u.get("/market-api/shippers/shipmentsrch",r).then(h,l("Error GetShipmentsByLocation "))},GetShipmentsByLocations:function(r,e,t,n,a,p,i){null!=r&&""!=r||(r="all");null!=e&&""!=e||(e="all");null!=t&&""!=t||(t="all");null!=n&&""!=n||(n="all");null!=a&&""!=a||(a="all");null!=p&&""!=p||(p="all");return u.get("/market-api/shippers/shipmentsearch/"+r+"/"+e+"/"+t+"/"+n+"/"+a+"/"+p+"/"+i).then(h,l("Error GetShipmentsByLocations "))},UpdateShipmentTenderTerminationDate:function(r){return u.post("/market-api/shippers/updateshipmentbidenddate",r).then(h,l("Error UpdateShipmentTenderTerminationDate "))},InsertCarrierBid:function(r){return u.post("/market-api/shippers/insertcarrierbid",r).then(h,l("Error insert carrier bid "))},GetShipmentsForBid:function(r){return u.get("/market-api/shippers/shipmentsforbid/"+r).then(h,l("Error GetShipmentsForBid"))},GetShipmentsForBidByLocations:function(r,e,t,n,a,p,i){null!=r&&""!=r||(r="all");null!=e&&""!=e||(e="all");null!=t&&""!=t||(t="all");null!=n&&""!=n||(n="all");null!=a&&""!=a||(a="all");null!=p&&""!=p||(p="all");return u.get("/market-api/shippers/shipmentforbidsearch/"+r+"/"+e+"/"+t+"/"+n+"/"+a+"/"+p+"/"+i).then(h,l("Error GetShipmentsForBidByLocations "))},GetShipmentCarrierBids:function(r){return u.get("/market-api/shippers/shipmentcarrierbid/"+r).then(h,l("Error GetShipmentCarrierBids "))},BookShipment:function(r){return u.post("/market-api/shippers/bookshipment/",r).then(h,l("Error BookShipment "))},GetShipmentPairsForBidByLocations:function(r,e,t,n,a,p,i,s,o){null!=r&&""!=r||(r="all");null!=e&&""!=e||(e="all");null!=t&&""!=t||(t="all");null!=n&&""!=n||(n="all");null!=a&&""!=a||(a="all");null!=p&&""!=p||(p="all");null!=i&&""!=i||(i="all");null!=s&&""!=s||(s="all");return u.get("/market-api/shippers/shipmentpairforbidsearch/"+r+"/"+e+"/"+t+"/"+n+"/"+a+"/"+p+"/"+i+"/"+s+"/"+o).then(h,l("Error GetShipmentPairsForBidByLocations "))},DoNothing:function(r){return u.post("/market-api/shippers/donothing",r).then(h,l("Error DoNothing "))},Create:function(r){return u.post("/market-api/shippers",r).then(h,l("Error Create "))},Upsert:function(r){return u.post("/market-api/shippers/upsert",r).then(h,l("Error Upsert company "))},Generate:function(r,e){return u.post("/market-api/shippers/create",r,e).then(h,l("Error Generate company "))}};return r;function h(r){return r.data}function l(r){return function(){return{success:!1,message:r}}}}angular.module("app").factory("ShipperService",r),r.$inject=["$http"]}();
!function(){"use strict";function e(i){var e={GetAllServiceAreas:function(){return i.get("/market-api/serviceAreas/allServiceAreas").then(a,n("Error getting all service areas"))},GetAllCarriersForServiceArea:function(e){return i.get("/market-api/serviceAreas/area/"+e).then(a,n("Error getting carriers for service area"))},getCarrierServiceAreas:function(e){return i.get("/market-api/serviceAreas/"+e).then(a,n("Error getting carriers for service area"))},GetAllCarriersForServiceAreaAndService:function(e,r,t){e={areaList:e,serviceList:r,equipmentList:t};return i.post("/market-api/serviceAreas/area/search",e).then(a,n("Error getting carriers for service area"))},GetAllServices:function(){return i.get("/market-api/serviceAreas/services").then(a,n("Error getting all services"))},GetAllServiceAreasForDropDownList:function(){return i.get("/market-api/serviceAreas/areasDDL").then(a,n("Error getting all for DDL service areas"))},GetAllServicesForDropDownList:function(){return i.get("/market-api/serviceAreas/servicesDDL").then(a,n("Error getting all for DDL service areas"))},GetAllEquipmentTypesForDropDownList:function(){return i.get("/market-api/serviceAreas/equipmentTypesDDL").then(a,n("Error getting all for DDL Equipment Types"))},GetCarrierView:function(e){return i.get("/market-api/serviceAreas/carrierView/"+e).then(a,n("Error getting carrier quick view"))}};return e;function a(e){return e.data}function n(e){return function(){return{success:!1,message:e}}}}angular.module("app").factory("CarrierServicesService",e),e.$inject=["$http"]}();
!function(){"use strict";function e(n){var e={ValidateShipment:function(e){return n.get("/market-api/shipmentTenders/shipmentsearch/"+e.shipmentNbr+"/"+e.shipperId).then(i,s("Error fetching company services:"))},GetCountry:function(){return n.get("/market-api/shipmentTenders/country").then(i,s("Error fetching Country"))},GetEquipment:function(){return n.get("/market-api/shipmentTenders/equipmentType").then(i,s("Error fetching Equipment"))},GetServices:function(){return n.get("/market-api/shipmentTenders/services").then(i,s("Error fetching services"))},GetUom:function(){return n.get("/market-api/shipmentTenders/uom").then(i,s("Error fetching uom"))},CreateShipment:function(e){return console.log("sending to Market API...",e),n.post("/market-api/shipmentTenders/createOrder",e).then(i,s("Error Creating shipment"))},GetPaymentTerm:function(){return n.get("/market-api/shipmentTenders/paymentterm").then(i,s("Error fetching payment term"))},GetCurrency:function(){return n.get("/market-api/shipmentTenders/currency").then(i,s("Error fetching currency"))},GetRateShop:function(e,t){return n.get("/market-api/shipmentTenders/rateshop/"+e+"/"+t).then(i,s("Error shop rate"))},SearchAddress:function(e,t,r){return n.get("/market-api/shipmentTenders/address/"+e+"/"+t+"/"+r).then(i,s("Error fetching search address"))},GetCompanyCountry:function(e){return n.get("/market-api/shipmentTenders/compCountry/"+e).then(i,s("Error companyAddress Country"))},GetDates:function(){return console.log("get dates..."),n.get("/market-api/shipmentTenders/formatdate").then(i,s("Error dates"))}};return e;function i(e){return e.data}function s(e){return function(){return{success:!1,message:e}}}}angular.module("app").factory("ShipmentTendersService",e),e.$inject=["$http"]}();
!function(){"use strict";function t(r,t){var e={GetShipments:function(t){return r.post("/tms-api/dispatcher/referenceshipment",t).then(i,a("Error shipments"))},GetShipmentByDriverModuleDt:function(t){return r.get("/tms-api/dispatcher/shipmentdriver/"+t.provider+"/"+t.from+"/"+t.mobileId+"/"+t.module).then(i,a("Error shipments"))},GetPendingShipmentByModuleDt:function(t){return r.get("/tms-api/dispatcher/shipmentpending/"+t.provider+"/"+t.from+"/"+t.module+"/"+t.mobileId).then(i,a("Error shipments"))},GetMultipleShipment:function(t){return r.post("/tms-api/dispatcher/multipleshipment",t).then(i,a("Error creating shipment"))},GetDriverByProvider:function(t){return r.get("/tms-api/dispatcher/driver/"+t).then(i,a("Error driver"))},AssignLoad:function(t){return r.post("/tms-api/dispatcher/assign",t).then(i,a("Error assigning shipments"))},UnAssignLoad:function(t){return r.post("/tms-api/dispatcher/unassign",t).then(i,a("Error assigning shipments"))},UnAssignSequence:function(t){return r.post("/tms-api/dispatcher/unassignedsequence",t).then(i,a("Error assigning shipments"))},OrderLoad:function(t){return r.post("/tms-api/dispatcher/ordersequence",t).then(i,a("Error assigning shipments"))},DeclineLoad:function(t){return r.post("/tms-api/dispatcher/decline",t).then(i,a("Error declining shipments"))},GetAssets:function(t){return r.get("/tms-api/dispatcher/asset/"+t).then(i,a("Error fetching assets"))},GetAssetById:function(t){return r.get("/tms-api/dispatcher/assetId/"+t).then(i,a("Error fetching assets"))},GetAssetByName:function(t){return r.post("/tms-api/dispatcher/assetname",t).then(i,a("Error fetching assets"))},GetAssetType:function(){return r.get("/tms-api/dispatcher/assettype").then(i,a("Error fetching asset type"))},GetAssetStatus:function(){return r.get("/tms-api/dispatcher/assetstatus").then(i,a("Error fetching asset status"))},NewAsset:function(t){return r.post("/tms-api/dispatcher/newasset",t).then(i,a("Error creating new asset"))},GetTimezone:function(){return r.get("/tms-api/dispatcher/tz").then(i,a("Error fetching timezone"))},TrackShipment:function(t){return console.log("probill",t),r.get("/tms-api/dispatcher/track/"+t.proBillNbr+"/"+t.defaultTimezone.replace("/","-")+"/"+t.currentTimezone.replace("/","-")+"/"+t.picturePath+"/"+t.dataStagingThreshold).then(i,a("Error fetching asset type"))},CreateDocument:function(t){return r.post("/tms-api/dispatcher/document",t).then(i,a("Error creating document"))},GetTags:function(){return r.get("/tms-api/dispatcher/tag").then(i,a("Error fetching tag"))},GetReasons:function(){return r.get("/tms-api/dispatcher/reasons").then(i,a("Error fetching reasons"))},UpdateShipment:function(t){return r.post("/tms-api/dispatcher/update",t).then(i,a("Error creating shipment"))},FetchPurchaseOrder:function(t,e){return r.get("/tms-api/dispatcher/podetails/"+e+"/"+t).then(i,a("Error fetching assets"))},ListCountries:function(){return r.get("/tms-api/dispatcher/countries").then(i,a("Error fetching countries"))},CreateRelay:function(t){return console.log("sending",t),r.post("/tms-api/dispatcher/createRelay",t).then(i,a("Error creating shipment"))},UpdateShipmentAssetId:function(t){return r.post("/tms-api/dispatcher/updateassetid",t).then(i,a("Error creating shipment"))},GetConsolidatedLoads:function(t){return r.get("/tms-api/tms/vpos/"+t).then(i,a("Error fetching assets"))},PreviewRoute:function(t){return console.log("passing routes",t),r.post("/tms-api/route/save",t).then(i,a("Error preview route"))},ViewPkBol:function(t){return console.log("sending",t),r.post("/tms-api/dispatcher/pkbol",t).then(i,a("Error creating shipment"))},SaveActivity:function(t){return r.post("/tms-api/dispatcher/track/save",t,n()).then(i,a("Error saving activity"))},GetLocationByRecipient:function(t){return r.get("/tms-api/dispatcher/location?name="+t).then(i,a("Error retrieving locations"))},GetLocationById:function(t){return r.get("/tms-api/dispatcher/location?id="+t).then(i,a("Error retrieving locations"))},SaveShipmentByProperty:function(t){return r.post("/tms-api/dispatcher/podetails/save",t,n()).then(i,a("Error creating shipment"))},SaveShipmentNewLocation:function(t){return r.post("/tms-api/dispatcher/location/new",t,n()).then(i,a("Error creating address"))},SaveShipmentStatus:function(t){return r.post("/tms-api/dispatcher/track/shipment/save",t,n()).then(i,a("Error saving shipment status"))},SaveInstruction:function(t){return r.post("/tms-api/dispatcher/poinstruction/update",t,n()).then(i,a("Error updating shipment comment"))},SaveNewLeg:function(t){return r.post("/tms-api/dispatcher/shipment/save",t,n()).then(i,a("Error creating shipment"))},DeleteLeg:function(t){return r.post("/tms-api/dispatcher/shipment/delete",t,n()).then(i,a("Error creating shipment"))},dsqlGetAssets:function(t){t={query:{"assets@dispatcher:fetch-assets":{param:{code:t}}}};return r.post("/dsql/api",t,s()).then(i,a("Error fetching assets"))},dsqlGetServiceAreas:function(t){t={query:{"serviceAreas@dispatcher:fetch-service-area-by-partner-code":{param:{code:t}}}};return r.post("/dsql/api",t,s()).then(i,a("Error fetching service areas"))},dsqlSaveAsset:function(t){t={mutation:{"assets@dispatcher:save-asset":{param:{id:t.id,code:t.code,assetNumber:t.number,assetType:t.type,assetStatus:t.status,serviceArea:t.serviceArea}}}};return r.post("/dsql/api",t,s()).then(i,a("Error saving asset"))},SaveShipmentLineItem:function(t){return r.post("/tms-api/dispatcher/podetaillineitem/save",t).then(i,a("Error saving shipment line item"))},SaveShipmentLocation:function(t){return r.post("/tms-api/dispatcher/location/update",t,n()).then(i,a("Error creating address"))}};return e;function n(){return{headers:{"x-openport-token":t.currentUser.token.accessToken}}}function s(){return{headers:{Authorization:"Bearer "+t.currentUser.oauth.access_token,"app-code":"OPT_DEFAULT"}}}function i(t){return t.data}function a(t){return function(){return{success:!1,message:t}}}}angular.module("app").factory("DispatcherService",t),t.$inject=["$http","UserService"]}();
!function(){"use strict";function r(t,r){var n={headers:{"x-openport-token":r.currentUser.token.accessToken}},r={ListPaymentTypes:function(){return t.get("/tms-api/dispatcher/paymentTypes",n).then(i,s("Error fetching payment types"))},ListDrivers:function(r,e){return t.get("/tms-api/dispatcher/drivers/"+r+"/"+e,n).then(i,s("Error fetching drivers"))},FetchPhone:function(r){return t.get("/tms-api/dispatcher/phoneNbr/"+r.phoneNbr+"/"+r.providerId,n).then(i,s("Error fetching phone"))},GetDriverShipment:function(r){return t.get("/tms-api/dispatcher/drivershipment/"+r.providerId+"/"+r.mobileUserId,n).then(i,s("Error fetching shipment"))},ManageDriver:function(r){return t.post("/tms-api/dispatcher/manageByDriver",r,n).then(i,s("Error managing driver"))},approveDriver:function(r){return t.get("/tms-api/dispatcher/driver/approve/"+r.providerId+"/"+r.mobileUserId,n).then(i,s("Error approving registration driver"))},declineDriver:function(r){return t.get("/tms-api/dispatcher/driver/decline/"+r.providerId+"/"+r.mobileUserId,n).then(i,s("Error declining registration driver"))},getCurrencyList:function(){return t.get("/tms-api/dispatcher/currencyList",n).then(i,s("Error fetching currency list"))}};return r;function i(r){return r.data}function s(r){return function(){return{success:!1,message:r}}}}angular.module("app").factory("RegistrationService",r),r.$inject=["$http","UserService"]}();
!function(){"use strict";function r(e){var r={ValidateOrder:function(r){return e.get("/tms-api/dispatcher/orders/"+r.provider+"/"+r.referenceNbr).then(t,n("Error fetching orders"))},FetchOrder:function(r){return e.post("/tms-api/dispatcher/fetchorders",r).then(t,n("Error fetching orders"))},ListCountries:function(){return e.get("/tms-api/dispatcher/countries").then(t,n("Error fetching countries"))},ListUom:function(r){return e.get("/tms-api/dispatcher/uom/"+r.parent+"/"+r.partner).then(t,n("Error fetching countries"))},CreateOrder:function(r){return console.log("sending",r),e.post("/tms-api/dispatcher/createOrder",r).then(t,n("Error creating shipment"))},GetAddress:function(r){return e.get("/tms-api/dispatcher/address/"+r).then(t,n("Error fetching countries"))},GetAddresses:function(r){return e.get("/tms-api/dispatcher/addresses/"+r).then(t,n("Error fetching countries"))}};return r;function t(r){return r.data}function n(r){return function(){return{success:!1,message:r}}}}angular.module("app").factory("OrdersService",r),r.$inject=["$http"]}();
!function(){"use strict";function t(n){var t={};return t.Fetch=function(t){return n.get("/tms-api/dispatcher/affiliation/"+t.parent+"/"+t.application).then(i,function(t){return function(){return{success:!1,message:t}}}("Error fetching Affiliation"))},t;function i(t){return t.data}}angular.module("app").factory("AffiliationService",t),t.$inject=["$http"]}();
!function(){"use strict";function t(n){var t={GetConsolidatedLoads:function(t){return n.get("/tms-api/tms/vpos/"+t).then(e,r("Error fetching assets"))},GetAvailableLoads:function(t){return n.get("/tms-api/tms/shipment/"+t).then(e,r("Error fetching assets"))}};return t;function e(t){return t.data}function r(t){return function(){return{success:!1,message:t}}}}angular.module("app").factory("ConsolidatorService",t),t.$inject=["$http"]}();
!function(){"use strict";function t(t){var e={};return e.get=function(){return t.get("https://rss2json.com/api.json?rss_url=https://openport.com/feed/").then(n,function(t){return function(){return{success:!1,message:t}}}("Error fetching asset type"))},e}function n(t){return t.data.items}angular.module("app").factory("FeedLoaderService",t),t.$inject=["$http"]}();
!function(){"use strict";function r(e,r){var t={ApproveUser:function(r){return e.post("/tms-api/users/approver",r).then(s,i("Error fetching Approver"))},EditUser:function(r){return e.post("/tms-api/users/modify",r).then(s,i("Error modifying user"))},ActiveUsers:function(){return e.get("/tms-api/users/activeDispatcherUser",n()).then(s,i("Error fetching Approver"))},PendingUsers:function(){return e.get("/tms-api/users/pendingDispatcherUser",n()).then(s,i("Error fetching Approver"))}};return t;function n(){return{headers:{"x-openport-token":r.currentUser.token.accessToken}}}function s(r){return r.data}function i(r){return function(){return{success:!1,message:r}}}}angular.module("app").factory("ApproverService",r),r.$inject=["$http","UserService"]}();
!function(){"use strict";function e(r){var e={GetDataSources:function(e){return console.log("fields for data source",e),r.get("/tms-api/reportwizard/datasources/"+e.parent+"/"+e.partner).then(t,n("Error fetching asset type"))},GetAvailableSources:function(e){return r.get("/tms-api/reportwizard/availablesources/"+e.sourcename+"/"+e.userId).then(t,n("Error fetching asset type"))},GetAvailableColumns:function(e){return r.get("/tms-api/reportwizard/availablecolumns/"+e).then(t,n("Error fetching asset type"))},RunReport:function(e){return r.post("/tms-api/reportwizard/runreport",e).then(t,n("Error running the report"))},DeleteReport:function(e){return r.post("/tms-api/reportwizard/deletereport",e).then(t,n("Error running the delete report"))},DeleteSchedule:function(e){return r.post("/tms-api/reportwizard/deleteschedule",e).then(t,n("Error running the delete schedule"))},GetGmt:function(){return r.get("/tms-api/reportwizard/gmt").then(t,n("Error fetching Gmt"))}};return e;function t(e){return e.data}function n(e){return function(){return{success:!1,message:e}}}}angular.module("app").factory("ReportWizardService",e),e.$inject=["$http"]}();
!function(){"use strict";function t(e){var t={FetchInvoice:function(t){return e.get("/tms-api/invoice/report/"+t.chargeType+"/"+t.affiliation+"/"+t.from+"/"+t.end+"/"+t.batchNbr).then(r,n("Error fetching asset type"))},ExportInvoice:function(t){return e.post("/tms-api/invoice/exportreport",t).then(r,n("Error exporting models"))},InvoiceCharge:function(t){return e.post("/tms-api/invoice/invoicecharge",t).then(r,n("Error exporting charges"))}};return t;function r(t){return t.data}function n(t){return function(){return{success:!1,message:t}}}}angular.module("app").factory("GLService",t),t.$inject=["$http"]}();
!function(){"use strict";angular.module("app").factory("GoogleAnalyticsService",["$http",function(t){var r={getTrackingId:function(n){return t.get("/tms-api/analytics/ga/tracking",{params:{host:n}}).then(r.handleSuccess,r.handleError("Error getting data"))},handleSuccess:function(n){return n.data},handleError:function(n){return function(){return{success:!1,message:n}}}};return r}])}();
!function(){"use strict";function r(t,n){function i(){return{headers:{"x-openport-token":n.currentUser.token.accessToken}}}function a(r){return r.data}function o(r){return function(){return{success:!1,message:r}}}function r(r){var e,t=n.currentUser.roles;for(e in t)if(t[e].role.toUpperCase()===r.toUpperCase())return!0;return!1}return{getDriverList:function(r){r=n.currentUser.provider.scacCd;return t.get("/tms-api/rewards/getDriverList/"+r,i()).then(a,o("Error getting Driver list"))},getDriverPending:function(r){var e=n.currentUser.provider.scacCd;return t.get("/tms-api/rewards/getDriverRewards/"+r+"/"+e,i()).then(a,o("Error getting Driver pending list"))},approveAll:function(r){return t.put("/tms-api/rewards/approveAllReward",r,i()).then(a,o("Error approving all rewards"))},approve:function(r){return t.put("/tms-api/rewards/approveReward",{userPointId:r},i()).then(a,o("Error approving reward"))},reject:function(r){return t.put("/tms-api/rewards/rejectReward",{userPointId:r},i()).then(a,o("Error approving reward"))},pay:function(r){return t.put("/tms-api/rewards/payReward",{mobileId:r},i()).then(a,o("Error paying reward"))},isApproving:function(){return r("TMS_DISPATCHER")||r("TMS_REWARDS")},isPaying:function(){return r("TMS_INVOICE")}}}angular.module("app").factory("RewardService",r),r.$inject=["$http","UserService"]}();
!function(){"use strict";function e(n,i){function p(){return{headers:{"x-openport-token":i.currentUser.token.accessToken}}}function o(e){return e.data}function s(e){return function(){return{success:!1,message:e}}}function e(e){var t,r=i.currentUser.roles;for(t in r)if(r[t].role.toUpperCase()===e.toUpperCase())return!0;return!1}return{getDriverList:function(){return n.get("/tms-api/epodreview/getDrivers/"+i.currentUser.partnerCd,p()).then(o,s("Error getting Driver list"))},getShipmentList:function(e){return n.get("/tms-api/epodreview/getShipments/"+i.currentUser.partnerCd+e,p()).then(o,s("Error getting Shipment list"))},fetchEpodReportData:function(e){e={params:{criteria:e.criteria,startDt:e.startDt,endDt:e.endDt,shipper:e.shipper,reference:e.reference,partner:i.currentUser.partnerCd}};return console.log(e),n.get("/tms-api/epod/fetchData",e,p()).then(o,s("Error getting Shipment list"))},createSingleReport:function(e){return n.post("/tms-api/epod/single/"+i.currentUser.partnerCd,e,p()).then(o,s("Error creating single epod report"))},createMultipleReport:function(e){return n.post("/tms-api/epod/multiple/"+i.currentUser.partnerCd,e,p()).then(o,s("Error creating multiple report"))},getShipmentEpod:function(e){return n.get("/tms-api/epodreview/getEpodsByShipmentId?shipmentId="+e,p()).then(o,s("Error getting Shipment Epod list"))},getShipmentEpodByEvent:function(e,t,r){return n.get("/tms-api/epodreview/getEpodsByShipmentId?shipmentId="+e+"&event="+t+"&eventDesc="+r,p()).then(o,s("Error getting Shipment Epod list"))},createSingleReportByShipment:function(e){return n.get("/tms-api/epod/shipment/"+e,p()).then(o)},approve:function(e){return n.post("/tms-api/epodreview/postEpodReview",{epod:[{shipmentUserFileId:e,status:"APPROVED"}]},p()).then(o,s("Error approving reward"))},reject:function(e){return n.post("/tms-api/epodreview/postEpodReview",{epod:[{shipmentUserFileId:e,status:"REJECTED"}]},p()).then(o,s("Error approving reward"))},reset:function(e){return n.post("/tms-api/epodreview/postEpodReview",{epod:[{shipmentUserFileId:e,status:"PENDING"}]},p()).then(o,s("Error paying reward"))},isAdmin:function(){return e("TMS_ADMIN")},isDispatcher:function(){return e("TMS_DISPATCHER")}}}angular.module("app").factory("EpodReviewService",e),e.$inject=["$http","UserService"]}();
!function(){"use strict";function e(e,t){function r(e){return e.data}return{getDataloaderOptions:function(){return e.get("/tms-api/dataloader/options/"+t.currentUser.parentPartnerCd+"/"+t.currentUser.partnerCd,{headers:{"x-openport-token":t.currentUser.token.accessToken}}).then(r,function(e){return function(){return{success:!1,message:e}}}("Error getting Dataloader options"))}}}angular.module("app").factory("DataloaderService",e),e.$inject=["$http","UserService"]}();
!function(){"use strict";function e(o,n){function c(){return{headers:{"x-openport-token":n.currentUser.token.accessToken}}}function i(e){return e.data}function a(e){return function(){return{success:!1,message:e}}}return{getInvoiceTransactionsByFbrid:function(e){return o.get("/tms-api/invoice/freight-billing/get-invoice-transactions/"+e+"/"+n.currentUser.partnerCd,c()).then(i,a("Error getting Invoice-transactions list by invoice #"))},getUserShippers:function(){return o.get("/tms-api/users/getShippers/"+n.currentUser.partnerCd,c()).then(i,a("Error getting User Shipper list"))},getInvoiceByShipperCd:function(e,r,t){return o.get("/tms-api/invoice/freight-billing/get-invoices/R/"+n.currentUser.partnerCd+"/"+r+"/"+t+"/"+e,c()).then(i,a("Error getting Invoice list by shipperCd"))},getInvoiceByInvoiceNbr:function(e){return o.get("/tms-api/invoice/freight-billing/get-invoices/"+e+"/"+n.currentUser.partnerCd,c()).then(i,a("Error getting Invoice list by invoice #"))},getInvoiceByColumn:function(e){return o.post("/tms-api/invoice/freight-billing/get-invoices-by-column/R/"+n.currentUser.partnerCd,e,c()).then(i,a("Error multiple fetch Invoice list by "+e.valueString))},getHeadersByBillerCd:function(){return o.get("/tms-api/invoice/freight-billing/headers/"+n.currentUser.partnerCd,c()).then(i,a("Error getting headers by biller_cd"))},getHeaderIdByHeaders:function(e){var r="undefined"!==e.drNbr?"drNbr="+e.drNbr:"";return r=(r=(r+="undefined"!==e.poNbr?("undefined"!=r&&0<r.length?"&":"")+"poNbr="+e.poNbr:"")+("undefined"!==e.oscaPwdNbr?("undefined"!=r&&0<r.length?"&":"")+"oscaPwdNbr="+e.oscaPwdNbr:""))+("undefined"!==e.taxIdNbr?("undefined"!=r&&0<r.length?"&":"")+"taxIdNbr="+e.taxIdNbr:""),o.get("/tms-api/invoice/freight-billing/header-id/"+n.currentUser.partnerCd+("undefined"!=r&&0<r.length?"?"+r:""),c()).then(i,a("Error getting header id by headers"))},saveInvoiceCharges:function(e){return o.post("/tms-api/invoice/invoicecharge",e,c()).then(i,a("Error saving invoice charges"))},deleteInvoiceCharges:function(e){return o.post("/tms-api/invoice/deleteinvoicecharge",e,c()).then(i,a("Error deleting invoice charges"))},checkIfTinExist:function(e){return o.get("/tms-api/invoice/freight-billing/get-tax-id-nbr/"+n.currentUser.partnerCd,c()).then(i,a("Error in retrieving user TIN"))},checkIfInvoiceNbrExist:function(e){return o.get("/tms-api/invoice/freight-billing/report-invoice-nbr-exists/"+e,c()).then(i,a("Error checking if Invoice # exist"))},generateReport:function(e){return e.affiliation=n.currentUser.partnerCd,o.post("/tms-api/invoice/freight-billing/generate-report",e,c()).then(i,a("Error in downloading report"))},downloadFile:function(e){location.href="/tms-api/invoice/freight-billing/download-report-pdf/"+e+"/"+n.currentUser.partnerCd+"?t="+c().headers["x-openport-token"]},deleteReport:function(e){return e.affiliation=n.currentUser.partnerCd,o.post("/tms-api/invoice/freight-billing/delete-report",e,c()).then(i,a("Error in deleting report"))},getProvidersByBillerCd:function(){return o.get("/tms-api/invoice/freight-billing/providers/"+n.currentUser.partnerCd,c()).then(i,a("Error getting providers by biller_cd"))},getDefaultInvoiceHeaderEmailReceivers:function(e,r,t,n){var i=c();return i.headers.parameterCd="",i.headers.parameterName="",i.headers.programId="",i.headers.providerCd="",i.headers.parameterCd=e,i.headers.parameterName=r,i.headers.programId=t,i.headers.providerCd=n,o.get("/tms-api/email/invoiceheader/default/emailreceivers",i)},getInvoiceAttachmentList:function(e){return o.get("/tms-api/invoice/freight-billing/get-attachment-list/"+e,c()).then(i,a("Error getting invoice attachment list"))},deleteInvoiceAttachment:function(e,r){return o.delete("/tms-api/invoice/freight-billing/invoice-attachment/"+e+"/"+r,c()).then(i,a("Error deleting invoice attachment"))},downloadAttachment:function(i){var e=JSON.parse(JSON.stringify(c()));return e.responseType="blob",o.get("/tms-api/invoice/freight-billing/invoice-attachment/"+i.fbrId+"/"+i.uuid,e).then(function(e){var r=e.headers(),e=new Blob([e.data],{type:r["content-type"]}),r=window.URL||window.webkitURL,t=r.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=i.fileName,document.body.appendChild(n),n.click(),r.revokeObjectURL(e)}).catch(function(){a("Error in downloading attachment")})},deleteAllInvoiceAttachment:function(e){return o.delete("/tms-api/invoice/freight-billing/invoice-attachment/"+e,c()).then(i,a("Error deleting invoice attachment"))}}}angular.module("app").factory("InvoiceService",e),e.$inject=["$http","UserService"]}();
!function(){"use strict";function t(o,a){function s(){return{headers:{"x-openport-token":a.currentUser.token.accessToken}}}return{getShipmentList:function(t){return o.get("/tms-api/liquidity/shipment/"+t,s())},getAttachmentList:function(t){return o.get("/tms-api/liquidity/attachment/"+t,s())},deleteAttachment:function(t,e){return o.delete("/tms-api/liquidity/attachment/"+t+"/"+e,s())},downloadAttachment:function(t,r){var e=JSON.parse(JSON.stringify(s()));return e.responseType="blob",o.get("/tms-api/liquidity/attachment/"+t+"/"+r.uuid,e).then(function(t){var e=t.headers(),t=new Blob([t.data],{type:e["content-type"]}),e=window.URL||window.webkitURL,n=e.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=r.fileName,document.body.appendChild(i),i.click(),e.revokeObjectURL(t)}).catch(function(){alert("Error in download")})},getAvailmentList:function(t,e,n){return console.log("reportInvoiceNbr: ",t),o.get("/tms-api/liquidity/getAvailments/"+t+"/"+e+"/"+n,s()).then(r,u("Error getting availment list"))},updateAvailment:function(t,e,n,i){return console.log("availment: ",t),o.post("/tms-api/liquidity/updateAvailment/"+e+"/"+n+"/"+i,t,s()).then(r,u("Error getting availment list"))},insertAvailment:function(t,e,n,i){return console.log("availment: ",t),o.post("/tms-api/liquidity/insertAvailment/"+e+"/"+n+"/"+i,t,s()).then(r,u("Error inserting availment list"))},getTotalInvoiceAmount:function(t){return console.log("reportInvoiceNbr: ",t),o.get("/tms-api/liquidity/getTotalInvoiceAmount/"+t,s()).then(r,u("Error getting availment list"))},getHeaderDetails:function(t){return o.get("/tms-api/liquidity/header/"+t,s())},sendMessage:function(e,n,i,r){return a.getSystemUser().then(function(t){return o.post("/tms-api/conversation/postConversation",{senderUserId:t.userName,recipientList:n,message:r,invoiceNbr:e,publicMessage:i,invoiceType:"FB"},s())})},getMessageList:function(t){return o.get("/tms-api/conversation/getConversation/"+a.currentUser.userName+"/"+t,s()).then(r,u("Error getting message list"))},getUserList:function(){return o.get("/tms-api/conversation/getUsers/"+a.currentUser.partnerCd,s()).then(r,u("Error getting user list"))}};function r(t){return t.data}function u(t){return function(){return{success:!1,message:t}}}}angular.module("app").factory("FbsDetailService",t),t.$inject=["$http","UserService"]}();
!function(){"use strict";function e(n,i,e){function o(){return{headers:{"x-openport-token":i.currentUser.token.accessToken}}}function c(e){return e.data}function u(e){return function(){return{success:!1,message:e}}}return{getUserShippers:function(){return n.get("/tms-api/freightbilling/getShippers/"+i.currentUser.partnerCd,o()).then(c,u("Error getting User Shipper list"))},getInvoiceByShipperCd:function(e,t,r){return n.get("/tms-api/freightbilling/getFreightSummary?carrier="+i.currentUser.partnerCd+"&shipper="+e+"&from="+t+"&to="+r,o()).then(c,u("Error getting Invoice list"))},getInvoiceByInvoiceNbr:function(e){return n.get("/tms-api/freightbilling/getFreightSummary?invoiceNbr="+e,o()).then(c,u("Error getting Invoice list"))},getVendorList:function(){return n.get("/tms-api/freightbilling/getVendorList/"+i.currentUser.partnerCd,o()).then(c,u("Error getting Invoice list"))},generateFreightBillSummaryReport:function(t){var r=e.defer();return setTimeout(function(){var e=document.createElement("a");e.setAttribute("href","/tms-api/invoice/freight-billing/download-report-file/"+t+"/"+i.currentUser.partnerCd+"?t="+o().headers["x-openport-token"]),e.setAttribute("target","_blank"),document.body.appendChild(e),e.click(),e.remove(),r.resolve(!0)}),r.promise}}}angular.module("app").factory("LiquidityPortalService",e),e.$inject=["$http","UserService","$q"]}();
!function(){"use strict";function e(o,n){function a(){return{headers:{"x-openport-token":n.currentUser.token.accessToken}}}function i(e){return e.data}function c(e){return function(){return{success:!1,message:e}}}return{getBillToList:function(){return o.get("/tms-api/invoice/dos/bill-to-party/all/"+n.currentUser.partnerCd,a()).then(i,c("Error in getting bill to party list"))},getAllShipments:function(e,t){return o.get("/tms-api/invoice/dos/shipments/all/G/"+n.currentUser.partnerCd+"/"+e+"/"+t,a()).then(i,c("Error in fetching all shipments."))},getShipmentByBillToParty:function(e,t,r){return o.get("/tms-api/invoice/dos/shipments/bill-to-party/G/"+n.currentUser.partnerCd+"/"+e+"/"+t+"/"+r,a()).then(i,c("Error in fetching shipments by bill to party."))},getShipmentsByColumn:function(e){return o.post("/tms-api/invoice/dos/shipments/column/G/"+n.currentUser.partnerCd,e,a()).then(i,c("Error multiple fetch Invoice list by "+e.valueString))},getInvoiceByInvoiceNbr:function(e){return o.get("/tms-api/invoice/dos/dos-invoice/G/"+n.currentUser.partnerCd+"/"+e,a()).then(i,c("Error getting Invoice by invoice #"))},generateReport:function(e){return e.affiliation=n.currentUser.partnerCd,e.chargeTypeCd="G",o.post("/tms-api/invoice/dos/generate",e,a()).then(i,c("Error in generating report"))},saveInvoiceCharges:function(e){return o.post("/tms-api/invoice/invoicecharge",e,a()).then(i,c("Error saving invoice charges"))},checkIfTinExist:function(){return o.get("/tms-api/invoice/dos/tax-id-nbr/"+n.currentUser.partnerCd,a()).then(i,c("Error in retrieving user TIN"))},checkIfInvoiceNbrExist:function(e){return o.get("/tms-api/invoice/dos/dos-invoice-nbr-exists/"+e,a()).then(i,c("Error checking if Invoice # exist"))},downloadFile:function(e){location.href="/tms-api/invoice/dos/download-report-pdf/"+e+"?t="+a().headers["x-openport-token"]},deleteReport:function(e){return o.delete("/tms-api/invoice/dos/delete/"+n.currentUser.partnerCd+"/"+e,a()).then(i,c("Error in deleting report"))},getProvidersByBillerCd:function(){return o.get("/tms-api/invoice/dos/providers/"+n.currentUser.partnerCd,a()).then(i,c("Error getting providers by biller_cd"))},getSearchLabels:function(){return o.get("/tms-api/invoice/dos/search-labels",a()).then(i,c("Error getting search labels"))},getDefaultInvoiceHeaderEmailReceivers:function(e,t,r,n){var i=a();return i.headers.parameterCd="",i.headers.parameterName="",i.headers.programId="",i.headers.providerCd="",i.headers.parameterCd=e,i.headers.parameterName=t,i.headers.programId=r,i.headers.providerCd=n,o.get("/tms-api/email/invoiceheader/default/emailreceivers",i)},getInvoiceAttachmentList:function(e){return o.get("/tms-api/invoice/dos/get-attachment-list/"+e,a()).then(i,c("Error getting invoice attachment list"))},deleteInvoiceAttachment:function(e,t){return o.delete("/tms-api/invoice/dos/invoice-attachment/"+e+"/"+t,a()).then(i,c("Error deleting invoice attachment"))},downloadAttachment:function(i){var e=JSON.parse(JSON.stringify(a()));return e.responseType="blob",o.get("/tms-api/invoice/dos/invoice-attachment/"+i.fbrId+"/"+i.uuid,e).then(function(e){var t=e.headers(),e=new Blob([e.data],{type:t["content-type"]}),t=window.URL||window.webkitURL,r=t.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=i.fileName,document.body.appendChild(n),n.click(),t.revokeObjectURL(e)}).catch(function(){c("Error in downloading attachment")})},deleteAllInvoiceAttachment:function(e){return o.delete("/tms-api/invoice/dos/invoice-attachment/"+e,a()).then(i,c("Error deleting invoice attachment"))}}}angular.module("app").factory("InvoiceDosService",e),e.$inject=["$http","UserService"]}();
!function(){"use strict";angular.module("app").factory("BackhaulService",["$http","UserService",function(n,t){var a={getShipments:function(){var e={headers:{"x-openport-token":t.currentUser.token.accessToken}};return n.get("/tms-api/backhaul/"+t.currentUser.partnerCd,e).then(a.handleSuccess,a.handleError("Error getting data"))},getNearbyShipments:function(e){var r={headers:{"x-openport-token":t.currentUser.token.accessToken}};return n.get("/tms-api/backhaul/"+t.currentUser.partnerCd+"/"+e.shipmentId+"/"+e.distance,r).then(a.handleSuccess,a.handleError("Error getting data"))},assign:function(e){var r={headers:{"x-openport-token":t.currentUser.token.accessToken}};return n.post("/tms-api/dispatcher/assign",e,r).then(a.handleSuccess,a.handleError("Error posting data"))},handleSuccess:function(e){return e.data},handleError:function(e){return function(){return{success:!1,message:e}}}};return a}])}();
!function(){"use strict";function t(i,o,t){function e(){return{headers:{"oauth-token":o.currentUser.oauth.access_token,"app-code":"OPT_DEFAULT","client-id":"openport-client","client-secret":"openport-secret"}}}function r(t){return t.data}function n(t){return function(){return{success:!1,message:t}}}return{saveNotificationSettings:function(t){return i.post("/activity-api/notificationsettings",t,e()).then(r,function(t){console.log(t)})},getNotificationSettings:function(){return i.get("/activity-api/notificationsettings",e()).then(r,function(t){console.log(t)})},getNotificationCount:function(t,n){return i.get("/activity-api/notifications/count/"+o.currentUser.partnerCd,e()).then(r,function(t){console.log(t)})},getNotifications:function(t,n){t="?time="+t;""!==n&&(t+="&group="+n);return i.get("/activity-api/notifications/"+o.currentUser.partnerCd+"/"+t,e()).then(r,function(t){console.log(t)})},markAllAsRead:function(t){return i.post("/activity-api/notifications",t,e()).then(r,n("Error marking all notification"))},markAsRead:function(t){return i.post("/activity-api/notifications/read/"+t,{},e()).then(r,n("Error marking notification"))},markAsUnread:function(t){return i.post("/activity-api/notifications/unread/"+t,{},e()).then(r,n("Error marking notification"))}}}angular.module("app").factory("ActivityService",t),t.$inject=["$http","UserService","$q"]}();
!function(){"use strict";function e(e,t){var r={};return r.getAssets=function(){return e.get("/tms-api/dispatcher/bayqueue/"+t.currentUser.partnerCd,{headers:{"x-openport-token":t.currentUser.token.accessToken}}).then(n,function(e){return function(){return{success:!1,message:e}}}("Error fetching assets"))},r;function n(e){return e.data}}angular.module("app").factory("BayqueueService",e),e.$inject=["$http","UserService"]}();
!function(){"use strict";function r(r,e,t,o){console.log("should go to home",r.currentUser),this.user=null,this.allUsers=[],o.debug("HomeController "+t.current+" UserService.currentUser:",r.currentUser),void 0===e.analytics&&(e.analytics=r.currentUser.analytics),o.debug("$state.current:",t.current),o.debug("HomeController "+t.current+" UserService.currentUser:",r.currentUser),void 0!==(e=r.currentUser)&&e||t.go("login")}angular.module("app").controller("HomeController",r),r.$inject=["UserService","$rootScope","$state","$log"]}();
!function(){"use strict";function e(a,s,t,n,e,r,o,l,i,c,d,u){console.log("reload ",window._need_reload),window._need_reload&&window.location.reload();var g=this;g.host=o.host(),g.languages=[{id:"en_US",name:"English - USA"},{id:"id_ID",name:"Bahasa"},{id:"zh_CN",name:"简体中文"}],g.language=g.languages[0].id,g.login=function(){g.dataLoading=!0,s.Login(g.username,g.password,g.host,function(o){o.success?s.OAuthLogin(g.username,g.password,function(e){void 0!==e.data&&(t.currentUser.oauth=e.data),s.SetCredentials(g.username,g.password),g.usr=o.user,c.getTrackingId(g.host).then(function(e){e&&(ga("create",e.trackingId,"auto"),i.pageTrack("/"),i.setUsername(t.currentUser.userId.toString()))}),1==o.user.resetPassword?(g.dataLoading=!1,l.open({template:"app/login/reset.password.html",className:"ngdialog-overlay",scope:r,showClose:!1,modal:!0,controller:this})):(void 0===n.analytics&&(n.analytics=t.currentUser.analytics),t.hasRole(u.access.controltower)?a.go("controltower"):a.go("home"))}):(toastr.error(o.message),g.dataLoading=!1)})},g.isLoggedIn=!1,t.isLoggedIn()?t.hasRole(u.access.controltower)?a.go("controltower"):a.go("home"):(s.ClearCredentials(),g.isLoggedIn=!0),g.changeLanguage=function(){e.use(g.language)},g.closeAsset=function(){l.closeAll()},g.resetPassword=function(){var e=angular.element(document.getElementById("password1"))[0],o=angular.element(document.getElementById("password2"))[0];e.value!=o.value?(o.focus(),toastr.error("confirm password should match new password")):(g.dataLoading=!0,g.usr.password=e.value,t.UpdatePassword(g.usr).then(function(e){g.dataLoading=!1,g.usr.password="",angular.isObject(e)?(toastr.success("Saved Successfully"),l.closeAll(),a.go("home")):toastr.error("failed to reset password.")}))}}angular.module("app").controller("LoginController",e).filter("trustAsHtml",["$sce",function(o){return function(e){return angular.isString(e)?o.trustAsHtml(e):e}}]),e.$inject=["$state","AuthenticationService","UserService","$rootScope","$translate","$scope","$location","ngDialog","$analytics","GoogleAnalyticsService","FeedLoaderService","Role"]}();
!function(){"use strict";function e(h,g,e,R,B,o,n,l,s,i,r,t,d,c,p,u,F,m,v){var f=this,a=(f.isDateType=!0,f.isReferenceType=!1,f.isReferenceWithDate=!1,f.criteria="ALL",f.fetchCategory=0,f.grp=0,f.grpPending=0,f.attachmentPath,f.singleDriver=!1,f.isSingleDriver=!0,f.singleAsset=!1,f.assetId=0,f.assetTagId=0,f.dispatchers=[],f.actualDrivers=[],f.actualDriversAuto=[],f.sortTnT="asc",f.picturePath="https://"+i.host()+"/files/pic/",f.assets=[],f.tracks=[],f.ref="DN",f.opt3=void 0,f.opt2=void 0,f.opt=void 0,f.openOrderSequence=void 0,f.dialogAdvancedSearch=void 0,f.allowAddFlg=!0,f.showSeqInit="N",f.clearDriver="N",!(f.showDispatchButton="N")),A=void 0;function b(){var e=new Date,t=new Date;t.setDate(t.getDate()+3),e.setDate(e.getDate()-1),e=$.datepicker.formatDate("yy/mm/dd",new Date(e)),t=$.datepicker.formatDate("yy/mm/dd",new Date(t)),$("#fromDate1").val(e),$("#toDate1").val(t),$("#fromDate2").val(e),$("#toDate2").val(t)}function D(){f.singleDriver=!1,f.isSingleDriver=!0,f.singleAsset=!1,f.assetInfo="",f.assetId=0,f.assetTagId=0,f.driver=-2,$("#singleDriver").val(""),l(function(){0==f.singleDriver?($("#singleDriver").select2(),$("#singleDriver").val("")):f.isSingleDriver=!0},0)}function y(){var e,t;f.showDispatchButton="N",o.loading=!0,f.dispatchers,$("#shipments").DataTable().clear().draw(),$("#shipments").dataTable().fnDestroy(),f.showTable="N",f.noRecordFound="N",isNaN(new Date($("#fromDate1").val()).getTime())?(toastr.error("Invalid Date Value"),f.noRecordFound="Y",o.loading=!1,f.isFetchClick=!0,$("#fromDate1").focus()):isNaN(new Date($("#toDate1").val()).getTime())?(toastr.error("Invalid Date Value"),f.noRecordFound="Y",f.isFetchClick=!0,o.loading=!1,$("#toDate1").focus()):(t=N(new Date($("#fromDate1").val())),e=N(new Date($("#toDate1").val())),t={provider:g.currentUser.partnerCd,from:t,to:e,criteria:f.criteria,reference:"-"},h.GetShipments(t).then(function(e){if(f.dispatchers=[],f.isFetchClick=!0,angular.isObject(e)&&0<e.length){f.originalDispatchers=JSON.parse(JSON.stringify(e)),I(e),f.dispatchers=f.tmpListProbills,o.tmpListProbills=f.dispatchers,f.lpoShipment=[];for(var t=0;t<f.dispatchers.length;t++)void 0!==f.dispatchers[t].poTypeCd&&"LPO"==f.dispatchers[t].poTypeCd&&f.lpoShipment.push(f.dispatchers[t]);f.showTable="Y",f.showDispatchButton="Y",f.initDataTable("shipments"),l(function(){o.loading=!1},100)}else o.loading=!1,f.noRecordFound="Y"}))}function I(t){if(f.tmpListProbills=[],f.tmpListFoundProbills=[],t){t.sort(function(s){var i=1;"-"===s[0]&&(i=-1,s=s.substr(1));return function(e,t){return(e[s]<t[s]?-1:e[s]>t[s]?1:0)*i}}("legNbr"));for(var s=0;s<t.length;s++)if(function(t,s){return f.tmpListProbills.some(function(e){return e[t]===s})}("shipmentNbr",t[s].shipmentNbr)){f.tmpListFoundProbills.push(t[s]);for(let e=0;e<f.tmpListProbills.length;e++)f.tmpListProbills[e].shipmentNbr===t[s].shipmentNbr&&1!==t[s].legNbr&&(f.tmpListProbills[e].subProbill.push(t[s]),f.tmpListProbills[e].hasProbill=!0,f.tmpListProbills[e].isAllowedProbill=9<=f.tmpListProbills[e].subProbill.length)}else t[s].subProbill=[],t[s].hasProbill=!1,t[s].isAllowedProbill=!0,t[s].isActive=!1,t[s].stopSeq=t[s].legNbr,f.tmpListProbills.push(t[s])}console.log(f.tmpListFoundProbills,f.tmpListProbills)}function N(e){var t=e.getDate(),s=(t<10&&(t="0"+t),e.getMonth()+1);return s<10&&(s="0"+s),e.getFullYear()+"-"+s+"-"+t}function S(){f.showSeqInit="N",f.sequenceRecord="N",f.showPendShipment="N",f.ords=[],f.pends=[]}function T(i,t){$("#col_list tr").each(function(){for(var e=$(this).find(".shipmentid").html(),t=$(this).find(".priority").html(),s=0;s<f.ords.length;s++)f.ords[s].shipmentId==e&&(f.ords[s].stopSeq=t,f.ords[s].mobileUserId=i)}),h.OrderLoad(f.ords).then(function(e){"success"==e.response?(toastr.success("Saved Successfully."),"ReAssign"==t&&(f.ordSeqDriver=f.orderSeqReAssignDriver),f.fetchDriverOrders()):toastr.error("Failed to assign load.")})}function w(){var e,t;f.showDispatchButton="N",f.dispatchers,$("#shipments").DataTable().clear().draw(),$("#shipments").dataTable().fnDestroy(),f.showTable="N",f.noRecordFound="N",isNaN(new Date($("#fromDate2").val()).getTime())&&(toastr.error("Invalid Date Value"),o.loading=!1,$("#fromDate2").focus()),isNaN(new Date($("#toDate2").val()).getTime())&&(toastr.error("Invalid Date Value"),o.loading=!1,$("#toDate2").focus()),void 0===f.reference2||0==f.reference2.trim().length?(o.loading=!1,toastr.error("Reference is required to fetch the data"),$("#reference2").focus()):(t=N(new Date($("#fromDate2").val())),e=N(new Date($("#toDate2").val())),t={provider:g.currentUser.partnerCd,from:t,to:e,criteria:f.criteria,reference:f.reference2},h.GetShipments(t).then(function(e){if(f.isFetchClick=!0,angular.isObject(e)&&0<e.length){f.originalDispatchers=JSON.parse(JSON.stringify(e)),I(e),f.dispatchers=f.tmpListProbills,o.tmpListProbills=f.dispatchers,f.lpoShipment=[];for(var t=0;t<f.dispatchers.length;t++)void 0!==f.dispatchers[t].poTypeCd&&"LPO"==f.dispatchers[t].poTypeCd&&f.lpoShipment.push(f.dispatchers[t]);f.initDataTable("shipments"),f.showTable="Y",f.showDispatchButton="Y",l(function(){o.loading=!1},100)}else f.noRecordFound="Y",o.loading=!1}))}function k(){f.showDispatchButton="N",o.loading=!0;var e=$("#shipments").DataTable();f.dispatchers=[],e.clear().draw(),$("#shipments").dataTable().fnDestroy(),f.showTable="N",f.noRecordFound="N",void 0===f.reference1||0==f.reference1.trim().length?(o.loading=!1,toastr.error("Reference is required to fetch the data"),$("#reference2").focus()):(e={provider:g.currentUser.partnerCd,from:"F",to:"T",criteria:f.criteria,reference:f.reference1},h.GetShipments(e).then(function(e){if(f.isFetchClick=!0,f.dispatchers=[],angular.isObject(e)&&0<e.length){f.originalDispatchers=JSON.parse(JSON.stringify(e)),I(e),l(function(){f.dispatchers=JSON.parse(JSON.stringify(f.tmpListProbills)),console.log(f.dispatchers)},100),o.tmpListProbills=f.dispatchers,f.lpoShipment=[];for(var t=0;t<f.dispatchers.length;t++)void 0!==f.dispatchers[t].poTypeCd&&"LPO"==f.dispatchers[t].poTypeCd&&f.lpoShipment.push(f.dispatchers[t]);f.initDataTable("shipments"),f.showTable="Y",f.showDispatchButton="Y",l(function(){o.loading=!1},100)}else f.noRecordFound="Y",o.loading=!1}))}function C(e){for(var t=0;t<f.drivers.length;t++)if(f.drivers[t].driverInfo==e)return f.drivers[t].mobileUserId;return-1}function P(e){var t=(e=e.substring(11,16)).substring(0,2),e=e.substring(3,6);return"00"==t||+t<12?t+":"+e+" AM":("13"==t?t="1":"14"==t?t="2":"15"==t?t="3":"16"==t?t="4":"17"==t?t="5":"18"==t?t="6":"19"==t?t="7":"20"==t?t="8":"21"==t?t="9":"22"==t?t="10":"23"==t&&(t="11"),t+":"+e+" PM")}function L(e){if(0<f.actualDrivers.length)for(var t=0;t<f.actualDrivers.length;t++)if(f.actualDrivers[t].mobileUserId==e)return f.actualDrivers[t].ticked=!0,void(f.currentDriverIndex=t)}function E(t,s){console.log("Asset for edit",t),void 0!==f.currentDriverIndex&&(f.actualDrivers[f.currentDriverIndex].ticked=!1);var i="";void 0!==t.tagCd&&(i+=t.tagCd),void 0!==t.macAddress&&(i=i+"("+t.macAddress+")"),f.previousTagId=t.tagId,f.addAssetName=t.assetNumber,f.addAssetTagName=t.tagNumber,f.assetTypeValue=t.assetTypeId,f.assetStatusValue=t.assetStatusId,f.addAssetId=t.assetId,f.tagId=t.tagId,f.serviceAreaId=t.serviceAreaId,f.assetTitle="Edit Asset",f.currentAsset=t,L(t.mobileUserId),h.GetTags().then(function(e){f.tags=e,console.log("tags",e),f.tags.push({macAddress:t.macAddress,tagCd:t.tagCd,tagId:t.tagId,tagInfo:i}),f.tagId=t.tagId,"edit"==s&&(f.assetname=t.assetNumber,f.assetSearch="N",f.disabledAsset=!1,f.originalAssetName=void 0,f.opt2=n.open({template:"app/dispatcher/asset.add.view.html",className:"ngdialog-overlay",scope:o,showClose:!1,modal:!0,closeByDocument:!1,closeByEscape:!1,controller:this}))})}function U(e){if(void 0!==f.tags&&0<f.tags.length)for(var t=0;t<f.tags.length;t++)if(f.tags[t].tagId==e)return f.tags[t];return null}function q(){var e,s;void 0!==f.addAssetName&&f.addAssetName?-1==f.assetTypeValue?($("#uiAssetType").focus(),toastr.error("Asset Type is required")):-1==f.assetStatusValue?($("#assetStatus").focus(),toastr.error("Asset Status is required")):f.serviceArea&&0<f.serviceArea.length&&!f.serviceAreaId?($("#singleTag").focus(),toastr.error("Service Area is required")):(f.serviceAreaId||(f.serviceAreaId=null),f.dataLoading=!0,e={id:f.addAssetId,code:g.currentUser.partnerCd,number:f.addAssetName,type:f.assetTypeValue,status:f.assetStatusValue,serviceArea:f.serviceAreaId},s="",f.assettypes.forEach(function(e){e.assetTypeId===f.assetTypeValue&&(s=e.assetDescription)}),h.dsqlSaveAsset(e).then(function(t){f.dataLoading=!1,angular.isObject(t)?(console.log("return before update shipment",t),f.dispatcherShipmentAsset?(f.dispatcherShipmentAsset.assetId=t.assets.result,console.log("the dispatcher object",f.dispatcherShipmentAsset),h.UpdateShipmentAssetId(f.dispatcherShipmentAsset).then(function(e){console.log("return after update shipment",e),f.dispatcherShipmentAsset.assetNumber=t.assets.result,f.dispatcherShipmentAsset.equipment=s,console.log("the dispatcher object",f.dispatcherShipmentAsset),toastr.success("Saved Successfully."),f.closeAddAsset()})):(toastr.success("Saved Successfully."),f.closeAddAsset())):toastr.error("Failed to manage asset.")})):($("#uiAssetName").focus(),toastr.error("Asset Name is required"))}function O(e){if(console.log(f.drivers,e),void 0!==f.drivers&&0<f.drivers.length)for(var t=0;t<f.drivers.length;t++)if(e==f.drivers[t].mobileUserId)return f.drivers[t]}f.host=i.host(),o.mapSrc="",f.originalDispatchers=[],f.tmpListProbills=[],f.tmpListFoundProbills=[],o.tmpListProbills=[],f.selectedIndex=-1,o.tntMapSrc="",o.trustSrc=function(){return r.trustAsResourceUrl(o.mapSrc)},o.tntmapTrustSrc=function(){return r.trustAsResourceUrl(o.tntMapSrc)},f.setMapSrc=function(e){o.mapSrc=("localhost"===f.host?"https://sgp04.openport.com":location.origin)+"/tracker/OpPaidTracker.html?partner="+g.currentUser.partnerCd+"&token="+g.currentUser.token.accessToken+"&shpmnt="+e.deliveryNumber+"&events="+a},f.setTntMapSrc=function(e){o.tntMapSrc=("localhost"===f.host?"https://sgp04.openport.com":location.origin)+"/insight-apps/main/#/track-and-trace/tnt-map?referenceNbr="+e.deliveryNumber+"&showEventControls=true&showEpod=true&showTntHeader=true&application=dispatcher&partnerCd="+g.currentUser.partnerCd+"&token="+g.currentUser.oauth.refresh_token},console.log("UserService.currentUser",g.currentUser),f.ord=[],h.ListCountries().then(function(e){f.countries=[],f.countries.push({countryCd:"Select",countryName:"Select One"});for(var t=0;t<e.length;t++)f.countries.push(e[t])}),f.seqTrustSrc=function(){console.log(f.seqTrustUrl);var e=$("#iFrmSeqTracker"),t=$(window),s=$("#headerow"),t=t.height()-s.height()-10;return e.css("height",t+"px"),r.trustAsResourceUrl(f.seqTrustUrl)},f.createRelays=function(e,t){console.log("no of relay",t),f.relaydata=e,console.log("source shipment",f.relaydata),f.relays=[];var s={leg:1};s.driverInfo=e.driverInfo,s.origin={},s.origin.recipient=e.sender.recipientName,s.origin.address=e.sender.line1,s.origin.district=e.sender.district,s.origin.city=e.sender.city,s.origin.province=e.sender.province,s.origin.country=e.sender.country,s.origin.postal=e.sender.postal,s.origin.readonly=!0,s.destination={},s.destination.country=g.currentUser.partner.country,s.destination.readonly=!1,s.instructionTxt=e.instructionTxt,f.relays.push(s);for(var i=1;i<t-1;i++)(s={}).leg=i+1,s.origin={},s.driverInfo="",s.origin.country=g.currentUser.partner.country,s.origin.readonly=!0,s.destination={},s.destination.country=g.currentUser.partner.country,s.destination.readonly=!1,s.instructionTxt="",f.relays.push(s);(s={}).leg=t,s.destination={},s.destination.recipient=e.recipient.recipientName,s.destination.address=e.recipient.line1,s.destination.district=e.recipient.district,s.destination.city=e.recipient.city,s.destination.province=e.recipient.province,s.destination.country=e.recipient.country,s.destination.postal=e.recipient.postal,s.destination.readonly=!0,s.instructionTxt="",s.origin={},s.origin.country=g.currentUser.partner.country,s.origin.readonly=!0,f.relays.push(s),console.log("relays",f.relays),f.relayDialog=n.open({template:"app/dispatcher/relay.view.html",className:"ngdialog-overlay",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this})},f.closeSequenceMap=function(){f.sequenceMapDialog.close()},f.routePreview=function(){console.log("orders sequence",f.ords),f.seqJson=[];var r=1;$("#col_list tr").each(function(){var e=$(this).find(".shipmentid").html(),t=$(this).find(".priority").html();console.log("cnt",r);for(var s=0;s<f.ords.length;s++)if(f.ords[s].shipmentId==e){var i=parseInt(t);f.seqJson.push({id:f.ords[s].shipmentId,seq:i}),r+=1;break}}),console.log("open map"),f.sequenceMapDialog=n.open({template:"app/tracker/sequence.map.html",className:"ngdialog-overlay",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this,resolve:f.getRouteId()})},f.getRouteId=function(){console.log("Json seq",f.seqJson),h.PreviewRoute(f.seqJson).then(function(e){console.log("msg Id",e.routeId),void 0!==g.currentUser.partner.country&&"CN"==g.currentUser.partner.country?f.seqTrustUrl="/tracker/broutev.html?msgId="+e.routeId:f.seqTrustUrl="/tracker/groutev.html?msgId="+e.routeId})},f.submitRelay=function(){for(var e=[],t=0;t<f.relays.length;t++){var s=f.relaydata;s.legNbr=f.relays[t].leg,s.sender.line1=f.relays[t].origin.address,s.sender.address=f.relays[t].origin.address,s.sender.recipient=f.relays[t].origin.recipient,s.sender.city=f.relays[t].origin.city,s.sender.country=f.relays[t].origin.country,s.sender.province=f.relays[t].origin.province,s.sender.postal=f.relays[t].origin.postal,s.recipient.line1=f.relays[t].destination.address,s.recipient.address=f.relays[t].destination.address,s.recipient.recipient=f.relays[t].destination.recipient,s.recipient.city=f.relays[t].destination.city,s.recipient.country=f.relays[t].destination.country,s.recipient.province=f.relays[t].destination.province,s.recipient.postal=f.relays[t].destination.postal,s.instructionTxt=f.relays[t].instructionTxt,s.mobileUserId=C(f.relays[t].driverInfo),console.log("new shipment",s),1<s.legNbr&&(s.shipmentNbr=void 0),e.push(s)}console.log("final relays",e)},f.cancelRelay=function(){f.relayDialog.close()},f.divIsReady=function(){l(function(){$("#assets").DataTable({searching:!0,bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100),l(function(){$("#tnts").DataTable({searching:!0,bDestroy:!0,displayLength:25,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100),l(function(){$("#shipments").DataTable({searching:!0,bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100),b(),f.fetchCategory=1,y()},f.openAsset=function(){f.forceeditasset="Y",f.openAssetForm()},f.openDriverSingleAsset=function(){f.forceeditasset="N",f.openAssetForm()},f.makeDestOrigin=function(e,t){var s=e.leg+1;s<=f.relays.length&&("recipient"==t&&$("#ORIGIN_RECIPIENT_"+s).val($("#DESTINATION_RECIPIENT_"+e.leg).val()),"address"==t&&$("#ORIGIN_ADDRESS_"+s).val($("#DESTINATION_ADDRESS_"+e.leg).val()),"district"==t&&$("#ORIGIN_DISTRICT_"+s).val($("#DESTINATION_DISTRICT_"+e.leg).val()),"city"==t&&$("#ORIGIN_CITY_"+s).val($("#DESTINATION_CITY_"+e.leg).val()),"province"==t&&$("#ORIGIN_PROVINCE_"+s).val($("#DESTINATION_PROVINCE_"+e.leg).val()),"country"==t&&$("#ORIGIN_COUNTRY_"+s).val($("#DESTINATION_COUNTRY_"+e.leg).val()),"postal"==t&&$("#ORIGIN_POSTAL_"+s).val($("#DESTINATION_POSTAL_"+e.leg).val()))},f.clearDrivers=function(){f.clearDriver="N",S(),f.ordSeqDriver=""},f.submitAdvancedSearch=function(){var e;f.multipleRef?(f.fetchFlg="N",(e={}).provider=g.currentUser.partnerCd,e.refType=f.ref,e.references=f.multipleRef,console.log("src - ",e),h.GetMultipleShipment(e).then(function(e){$("#shipments").DataTable().clear().draw(),$("#shipments").dataTable().fnDestroy(),f.showTable="N",f.noRecordFound="N",void 0!==f.dialogAdvancedSearch&&f.dialogAdvancedSearch.close(),f.dialogAdvancedSearch=void 0,f.dispatchers=[],console.log("shipments",e),angular.isObject(e)&&0<e.length?(f.noRecordFound="N",f.dispatchers=e,f.originalDispatchers=JSON.parse(JSON.stringify(e)),I(e),f.dispatchers=f.tmpListProbills,o.tmpListProbills=f.dispatchers,console.log("shipments",e),f.initDataTable("shipments"),f.showTable="Y",l(function(){o.loading=!1},100)):(f.noRecordFound="Y",o.loading=!1)})):(toastr.error("Reference is required."),$("#asRef").focus())},f.closeAssetEditDialog=function(){f.opt3.close(),f.opt3=void 0},f.cancelAdvancedSearch=function(){void 0!==f.dialogAdvancedSearch&&f.dialogAdvancedSearch.close(),f.dialogAdvancedSearch=void 0},$("#singleDriver").select2(),h.GetDriverByProvider(g.currentUser.partnerCd).then(function(e){f.drivers=[],f.drivers.push({driverInfo:"",mobileUserId:-2,phone_nbr:"",lastName:"",firstName:""});for(var t=0;t<e.length;t++)f.drivers.push(e[t]);if(angular.isObject(e)&&0<e.length)for(var s=0;s<e.length;s++)f.actualDrivers.push({name:e[s].driverInfo,mobileUserId:e[s].mobileUserId}),f.actualDriversAuto.push(e[s].driverInfo);console.log(""),$("#singleDriver").select2(),$("#singleDriver").val("")}),h.GetTimezone().then(function(e){f.tz=[];for(var t=0;t<e.length;t++)f.tz.push(e[t].timezone)}),h.GetAssetType().then(function(e){f.assettypes=[],f.assettypes.push({assetTypeId:-1,assetDescription:"Select"});for(var t=0;t<e.length;t++)f.assettypes.push(e[t])}),h.GetAssetStatus().then(function(e){f.assetstatus=[],f.assetstatus.push({assetStatusId:-1,assetStatusCd:"Select"});for(var t=0;t<e.length;t++)f.assetstatus.push(e[t])}),f.openAttachment=function(e){f.currentTnT=e,f.attachDialog=n.open({template:"app/dispatcher/attach.view.html",className:"ngdialog-overlay ngdialog-theme-default  custom-width-320",showClose:!1,scope:o,modal:!0,controller:this}),l(function(){$("#attach_pic").focus().trigger("click")},100)},f.closeAttachDialog=function(){f.attachDialog.close(),f.attachDialog=void 0},f.openEditAttachment=function(){console.log("open..."),f.attachDialog=n.open({template:"app/dispatcher/attach.edit.view.html",className:"ngdialog-theme-default custom-width-400x200",scope:o,showClose:!0,modal:!0,controller:this}),l(function(){$("#attach_pic").focus().trigger("click")},100)},f.upload_attachment=function(){var e,t=angular.element(document.getElementById("attach_pic"))[0].files[0];void 0!==t&&((e=new FormData).append("file",t),s.post("/tms-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){var t={};t.activityId=f.currentTnT.activityId,t.path=e.fileId,t.timezone=g.currentUser.partner.timezone,h.CreateDocument(t).then(function(e){t.rootPath=f.picturePath,void 0===f.currentTnT.proofDocument&&(f.currentTnT.proofDocument=[]),f.currentTnT.proofDocument.push(t)})}).error(function(){}),f.attachDialog.close())},f.clearAttachment=function(){f.attachment=""},f.upload_edit_attachment=function(){var e,t=angular.element(document.getElementById("attach_pic"))[0].files[0];console.log("files",t),f.attachment=t.name,void 0!==t&&((e=new FormData).append("file",t),s.post("/tms-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){f.attachmentPath=e.fileId}).error(function(){}),f.attachDialog.close())},f.reTrack=function(){console.log("reTrack")},f.showProof=function(s){f.closeTnTDialog();d.open({templateUrl:"app/epod/md.review.view.html",windowClass:"modal-xl",controller:function(a,e,t){a.shipmentInfo=s,a.shipmentInfo.shipmentNumber=s.proBillNbr,a.epodList=[],a.mdIsProcessing=!1,a.selectedFilterTab="pending";var n=[];function o(){if(a.epodList=[],"all"===a.selectedFilterTab)a.epodList=n;else for(var e in n)n[e].status.toLowerCase()===a.selectedFilterTab&&a.epodList.push(n[e])}a.allCount=0,a.pendingCount=0,a.approvedCount=0,a.rejectedCount=0,a.dirty=!1,a.isDispatcher=function(){return c.isDispatcher()},a.isAdmin=function(){return c.isAdmin()},a.getShipmentEpods=function(e,t,s){a.epodList=[],a.mdIsProcessing=!0,"delivered"===t.toLowerCase()&&(t="delivery"),c.getShipmentEpodByEvent(e,t,s).then(function(e){if(a.mdIsProcessing=!1,void 0!==e.epod&&e.epod.constructor===Array){n=e.epod;var t,s=0,i=0,r=0;for(t in a.allCount=n.length,n)switch(n[t].status.toLowerCase()){case"pending":s++;break;case"approved":i++;break;case"rejected":r++}a.pendingCount=s,a.approvedCount=i,a.rejectedCount=r,o()}})},a.approve=function(e){1==confirm("Are you sure you want to approve this item?")&&(a.mdIsProcessing=!0,c.approve(e.shipmentUserFileId).then(function(e){a.mdIsProcessing=!1,a.getShipmentEpods(a.shipmentInfo.shipmentId,a.shipmentInfo.eventCd),a.dirty=!0}))},a.reject=function(e){1==confirm("Are you sure you want to reject this item?")&&(a.mdIsProcessing=!0,c.reject(e.shipmentUserFileId).then(function(e){a.mdIsProcessing=!1,a.getShipmentEpods(a.shipmentInfo.shipmentId,a.shipmentInfo.eventCd),a.dirty=!0}))},a.reset=function(e){1==confirm("Are you sure you want to reset this item?")&&(a.mdIsProcessing=!0,c.reset(e.shipmentUserFileId).then(function(e){a.mdIsProcessing=!1,a.getShipmentEpods(a.shipmentInfo.shipmentId,a.shipmentInfo.eventCd),a.dirty=!0}))},a.getImagePath=function(e){e="/delivery/shipments/pic/"+e;return e="localhost"===location.hostname?"https://sgp04.openport.com"+e:e},a.closeModal=function(){a.epodList=[],e.dismiss("cancel"),f.openTrackTrace(f.selectedIndex)},a.setActiveFilterTab=function(e){a.selectedFilterTab=e,o()},a.getShipmentEpods(s.shipmentId,s.eventCd,s.eventDesc)},scope:o,size:"xl",backdrop:"static",resolve:{options:function(){}}})},f.closeDocument=function(){f.dc.close()},f.setSingleAsset=function(e){console.log("asset...",e),f.opt.close(),f.opt=void 0,f.assetId=e.assetId,f.assetTagId=e.tagId;var t="";void 0!==e.assetNumber&&(t=t+e.assetNumber+"/"),void 0!==e.tagCd&&(t+=e.tagCd),void 0!==e.macAddress&&(t=t+"("+e.macAddress+")"),void 0!==e.assetDescription&&(t=t+"/"+e.assetDescription),void 0!==e.status&&(t=t+"/"+e.status),f.assetInfo=t},f.singleDriverFunc=function(){f.driver=-2,$("#singleDriver").val(""),l(function(){0==f.singleDriver?(f.isSingleDriver=!0,$("#singleDriver").select2(),$("#singleDriver").val("")):f.isSingleDriver=!0},0)},f.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy/mm/dd",todayHighlight:!0,autoclose:!0})},f.openTimePicker=function(e){$("#"+e).datetimepicker({format:"LT"}),$("#"+e).focus()},f.openTimePicker2=function(e,t){$("#"+e).datetimepicker({format:t}),$("#"+e).focus()},f.fetchDriverOrders=function(){if(isNaN(new Date($("#fromRDD").val()).getTime()))toastr.error("Invalid Date Value"),o.loading=!1,$("#fromRDD").focus();else{var r=N(new Date($("#fromRDD").val()));if(f.prRqstDate=r,f.driverSeqInformation=f.ordSeqDriver,f.ordSeqDriver){for(var e=void 0,t=0;t<f.actualDriversAuto.length;t++)f.ordSeqDriver==f.actualDriversAuto[t]&&(e="true");if(void 0===e)return $("#ordSeqDriver").focus(),void toastr.error("driver is not registered!")}f.showSeqInit="Y",f.showSeq="N",f.showPendShipment="N",f.sequenceRecord="Y",f.allowReassign="N",f.saveButton="N",f.ordSeqDriver?f.driverId=C(f.ordSeqDriver):(f.driverId=-1,f.allowReassign="Y");var s={provider:g.currentUser.partnerCd,from:r,mobileId:f.driverId,module:"requested_delivery_date"};h.GetShipmentByDriverModuleDt(s).then(function(e){if(f.ords=[],console.log("dispatcher",e),angular.isObject(e)&&0<e.length){f.showSeq="Y",f.saveButton="Y",f.ords=[];for(var t=0;t<e.length;t++){var s=e[t];s.priority=t+1,-1==f.driverId&&(s.addFlg="Y"),f.ords.push(s)}}var i;0<f.driverId?(i={provider:g.currentUser.partnerCd,from:r,module:"requested_delivery_date",mobileId:f.driverId},h.GetPendingShipmentByModuleDt(i).then(function(e){f.pends=[],$("#shipmentavailable").DataTable().clear().draw(),$("#shipmentavailable").dataTable().fnDestroy(),angular.isObject(e)&&0<e.length&&(f.pends=e,f.initSortTable("shipmentavailable"),f.showPendShipment="Y"),"N"!=f.showSeq&&0!=f.ords.length||(f.sequenceRecord="N"),"N"==f.sequenceRecord&&"N"==f.showPendShipment?f.clearDriver="N":f.clearDriver="Y",l(function(){if(void 0!==f.pends&&0<f.pends.length)for(var e=0;e<f.pends.length;e++)f.pends[e].style="display:none"},100)})):(i={provider:g.currentUser.partnerCd,from:r,module:"requested_delivery_date",mobileId:f.driverId},h.GetPendingShipmentByModuleDt(i).then(function(e){if(f.pends=[],$("#shipmentavailable").DataTable().clear().draw(),$("#shipmentavailable").dataTable().fnDestroy(),angular.isObject(e)&&0<e.length){f.pends=e,f.initSortTable("shipmentavailable"),f.showSeq="Y",f.showPendShipment="Y";for(var t=[],s=0;s<f.pends.length;s++)f.pends[s].stopSeq&&0<f.pends[s].stopSeq&&f.pends[s].stopSeq<1e3||t.push(f.pends[s]);f.pends=t}"N"!=f.showSeq&&0!=f.ords.length||(f.sequenceRecord="N"),"N"==f.sequenceRecord&&"N"==f.showPendShipment?f.clearDriver="N":f.clearDriver="Y",l(function(){if(void 0!==f.pends&&0<f.pends.length)for(var e=0;e<f.pends.length;e++)f.pends[e].style="display:none"},100)}))})}},f.createSequenceAndReassign=function(){if(f.orderSeqReAssignDriver){if(f.orderSeqReAssignDriver){for(var e=void 0,t=0;t<f.actualDriversAuto.length;t++)f.orderSeqReAssignDriver==f.actualDriversAuto[t]&&(e="true");if(void 0===e)return $("#orderSeqReAssignDriver").focus(),void toastr.error("driver is not registered!")}T(C(f.orderSeqReAssignDriver),"ReAssign")}else f.createStopSequence()},f.createStopSequence=function(){T(f.driverId,"Stay")},f.addPends=function(e,t){f.sequenceRecord="Y",e.priority=f.ords.length+1,e.stopSeq=1e3,e.addFlg="Y",f.saveButton="Y",f.ords.push(e),$("#ORDER_"+e.shipmentId).attr("style","display:none")},f.deleteSequence=function(e){var t=f.ords.indexOf(e);f.ords.splice(t,1),$("#SEQ_"+e.shipmentNbr).click(),1e3==e.stopSeq?($("#ORDER_"+e.shipmentId).attr("style","display:true"),0==f.ords.length&&(f.sequenceRecord="N",f.saveButton="N")):h.UnAssignSequence(e).then(function(e){angular.isObject(e)&&T(f.driverId,"Stay"),0==f.ords.length&&(f.sequenceRecord="N",f.saveButton="N")})},f.fetch1=function(){f.isFetchClick=void 0,f.fetchCategory=1,y()},f.fetch3=function(){f.isFetchClick=void 0,f.fetchCategory=3,w()},f.closeDialog=function(){n.closeAll()},f.closeAsset=function(){f.singleAsset=!1;var e=angular.element(document.getElementById("uiChkbIsSingleAsset"))[0];1!=e.checked||f.assetInfo||(e.checked=!1),f.opt.close(),f.opt=void 0},f.fetch2=function(){f.isFetchClick=void 0,f.fetchCategory=2,k()},o.person={},o.people=[],f.completeSingleDriver=function(e){$("#"+e).autocomplete({source:f.actualDriversAuto})},f.completeTag=function(e){$("#"+e).autocomplete({source:f.tagInfos})},f.completeTnT=function(e){angular.element(document.getElementById("tntTimezone")).autocomplete({source:f.tz})},f.initDataTable=function(t){var s="#"+t,n=($(s).dataTable().fnDestroy(),null);f.dataLoading=!0,l(function(){var e;"shipments"===t?(e=$(s).DataTable({searching:!0,autoWidth:!1,bDestroy:!0,displayLength:10,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]}),n=e):-1<t.indexOf("shipments-")?$(s).DataTable({searching:!1,autoWidth:!1,bDestroy:!0,bLengthChange:!1,bInfo:!1,bPaginate:!1}):(e=$(s).DataTable({searching:!0,bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]}),n=e),f.dataLoading=!1},100),l(function(){var a=[];$("#main-content").on("scroll",function(){null!=i.url().match(/dispatcher/g)&&f.checkIfButtonExist(".detect-scroll")?$(".shipments-wrapper").floatingScroll("destroy"):$(".shipments-wrapper").floatingScroll()}),"shipments"===t&&($("#shipments").DataTable().rows(".untracked-row").remove().draw(),$(s+" tbody tr td.details-control").click(function(e){console.log(" I WAS HERE And CLICKED");var t,s=$(this).closest("tr"),i=n.row(s),r=$.inArray(s.attr("id"),a);f.checkIfActive(s.data("probill"))&&s.hasClass("details")?(setTimeout(function(){$(".tr-"+s.data("probill")).each(function(){$(this).remove()})},200),s.removeClass("details"),i.child.hide(),f.updateExpand(s.data("probill"),!1)):(null==o.proBillNbr&&(o.proBillNbr={}),t=f.dispatchers.find(function(e){return e.shipmentNbr==s.data("probill")}),o.proBillNbr[s.data("probill")]=t,s.data("index"),s.addClass("details"),f.updateExpand(s.data("probill"),!0),i.child(v(f.childElementFormat(s.data("probill")))(o)).show(),new Promise(function(e,t){setTimeout(function(){s.next().attr("id","wrapper-"+s.data("probill")),$("#wrapper-"+s.data("probill")+" > td").attr("id","child-wrapper-"+s.data("probill")),e()},100)}).then(function(){$("#wrapper-"+s.data("probill")).hide().children().unwrap(),$("#child-wrapper-"+s.data("probill")).hide().children().unwrap(),$(".tr-"+s.data("probill")).fadeIn(),f.updateExpand(s.data("probill"),!0)}),-1===r&&a.push(s.attr("id")))}),$('select[name="shipments_length"]').on("change",function(){f.clickEvent(n)})),$(s).on("page.dt",function(e){f.clickEvent(n),$("tr").each(function(){var e=$(this).closest("tr"),t=n.row(e);t.child.isShown()&&(e.removeClass("details"),f.closeAllExpand(),t.child.hide())})})},1e3)},f.childElementFormat=function(e){return angular.element('<tr data-index="1000" class="untracked-row tr-'+e+'" style="display:none;  background-color: #f3f3f3!important;" ng-repeat="dp in vm.checkOnClickProbill(\''+e+'\')">\n<td class="details-row-{{dp.shipmentNbr}}"  style="background-color: #f3f3f3!important;"> &nbsp;</td>\n<td style="width: 60px; background-color: #f3f3f3!important;" style="background-color: #f3f3f3!important;"><input type="checkbox" ng-checked="dp.checked" ng-disabled="dp.isDisabled" ng-click="vm.checkSubItem($index, $event, dp);" /></td>\n<td style="width: 60px; display: none;" ><a tabindex="-1" id="uiADetails" class="btn btn-xs btn-link">\n<h:i ng-click="vm.editShipment(dp)" class="glyphicon glyphicon-list-alt icon-link-pad"> </h:i></a></td>\n<td style="width: 60px;" >\n<a tabindex="-1" id="uiADetails" class="btn btn-xs btn-link" ng-if="vm.checkUserIsAvailableChat()">\n<i id="conversations" class="material-icons " ng-click="vm.chatShipment(dp)"  tooltip="Chat" analytics-on="click" analytics-event="Click" analytics-category="Information" analytics-label="Conversations Campaign">chat_bubble</i>\n</a>\n<a tabindex="-1" id="uiADetails" class="btn btn-xs btn-link" style="margin-top: -5px;"> <i ng-click="vm.deleteLeg(dp)" tooltip="Remove Stop" class="material-icons">delete</i></a>\n</td>\n<td class="lbl10"><label ng-if="dp.stopSeq !== undefined && dp.stopSeq > 0" style="font-weight: bold;">{{dp.stopSeq}}</label><label ng-if="dp.stopSeq === undefined || dp.stopSeq == 0">{{dp.legNbr}}</label></td>\n<td style="max-width: 250px;width: 226px;display: block; padding-right: 50px;">\n<input type="text" style="width: 100%" class="form-control" onmouseover="focus();old = value;" onmousedown="value = \'\';" onmouseup="value = old;" id="{{dp.dispatchId}}" width="100%" list="drivers" ng-model="dp.driverInfo"/></td>\n<td class="lbl2" style="display: none;"><span class="input-group-addon" style="background: white; border: none"> <label>{{dp.shipmentNbr}}</label> <a tabindex="-1" id="uiADetails" ng-show="dp.sender.country == \'PK\'" class="btn btn-xs btn-link">\n<h:i ng-click="vm.previewPdf(dp)" class="glyphicon glyphicon-list-alt icon-link-pad"> </h:i></a></span></td>\n<td class="po"><label ng-if="dp.orderNumber.length > 20" style="font-weight: bold; color: blue; cursor: pointer" tooltip="{{dp.orderNumber}}" ng-click="vm.openShipmentDetails(dp)" >{{dp.orderNumber.substring(0,20)}}</label>\n<label ng-if="dp.orderNumber.length <= 20" style="font-weight: bold; color: blue; cursor: pointer" tooltip="{{dp.orderNumber}}" ng-click="vm.openShipmentDetails(dp)" >{{dp.orderNumber}}</label></td>\n<td class="rls">\n<label ng-if="dp.deliveryNumber.length > 20" tooltip="{{dp.deliveryNumber}}">{{dp.deliveryNumber.substring(0,20)}} </label>\n<label ng-if="dp.deliveryNumber.length <= 20" tooltip="{{dp.deliveryNumber}}">{{dp.deliveryNumber}} </label></td>\n<td class="lbl1_1"><label ng-if="dp.instructionTxt.length > 0" style="font-weight: bold; color: #404040; cursor: pointer" tooltip="{{dp.instructionTxt}}"><i class="material-icons">comment</i></label></td>\n<td class="lbl1"><label style="font-weight: bold; color: blue; cursor: pointer" ng-click="vm.openTrackTrace($index)">{{dp.status}}</label></td>\n<td class="lbl1"><label style="font-weight: bold; color: blue; cursor: pointer" ng-click="vm.editShipmentAssetNumber(dp)">{{dp.assetNumber}}</label></td>\n<td class="lbl1"><label>{{ dp.equipmentNbr ? dp.equipmentNbr :"N/A"}}\n</label></td><td class="lbl3"><label>{{dp.shipperName}}</label></td>\n<td class="lbl3"><label>{{dp.sender.origin}}</label></td>\n<td class="lbl3"><label>{{dp.recipient.destination}}</label></td>\n<td class="lbl3"><label>{{dp.recipient.address}}</label></td>\n<td class="lbl1"><label>{{dp.recipient.city}}</label></td>\n<td class="lbl1"><label>{{dp.recipient.province}}</label></td>\n<td class="lbl1"><label>{{dp.purchaseOrderNumber}}</label></td>\n<td class="lblDt"><label>{{dp.dateCreated}}</label></td>\n<td class="lblDt"><label>{{dp.pickupDate}}</label></td>\n<td class="lblDt"><label>{{dp.requestedDeliveryDate}}</label></td>\n<td class="lblDt"><label>{{dp.estimatedDeliveryDate}}</label></td>\n<td class="lblDt"><label>{{dp.actualDeliveryDate}}</label></td>\n<td class="lbl1"><label>{{dp.unitCnt}}</label></td>\n<td class="lbl1"><label>{{dp.deliveredUnitCnt}}</label></td>\n<td class="lbl1"><label>{{dp.unitUom}}</label></td>\n<td class="lbl1" style="display: none"><label>{{dp.driverInfo}}</label></td>\n<td class="lbl3"><label>{{dp.equipment}}</label></td></tr>')},f.clickEvent=function(a){var n=[];l(function(){$("#shipments tbody tr td.details-control").unbind("click").bind("click",function(e){var t,s=$(this).closest("tr"),i=a.row(s),r=$.inArray(s.attr("id"),n);f.checkIfActive(s.data("probill"))&&s.hasClass("details")?(setTimeout(function(){$(".tr-"+s.data("probill")).each(function(){$(this).remove()})},200),s.removeClass("details"),i.child.hide(),f.updateExpand(s.data("probill"),!1)):(null==o.proBillNbr&&(o.proBillNbr={}),t=f.dispatchers.find(function(e){return e.shipmentNbr==s.data("probill")}),o.proBillNbr[s.data("probill")]=t,s.data("index"),s.addClass("details"),f.updateExpand(s.data("probill"),!0),i.child(v(f.childElementFormat(s.data("probill")))(o)).show(),new Promise(function(e,t){setTimeout(function(){s.next().attr("id","wrapper-"+s.data("probill")),$("#wrapper-"+s.data("probill")+" > td").attr("id","child-wrapper-"+s.data("probill")),e()},100)}).then(function(){$("#wrapper-"+s.data("probill")).hide().children().unwrap(),$("#child-wrapper-"+s.data("probill")).hide().children().unwrap(),$(".tr-"+s.data("probill")).fadeIn(),f.updateExpand(s.data("probill"),!0)}),-1===r&&n.push(s.attr("id")))})},100)},f.checkOnClickProbill=function(e){for(var t=o.proBillNbr[e],s=[],i=0;i<f.tmpListProbills.length;i++)f.tmpListProbills[i].shipmentNbr===t.shipmentNbr&&(s=f.tmpListProbills[i].subProbill,f.tmpListProbills[i].isActive=!0);return s},f.updateExpand=function(e,t){for(var s=0;s<f.tmpListProbills.length;s++)f.tmpListProbills[s].shipmentNbr===e&&(f.tmpListProbills[s].isActive=t)},f.closeAllExpand=function(){for(var e=0;e<f.tmpListProbills.length;e++)f.tmpListProbills[e].isActive=!1},f.checkIfActive=function(e){for(var t=!1,s=0;s<f.tmpListProbills.length;s++)if(f.tmpListProbills[s].shipmentNbr===e){t=f.tmpListProbills[s].isActive;break}return t},f.createNewLeg=function(e){f.openShipmentDetails(e,!0)},f.deleteLeg=function(t){if(confirm("Are you sure you want to remove stop?")){var e,s=0;for(let e=0;e<f.tmpListProbills.length;e++)f.tmpListProbills[e].shipmentNbr===t.shipmentNbr&&(s=f.tmpListProbills[e].subProbill.length);3<=s?"Pending"===t.status?(e={shipmentNbr:t.shipmentNbr,shipmentId:t.shipmentId},f.dataLoading=!0,h.DeleteLeg(e).then(function(e){null!=e?(o.mdIsProcessing=!1,toastr.success("Deleted Successfully."),f.dataLoading=!1,D(),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w()):toastr.error("Failed to delete shipment. Please try again later.")})):"Pending"!==t.status&&toastr.warning("Sorry, you can only delete pending shipments."):toastr.warning("Sorry, we can only precede deletion of shipment up to 2 legs onwards.")}},f.checkIfButtonExist=function(e){var t,s,i;if($(e)[0])return s=(t=$(window).scrollTop())+$(window).height(),(i=$(e).offset().top)+$(e).height()<=s&&t<=i},f.initSortTable=function(e){var t="#"+e;$(t).dataTable().fnDestroy(),l(function(){$(t).DataTable({searching:!0,bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100)},f.advancedSearch=function(){f.dialogAdvancedSearch||(f.fetchFlg="N",f.dialogAdvancedSearch=n.open({template:"app/dispatcher/advanced.search.html",className:"ngdialog-overlay",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this}))},f.ordersSequence=function(){f.dialogOrderSequence||(f.callSeq=!0,f.ords=[],f.pends=[],f.showSeq="N",f.sequenceRecord="Y",S(),f.clearDriver="N",f.ordSeqDriver=void 0,f.fromRDD=void 0,f.actualDriversSeq=f.actualDriversAuto,f.dialogOrderSequence=n.open({template:"app/dispatcher/order.sequence.html",className:"ngdialog-overlay",scope:o,closeByDocument:!1,closeByEscape:!1,showClose:!1,modal:!0,controller:this}))},f.submitEditShipment=function(){o.loading=!0,f.es.pickupTm=$("#es_pickupTm").val(),f.es.pickupDt=$("#es_pickupDt").val(),f.es.actualPickupTm=$("#es_actualPickupTm").val(),f.es.actualPickupDt=$("#es_actualPickupDt").val(),f.es.requestedDeliveryTm=$("#es_requestedDeliveryTm").val(),f.es.requestedDeliveryDt=$("#es_requestedDeliveryDt").val(),f.es.actualDeliveryTm=$("#es_actualDeliveryTm").val(),f.es.actualDeliveryDt=$("#es_actualDeliveryDt").val(),""!=f.es.pickupDt&&(f.es.pickupDt=new Date(f.es.pickupDt)),""!=f.es.actualPickupDt&&(f.es.actualPickupDt=new Date(f.es.actualPickupDt)),""!=f.es.requestedDeliveryDt&&(f.es.requestedDeliveryDt=new Date(f.es.requestedDeliveryDt)),""!=f.es.actualDeliveryDt&&(f.es.actualDeliveryDt=new Date(f.es.actualDeliveryDt)),void 0!==f.attachment&&0<f.attachment.length&&""!=f.attachment&&(f.es.relativePath=f.attachmentPath),f.es.userId=g.currentUser.userId,f.es.createUserId=g.currentUser.userName,f.es.timezone=g.currentUser.partner.timezone,h.UpdateShipment(f.es).then(function(e){o.loading=!1,n.closeAll(),D(),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w()})},f.closeOrderSequenceDialog=function(){f.dialogOrderSequence.close(),f.dialogOrderSequence=void 0,"Select"==f.criteria&&(f.fetchCategory=0),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w()},f.closeEditDialog=function(){o.loading=!1,n.closeAll(),D(),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w()},f.initShipment=function(){f.editShipmentPickedUpUnit="N",f.editShipmentPickupDt="N",f.editShipmentPickupTm="N",f.editShipmentActualPickupDt="N",f.editShipmentActualPickupTm="N",f.editShipmentDeliveryDt="N",f.editShipmentDeliveryTm="N",f.editShipmentActualDeliveryDt="N",f.editShipmentActualDeliveryTm="N",f.editShipmentPickedUpUnit="N",f.editShipmentDeliveredUnit="N",5==f.es.statusId||15==f.es.statusId?(f.editShipmentActualDeliveryDt="Y",f.editShipmentActualDeliveryTm="Y",f.editShipmentDeliveredUnit="Y"):7!=f.es.statusId&&9!=f.es.statusId||(f.editShipmentActualPickupDt="Y",f.editShipmentActualPickupTm="Y",f.editShipmentPickedUpUnit="Y")},f.chatShipment=function(e){f.isHistoryChatDate(e)?f.openDialogHistory(e):e.driverInfo?(e="?token="+g.currentUser.param.token+"&shipmentId="+e.shipmentId+"&type=dispatch",s.get("/integration-api/service/xmpp-shipment-group"+e).then(function(e){window.globalConverse.api.rooms.open(e.data.room)},function(e){})):toastr.error("No driver was assigned.")},f.checkUserIsAvailableChat=function(){return g.currentUser.provider&&g.currentUser.provider.chatAvailable},f.openDialogHistory=function(e){o.loading=!0;e="?token="+g.currentUser.param.token+"&shipmentId="+e.shipmentId+"&type=dispatch";s.get("/integration-api/service/xmpp-chat-logs"+e).then(function(e){f.dialog=n.open({template:"app/dispatcher/chat.dialog.html",className:"ngdialog-overlay ngdialog-lg",scope:o,showClose:!1,modal:!0,data:{resultData:e.data}}),l(function(){$("#log").DataTable()},1e3),o.loading=!1},function(e){})},f.isHistoryChatDate=function(e){var t,s;return e.actualDeliveryDate?(new Date(e.actualDeliveryDate),t=new Date,Date.prototype.addHours=function(e){return this.setHours(this.getHours()+e),this},s=(new Date).addHours(parseInt(g.currentUser.provider.chatHourExpiration)),t.valueOf()>=s.valueOf()):"UNDLVR"===e.statusCd||"LEFT_DL"===e.statusCd},f.editShipment=function(e){f.editIndex=f.dispatchers.indexOf(e),f.es=e,f.prFlg="Y",f.dvFlg="Y",f.dlFlg="Y",f.pkFlg="Y",f.itFlg="Y",f.undlvrFlg="Y",f.editShipmentPickedUpUnit="N",f.editShipmentPickupDt="N",f.editShipmentPickupTm="N",f.editShipmentActualPickupDt="N",f.editShipmentActualPickupTm="N",f.editShipmentDeliveryDt="N",f.editShipmentDeliveryTm="N",f.editShipmentActualDeliveryDt="N",f.editShipmentActualDeliveryTm="N",f.editShipmentPickedUpUnit="N",f.editShipmentDeliveredUnit="N",f.editShipmentButton="N",1==f.es.statusId?(f.prFlg="N",f.dvFlg="N",f.dlFlg="N",f.pkFlg="N",f.itFlg="N",f.undlvrFlg="N"):5==f.es.statusId||15==f.es.statusId?(f.pkFlg="N",f.dlFlg="N",f.itFlg="N",f.undlvrFlg="N",f.prFlg="N",f.editShipmentActualDeliveryDt="Y",f.editShipmentActualDeliveryTm="Y",f.editShipmentDeliveredUnit="Y"):7==f.es.statusId||9==f.es.statusId?(f.prFlg="N",f.editShipmentActualPickupDt="Y",f.editShipmentActualPickupTm="Y",f.editShipmentPickedUpUnit="Y"):20!=f.es.statusId&&(f.es.statusId=-2),void 0!==f.es.pickupDt?(f.s_pickupTm=P(f.es.pickupDt),f.s_pickupDt=(""+f.es.pickupDt).substring(0,10).replace(/-/g,"/")):(f.s_pickupTm="",f.s_pickupDt=""),void 0!==f.es.actualPickupDt?(f.s_actualPickupTm=P(f.es.actualPickupDt),f.s_actualPickupDt=(""+f.es.actualPickupDt).substring(0,10).replace(/-/g,"/")):(f.s_actualPickupTm="",f.s_actualPickupDt=""),void 0!==f.es.requestedDeliveryDt?(f.s_requestedDeliveryTm=P(f.es.requestedDeliveryDt),f.s_requestedDeliveryDt=(""+f.es.requestedDeliveryDt).substring(0,10).replace(/-/g,"/")):(f.s_requestedDeliveryTm="",f.s_requestedDeliveryDt=""),void 0!==f.es.actualDeliveryDt?(f.s_actualDeliveryTm=P(f.es.actualDeliveryDt),f.s_actualDeliveryDt=(""+f.es.actualDeliveryDt).substring(0,10).replace(/-/g,"/")):(f.s_actualDeliveryTm="",f.s_actualDeliveryDt=""),h.GetReasons().then(function(e){f.reasons=e,f.reasons.push({reasonCd:"UNKNOWN",reason:"Select One"}),f.reasonCd="UNKNOWN",f.editShipmentDialog=n.open({template:"app/dispatcher/shipment.edit.view.html",className:"ngdialog-overlay",scope:o,showClose:!1,modal:!0,controller:this})})},f.editShipmentStatus=function(){f.initShipment()},f.onChangeReason=function(){"UNKNOWN"==f.reasonCd?(console.log("went here"),f.editShipmentButton="N"):f.editShipmentButton="Y"},f.firstTnTRendering=function(){$("#tnts").DataTable()},f.initTntTable=function(e){$("#tnts thead").unbind("click"),$("#tnts").DataTable().clear().draw(),$("#tnts").dataTable().fnDestroy(),l(function(){var e=$("#tnts thead th:not(:hidden)").length,t=$("#tnts").DataTable({order:[[e,f.sortTnT]],searching:!0,bDestroy:!0,displayLength:25,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]});$("#tnts thead").on("click","th",function(){0==t.column(this).index()&&(t.column(this),"desc"==f.sortTnT?f.sortTnT="asc":f.sortTnT="desc")})},100),o.trackloading=!1},f.initDocTable=function(e){var t="#"+e;$(t).DataTable({searching:!1,bDestroy:!0,displayLength:1,aLengthMenu:[[1,2,3,-1],[1,2,3,"All"]]}).draw(),l(function(){$(t).DataTable({searching:!1,bDestroy:!0,displayLength:1,aLengthMenu:[[1,2,3,-1],[1,2,3,"All"]]})},100)},f.manageAsset=function(){f.opt||(f.dispatcherShipmentAsset=void 0,f.tagId=-2,f.addAssetId=null,f.isAssetManager="N",f.assetTypeValue=-1,f.assetStatusValue=-1,f.serviceArea=[],f.serviceAreaId=0,l(function(){f.opt=n.open({template:"app/dispatcher/asset.html",className:"ngdialog-overlay ngdialog-lg",scope:o,showClose:!1,modal:!0,closeByDocument:!1,closeByEscape:!1,controller:this,resolve:f.initDataTable("assets")})},0),h.dsqlGetAssets(g.currentUser.partnerCd).then(function(e){h.dsqlGetServiceAreas(g.currentUser.partnerCd).then(function(e){f.serviceArea=e.serviceAreas.result,f.dataLoading=!1}),f.assets=e.assets.result,f.initDataTable("assets")}))},f.clearAssetName=function(){f.disabledAsset=!0,f.assetname="",f.assetSearch="Y",f.addAssetName="",f.addAssetTagName="",f.assetTypeValue=-1,f.assetStatusValue=-1,f.addAssetId=null,f.tagId=-2,f.serviceArea=[],f.serviceAreaId=0},f.validateAssetName=function(){var e;f.assetname?(e={},f.originalAssetName=f.assetname,e.reference=f.assetname,e.provider=g.currentUser.partnerCd,h.GetAssetByName(e).then(function(e){angular.isObject(e)&&0<e.length&&e[0].assetNumber==e[0].assetTypeCd?(toastr.error("This asset is a reserved equipment. Please try a unique asset name."),$("#uiEnterAssetName").focus()):(f.assetSearch="N",f.disabledAsset=!1,f.addAssetTagName="",f.assetTypeValue=-1,f.assetStatusValue=-1,f.addAssetId=null,f.tagId=-2,f.serviceArea=[],f.serviceAreaId=0,angular.isObject(e)&&0<e.length?(console.log("existing",e),E(e[0],"retain"),f.originalAssetName=e[0].assetNumber):f.addAssetName=f.assetname)})):(toastr.error("asset name is required."),$("#uiEnterAssetName").focus())},f.openAssetForm=function(){f.opt||(f.addAssetId=null,1==angular.element(document.getElementById("uiChkbIsSingleAsset"))[0].checked?(f.isAssetManager="Y",f.assetTypeValue=-1,f.assetStatusValue=-1,l(function(){f.opt=n.open({template:"app/dispatcher/asset.html",className:"ngdialog-overlay  ngdialog-lg",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this,resolve:f.initDataTable("assets")})},0),h.dsqlGetAssets(g.currentUser.partnerCd).then(function(e){f.assets=[],f.assets=e.assets.result,f.initDataTable("assets")})):f.assetInfo="")},f.displayTnT=function(){var e={};e.proBillNbr=f.currentProBillNbr,e.currentTimezone=f.currentTimezone,e.defaultTimezone=g.currentUser.partner.timezone,e.dataStagingThreshold=g.currentUser.param.dataStagingThreshold,void 0===e.dataStagingThreshold&&(e.dataStagingThreshold=1e3),f.dataLoading=!0,h.TrackShipment(e).then(function(e){f.initTntTable("tnts"),f.tracks=e,console.log(f.tracks),f.dataLoading=!1})},f.openBCLink=function(e){console.log(e),t.open(e,"_blank")},f.createBlockchainLinkElementId=function(e){e="blockchain-link-"+e.replace(/\s+/g,"-").toLowerCase();return console.log(e),e},f.displayTnT2=function(){console.log("displaying TnT");f.currentProBillNbr,angular.element(document.getElementById("tntTimezone"))[0].value,g.currentUser.partner.timezone,$("#tnts").DataTable().clear().draw(),$("#tnts").dataTable().fnDestroy(),f.initTntTable("tnts"),console.log("tracks",f.tracks)},f.isShipmentReady=function(){o.loading=!0,h.FetchPurchaseOrder(f.shipment.shipmentNbr,f.shipment.legNbr).then(function(e){f.po=e,console.log("VM PO",f.po),o.loading=!1})},f.isTnTReady=function(){f.initTntTable("tnts")},f.openPoDetails=function(){},f.openShipmentDetails=function(i,e){var t=d.open({templateUrl:"app/dispatcher/md.podetail.view.html",controller:function(r,e,t){var s;r.mdIsProcessing=!1,r.optable=m,r.locations=[],r.isPickupNewAddress=!1,r.isDeliveryNewAddress=!1,r.isEditComments=!1,r.isUpdatingComment=!1,r.comment="",r.pickupDateTime={date:"",time:""},r.pickupEdited=null,r.deliveryDateTime={date:"",time:""},r.deliveryEdited=null,r.equipmentId=null,r.containerId=null,r.chassisId=null,r.assets=[],r.uoms=[],r.isPinMap=!1;function a(e,t){"pickup"===e&&(t=t||r.poDetail.pickupId,h.GetLocationById(t).then(function(e){0<e.length&&(r.pickupLocations=e,r.pickupEdited=JSON.parse(JSON.stringify(e[0])),r.isPickupNewAddress=!1)})),"delivery"===e&&(t=t||r.poDetail.deliveryId,h.GetLocationById(t).then(function(e){0<e.length&&(r.deliveryLocations=e,r.deliveryEdited=JSON.parse(JSON.stringify(e[0])),r.isDeliveryNewAddress=!1)}))}r.pickupLocationConfig={maxItems:1,valueField:"id",labelField:"name",searchField:["consigneeCd","name"],loadThrottle:500,load:function(e,t){if(!e.length)return t();$.ajax({url:"/tms-api/dispatcher/location",type:"GET",dataType:"json",data:{name:e},error:function(){t()},success:function(e){t(e)}})},onChange:function(e){void 0!==e&&a("pickup",e)},create:function(e){return 300<=e.length?(toastr.error("Location name must not exceed 300 characters."),null):(r.pickupEdited={},r.pickupEdited.name=e,r.isPickupNewAddress=!0,{id:-1,name:e})}},r.deliveryLocationConfig={maxItems:1,valueField:"id",labelField:"name",searchField:["consigneeCd","name"],loadThrottle:500,load:function(e,t){if(!e.length)return t();$.ajax({url:"/tms-api/dispatcher/location",type:"GET",dataType:"json",data:{name:e},error:function(){t()},success:function(e){t(e)}})},onChange:function(e){void 0!==e&&a("delivery",e)},create:function(e){return 300<=e.length?(toastr.error("Location name must not exceed 300 characters."),null):(r.deliveryEdited={},r.deliveryEdited.name=e,r.isDeliveryNewAddress=!0,{id:-1,name:e})}},r.showEditableField=function(e){"isEditRequestedPickupDate"===e?(r.pickupDateTime.date=r.poDetail.pickupDt.split(" ")[0],r.pickupDateTime.time=r.poDetail.pickupDt.split(" ")[1]+" "+r.poDetail.pickupDt.split(" ")[2],$("#req-pickup-time").val(r.pickupDateTime.time)):"isEditRequestedDeliveryDate"===e?(r.deliveryDateTime.date=r.poDetail.deliveryDt.split(" ")[0],r.deliveryDateTime.time=r.poDetail.deliveryDt.split(" ")[1]+" "+r.poDetail.deliveryDt.split(" ")[2],$("#req-delivery-time").val(r.deliveryDateTime.time)):"isEditEquipmentNbr"===e?r.equipmentId=r.poDetail.equipmentId:"isEditContainerNbr"===e?r.containerId=r.poDetail.containerId:"isEditChassisNbr"===e&&(r.chassisId=r.poDetail.chassisId),r[e]=!0},r.locationType="",r.showPinMap=function(e){var t,s,i;e&&(r.isPinMap=!0,r.locationType=e,r.editLatitude=r[e].lat,r.editLongitude=r[e].lon,e=12.103027175625366,t=122.7284319643599,new google.maps.InfoWindow,i={zoom:r.editLatitude&&r.editLongitude?8:5,center:new google.maps.LatLng(r.editLatitude||e,r.editLongitude||t)},r.gMap=new google.maps.Map(document.getElementById("googleMap"),i),s=[],i=new google.maps.Marker({map:r.gMap,position:new google.maps.LatLng(r.editLatitude||e,r.editLongitude||t)}),s.push(i),r.gMap.addListener("click",function(e){r.editLatitude=e.latLng.lat()+"",r.editLongitude=e.latLng.lng()+"",s[0].setMap(null),s=[];e=new google.maps.Marker({map:r.gMap,position:new google.maps.LatLng(r.editLatitude,r.editLongitude)});s.push(e)}))},r.hidePinMap=function(e){e&&(r[r.locationType].lat=r.editLatitude||0,r[r.locationType].lon=r.editLongitude||0,console.log(r[r.locationType])),r.locationType="",r.isPinMap=!1},r.showEditableComment=function(){var e=JSON.parse(JSON.stringify(r.poDetail));r.isEditComments=!0,r.comment=e.instructionTxt},r.cancelComment=function(){r.isEditComments=!1,r.poDetail.instructionTxt=r.comment,r.isUpdatingComment=!1},r.clearComment=function(e){r.poDetail.instructionTxt=""},r.saveComment=function(){var e=JSON.parse(JSON.stringify(r.poDetail));e&&(r.isUpdatingComment=!0,h.SaveInstruction({shipmentId:e.shipmentId,instructionTxt:e.instructionTxt}).then(function(e){r.hasUpdates=!0,r.isUpdatingComment=!1,r.isEditComments=!1}))},r.clearLocationDetails=function(e){r[e]=null},r.hasUpdates=!1,r.savePoDetailChanges=function(e,t,s){if(e){var i={proBillNbr:r.poDetail.proBillNbr,legNbr:r.poDetail.legNbr};switch(s){case"pickupDateTime":i.pickupDt=r.pickupDateTime.date+" "+$("#req-pickup-time").val().trim(),h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.pickupDt=i.pickupDt});break;case"deliveryDateTime":i.deliveryDt=r.deliveryDateTime.date+" "+$("#req-delivery-time").val().trim(),h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.deliveryDt=i.deliveryDt});break;case"pickupEdited":null===r.pickupEdited||void 0===r.pickupEdited.id?a("pickup"):"-1"===r.pickupEdited.id?h.SaveShipmentNewLocation(r.pickupEdited).then(function(e){i.pickupId=e.id,r.isPickupNewAddress=!1,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.pickupId=i.pickupId,a("pickup")})}):h.SaveShipmentLocation(r.pickupEdited).then(function(e){i.pickupId=r.pickupEdited.id,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.pickupId=i.pickupId,a("pickup")})});break;case"deliveryEdited":null===r.deliveryEdited||void 0===r.deliveryEdited.id?a("delivery"):"-1"===r.deliveryEdited.id?h.SaveShipmentNewLocation(r.deliveryEdited).then(function(e){i.deliveryId=e.id,r.isDeliveryNewAddress=!1,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.deliveryId=i.deliveryId,a("delivery")})}):h.SaveShipmentLocation(r.deliveryEdited).then(function(e){i.deliveryId=r.deliveryEdited.id,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.deliveryId=i.deliveryId,a("delivery")})});break;case"equipmentId":i.equipmentId=r.equipmentId,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.equipmentId=parseInt(i.equipmentId);for(var t of r.assets)if(t.assetId===r.poDetail.equipmentId){r.poDetail.equipmentNbr=t.assetNumber;break}});break;case"containerId":i.containerId=r.containerId,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.containerId=parseInt(i.containerId);for(var t of r.assets)if(t.assetId===r.poDetail.containerId){r.poDetail.containerNbr=t.assetNumber;break}});break;case"chassisId":i.chassisId=r.chassisId,h.SaveShipmentByProperty(i).then(function(e){r.hasUpdates=!0,r.poDetail.chassisId=parseInt(i.chassisId);for(var t of r.assets)if(t.assetId===r.poDetail.chassisId){r.poDetail.chassisNbr=t.assetNumber;break}})}}else a(s);r[t]=!1},r.findUomDesc=function(t){var e=r.uoms.filter(e=>e.uomCd===t);return 0<e.length?e[0].uomDescriptionTxt:"--"},r.editLineItem=function(e){e.edit=JSON.parse(JSON.stringify(e)),e.isEditing=!0,console.log(e)},r.cancelEditLineItem=function(e){confirm("Are you sure you want to cancel changes?")&&(e.isEditing=!1,delete e.edit)},r.saveEditLineItem=function(s){if(confirm("Are you sure you want to save changes?")){var e,i=JSON.parse(JSON.stringify(s.edit));for(e in s)if("$$hashKey"!=e&&"edit"!=e)if(0<=["shipmentWt","shipmentVol","orderedQty","shippedQty","deliveredQty","totalDeliveredQty"].indexOf(e))i[e]=i[e]||0;else{if("productCd"===e){if(!i[e]||""===i[e].trim())return void alert("Product Code is required")}else if("productDescription"===e&&(!i[e]||""===i[e].trim()))return void alert("Product Description is required");i[e]=i[e]||""}r.mdIsProcessing=!0,h.SaveShipmentLineItem(i).then(function(e){r.mdIsProcessing=!1,delete s.edit;for(const t in i)s[t]=i[t];s.isEditing=!1})}},r.closeModal=function(){r.hasUpdates&&(1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w()),e.dismiss("cancel")},r.mdIsProcessing=!0,l(function(){u.initializeDatePicker("req-pickup-date"),$("#req-pickup-time").datetimepicker({format:"LT"}),u.initializeDatePicker("req-delivery-date"),$("#req-delivery-time").datetimepicker({format:"LT"})},700),(s={}).parent=g.currentUser.parentPartnerCd,s.partner="-",p.ListUom(s).then(function(e){if(angular.isObject(e)&&0<e.length){r.uoms=[];for(var t=0;t<e.length;t++)r.uoms.push(e[t])}}),h.ListCountries().then(function(e){r.countries=e}),h.dsqlGetAssets(g.currentUser.partnerCd).then(function(e){r.assets=[],r.assets=e.assets.result}),h.FetchPurchaseOrder(i.shipmentNbr,i.legNbr).then(function(e){null!==e&&(r.poDetail=e,r.optable.setObjectList(r.poDetail.items2),a("pickup"),a("delivery"),r.mdIsProcessing=!1)})},scope:o,size:"lg",backdrop:"static",resolve:{options:function(){}}});l(function(){t.result.then(function(){console.log("Modal Closed!!!")},function(){e&&(f.dataLoading=!1,D(),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w())})},500)},f.closeTnTDialog=function(){f.dialogTNT.close(),f.dialogTNT=void 0},f.isDialogClosed=!0,f.openTrackTrace=function(e){var t;f.dialogTNT&&!f.isDialogClosed||(o.loading=!0,t=f.dispatchers[e].shipmentNbr,f.dialogTNT=null,f.currentProBillNbr=t,f.currentLegNbr=f.dispatchers[e].legNbr,A=f.dispatchers[e],f.selectedIndex=e,f.currentTimezone=g.currentUser.partner.timezone,f.fields={},f.fields.proBillNbr=t,f.fields.currentTimezone=g.currentUser.partner.timezone,f.fields.defaultTimezone=g.currentUser.partner.timezone,f.fields.dataStagingThreshold=g.currentUser.param.dataStagingThreshold,void 0===f.fields.dataStagingThreshold&&(f.fields.dataStagingThreshold=1e3),console.log(f.fields),f.setTntMapSrc(f.dispatchers[e]),function(){f.dialogTNT=n.open({template:"app/dispatcher/tnt-map.html",className:"ngdialog-overlay ngdialog-xl",scope:o,showClose:!1,modal:!0,closeByDocument:!1,closeByEscape:!0,controller:this})}())},f.addAsset=function(){f.assetname=void 0,f.assetSearch="Y",f.disabledAsset=!0,f.allowAddFlg=!1,f.opt2||(void 0!==f.currentDriverIndex&&(f.actualDrivers[f.currentDriverIndex].ticked=!1),f.previousTagId,f.addAssetName="",f.addAssetTagName="",f.assetTypeValue=-1,f.assetStatusValue=-1,f.addAssetId=null,f.assetTitle="Add Asset",f.currentAsset,h.dsqlGetServiceAreas(g.currentUser.partnerCd).then(function(e){f.serviceArea=e.serviceAreas.result,f.disabledAsset=!1,f.opt2=n.open({template:"app/dispatcher/asset.add.view.html",className:"ngdialog-overlay",scope:o,closeByDocument:!1,closeByEscape:!1,modal:!0,showClose:!1,controller:this}),l(function(){$("#assetSingleDriver").select2()},100)}))},f.declineLoad=function(){f.declinedProcessFlg="N";for(var e=!(f.declineShowFlg=!0),t=0;t<f.dispatchers.length;t++){if(1==f.dispatchers[t].checked){e=!0;break}for(var s=0;s<f.dispatchers[t].subProbill.length;s++)if(1==f.dispatchers[t].subProbill[s].checked){e=!0;break}}e?n.open({template:"app/dispatcher/decline.html",className:"ngdialog-theme-default",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this}):(f.declinedProcessFlg="Y",f.declineShowFlg=void 0,toastr.clear(),toastr.error("No shipment selected. Please select load to be declined"))},f.exitDeclinedError=function(){console.log("went here"),f.leaveDialog.close()},f.editShipmentAssetNumber=function(e,t){console.log("shipment",e),f.opt2||((f.dispatcherShipmentAsset=e).assetNumber===e.assetTypeCd?(f.assetname=e.assetNumber,f.disabledAsset=!1,f.allowAddFlg=!1,void 0!==f.currentDriverIndex&&(f.actualDrivers[f.currentDriverIndex].ticked=!1),f.previousTagId,f.addAssetName="",f.addAssetTagName="",f.assetTypeValue=e.assetTypeId,f.assetStatusValue=-1,f.addAssetId=null,f.assetTitle="Add Asset",f.currentAsset,h.dsqlGetServiceAreas(g.currentUser.partnerCd).then(function(e){f.serviceArea=e.serviceAreas.result,f.disabledAsset=!1,f.opt2=n.open({template:"app/dispatcher/asset.add.view.html",className:"ngdialog-overlay",scope:o,closeByDocument:!1,closeByEscape:!1,modal:!0,showClose:!1,controller:this}),l(function(){$("#assetSingleDriver").select2()},100)})):h.GetAssetById(e[t]).then(function(t){console.log("current asset",t);var s="";void 0!==t.tagCd&&(s+=t.tagCd),void 0!==t.macAddress&&(s=s+"("+t.macAddress+")"),f.previousTagId=t.tagId,f.addAssetName=t.assetNumber,f.originalAssetName=t.assetNumber,f.addAssetTagName=t.tagNumber,f.assetTypeValue=t.assetTypeId,f.assetStatusValue=t.assetStatusId,f.addAssetId=t.assetId,f.tagId=t.tagId,f.assetTitle="Edit Asset",f.currentAsset=t,L(t.mobileUserId),h.GetTags().then(function(e){f.tags=e,""===f.tags&&(f.tags=[]),console.log("tags",e),f.tags.push({macAddress:t.macAddress,tagCd:t.tagCd,tagId:t.tagId,tagInfo:s}),f.tagId=t.tagId,f.assetname=t.assetNumber,f.assetSearch="N",f.disabledAsset=!1,f.opt2=n.open({template:"app/dispatcher/asset.add.view.html",className:"ngdialog-overlay",scope:o,showClose:!1,modal:!0,closeByDocument:!1,closeByEscape:!1,controller:this})})}))},f.editAsset=function(e){E(e,"edit")},f.closeAsset=function(){var e;"Y"==f.forceeditasset?f.forceeditasset:"Yes"!=f.isAssetManager&&"Y"!=f.isAssetManager||(1!=(e=angular.element(document.getElementById("uiChkbIsSingleAsset"))[0]).checked||f.assetInfo||(e.checked=!1)),f.opt.close(),f.opt=void 0},f.closeAddAsset=function(){f.allowAddFlg=!0,void 0!==f.opt2&&(f.opt2.close(),f.opt2=void 0),void 0!==f.opt&&(f.opt.close(),f.opt=void 0,l(function(){1==angular.element(document.getElementById("uiChkbIsSingleAsset"))[0].checked?f.openAssetForm():f.manageAsset()},100))},f.submitNewAsset=function(){f.dataLoading=!0,void 0!==f.tagId&&f.tagId||(f.tagId=-2);var e=U(f.tagId),t={assetId:f.addAssetId,scacCd:g.currentUser.partnerCd,assetNumber:f.addAssetName,tagCd:e.tagCd,macAddress:e.macAddress,assetTypeId:f.assetTypeValue,tagId:e.tagId,timezone:g.currentUser.partner.timezone,previousTagId:f.previousTagId,assetStatusId:f.assetStatusValue};0<f.selectedDrivers.length&&(t.mobileUserId=f.selectedDrivers[0].mobileUserId),console.log("new Asset",t),void 0!==e.tagCd?h.NewAsset(t).then(function(e){f.dataLoading=!1,angular.isObject(e)?toastr.success("Saved Successfully."):toastr.error("Failed to manage asset."),f.closeAddAsset()}):(f.dataLoading=!1,toastr.error("Failed to manage asset."))},f.submitEditAsset=function(){console.log("submit",f.originalAssetName),console.log("submit",f.assetname),f.originalAssetName||(f.originalAssetName=f.assetname);var e={};e.reference=f.addAssetName,e.provider=g.currentUser.partnerCd,f.addAssetName!=f.originalAssetName?h.GetAssetByName(e).then(function(e){angular.isObject(e)&&0<e.length?(toastr.error("You are creating asset that is already been used or a reserved asset."),$("#uiAssetName").focus()):q()}):q()},f.closeDecline=function(){n.closeAll(),f.declineShowFlg=void 0},f.decline=function(){if(f.declinedProcessFlg="Y",f.reason){var e=[];if(n.closeAll(),f.dataLoading=!0,0<f.dispatchers.length)for(var t=f.dispatchers,s=0;s<f.dispatchers.length;s++)if(1==f.dispatchers[s].checked&&(f.dispatchers[s].comments=f.reason,f.dispatchers[s].createUserId=g.currentUser.userName,e.push(f.dispatchers[s]),"VPO"==f.dispatchers[s].poTypeCd))for(var i=0;i<t.length;i++)void 0!==t[i].vpoReferenceNumber&&t[i].vpoReferenceNumber==f.dispatchers[s].shipmentNbr&&(t[i].comments=f.reason,t[i].createUserId=g.currentUser.userName,e.push(t[i]));0<e.length?(console.log("shipments",e),h.DeclineLoad(e).then(function(e){f.dataLoading=!1,D(),1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w(),"success"==e.response?toastr.success("Saved Successfully."):toastr.error("Failed to decline load."),f.declineShowFlg=void 0})):(f.dataLoading=!1,f.declineShowFlg=void 0)}else f.declinedProcessFlg="N",toastr.clear(),toastr.error("You must provide reason why shipment has to be declined."),$("#uiTextbDeclineReason").focus()},f.verifyDriverChange=function(e){},f.checkItem=function(e,t){f.dispatchers[+e].checked=t.target.checked},f.checkSubItem=function(e,t,s){for(var i=JSON.parse(JSON.stringify(f.dispatchers)),r=0;r<f.dispatchers.length;r++)if(f.dispatchers[r].shipmentNbr===s.shipmentNbr){f.dispatchers[r].subProbill[+e].checked=!f.dispatchers[r].subProbill[+e].checked,f.dispatchers[r].subProbill[+e].driverInfo=s.driverInfo,f.dispatchers[r].subProbill[+e].mobileUserId=s.mobileUserId;break}console.log(f.dispatchers,i)},f.assignLoad=function(){f.dataLoading=!0;for(var e=[],t=-2,s="",i="",r="",a=!(f.assignShowFlg=!0),n=0;n<f.dispatchers.length;n++){if(1==f.dispatchers[n].checked){a=!0;break}for(var o=0;o<f.dispatchers[n].subProbill.length;o++)if(1==f.dispatchers[n].subProbill[o].checked){a=!0;break}}if(a){angular.element(document.getElementById("uiChkbIsSingleAsset"))[0];if(0!=function(){if(f.singleDriver&&f.driver<0)return f.dataLoading=!1,f.assignShowFlg=void 0,toastr.error("driver is required for shipment(s) assigned to single driver!"),$("#singleDriver").focus(),0;if(f.singleAsset&&!f.assetInfo)return f.dataLoading=!1,f.assignShowFlg=void 0,toastr.error("asset is required."),$("#uiChkbIsSingleAsset").focus(),0;for(var e=0;e<f.dispatchers.length;e++)if(1==f.dispatchers[e].checked&&0==f.singleDriver){var t=f.dispatchers[e].driverInfo;if(!t&&0==f.singleAsset)return f.dataLoading=!1,f.assignShowFlg=void 0,$("#"+f.dispatchers[e].dispatchId).focus(),toastr.error("driver is required!"),0;if(t){for(var s=void 0,i=0;i<f.actualDriversAuto.length;i++)t==f.actualDriversAuto[i]&&(s="true");if(void 0===s)return f.dataLoading=!1,f.assignShowFlg=void 0,$("#"+f.dispatchers[e].dispatchId).focus(),toastr.error("driver is not registered!"),0}}return 1}()){if(1==f.singleDriver&&0<f.driver)var l=angular.element(document.getElementById("singleDriver"))[0],s=(p=f.drivers[l.value]).firstName,i=p.lastName,t=p.mobileUserId,r=p.phoneNbr;else if(1==f.singleDriver&&f.driver<0)return(l=angular.element(document.getElementById("singleDriver"))[0]).focus(),f.dataLoading=!1,void(f.assignShowFlg=void 0);if(0<f.dispatchers.length){console.log(f.dispatchers);for(var d=f.dispatchers,n=0;n<f.dispatchers.length;n++){if(1==f.dispatchers[n].checked)if(0==f.singleDriver?(t=C(f.dispatchers[n].driverInfo),p=O(f.dispatchers[n].mobileUserId=t),f.dispatchers[n].firstName=p.firstName,f.dispatchers[n].lastName=p.lastName):(f.dispatchers[n].mobileUserId=t,f.dispatchers[n].firstName=s,f.dispatchers[n].lastName=i),f.dispatchers[n].phoneNbr=r,1==f.singleAsset&&""!=f.assetInfo?(f.dispatchers[n].assetId=f.assetId,f.dispatchers[n].tagId=f.assetTagId):f.singleAsset=!1,f.dispatchers[n].createUserId=g.currentUser.userName,void 0!==g.currentUser.partner.timezone&&(f.dispatchers[n].timezone=g.currentUser.partner.timezone),e.push(f.dispatchers[n]),"VPO"==f.dispatchers[n].poTypeCd)for(o=0;o<d.length;o++)void 0!==d[o].vpoReferenceNumber&&d[o].vpoReferenceNumber==f.dispatchers[n].shipmentNbr&&(d[o].timezone=f.dispatchers[n].timezone,d[o].mobileUserId=f.dispatchers[n].mobileUserId,d[o].createUserId=f.dispatchers[n].createUserId,d[o].assetId=f.dispatchers[n].assetId,e.push(d[o]));var c=f.dispatchers[n].subProbill;if(0<c.length)for(var p,o=0;o<c.length;o++)if(1==c[o].checked)if(0==f.singleDriver?(t=C(c[o].driverInfo),p=O(c[o].mobileUserId=t),c[o].firstName=p.firstName,c[o].lastName=p.lastName):(c[o].mobileUserId=t,c[o].firstName=s,c[o].lastName=i),c[o].phoneNbr=r,1==f.singleAsset&&""!=f.assetInfo?(c[o].assetId=f.assetId,c[o].tagId=f.assetTagId):f.singleAsset=!1,c[o].createUserId=g.currentUser.userName,void 0!==g.currentUser.partner.timezone&&(c[o].timezone=g.currentUser.partner.timezone),e.push(c[o]),"VPO"==c[o].poTypeCd)for(var u=0;u<d.length;u++)void 0!==d[o].vpoReferenceNumber&&d[u].vpoReferenceNumber==c[o].shipmentNbr&&(d[u].timezone=c[o].timezone,d[u].mobileUserId=c[o].mobileUserId,d[u].createUserId=c[o].createUserId,d[u].assetId=c[o].assetId,e.push(d[u]))}}console.log(e),0<e.length?(console.log("shipments",e),h.AssignLoad(e).then(function(e){console.log("return",e),D(),f.dataLoading=!1,1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w(),"success"==e.response?toastr.success("Saved Successfully."):toastr.error("Failed to assign load."),f.assignShowFlg=void 0})):(f.assignShowFlg=void 0,f.dataLoading=!1)}}else f.assignShowFlg=void 0,f.dataLoading=!1,toastr.clear(),toastr.error("No shipment selected. Please select shipment to assign.")},f.unAssignLoad=function(){f.dataLoading=!0;for(var e=[],t=[],s=!(f.unAssignedShowFlg=!0),i=0;i<f.dispatchers.length;i++){if(1==f.dispatchers[i].checked){s=!0;break}for(var r=0;r<f.dispatchers[i].subProbill.length;r++)if(1==f.dispatchers[i].subProbill[r].checked){s=!0;break}}if(s){if(0<f.dispatchers.length){for(var a=f.dispatchers,i=0;i<f.dispatchers.length;i++){1==f.dispatchers[i].checked&&(console.log("driver",f.dispatchers[i].driverInfo),t.push(f.dispatchers[i]));for(r=0;r<f.dispatchers[i].subProbill.length;r++)1==f.dispatchers[i].subProbill[r].checked&&t.push(f.dispatchers[i].subProbill[r])}console.log("new",t)}if(0<t.length){a=f.lpoShipment;console.log("lpos",a);for(var n,i=0;i<t.length;i++)if(1==t[i].checked)if(0==f.singleDriver&&(n=t[i].driverInfo,console.log("driver",n),n=C(n),t[i].mobileUserId=n,console.log(n),n=O(n),t[i].firstName=n.firstName,t[i].lastName=n.lastName,t[i].phoneNbr=""),1==f.singleAsset&&""!=f.assetInfo?(t[i].assetId=f.assetId,t[i].tagId=f.assetTagId):f.singleAsset=!1,t[i].createUserId=g.currentUser.userName,void 0!==g.currentUser.partner.timezone&&(t[i].timezone=g.currentUser.partner.timezone),e.push(t[i]),"VPO"==t[i].poTypeCd)for(r=0;r<a.length;r++)void 0!==a[r].vpoReferenceNumber&&a[r].vpoReferenceNumber==t[i].shipmentNbr&&(a[r].timezone=t[i].timezone,a[r].mobileUserId=t[i].mobileUserId,a[r].createUserId=t[i].createUserId,a[r].assetId=t[i].assetId,e.push(a[r]))}0<e.length?(console.log("shipments",e),h.UnAssignLoad(e).then(function(e){console.log("return",e),D(),f.dataLoading=!1,1==f.fetchCategory?y():2==f.fetchCategory?k():3==f.fetchCategory&&w(),"success"==e.response?(f.unAssignedShowFlg=void 0,toastr.success("Saved Successfully.")):(f.unAssignedShowFlg=void 0,toastr.error("Failed to assign load."))})):(f.unAssignedShowFlg=void 0,f.dataLoading=!1)}else f.unAssignedShowFlg=void 0,f.dataLoading=!1,toastr.clear(),toastr.error("No shipment selected. Please select load to unassigned.")},f.changeCriteria=function(){f.isDateType=!1,f.isReferenceType=!1,f.isReferenceWithDate=!1,b(),"Select"!=f.criteria&&("ALL"==f.criteria||"PKR"==f.criteria||"DLVR"==f.criteria||"PR"==f.criteria||"AS"==f.criteria||"RA"==f.criteria||"DV"==f.criteria?f.isDateType=!0:"ON"==f.criteria||"DN"==f.criteria||"PRO"==f.criteria||"CPO"==f.criteria?f.isReferenceType=!0:"DRVT"!=f.criteria&&"DRVN"!=f.criteria&&"DRVL"!=f.criteria&&"SCN"!=f.criteria||(f.isReferenceWithDate=!0))},f.openOrderSequence=function(e){l(function(){n.open({template:"app/dispatcher/order.sequence.html",className:"ngdialog-overlay",scope:o,showClose:!1,closeByDocument:!1,closeByEscape:!1,modal:!0,controller:this})},100)},f.groupByPending=function(){var t;"0"==f.grpPending?$("#shipmentavailable").DataTable({bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]}):(t=$("#shipmentavailable").DataTable({columnDefs:[{visible:!0,targets:f.grpPending}],bDestroy:!0,order:[[f.grpPending,"asc"]],displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]],drawCallback:function(e){var t=this.api(),s=t.rows({page:"current"}).nodes(),i=null;t.column(f.grpPending,{page:"current"}).data().each(function(e,t){i!==e&&($(s).eq(t).before('<tr class="group"><td colspan="21">'+e+"</td></tr>"),i=e)})}}),$("#shipmentavailable tbody").on("click","tr.group",function(){var e=t.order()[0];(e[0]===f.grpPending&&"asc"===e[1]?t.order([f.grpPending,"desc"]):t.order([f.grpPending,"asc"])).draw()}))},f.previewPdf=function(e){console.log("preview",e),toastr.clear();e={parentPartnerCd:e.shipperCd,referenceNbr:e.shipmentNbr,carrierCd:e.scacCd};h.ViewPkBol(e).then(function(e){console.log("return",e),angular.isObject(e)?"200"==e.status?$(location).attr("href","https://"+f.host+"/files/doc/"+e.filename):toastr.error("failed to process request.."):toastr.error("failed to process request")})},f.testPdf=function(e){toastr.clear();e={parentPartnerCd:g.currentUser.parentPartnerCd,referenceNbr:e.probillnbr,carrierCd:"INTRSL"};h.ViewPkBol(e).then(function(e){console.log("return",e),angular.isObject(e)?"200"==e.status?$(location).attr("href","https://"+f.host+"/files/doc/"+e.filename):toastr.error("failed to process request.."):toastr.error("failed to process request")})},f.getVPOs=function(){h.GetConsolidatedLoads("GLAXO").then(function(e){console.log("return",e)})},f.groupBy=function(){"0"==f.grp?$("#shipments").DataTable({bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]}):($("#shipments").DataTable({columnDefs:[{visible:!0,targets:f.grp}],bDestroy:!0,order:[[f.grp,"asc"]],displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]],drawCallback:function(e){var t=this.api(),s=t.rows({page:"current"}).nodes(),i=null;t.column(f.grp,{page:"current"}).data().each(function(e,t){i!==e&&($(s).eq(t).before('<tr class="group"><td colspan="25">'+e+"</td></tr>"),i=e)})}}),$("#shipments tbody").on("click","tr.group",function(){var e=$("#shipments").DataTable(),t=e.order()[0];t[0]===f.grp&&"asc"===t[1]?(e=$("#shipments").DataTable({columnDefs:[{visible:!0,targets:f.grp}],bDestroy:!0,order:[[f.grp,"desc"]],displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]],drawCallback:function(e){var t=this.api(),s=t.rows({page:"current"}).nodes(),i=null;t.column(f.grp,{page:"current"}).data().each(function(e,t){i!==e&&($(s).eq(t).before('<tr class="group"><td colspan="25">'+e+"</td></tr>"),i=e)})}})).draw():$("#shipments").DataTable({columnDefs:[{visible:!0,targets:f.grp}],bDestroy:!0,order:[[f.grp,"asc"]],displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]],drawCallback:function(e){var t=this.api(),s=t.rows({page:"current"}).nodes(),i=null;t.column(f.grp,{page:"current"}).data().each(function(e,t){i!==e&&($(s).eq(t).before('<tr class="group"><td colspan="25">'+e+"</td></tr>"),i=e)})}})}))},f.canEditEvent=function(e){if(void 0!==e)switch(e.trim()){case"SLD":case"PK":case"PICKUP":case"SUL":case"DV":case"DELIVERED":case"UNDLVR":case"DELAYED":case"TGI":case"TGO":return!0;default:return!1}},f.toggleAddEventModal=function(a){f.closeTnTDialog(),console.log(a),void 0!==a&&("PICKUP"===a.eventCd&&(a.eventCd="PK"),"DELIVERED"===a.eventCd&&(a.eventCd="DV"));d.open({templateUrl:"app/dispatcher/md.event.view.html",controller:function(r,e,t){function s(){var e,t,s,i;void 0!==a?(r.title="Edit",e=a.eventDt,e=new Date(e),s=12<=e.getHours()?(t=parseInt(e.getHours())-12,"PM"):(t=e.getHours(),"AM"),i="",e.getSeconds()<10&&(i+="0"),i+=e.getSeconds(),t=t+":"+e.getMinutes()+":"+i+" "+s,r.eventObject={activityId:a.activityId,eventCd:a.eventCd,eventDesc:a.eventDesc,date:a.eventDt.split(" ")[0],time:t,previousComment:a.comments,reason:"",comment:"",legNbr:a.legNbr}):(r.title="Add",r.eventObject={legNbr:f.currentLegNbr}),r.eventObject.probillNbr=f.currentProBillNbr,r.mdIsProcessing=!1}r.mdIsProcessing=!0,r.eventObject={},r.submitEvent=function(){r.eventObject.time=$("#event-time").val().trim(),void 0===r.eventObject.eventCd?toastr.error("Please select an event type"):void 0===r.eventObject.date?toastr.error("Please enter date"):""===r.eventObject.time?toastr.error("Please enter time"):void 0===r.eventObject.previousComment||""===r.eventObject.previousComment.trim()?toastr.error("Please enter comment"):void 0===r.eventObject.reason||""===r.eventObject.reason.trim()?toastr.error("Please enter reason"):(r.eventObject.date=r.eventObject.date.split("-").join("/"),r.eventObject.eventDtStr=r.eventObject.date+" "+r.eventObject.time,r.eventObject.eventDesc=function(e){switch(e.trim()){case"SLD":return"Start Loading";case"PK":return"Picked Up";case"SUL":return"Start Unloading";case"DV":return"Delivered";case"UNDLVR":return"Undeliverable";case"DELAYED":return"Delayed";case"BAYASSIGN":return"Loading Bay Assignment";case"TGI":return"Truck Gate - In";case"TGO":return"Truck Gate - Out";default:return""}}(r.eventObject.eventCd),r.eventObject.comment=r.eventObject.previousComment.trim()+"\nReason: "+r.eventObject.reason.trim(),r.mdIsProcessing=!0,h.SaveActivity(r.eventObject).then(function(e){"PK"===e.eventCd||"DV"===e.eventCd?l(function(){1==confirm("Do you want to change the shipment's status?")?h.SaveShipmentStatus(e).then(function(e){r.mdIsProcessing=!1,toastr.success("Shipment status has been updated. Event will be processed in a few minutes."),r.closeModal()}):(r.mdIsProcessing=!1,toastr.success("Event will be processed in a few minutes."),r.closeModal())},700):(r.mdIsProcessing=!1,toastr.success("Event will be processed in a few minutes."),r.closeModal())}))},r.closeModal=function(){e.dismiss("cancel"),function(){f.dialogTNT=n.open({template:"app/dispatcher/track.html",className:"ngdialog-overlay ngdialog-xl",scope:o,showClose:!1,modal:!0,closeByDocument:!1,closeByEscape:!0,controller:this}),f.dataLoading=!1}()},l(function(){s()},1e3)},scope:o,size:"lg",backdrop:"static",resolve:{options:function(){}}})},f.toggleSensorChkbox=function(e){a=e,f.setMapSrc(A)}}angular.module("app").controller("DispatcherController",e).directive("loading",function(){return{restrict:"E",replace:!0,template:'<div class="loading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />LOADING...</div>',link:function(e,t,s){e.$watch("loading",function(e){e?$(t).show():$(t).hide()})}}}).directive("repeatDone",function(){return function(e,t,s){e.$last&&e.$eval(s.repeatDone)}}).directive("trackloading",function(){return{restrict:"E",replace:!0,template:'<div class="trackloading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />LOADING...</div>',link:function(e,t,s){e.$watch("trackloading",function(e){e?$(t).show():$(t).hide()})}}}).directive("ngElementReady",[function(){return{priority:Number.MIN_SAFE_INTEGER,restrict:"A",link:function(e,t,s){e.$eval(s.ngElementReady)}}}]),e.$inject=["DispatcherService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$location","$sce","$window","$modal","EpodReviewService","OrdersService","DateHelper","$interval","OpTableHelper","$compile"]}();
!function(){"use strict";function e(t,s,e,r,i,n,d,a,o){var A=this;function c(){A.driver={},A.driversFlg="N",A.registrationFlg="Y",A.remarks="N",A.NewRegistration="Y",A.allowEdit="N",A.driverSubmitEnabled="Y",A.validateNbr=""}n.isProcessing=!1,n.acceptNumeric=/^[0-9]+(\.[0-9]{1,2})?$/,n.paymentTypes=[],n.currencyList=[],n.paymentTypeValidation={BANK:"XTR94500",PAYPAL:"XTR94501"},c(),A.submitDriverInfo=function(){console.log("manage driver",A.driver);var e=angular.element(document.getElementById("driverActiveYes"))[0].checked,e=(A.driver.activeFlg=1==e?"Y":"N",angular.element(document.getElementById("driverWechatActiveYes"))[0].checked);if(A.driver.wechatDriverFlg=1==e?"Y":"N",-2==A.driver.primaryUserRoleId)toastr.error("Role is required."),$("#uiRegistrationRole").focus();else if(void 0===A.driver.firstName||""==A.driver.firstName)toastr.error("First Name is required."),$("#uiRegistrationFN").focus();else if(void 0===A.driver.lastName||""==A.driver.lastName)toastr.error("Last Name is required."),$("#uiRegistrationLN").focus();else if(void 0===A.driver.emailAddress||""==A.driver.emailAddress)toastr.error("Email address is required."),$("#uiRegistrationEA").focus();else if(e=A.driver.emailAddress,/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)){if("Y"===A.driver.assignWallet)for(var r in A.driver.withWallet=!0,n.paymentTypes){if(A.driver.acctType==n.paymentTypes[r].paymentValue)if(A.driver.acctType===paymentTypeValidation.PAYPAL){if(void 0===A.driver.emailAddress||null===A.driver.emailAddress||""===A.driver.emailAddress)return toastr.error("Email address is required."),void $("#uiRegistrationEA").focus()}else{if(A.driver.acctType!==paymentTypeValidation.BANK)break;if(void 0===A.driver.acctNbr||null===A.driver.acctNbr||""===A.driver.acctNbr)return toastr.error("Account Number is required."),void $("#uiRegistrationAcctNbr").focus();if(void 0===A.driver.swiftCd||null===A.driver.swiftCd||""===A.driver.swiftCd)return toastr.error("Swift Code is required."),void $("#uiRegistrationSwiftCd").focus()}if(r===n.paymentTypes.length)return void toastr.error("Please select preferred payment method")}else A.driver.withWallet=!1,A.driver.acctType=null,A.driver.acctNbr=null;console.log(A.driver),n.isProcessing=!0,t.ManageDriver(A.driver).then(function(e){n.isProcessing=!1,console.log("return",e),"success"==e.response?(toastr.success("Saved Successfully."),c()):"xtrm_duplicate_email"==e.response?toastr.error("This email has already been linked to a wallet. Please try another email."):toastr.error("Failed to submit user information")})}else toastr.error("Email address is invalid."),$("#uiRegistrationEA").focus()},A.processSelectedDriver=function(e){A.forApproval=!1,A.allowEdit="N",A.NewRegistration="N",null==e.isApproved||0!==e.isApproved&&-1!==e.isApproved||(A.forApproval=!0),A.driverSubmitEnabled="N",A.remarks="N",A.driver=e,console.log("vm dirver",A.driver),A.driver.providerId=s.currentUser.provider.providerId,A.driversFlg="N",A.registrationFlg="Y",angular.element(document.getElementById("driverActiveNo"))[0].disabled=!1,A.drivers,$("#drivers").DataTable().clear().draw(),$("#drivers").dataTable().fnDestroy(),"Y"==A.driver.activeFlg?(angular.element(document.getElementById("driverActiveYes"))[0].checked=!0,t.GetDriverShipment(A.driver).then(function(e){angular.isObject(e)&&(A.remarks="Y",angular.element(document.getElementById("driverActiveNo"))[0].disabled=!0)})):angular.element(document.getElementById("driverActiveNo"))[0].checked=!0,"Y"==A.driver.wechatDriverFlg?angular.element(document.getElementById("driverWechatActiveYes"))[0].checked=!0:angular.element(document.getElementById("driverWechatActiveNo"))[0].checked=!0,1===A.driver.isActive?(A.driver.assignWallet="Y",A.driver.prefPayment="",angular.element(document.getElementById("driverYesWallet"))[0].checked=!0):(A.driver.assignWallet="N",A.driver.acctType=null,A.driver.acctNbr=null,angular.element(document.getElementById("driverNoWallet"))[0].checked=!0)},A.validatePhone=function(){A.NewRegistration="Y";var r,i=A.validateNbr;n.isProcessing=!0,void 0===i?(angular.element(document.getElementById("uiInputShipmentNbr"))[0].focus(),toastr.error("Entered Phone Number is invalid")):0<i.length?((r={}).phoneNbr=i,r.providerId=s.currentUser.provider.providerId,t.FetchPhone(r).then(function(e){angular.isObject(e)?(n.isProcessing=!1,e=e[0],toastr.warning(0===e.isApproved?"Pending Approval":"Edit Registration"),e.registrationType="Update",A.processSelectedDriver(e),A.NewRegistration="N"):(r.phoneNbr=i,r.providerId=-2,t.FetchPhone(r).then(function(e){var r;n.isProcessing=!1,angular.isObject(e)?(toastr.success("New Registration"),(r=e[0]).providerId=s.currentUser.provider.providerId,r.providerName=s.currentUser.provider.providerName,r.scacCd=s.currentUser.provider.scacCd,r.registrationType="Add",A.processSelectedDriver(r)):(toastr.success("New Registration"),(e={}).phoneNbr=i,e.primaryUserRoleId=-2,e.providerId=s.currentUser.provider.providerId,e.scacCd=s.currentUser.provider.scacCd,e.providerName=s.currentUser.provider.providerName,e.hasWallet=!1,e.registrationType="New",A.processSelectedDriver(e)),A.NewRegistration="Y"}))})):(angular.element("#uiInputShipmentNbr").trigger("focus"),toastr.error("Entered Phone Number is invalid"))},A.fetchDrivers=function(){A.driversFlg="N",n.driverlist=!0,A.validateNbr="",t.ListDrivers(s.currentUser.provider.providerId,1).then(function(e){A.drivers,$("#drivers").DataTable().clear().draw(),$("#drivers").dataTable().fnDestroy(),A.drivers=e,angular.isObject(e)&&(A.registrationFlg="N",A.driversFlg="Y",A.initDriverTable("#drivers"),n.driverlist=!1)}),t.ListDrivers(s.currentUser.provider.providerId,0).then(function(e){A.pnddrivers,$("#pnddrivers").DataTable().clear().draw(),$("#pnddrivers").dataTable().fnDestroy(),A.pnddrivers=e,angular.isObject(e)&&(A.registrationFlg="N",A.driversFlg="Y",A.initDriverTable("#pnddrivers"),n.driverlist=!1)})},A.initDriverTable=function(e){a(function(){$(e).DataTable({searching:!0,bDestroy:!0,displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100)},A.approveDriver=function(){1==confirm("Are you sure you want to approve this driver?")&&(n.isProcessing=!0,t.approveDriver(A.driver).then(function(){A.fetchDrivers(),n.isProcessing=!1}))},A.declineDriver=function(){1==confirm("Are you sure you want to decline this driver?")&&(n.isProcessing=!0,t.declineDriver(A.driver).then(function(){A.fetchDrivers(),n.isProcessing=!1}))},A.getCurrencyList=function(){n.isProcessing=!0,t.getCurrencyList().then(function(e){n.currencyList=e,n.isProcessing=!1})},A.getPaymentTypeList=function(){n.isProcessing=!0,t.ListPaymentTypes().then(function(e){n.paymentTypes=e,n.isProcessing=!1})},n.isNewRegistration=function(){return"Y"===A.NewRegistration},A.getCurrencyList(),A.getPaymentTypeList()}angular.module("app").controller("RegistrationController",e).directive("driverlist",function(){return{restrict:"E",replace:!0,template:'<div class="loading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />LOADING...</div>',link:function(e,r,i){e.$watch("driverlist",function(e){e?$(r).show():$(r).hide()})}}}),e.$inject=["RegistrationService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http"]}();
!function(){"use strict";function e(t,o,e,r){var s=this;console.log("register"),s.host=o.host(),s.user={},s.register=function(r){console.log("register1",s.user),t.ValidateUser(s.user.userName).then(function(e){angular.isObject(e)?(angular.element(document.getElementById("username"))[0].focus(),toastr.error("Username already exists")):t.ValidateCompany(s.user.partnerCd).then(function(e){angular.isObject(e)?(console.log("Partner",e),r?(s.dataLoading=!0,s.user.hostname=s.host,s.user.userApplication="DISPATCHER",s.user.parentPartnerCd="OPENPT",s.user.companyName=e.name,t.Register(s.user).then(function(e){s.dataLoading=!1,e.success?(toastr.success("Registration successful"),o.path("/login")):toastr.error(e.message)})):toastr.error("Form is incomplete or has invalid values")):(angular.element(document.getElementById("companyCd"))[0].focus(),toastr.error("Invalid company Code"))})})}}angular.module("app").controller("RegisterController",e),e.$inject=["UserService","$location","$rootScope","$timeout"]}();
!function(){"use strict";function r(t,a,n,o,y,r,e,c,s,i){var d=this;console.log(a.currentUser),d.cmpnyobj=a.currentUser.company,d.companyobj={},d.clientList=[],d.corporateAddress={},d.tabs=[{title:"Profile",route:"shipper.profile",tab:0,content:""},{title:"Address",route:"shipper.address",tab:1,content:""},{title:"Clients",route:"shipper.client",tab:2,content:""},{title:"Offices",route:"shipper.branches",tab:3,content:""}],d.maxTab=3,d.activeRoute="",d.currentTab=0,d.highTab=0,d.wizardLastTab=0,d.noid=-2,d.initmapstate=0,d.branchpagevisit=0,d.btntabshprprev=!1,d.btntabshprnext=!1,d.btntabshprsubmit=!1,d.addressCountry={},y.params=r,d.countryList=[],t.GetCountry().then(function(r){d.countryList=r,t.GetCompanyById(d.cmpnyobj.companyId).then(function(r){d.cmpnyobj=r,d.companyobj=r,d.clientList=r.clients,d.corporateAddress=r.corporateAddress,y.branchList=r.companyBranches,d.wizardStepNbr=r.wizardStepNbr,d.highTab=r.wizardStepNbr,y.setTabActive(r.wizardStepNbr),y.setTabEnabledStatus(),y.setCountryCorporateAddress(d.corporateAddress.countryName),y.markerlisting=!0,d.companyobj.corporateAddress={},d.companyobj.companyBranches=[],d.companyobj.clients=[]})}),y.loadCompanyData=function(){t.GetCompanyById(d.noid).then(function(r){d.clientList=d.cmpnyobj.clients,d.wizardStepNbr=d.cmpnyobj.wizardStepNbr,d.highTab=d.cmpnyobj.wizardStepNbr,y.setTabActive(d.cmpnyobj.wizardStepNbr),y.setTabEnabledStatus(),y.setCountryCorporateAddress(d.cmpnyobj.corporateAddress.countryName)})},y.loadInitCountryList=function(){t.GetCountry().then(function(r){d.countryList=r})},y.searchCompany=function(){t.GetCompanyById(d.cmpnyobj.companyId).then(function(r){d.cmpnyobj=r,d.clientList=r.clients,y.setCountryCorporateAddress(r.corporateAddress.countryName),d.wizardStepNbr=r.wizardStepNbr,d.highTab=r.wizardStepNbr,y.setTabActive(r.wizardStepNbr),y.setTabEnabledStatus()})},y.setTabEnabledStatus=function(){d.tabs.forEach(function(r){r.disabled=r.tab>d.wizardStepNbr||r.isDisabled})},y.setTabActive=function(r){r>d.maxTab&&(r=0);r=e("filter")(d.tabs,{tab:r},!0);r.length&&(y.go(r[0].route,r[0].tab),console.log(r[0])),y.setActionButton()},y.setCountryCorporateAddress=function(r){r=e("filter")(d.countryList,{countryName:r},!0);r.length?d.addressCountry=r[0]:d.addressCountry=d.countryList[0]},y.setCountryBranchAddress=function(r){r=e("filter")(d.countryList,{countryName:r},!0);r.length?marker.cmpnybranch.branchAddress.countrybranch=r[0]:marker.cmpnybranch.branchAddress.countrybranch=d.countryList[0]},y.setCountryCorporateAddress2=function(){var r=e("filter")(d.countryList,{countryName:d.cmpnyobj.corporateAddress.countryName},!0);r.length?d.addressCountry=r[0]:d.addressCountry=d.countryList[0]},y.setActionButton=function(){d.currentTab==d.maxTab?(d.btntabshprprev=!1,d.btntabshprnext=!0):(0==d.currentTab?d.btntabshprprev=!0:d.btntabshprprev=!1,d.btntabshprnext=!1),d.btntabshprsubmit=!0,(d.wizardStepNbr>=d.maxTab||d.wizardStepNbr>=d.currentTab)&&(d.btntabshprsubmit=!1),d.wizardStepNbr>d.maxTab&&(n.isShipperRegistrationComplete=!0)},y.go=function(r,e){console.log("Previous vm.currentTab:"+d.currentTab),d.currentTab=e,o.go(r).then(function(){3==e?c.all(y.mapLoadBranchAddress()).then(function(){console.log(n.mapPositionByAddress)}):1==e&&y.mapLoadCorporateAddress()})},y.active=function(r){return o.is(r)},y.$on("$stateChangeSuccess",function(r,e,n,t,a){d.tabs.forEach(function(r){r.disabled=r.tab>d.highTab||r.isDisabled,r.active=y.active(r.route)}),y.setActionButton()}),y.pop=function(){toastr.success("title","text")},y.prev=function(){console.log("Previous vm.currentTab:"+d.currentTab),d.currentTab=d.currentTab-1,d.wizardLastTab=d.currentTab,o.go(d.tabs[d.currentTab].route,d.cmpnyobj),y.setActionButton()},y.next=function(){console.log("Previous vm.currentTab:"+d.currentTab),d.activeRoute=d.tabs[d.currentTab].route,0==d.currentTab?y.createCompany():1==d.currentTab?y.createCompanyAddress():2==d.currentTab?y.createCompanyClient():d.currentTab,d.currentTab=d.currentTab+1,d.highTab<d.currentTab&&(d.highTab=d.currentTab),d.wizardStepNbr=d.highTab,a.currentUser.company.wizardStepNbr=d.wizardStepNbr,d.cmpnyobj.wizardStepNbr=d.wizardStepNbr,d.wizardLastTab=d.currentTab,d.currentTab<=d.maxTab&&o.go(d.tabs[d.currentTab].route,d.cmpnyobj),y.setActionButton(),console.log("wizardLastTab:"+d.wizardLastTab+" wizardStepNbr:"+d.wizardStepNbr)},y.submit=function(){0==d.currentTab?y.createCompany():1==d.currentTab?(y.createCompanyAddress(),y.mapLoadCorporateAddress()):2==d.currentTab?y.createCompanyClient():3==d.currentTab&&(d.wizardLastTab=d.maxTab+1,d.cmpnyobj.wizardStepNbr=d.maxTab+1,y.updateWizardStepNbr(),n.isShipperRegistrationComplete=!0)},y.updateWizardStepNbr=function(){d.companyobj.wizardStepNbr=d.wizardStepNbr,t.UpdateWizardStepNbr(d.companyobj).then(function(r){})},y.doThingHere=function(){t.DoNothing(d.cmpnyobj).then(function(r){})},y.createCompany=function(){d.companyobj.corporateAddress={},d.companyobj.companyBranches=[],d.companyobj.clients=[],t.CreateCompany(d.companyobj).then(function(r){d.companyobj=r,toastr.success("Saved Successfully")})},y.createCompanyAddress=function(){d.corporateAddress.countryName=d.addressCountry.countryName,d.corporateAddress.countryId=d.addressCountry.countryId,t.CreateCompanyAddress(d.corporateAddress).then(function(r){d.corporateAddress=r,d.companyobj.corporateAddressId=d.corporateAddress.companyAddressId,y.updateWizardStepNbr(),toastr.success("Saved Successfully")})},y.createCompanyClient=function(){d.clientList[0].companyId=d.cmpnyobj.companyId,t.CreateCompanyClient(d.clientList).then(function(r){y.updateWizardStepNbr(),toastr.success("Saved Successfully")})},y.addClient=function(){var r=new Object;r.clientName=d.companyClient.clientName,null==d.clientList&&(d.clientList=[]),d.clientList.push(r)};var p={zoom:2,scrollwheel:!0,scrollwheelZoom:!(y.removeClient=function(r){r=d.clientList.indexOf(r);d.clientList.splice(r,1)}),navigationControl:!0,mapTypeControl:!0,scaleControl:!0,scaleControl:!0,draggable:!0,zoomControl:!0,panControl:!0,fullscreenControl:!0,center:new google.maps.LatLng(31.22011,121.466373),mapTypeId:google.maps.MapTypeId.ROADMAP},l=new google.maps.InfoWindow,h=new google.maps.Geocoder,b=(n.mapPositionByAddress=[],y.mapLoadBranchAddress=function(){y.markers=[],y.map=new google.maps.Map(document.getElementById("mapShipperBranch"),p);for(var r=0;r<y.branchList.length;r++){var e=y.branchList[r],n=e.branchAddress.addressLine1+" , "+e.branchAddress.cityName+" , "+e.branchAddress.provinceName+" , "+e.branchAddress.countryName;b(n,y.map,p,!1,e.branchName,e.branchAddress.addressLine1,e.branchAddress.cityName,e.branchAddress.provinceName,e.branchAddress.countryName,e,y.markers,"mapShipperBranch")}y.updateWizardStepNbr()},y.mapLoadCorporateAddress=function(){y.markerCorporate=[];var r=d.corporateAddress.addressLine1+" , "+d.corporateAddress.cityName+" , "+d.corporateAddress.provinceName+" , "+d.corporateAddress.countryName;"Unknown , undefined ,  , Unknown1"!=r?(y.mapShipperCorp=new google.maps.Map(document.getElementById("mapShipperCorp"),p),b(r,y.mapShipperCorp,p,!0,"Corporate Address",d.corporateAddress.addressLine1,d.corporateAddress.cityName,d.corporateAddress.provinceName,d.corporateAddress.countryName,{},y.markerCorporate,"mapShipperCorp")):y.mapShipperCorp=new google.maps.Map(document.getElementById("mapShipperCorp"),p),y.updateWizardStepNbr()},function(t,a,r,o,c,s,i,d,p,b,m,u){h.geocode({address:t},function(r,e){var n;e==google.maps.GeocoderStatus.OK&&(1==o&&(e={zoom:2,scrollwheel:!0,scrollwheelZoom:!1,navigationControl:!0,mapTypeControl:!0,scaleControl:!0,scaleControl:!0,draggable:!0,zoomControl:!0,panControl:!0,fullscreenControl:!0,center:r[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.Map(document.getElementById(u),e)),(n=new google.maps.Marker({map:a,position:r[0].geometry.location,title:c,address:s,city:i,province:d,country:p,cmpnybranch:b})).content='<div class="infoWindowContent">'+t+"</div>",google.maps.event.addListener(n,"click",function(){l.setContent("<h2>"+n.title+"</h2>"+n.content),l.open(a,n)}),m.push(n),y.openInfoWindow=function(r,e){r.preventDefault(),google.maps.event.trigger(e,"click")})})});y.updateMarker=function(r){d.wizardLastTab=d.maxTab+1,d.cmpnyobj.wizardStepNbr=d.maxTab+1,d.wizardStepNbr=d.maxTab+1,a.currentUser.company.wizardStepNbr=d.wizardStepNbr,console.log(r);var e={},n=(e.companyBranchId=r.cmpnybranch.companyBranchId,e.companyId=d.cmpnyobj.companyId,e.branchName=r.cmpnybranch.branchName,{});n.addressLine1=r.cmpnybranch.branchAddress.addressLine1,n.cityName=r.cmpnybranch.branchAddress.cityName,n.provinceName=r.cmpnybranch.branchAddress.provinceName,n.countryName=r.cmpnybranch.branchAddress.countryName,n.countryId=r.cmpnybranch.branchAddress.countryId,e.branchAddress=n,console.log(e),t.UpdateCompanyBranchAddress(e).then(function(r){console.log(r),y.branchList=r,d.cmpnyobj.companyBranches=y.branchList,s(function(){}),y.mapLoadBranchAddress(),toastr.success("Saved Successfully")})},y.removeMarker=function(r){d.wizardLastTab=d.maxTab+1,d.cmpnyobj.wizardStepNbr=d.maxTab+1,d.wizardStepNbr=d.maxTab+1,a.currentUser.company.wizardStepNbr=d.wizardStepNbr,console.log(r);var e={};e.companyBranchId=r.cmpnybranch.companyBranchId,e.companyId=d.cmpnyobj.companyId,t.DeleteCompanyBranchAddress(e).then(function(r){console.log(r),y.branchList=r,d.cmpnyobj.companyBranches=y.branchList,s(function(){}),y.mapLoadBranchAddress(),toastr.success("Saved Successfully")})},y.addMarker=function(r){d.wizardLastTab=d.maxTab+1,d.cmpnyobj.wizardStepNbr=d.maxTab+1,d.wizardStepNbr=d.maxTab+1,a.currentUser.company.wizardStepNbr=d.wizardStepNbr;console.log(y.newmarker);var e={},n=(e.companyBranchId=r.cmpnybranch.companyBranchId,e.companyId=d.cmpnyobj.companyId,e.branchName=r.cmpnybranch.branchName,{});n.addressLine1=r.cmpnybranch.branchAddress.addressLine1,n.cityName=r.cmpnybranch.branchAddress.cityName,n.provinceName=r.cmpnybranch.branchAddress.provinceName,n.countryName=r.cmpnybranch.branchAddress.country.countryName,n.countryId=r.cmpnybranch.branchAddress.country.countryId,e.branchAddress=n,console.log(e),t.CreateCompanyBranchAddress(e).then(function(r){console.log(r),y.branchList=r,d.cmpnyobj.companyBranches=y.branchList,s(function(){}),y.mapLoadBranchAddress(),toastr.success("Saved Successfully")})},y.shipments=[{title:"Shpt1",bid:"100",origin:"Origin1",destination:"Destination1"},{title:"Shpt1",bid:"100",origin:"Origin1",destination:"Destination1"},{title:"Shpt1",bid:"100",origin:"Origin1",destination:"Destination1"},{title:"Shpt1",bid:"100",origin:"Origin1",destination:"Destination1"}]}angular.module("app").controller("ShipperController",r),r.$inject=["ShipperService","UserService","$rootScope","$state","$scope","$stateParams","$filter","$q","$timeout","$translate"]}();
!function(e){"use strict";"function"==typeof define&&define.amd?define(["angular","moment"],e):"object"==typeof exports?module.exports=e(require("angular"),require("moment")):e(window.angular,window.moment)}(function(u,w){"use strict";function e(n,i){var e={bindToController:!1,controller:t,controllerAs:"dateTimePickerController",replace:!0,require:"ngModel",restrict:"E",scope:{beforeRender:"&",onSetTime:"&"},templateUrl:"templates/datetimepicker.html"};function t(l,e,t){var f=e.controller("ngModel"),m=r(),d=(l.screenReader=m.screenReader,l.changeView=function(e,t,r){r&&(r.stopPropagation(),r.preventDefault());if(e&&t.utcDateValue>-1/0&&t.selectable&&d[e]){var a=d[e](t.utcDateValue),n=[];if(a.weeks)for(var i=0;i<a.weeks.length;i+=1)for(var u=a.weeks[i],o=0;o<u.dates.length;o+=1){var s=u.dates[o];n.push(s)}l.beforeRender({$view:a.currentView,$dates:a.dates||n,$leftDate:a.leftDate,$upDate:a.previousViewDate,$rightDate:a.rightDate}),l.data=a}},f.$render=function(){l.changeView(m.startView,new v({utcDateValue:function(e){var t=new Date;if(e){var r=a(e);if(!r.isValid())throw"Invalid date: "+e;t=r.toDate()}return t.getTime()-6e4*t.getTimezoneOffset()}(f.$viewValue)}))},m.configureOn&&l.$on(m.configureOn,function(){m=r(),l.screenReader=m.screenReader,f.$render()}),m.renderOn&&l.$on(m.renderOn,f.$render),{year:function(e){for(var t=w.utc(e).startOf("year"),r=10*parseInt(t.year()/10,10),a=w.utc(s(e)).subtract(1,"year").startOf("year"),n=p(f.$modelValue,"YYYY"),i={currentView:"year",nextView:"year"===m.minView?"setTime":"month",previousViewDate:new v({utcDateValue:null,display:r+"-"+(9+r)}),leftDate:new v({utcDateValue:w.utc(a).subtract(9,"year").valueOf()}),rightDate:new v({utcDateValue:w.utc(a).add(11,"year").valueOf()}),dates:[]},u=0;u<12;u+=1){var o=w.utc(a).add(u,"years"),o={utcDateValue:o.valueOf(),display:o.format("YYYY"),past:o.year()<r,future:o.year()>9+r,active:o.format("YYYY")===n};i.dates.push(new v(o))}return i},month:function(e){for(var t=w.utc(e).startOf("year"),e=s(e),r=p(f.$modelValue,"YYYY-MMM"),a={previousView:"year",currentView:"month",nextView:"month"===m.minView?"setTime":"day",previousViewDate:new v({utcDateValue:e.valueOf(),display:t.format("YYYY")}),leftDate:new v({utcDateValue:w.utc(t).subtract(1,"year").valueOf()}),rightDate:new v({utcDateValue:w.utc(t).add(1,"year").valueOf()}),dates:[]},n=0;n<12;n+=1){var i=w.utc(t).add(n,"months"),i={utcDateValue:i.valueOf(),display:i.format("MMM"),active:i.format("YYYY-MMM")===r};a.dates.push(new v(i))}return a},day:function(e){for(var e=w.utc(e),t=w.utc(e).startOf("month"),r=w.utc(e).startOf("year"),a=w.utc(e).endOf("month"),n=w.utc(t).subtract(Math.abs(t.weekday()),"days"),i=p(f.$modelValue,"YYYY-MMM-DD"),u={previousView:"month",currentView:"day",nextView:"day"===m.minView?"setTime":"hour",previousViewDate:new v({utcDateValue:r.valueOf(),display:t.format("YYYY-MMM")}),leftDate:new v({utcDateValue:w.utc(t).subtract(1,"months").valueOf()}),rightDate:new v({utcDateValue:w.utc(t).add(1,"months").valueOf()}),dayNames:[],weeks:[]},o=0;o<7;o+=1)u.dayNames.push(w.utc().weekday(o).format("dd"));for(var s=0;s<6;s+=1){for(var l={dates:[]},d=0;d<7;d+=1){var c=w.utc(n).add(7*s+d,"days"),c={utcDateValue:c.valueOf(),display:c.format("D"),active:c.format("YYYY-MMM-DD")===i,past:c.isBefore(t),future:c.isAfter(a)};l.dates.push(new v(c))}u.weeks.push(l)}return u},hour:function(e){for(var t=w.utc(e).startOf("day"),e=w.utc(t).startOf("month"),r=p(f.$modelValue,"YYYY-MM-DD H"),a={previousView:"day",currentView:"hour",nextView:"hour"===m.minView?"setTime":"minute",previousViewDate:new v({utcDateValue:e.valueOf(),display:t.format("ll")}),leftDate:new v({utcDateValue:w.utc(t).subtract(1,"days").valueOf()}),rightDate:new v({utcDateValue:w.utc(t).add(1,"days").valueOf()}),dates:[]},n=0;n<24;n+=1){var i=w.utc(t).add(n,"hours"),i={utcDateValue:i.valueOf(),display:i.format("LT"),active:i.format("YYYY-MM-DD H")===r};a.dates.push(new v(i))}return a},minute:function(e){for(var t=w.utc(e).startOf("hour"),e=w.utc(t).startOf("day"),r=p(f.$modelValue,"YYYY-MM-DD H:mm"),a={previousView:"hour",currentView:"minute",nextView:"setTime",previousViewDate:new v({utcDateValue:e.valueOf(),display:t.format("lll")}),leftDate:new v({utcDateValue:w.utc(t).subtract(1,"hours").valueOf()}),rightDate:new v({utcDateValue:w.utc(t).add(1,"hours").valueOf()}),dates:[]},n=60/m.minuteStep,i=0;i<n;i+=1){var u=w.utc(t).add(i*m.minuteStep,"minute"),u={utcDateValue:u.valueOf(),display:u.format("LT"),active:u.format("YYYY-MM-DD H:mm")===r};a.dates.push(new v(u))}return a},setTime:function(e){var t=new Date(e),r=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());switch(m.modelType){case"Date":break;case"moment":r=w(r);break;case"milliseconds":r=e;break;default:r=w(r).format(m.modelType)}t=f.$modelValue;f.$setViewValue(r),m.dropdownSelector&&jQuery(m.dropdownSelector).dropdown("toggle");return l.onSetTime({newDate:r,oldDate:t}),d[m.startView](e)}});function s(e){var t=10*parseInt(w.utc(e).year()/10,10);return w.utc(e).year(t).startOf("year")}function p(e,t){return e?a(e).format(t):""}function a(e){return w(e,u.isString(e)?m.parseFormat:void 0)}function r(){var e={},e=(t.datetimepickerConfig&&(e=l.$parent.$eval(t.datetimepickerConfig)),u.extend({},n,e));return i.validate(e),e}}function v(){var e,t=new Date,r=6e4*t.getTimezoneOffset(),a=(this.utcDateValue=t.getTime(),this.selectable=!0,this.localDateValue=function(){return this.utcDateValue+r},["utcDateValue","localDateValue","display","active","selectable","past","future"]);for(e in arguments[0])0<=a.indexOf(e)&&(this[e]=arguments[0][e])}return t.$inject=["$scope","$element","$attrs"],e}function t(n){return{validate:function(e){var t,r=["configureOn","dropdownSelector","minuteStep","minView","modelType","parseFormat","renderOn","startView","screenReader"];for(t in e)if(r.indexOf(t)<0)throw"invalid option: "+t;var a=["minute","hour","day","month","year"];if(a.indexOf(e.startView)<0)throw"invalid startView value: "+e.startView;if(a.indexOf(e.minView)<0)throw"invalid minView value: "+e.minView;if(a.indexOf(e.minView)>a.indexOf(e.startView))throw"startView must be greater than minView";if(!u.isNumber(e.minuteStep))throw"minuteStep must be numeric";if(e.minuteStep<=0||60<=e.minuteStep)throw"minuteStep must be greater than zero and less than 60";if(null!==e.configureOn&&!u.isString(e.configureOn))throw"configureOn must be a string";if(null!==e.configureOn&&e.configureOn.length<1)throw"configureOn must not be an empty string";if(null!==e.renderOn&&!u.isString(e.renderOn))throw"renderOn must be a string";if(null!==e.renderOn&&e.renderOn.length<1)throw"renderOn must not be an empty string";if(null!==e.modelType&&!u.isString(e.modelType))throw"modelType must be a string";if(null!==e.modelType&&e.modelType.length<1)throw"modelType must not be an empty string";"Date"!==e.modelType&&"moment"!==e.modelType&&"milliseconds"!==e.modelType&&(e.parseFormat=e.modelType);if(null!==e.dropdownSelector&&!u.isString(e.dropdownSelector))throw"dropdownSelector must be a string";null===e.dropdownSelector||"undefined"!=typeof jQuery&&"function"==typeof jQuery().dropdown||(n.error("Please DO NOT specify the dropdownSelector option unless you are using jQuery AND Bootstrap.js. Please include jQuery AND Bootstrap.js, or write code to close the dropdown in the on-set-time callback. \n\nThe dropdownSelector configuration option is being removed because it will not function properly."),delete e.dropdownSelector)}}}u.module("ui.bootstrap.datetimepicker",[]).service("dateTimePickerConfig",function(){var e={bg:{previous:"предишна",next:"следваща"},ca:{previous:"anterior",next:"següent"},da:{previous:"forrige",next:"næste"},de:{previous:"vorige",next:"weiter"},"en-au":{previous:"previous",next:"next"},"en-gb":{previous:"previous",next:"next"},en:{previous:"previous",next:"next"},"es-us":{previous:"atrás",next:"siguiente"},es:{previous:"atrás",next:"siguiente"},fi:{previous:"edellinen",next:"seuraava"},fr:{previous:"précédent",next:"suivant"},hu:{previous:"előző",next:"következő"},it:{previous:"precedente",next:"successivo"},ja:{previous:"前へ",next:"次へ"},ml:{previous:"മുൻപുള്ളത്",next:"അടുത്തത്"},nl:{previous:"vorige",next:"volgende"},pl:{previous:"poprzednia",next:"następna"},"pt-br":{previous:"anteriores",next:"próximos"},pt:{previous:"anterior",next:"próximo"},ro:{previous:"anterior",next:"următor"},ru:{previous:"предыдущая",next:"следующая"},sk:{previous:"predošlá",next:"ďalšia"},sv:{previous:"föregående",next:"nästa"},tr:{previous:"önceki",next:"sonraki"},uk:{previous:"назад",next:"далі"},"zh-cn":{previous:"上一页",next:"下一页"},"zh-tw":{previous:"上一頁",next:"下一頁"}}[w.locale().toLowerCase()];return u.extend({},{configureOn:null,dropdownSelector:null,minuteStep:5,minView:"minute",modelType:"Date",parseFormat:"YYYY-MM-DDTHH:mm:ss.SSSZZ",renderOn:null,startView:"day"},{screenReader:e})}).service("dateTimePickerValidator",t).directive("datetimepicker",e),e.$inject=["dateTimePickerConfig","dateTimePickerValidator"],t.$inject=["$log"]});
!function(){"use strict";angular.module("ui.bootstrap.datetimepicker").run(["$templateCache",function(a){a.put("templates/datetimepicker.html",'<div class="datetimepicker table-responsive">\n    <table class="table table-condensed {{ data.currentView }}-view">\n        <thead>\n        <tr>\n            <th class="left" data-ng-click="changeView(data.currentView, data.leftDate, $event)" data-ng-show="data.leftDate.selectable"><i class="glyphicon glyphicon-arrow-left"><span class="sr-only">{{ screenReader.previous }}</span></i>\n            </th>\n            <th class="switch" colspan="5" data-ng-show="data.previousViewDate.selectable" data-ng-click="changeView(data.previousView, data.previousViewDate, $event)">{{ data.previousViewDate.display }}</th>\n            <th class="right" data-ng-click="changeView(data.currentView, data.rightDate, $event)" data-ng-show="data.rightDate.selectable"><i class="glyphicon glyphicon-arrow-right"><span class="sr-only">{{ screenReader.next }}</span></i>\n            </th>\n        </tr>\n        <tr>\n            <th class="dow" data-ng-repeat="day in data.dayNames">{{ day }}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr data-ng-if="data.currentView !== \'day\'">\n            <td colspan="7">\n                          <span class="{{ data.currentView }}" data-ng-repeat="dateObject in data.dates" data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}" data-ng-click="changeView(data.nextView, dateObject, $event)">{{ dateObject.display }}</span></td>\n        </tr>\n        <tr data-ng-if="data.currentView === \'day\'" data-ng-repeat="week in data.weeks">\n            <td data-ng-repeat="dateObject in week.dates" data-ng-click="changeView(data.nextView, dateObject, $event)" class="day" data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}">{{ dateObject.display }}</td>\n        </tr>\n        </tbody>\n    </table>\n</div>')}])}();
!function(){"use strict";function e(a,e,n,t,i,h,d,s,r,o,c,l,m){var u=this;console.log(e.currentUser),t.cmpny=e.currentUser.company,u.cmpnyobj=e.currentUser.company,a.GetStatus().then(function(e){u.statusList=e;e={statusId:-2,statusCd:"All",descriptionTxt:"All"};u.statusList.push(e),u.loadShipmentsList(),u.setSearchStatusField(15)}),u.shipmentSearch={},u.shipmentStatusPosted=10,u.shipmentStatusUnderBidding=15,u.shipmentStatusEndPost=20,u.shipmentStatusBooked=30,u.statusList=[],u.setSearchStatusField=function(e){e=l("filter")(u.statusList,{statusId:e},!0);e.length?u.shipmentSearch.status=e[0]:u.shipmentSearch.status=u.statusList[0]},u.loadShipmentsList=function(){console.log(t.cmpny.companyId),console.log(u.cmpnyobj.companyId),a.GetShipmentByCompanyById(u.cmpnyobj.companyId).then(function(e){u.shipmentList=e,console.log(u.cmpnyobj.companyId),console.log(t.cmpny.companyId)})},u.SearchShipments=function(){u.clearTimers(),u.bidtime=10,u.bidtimes=[],u.counterintervals=[],u.Timer=[],u.bidEndIdsTohide=[],u.bidStartIdsTohide=[],u.shipmentSearch.pickupDateTxt=$("#datepickerpickup").find("input").val(),u.shipmentSearch.deliveryDateTxt=$("#datepickerdelivery").find("input").val(),console.log(u.cmpnyobj.companyId),a.GetShipmentsByLocations(u.shipmentSearch.originCity,u.shipmentSearch.destinationCity,u.shipmentSearch.pickupDateTxt,u.shipmentSearch.deliveryDateTxt,u.shipmentSearch.referenceNbr,u.shipmentSearch.status.statusId,u.cmpnyobj.companyId).then(function(e){void 0!==(u.shipmentList=e)&&e.length||toastr.warning("No data found")})},u.clearShprSearch=function(){u.shipmentSearch.originCity="",u.shipmentSearch.destinationCity="",u.shipmentSearch.pickupDateTxt="",u.shipmentSearch.deliveryDateTxt="",u.shipmentSearch.referenceNbr="",u.shipmentSearch.statusId=""},u.SearchShipments2=function(){u.shipmentList=[],o.all(u.clearTimers()).then(function(){a.GetShipmentsByLocations(u.shipmentSearch.originCity,u.shipmentSearch.destinationCity).then(function(e){void 0!==(u.shipmentList=e)&&e.length||toastr.warning("No data found")})})},u.showShipmentRatesDialog=function(e,t,i){u.selectedShipment=i,u.selectedRateShipmentId=t,u.bidEnded=u.bidEndIdsTohide[t],u.userModule="Carrier Rates",u.userTitle="Carrier Rates",u.selectedShipmentCarrierBid=[],h.sortType="quoteAmt",u.selectedShipmentTargetRateAmt=i.targetRateAmt,u.selectedShipmentCurrencyCd=i.currencyCd,u.selectedShipmentTargetRateTxt="",null!=u.selectedShipmentTargetRateAmt&&null!=u.selectedShipmentTargetRateAmt&&(u.selectedShipmentTargetRateTxt=m.instant("Target Rate")+": "+u.selectedShipmentTargetRateAmt+" "+u.selectedShipmentCurrencyCd),a.GetShipmentCarrierBids(t).then(function(e){console.log("HETO oh:",e),u.shptSlctdBookBtn=!0,u.shptSlctdShowEndBidBtn=!0,angular.isObject(e)&&(20<(u.selectedShipmentCarrierBid=e)[0].statusId?(u.shptSlctdShowEndBidBtn=!1,u.shptSlctdBookBtn=!1):"Y"==e[0].bidEnded?(u.shptSlctdBookBtn=!0,u.shptSlctdShowEndBidBtn=!1,e[0].statusId<10&&(u.shptSlctdShowEndBidBtn=!1)):"N"==e[0].bidEnded?(u.shptSlctdBookBtn=!1,u.shptSlctdShowEndBidBtn=!0,e[0].statusId<10&&(u.shptSlctdShowEndBidBtn=!1,u.shptSlctdBookBtn=!0)):e[0].statusId<10&&(u.shptSlctdShowEndBidBtn=!1,u.shptSlctdBookBtn=!1))}),r.open({template:"app/shipper/shipment.rates.shpr.view.html",className:"ngdialog-theme-default custom-width-700x500",scope:h,controller:this})};e=new Date;u.bidEndDatetimeSlctd=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2),u.showShipmentBidEndDialog=function(e,t,i){u.selectedShipment=i,u.bidModule="Bidding End",u.userTitle="Bidding End",u.selectedBidShipmentId=e,u.selectedBidShipmentNbr=t;r.open({template:"app/shipper/shipment.bid.end.shpr.view.html",className:"ngdialog-theme-default custom-width-400x500",scope:h,controller:this})},u.showShipmentDetailsShipperView=function(e){u.selectedShipment=e,u.userModule="Carrier Rates",u.userTitle="Carrier Rates",u.bidAmtGuideTxt="",o.all(u.setSlctdShipperInformation(e.shipperId),u.setSlctdShipmentInformation(e)).then(function(){r.open({template:"app/shipper/shipment.detail.shipper.view.html",className:"ngdialog-theme-default custom-width-600x500",scope:h,controller:this})})},u.setSlctdShipperInformation=function(e){n.GetCarrierView(e).then(function(e){console.log("HETO oh:",e),angular.isObject(e)&&(u.shipperSlctdDetail=e,void 0===u.shipperSlctdDetail.companyLogoPath&&(u.shipperSlctdDetail.companyLogoPath="img/CompanyLogo1.png"))})},u.setSlctdShipmentInformation=function(e){u.slctdShipment=e,u.selectedShipment=e,u.selectedShipmentBidGuideTxt="",u.selectedShipmentBidGuideTitleTxt="",null!=u.slctdShipment.targetRateAmt&&null!=u.slctdShipment.targetRateAmt&&(u.selectedShipmentBidGuideTitleTxt=m.instant("Bid Price Guide")+" ("+u.slctdShipment.currencyCd+"):",u.selectedShipmentBidGuideTxt=m.instant("Target Rate")+" :"+u.slctdShipment.targetRateAmt+" "+m.instant("Min")+"="+u.slctdShipment.lowEndBidAmt+" "+m.instant("High")+"="+u.slctdShipment.highEndBidAmt)},u.datepickerOptions={format:"yyyy-mm-dd",language:"en",autoclose:!0,weekStart:0},h.bidEndDatetime={},h.bidEndDatetime.value=new Date,h.myDate={value:new Date},u.showShipmentBidStartDialog=function(e,t,i){u.bidModule="Bidding Start",u.userTitle="Bidding Start",u.selectedBidShipmentId=e,u.selectedBidShipmentNbr=t,u.selectedBidShipment=i,u.selectedShipment=i;u.bidSelectedShipmentStartDate=new Date,r.open({template:"app/shipper/shipment.bid.start.shpr.view.html",className:"ngdialog-theme-default custom-width-400x500",scope:h,controller:this})},u.carrierInfo=function(e,t,i){console.log("carrierId",e),u.viewCarrier={},n.GetCarrierView(e).then(function(e){console.log("HETO oh:",e),angular.isObject(e)&&(u.viewCarrier=e,u.carrierBidCommentTxt=t,u.carrierBidYearsOfOperation=e.yearsOfOperation,u.carrierBidcarrierRating=i,console.log("vm.viewCarrier:",u.viewCarrier),u.viewCarrier.companyLogoPath="/market-api/files/"+u.viewCarrier.companyLogoPath,r.open({template:"app/shipper/carrier.bid.detail.view.html",className:"ngdialog-theme-default custom-width-400x300",scope:h,controller:this}))})},u.startBiddingSelectedShipmentByDatetime=function(e,t){u.selectedShipment=t,u.bidPostEndDatetimeSlctd=$("#datetimepicker1").find("input").val();var i={};i.shipmentId=e,i.tenderExpirationDt=new Date(u.bidPostEndDatetimeSlctd),a.UpdateShipmentTenderTerminationDate(i).then(function(e){u.bidTimer(i.tenderExpirationDt,u.selectedBidShipment.requestedDeliveryDt,"ss"+u.selectedBidShipment.shipmentId,u.selectedBidShipment.shipmentId,u.shipmentStatusPosted),u.bidStartIdsTohide[u.selectedBidShipment.shipmentId]=!0,u.bidEndIdsTohide[u.selectedBidShipment.shipmentId]=!1,toastr.success("Bid posted Successfully")}),r.closeAll()},u.selectBidStartDateTime=function(e){u.bidSelectedShipmentStartDate=e},u.bookSelectedShipment=function(t,e,i,n,d){var s={};s.shipmentId=t,s.shipmentCarrierBidId=e,s.carrierCd=i,s.assignedProviderId=n,a.BookShipment(s).then(function(e){u.bidStartIdsTohide[t]=!0,u.bidEndIdsTohide[t]=!0,u.bidTimer(d.tenderExpirationDt,d.requestedDeliveryDt,"ss"+d.shipmentId,d.shipmentId,u.shipmentStatusBooked),h.stopBidTimer(t),document.querySelectorAll("."+("ss"+t))[0].innerHTML=m.instant("Booked"),u.bidtimes[t]=-1,toastr.success("Selected carrier Successfully"),r.closeAll()})},u.endBiddingSelectedShipmentByDatetime=function(t){u.bidEndDatetimeSlctd=$("#datetimebidend").find("input").val();var e={};e.shipmentId=t,e.tenderExpirationDt=new Date(u.bidEndDatetimeSlctd),a.UpdateShipmentTenderTerminationDate(e).then(function(e){u.bidStartIdsTohide[t]=!1,u.bidEndIdsTohide[t]=!1,document.querySelectorAll("."+("ss"+t))[0].innerHTML=m.instant("Bid Ended"),toastr.success("Tender termination date set Successfully")}),r.closeAll()},u.endBiddingSelectedShipmentNow=function(t,e,i){u.shptSlctdBookBtn=!0,u.shptSlctdShowEndBidBtn=!1,u.selectedShipment=i,u.selectedShipment.tenderExpirationDt=new Date;var n={};n.shipmentId=t,n.requestedDeliveryDt=i.requestedDeliveryDt,n.tenderExpirationDt=new Date,a.UpdateShipmentTenderTerminationDate(n).then(function(e){u.bidStartIdsTohide[t]=!0,u.bidEndIdsTohide[t]=!0,u.bidTimer(n.tenderExpirationDt,n.requestedDeliveryDt,"ss"+n.shipmentId,n.shipmentId,u.shipmentStatusEndPost),h.stopBidTimer(t),document.querySelectorAll("."+("ss"+t))[0].innerHTML=m.instant("Bid Ended"),u.bidtimes[t]=-1})},u.endShipmentBidding=function(e){a.UpdateShipmentTenderTerminationDate(e).then(function(e){})},u.closeDialog=function(){r.closeAll()},u.closeNDialog=function(){r.closeAll()},u.newShprShipment=function(){},u.bidtime=10,u.bidtimes=[],u.counterintervals=[],u.Timer=[],u.bidEndIdsTohide=[],u.bidStartIdsTohide=[],u.bidTimer=function(e,t,c,l,p){var i;30==p?(u.bidtimes[l]=-2,u.bidStartIdsTohide[l]=!0):20==p&&(u.bidtimes[l]=-1),0!=u.counterintervals.length&&angular.isDefined(u.counterintervals[l])&&0!=u.counterintervals[l]||(i=new Date,-2==u.bidtimes[l]?document.querySelectorAll("."+c)[0].innerHTML=m.instant("Booked"):null==e?(document.querySelectorAll("."+c)[0].innerHTML="",u.bidStartIdsTohide[l]=!1,u.bidEndIdsTohide[l]=!0):(u.bidStartIdsTohide[l]=!0,(e=(new Date(e)-i)/1e3)<1&&(u.bidEndIdsTohide[l]=!0,e<1&&(document.querySelectorAll("."+c)[0].innerHTML=m.instant("Bid Ended"))),u.bidtimes[l]=e,u.counterintervals[l]=e)),angular.isDefined(u.Timer[l])||(u.Timer[l]=s(function(){if(u.bidtimes[l]=u.bidtimes[l]-1,sessionStorage.setItem("vm.bidtime"+l,u.bidtimes[l]),u.bidtimes[l]<0)30==p&&-2==u.bidtimes[l]?(u.bidEndIdsTohide[l]=!0,h.stopBidTimer(l),(o=(a=document.querySelectorAll("."+c))[0]).innerHTML=m.instant("Booked")):(u.bidEndIdsTohide[l]=!0,h.stopBidTimer(l),(o=(a=document.querySelectorAll("."+c))[0]).innerHTML=m.instant("Bid Ended"));else for(var e=Math.floor(u.bidtimes[l]%60),t=Math.floor(u.bidtimes[l]/60%60),i=Math.floor(u.bidtimes[l]/3600%24),n=Math.floor(u.bidtimes[l]/86400),d=""+e,s=i+"h "+t+"m "+(d=e<10?"0"+e:d)+"s",a=(0<n&&(s=n+"d "+i+"h "+t+"m "+d+"s"),document.querySelectorAll("."+c)),r=0;r<a.length;r++){var o=a[r];0==u.bidtimes[l]?o.innerHTML=m.instant("Bid Ended"):o.innerHTML=s+"</br>  "+m.instant("Bid time left")}},1e3))},h.stopBidTimer=function(e){angular.isDefined(u.Timer[e])&&(s.cancel(u.Timer[e]),u.Timer[e]=void 0)},h.go=function(e){c.path(e)},h.$on("$stateChangeStart",function(e){angular.forEach(u.Timer,function(e,t){angular.isDefined(e)&&s.cancel(e)})}),h.shouldBookBtnDisabled=function(){return u.shptSlctdBookBtn},h.shouldHideBidEndAction=function(e){return u.bidEndIdsTohide[e]},h.shouldHideBidStartAction=function(e){return u.bidStartIdsTohide[e]},u.clearTimers=function(){angular.forEach(u.Timer,function(e,t){angular.isDefined(e)&&s.cancel(e)})},u.isOpen=!1,u.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),u.isOpen=!0},h.today=function(){h.dt=new Date},h.today(),h.clear=function(){h.dt=null},h.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},h.toggleMin=function(){h.minDate=h.minDate?null:new Date},h.toggleMin(),h.opened=!1,h.open=function(e){e.preventDefault(),e.stopPropagation(),h.opened=!0},h.dateOptions={formatYear:"yy",startingDay:1},h.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],h.format=h.formats[0],h.formData={},h.formData.date="",h.opened2=!1,h.dateOptions={"year-format":"'yy'","show-weeks":!1},h.open2=function(e){e.preventDefault(),e.stopPropagation(),h.opened2=!0}}angular.module("app").controller("ShipperShipmentController",e),e.$inject=["ShipperService","UserService","CarrierServicesService","$rootScope","$state","$scope","$stateParams","$interval","ngDialog","$q","$location","$filter","$translate"]}();
!function(){"use strict";function e(o,e,t,c,d,i,n,r,h,s,a){var p=this,u=(console.log(e.currentUser),c.cmpny=e.currentUser.company,p.originCity="",p.destinationCity="",p.pickupDate="",p.shipmentSearch={},p.shipmentSearchMode="S",p.statusList=[],{}),l=(u.statusId=-2,u.statusCd="All",u.descriptionTxt="All",{}),m=(l.statusId=15,l.statusCd="BID",l.descriptionTxt="Under Bidding",{});m.statusId=20,m.statusCd="CLOSED",m.descriptionTxt="Bidding Closed";p.statusList.push(u),p.statusList.push(l),p.statusList.push(m),p.cmpnyobj=e.currentUser.company,o.GetShipmentsForBid(p.cmpnyobj.companyId).then(function(e){p.shipmentList=e,p.setSearchStatusField(15)}),p.setSearchStatusField=function(e){e=a("filter")(p.statusList,{statusId:e},!0);e.length?p.shipmentSearch.status=e[0]:p.shipmentSearch.status=p.statusList[0]},p.SearchShipmentsRefresh=function(){"S"!==p.shipmentSearchMode&&"P"===p.shipmentSearchMode?p.SearchShipmentsMultipleRoute():p.SearchShipments()},p.SearchShipments=function(){p.shipmentSearchMode="S",p.clearTimers(),p.bidtime=10,p.bidtimes=[],p.counterintervals=[],p.Timer=[],p.bidEndIdsTohide=[],p.bidStartIdsTohide=[],p.shipmentSearch.pickupDateTxt=$("#datepickerpickup").find("input").val(),p.shipmentSearch.deliveryDateTxt=$("#datepickerdelivery").find("input").val(),null==p.shipmentSearch.status&&(p.shipmentSearch.status=u),o.GetShipmentsForBidByLocations(p.shipmentSearch.originCity,p.shipmentSearch.destinationCity,p.shipmentSearch.pickupDateTxt,p.shipmentSearch.deliveryDateTxt,p.shipmentSearch.referenceNbr,p.shipmentSearch.status.statusId,p.cmpnyobj.companyId).then(function(e){void 0!==(p.shipmentList=e)&&e.length||toastr.warning("No data found")})},p.SearchShipmentsMultipleRoute=function(){p.shipmentSearchMode="P",p.clearTimers(),p.bidtime=10,p.bidtimes=[],p.counterintervals=[],p.Timer=[],p.bidEndIdsTohide=[],p.bidStartIdsTohide=[],p.shipmentSearch.pickupDateTxtRoute1=$("#datepickerPickupRoute1").find("input").val(),p.shipmentSearch.deliveryDateTxtRoute1=$("#datepickerDeliveryRoute1").find("input").val(),p.shipmentSearch.pickupDateTxtRoute2=$("#datepickerPickupRoute2").find("input").val(),p.shipmentSearch.deliveryDateTxtRoute2=$("#datepickerDeliveryRoute2").find("input").val(),null==p.shipmentSearch.destLocRoute1&&null==p.shipmentSearch.destLocRoute2||""==p.shipmentSearch.destLocRoute1&&""==p.shipmentSearch.destLocRoute2?p.shipmentSearch.originLocRoute2="000000000000000000000":p.shipmentSearch.originLocRoute2=p.shipmentSearch.destLocRoute1,o.GetShipmentPairsForBidByLocations(p.shipmentSearch.originLocRoute1,p.shipmentSearch.destLocRoute1,p.shipmentSearch.pickupDateTxtRoute1,p.shipmentSearch.deliveryDateTxtRoute1,p.shipmentSearch.originLocRoute2,p.shipmentSearch.destLocRoute2,p.shipmentSearch.pickupDateTxtRoute2,p.shipmentSearch.deliveryDateTxtRoute2,p.cmpnyobj.companyId).then(function(e){void 0!==(p.shipmentList=e)&&e.length||toastr.warning("No data found")})},p.clearTimers=function(){angular.forEach(p.Timer,function(e,t){angular.isDefined(e)&&i.cancel(e)})},p.clearShprSearch=function(){p.shipmentSearch.originCity="",p.shipmentSearch.destinationCity="",p.shipmentSearch.pickupDateTxt="",p.shipmentSearch.deliveryDateTxt="",p.shipmentSearch.referenceNbr="",p.shipmentSearch.statusCd=""},p.clearShprSearchMultipleRoute=function(){p.shipmentSearch.pickupDateTxtRoute1="",p.shipmentSearch.deliveryDateTxtRoute1="",p.shipmentSearch.pickupDateTxtRoute2="",p.shipmentSearch.deliveryDateTxtRoute2="",p.shipmentSearch.originLocRoute1="",p.shipmentSearch.destLocRoute1="",p.shipmentSearch.originLocRoute2="",p.shipmentSearch.destLocRoute2=""},p.SearchShipments2=function(){o.GetShipmentsByLocation(p.shipmentSearch).then(function(e){void 0!==(p.shipmentList=e)&&e.length||toastr.warning("No data found")})},p.counterinterval=0;p.bidtime=10,p.bidtimes=[],p.counterintervals=[];var S=[],f=[],g=[];p.bidTimer=function(e,d,h){var t;0!=p.counterintervals.length&&angular.isDefined(p.counterintervals[h])&&0!=p.counterintervals[h]||(t=new Date,null==e?(document.querySelectorAll("."+d)[0].innerHTML="",deliveryDt,bidStartIdsTohide[h]=!1,bidEndIdsTohide[h]=!0,g[h]=!0):(e=(new Date(e)-t)/1e3,p.bidtimes[h]=e,p.counterintervals[h]=e,g[h]=f[h]=!1,e<1&&(g[h]=!0,document.querySelectorAll("."+d)[0].innerHTML="Ended"))),angular.isDefined(S[h])||(S[h]=i(function(){if(p.bidtimes[h]=p.bidtimes[h]-1,sessionStorage.setItem("vm.bidtime"+h,p.bidtimes[h]),p.bidtimes[h]<0)p.stopBidTimer(h),f[h]=!0;else for(var e=Math.floor(p.bidtimes[h]%60),t=Math.floor(p.bidtimes[h]/60%60),i=Math.floor(p.bidtimes[h]/3600%24),n=Math.floor(p.bidtimes[h]/86400),r=""+e,s=i+"h "+t+"m "+(r=e<10?"0"+e:r)+"s",a=(0<n&&(s=n+"d "+i+"h "+t+"m "+r+"s"),document.querySelectorAll("."+d)),o=0;o<a.length;o++){var c=a[o];0==p.bidtimes[h]?(c.innerHTML="Bid Expired",g[h]=!0):c.innerHTML=s}},1e3))},p.stopBidTimer=function(e){angular.isDefined(S[e])&&(i.cancel(S[e]),S[e]=void 0)},d.$on("$stateChangeStart",function(e){angular.forEach(S,function(e,t){angular.isDefined(e)&&i.cancel(e)})}),p.shouldHidePlaceBidOption=function(e,t,i){return p.showYourBid=!1,p.showYourBidWon=!1,null!=t&&0<t&&(p.showYourBid=!0),p.cmpnyobj.companyId==i&&(p.showYourBidWon=!0),g[e]},d.shouldHide=function(e){return f[e]},d.stopTimeout=function(){angular.forEach(S,function(e,t){angular.isDefined(e)&&i.cancel(e)})},p.closeNDialog=function(){h.closeAll()},p.showShipmentDetails=function(e){p.userModule="Carrier Rates",p.userTitle="Carrier Rates",s.all(p.setSlctdShipperInformation(e.shipperId),p.setSlctdShipmentInformation(e)).then(function(){h.open({template:"app/shipper/shipment.detail.carrier.view.html",className:"ngdialog-theme-default custom-width-600x500",scope:d,controller:this})})},p.setSlctdShipperInformation=function(e){t.GetCarrierView(e).then(function(e){console.log("HETO oh:",e),angular.isObject(e)&&(p.shipperSlctdDetail=e,void 0===p.shipperSlctdDetail.companyLogoPath&&(p.shipperSlctdDetail.companyLogoPath="img/CompanyLogo1.png"))})},p.setSlctdShipmentInformation=function(e){p.slctdShipment=e},p.showShipmentCarrierRatesDialog=function(e){p.userModule="Carrier Rates",p.userTitle="Carrier Rates",p.selectedShipmentCurrentCarrierBid=[];d.sortType="quoteAmt",o.GetShipmentCarrierBids(e).then(function(e){console.log("HETO oh:",e),angular.isObject(e)&&(p.selectedShipmentCurrentCarrierBid=e)}),h.open({template:"app/shipper/shipment.rates.carrier.view.html",className:"ngdialog-theme-default custom-width-600x500",scope:d,controller:this})},p.showShipmentCarrierBiddingDialog=function(e,t,i,n,r,s){p.selectedShipmentOnBid=e,p.userModule="Carrier Bidding",p.userTitle="Carrier Biddind",p.selectedShipmentNbrToBid=n,p.selectedShipmentIdToBid=t,p.selectedShipmentEquipmentId=s,p.lowestCarrierBid=50,p.lowestCarrierBidCurrency=r,p.newLowestCarrierBid=i,p.newTransitTimeCarrierBid=0,p.bidPriceValidationMsg="",p.selectedShipmentCurrencyCd=e.currencyCd,p.selectedShipmentMinBid=e.lowEndBidAmt,p.selectedShipmentMaxBid=e.highEndBidAmt,p.selectedShipmentBidResultMsg="",null==p.selectedShipmentMinBid&&(p.selectedShipmentMinBid=10),null==p.selectedShipmentMaxBid&&(p.selectedShipmentMaxBid=1e7),null==p.selectedShipmentCurrencyCd&&(p.selectedShipmentCurrencyCd="Local Currency"),h.open({template:"app/shipper/shipment.bid.carrier.view.html",className:"ngdialog-theme-default custom-width-400x500",scope:d,controller:this})},p.submitCarrierBid=function(t,i,e,n,r,s,a){i<r?(p.selectedShipmentBidResultMsg="Bid too low! Please change bid.",d.$broadcast("newItemAdded")):s<i?(p.selectedShipmentBidResultMsg="Bid too high! Please change bid.",d.$broadcast("bidOutOfRange")):null==i?(p.selectedShipmentBidResultMsg="Bid out of target range! Please change bid.",angular.element(document.getElementById("carrierbid"))[0].focus()):(p.selectedShipmentBidResultMsg="",(r={}).shipmentId=t,r.carrierId=c.cmpny.companyId,r.carrierCd=c.cmpny.companyCode,r.quoteAmt=i,r.quoteCurrencyCd=a,r.transitTm=e,r.rateTypeCd="BID",r.equipmentTypeId=n,r.rateTypeDescTxt="Carrier bid",r.commentTxt=p.selectedShipmentCarrierBidComment,o.InsertCarrierBid(r).then(function(e){p.shouldHidePlaceBidOption(t,i),p.selectedShipmentOnBid.carrierBid=i,p.shipmentList.push(p.selectedShipmentOnBid),toastr.success("Bid submitted Successfully"),h.closeAll()}))}}angular.module("app").controller("ShipmentController",e),e.$inject=["ShipperService","UserService","CarrierServicesService","$rootScope","$scope","$interval","$stateParams","$state","ngDialog","$q","$filter"]}();
!function(){"use strict";function e(e,t,o,n,a,s,l){var c=[{city:"Toronto",desc:"This is the best city in the world!",lat:43.7,long:-79.4},{city:"New York",desc:"This city is aiiiiite!",lat:40.67,long:-73.94},{city:"Chicago",desc:"This is the second best city in the world!",lat:41.8819,long:-87.6278},{city:"Los Angeles",desc:"This city is live!",lat:34.05,long:-118.25},{city:"Las Vegas",desc:"Sin City...'nuff said!",lat:36.08,long:-115.1522}];alert("here");var r={zoom:4,center:new google.maps.LatLng(25,80),mapTypeId:google.maps.MapTypeId.TERRAIN},p=(s.map=new google.maps.Map(document.getElementById("map"),r),s.markers=[],new google.maps.InfoWindow);for(i=0;i<c.length;i++)!function(e){var t=new google.maps.Marker({map:s.map,position:new google.maps.LatLng(e.lat,e.long),title:e.city});t.content='<div class="infoWindowContent">'+e.desc+"</div>",google.maps.event.addListener(t,"click",function(){p.setContent("<h2>"+t.title+"</h2>"+t.content),p.open(s.map,t)}),s.markers.push(t)}(c[i]);s.openInfoWindow=function(e,t){e.preventDefault(),google.maps.event.trigger(t,"click")}}angular.module("app").controller("ShipperMapController",e),e.$inject=["ShipperMapController","ShipperService","UserService","$rootScope","$state","$scope","$log"]}();
!function(){function t(d){return{restrict:"A",link:function(t,e,l,r){var i=e[0];t.$watch(function(){var t=i.querySelector("tbody tr:first-child td:first-child");return t&&!t.style.width},function(t){t&&(angular.element(i.querySelectorAll("thead, tbody, tfoot")).css("display",""),d(function(){angular.forEach(i.querySelectorAll("tr:first-child th"),function(t,e){var l=i.querySelector("tbody tr:first-child td:nth-child("+(e+1)+")"),e=i.querySelector("tfoot tr:first-child td:nth-child("+(e+1)+")"),r=(l||t).offsetWidth;l&&(l.style.width=r+"px"),t&&(t.style.width=r+"px"),e&&(e.style.width=r+"px")}),angular.element(i.querySelectorAll("thead, tfoot")).css("display","block"),angular.element(i.querySelectorAll("tbody")).css({display:"block",height:l.tableHeight||"inherit",overflow:"auto"});var t,e=i.querySelector("tbody"),e=e.offsetWidth-e.clientWidth;0<e&&(e-=2,(t=i.querySelector("tbody tr:first-child td:last-child")).style.width=t.offsetWidth-e+"px")}))})}}}angular.module("anguFixedHeaderTable",[]).directive("fixedHeader",t),t.$inject=["$timeout"]}();
!function(){"use strict";function e(a,c,o,r,t,i,p){var s=this;function u(){angular.isObject(s.languages)&&0!=s.languages.length||(s.languages=[],c.GetLanguages().then(function(e){s.languages=e})),c.GetCompanyUser(s.company.companyId).then(function(e){console.log("users",e),s.users=e})}function m(){s.companyLogo={},s.companyLogoDocumentType={},s.pictureOne={},s.pictureOneDocumentType={},s.pictureTwo={},s.pictureTwoDocumentType={},s.pictureThree={},s.pictureThreeDocumentType={},s.fileLocation="/market-api/files/",s.companyLogo.fileDocumentTypeId=-1,s.companyLogo.documentType={descriptionTxt:"Select One"},s.companyLogo.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0},s.pictureOne.fileDocumentTypeId=-1,s.pictureOne.documentType={descriptionTxt:"Select One"},s.pictureOne.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0},s.pictureTwo.fileDocumentTypeId=-1,s.pictureTwo.documentType={descriptionTxt:"Select One"},s.pictureTwo.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0},s.pictureThree.fileDocumentTypeId=-1,s.pictureThree.documentType={descriptionTxt:"Select One"},s.pictureThree.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0},c.GetPhotos(s.company.companyId).then(function(e){var n;if(angular.isObject(e))for(s.company.fileDocTypes=e,n=0;n<s.company.fileDocTypes.length;n++)angular.isObject(s.company.fileDocTypes[n].documentType)&&0!=s.company.fileDocTypes[n].documentType.length&&(0==s.company.fileDocTypes[n].documentType.documentTypeId?(s.companyLogo=s.company.fileDocTypes[n],s.imageCompanyLogoActual=s.fileLocation+s.companyLogo.companyFile.relativePath):1==s.company.fileDocTypes[n].documentType.documentTypeId?(s.pictureOne=s.company.fileDocTypes[n],s.imagePicture1=s.fileLocation+s.pictureOne.companyFile.relativePath):2==s.company.fileDocTypes[n].documentType.documentTypeId?(s.pictureTwo=s.company.fileDocTypes[n],s.imagePicture2=s.fileLocation+s.pictureTwo.companyFile.relativePath):3==s.company.fileDocTypes[n].documentType.documentTypeId?(s.pictureThree=s.company.fileDocTypes[n],s.imagePicture3=s.fileLocation+s.pictureThree.companyFile.relativePath):5<s.company.fileDocTypes[n].documentType.documentTypeId&&s.docs.push(s.company.fileDocTypes[n]));angular.isObject(s.companyLogo)||(s.companyLogo.fileDocumentTypeId=-1,s.companyLogo.documentType=s.companyLogoDocumentType,s.companyLogo.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0}),angular.isObject(s.pictureOne)||(s.pictureOne.fileDocumentTypeId=-1,s.pictureOne.documentType=s.pictureOneDocumentType,s.pictureOne.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0}),angular.isObject(s.pictureTwo)||(s.pictureTwo.fileDocumentTypeId=-1,s.pictureTwo.documentType=s.pictureTwoDocumentType,s.pictureTwo.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0}),angular.isObject(s.pictureThree)||(s.pictureThree.fileDocumentTypeId=-1,s.pictureThree.documentType=s.pictureThreeDocumentType,s.pictureThree.companyFile={companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0})})}function d(){e(),c.GetCountry().then(function(e){var n;for(s.countryList=e,s.country=[],s.country[0]="Select One",s.countryList=e,n=0;n<s.countryList.length;n++)s.country.push(s.countryList[n].countryName)}),s.docDescs=[],c.GetDocumentType().then(function(e){s.docTypes=e;var n,o=0;for(s.docDescs[0]="Select One",n=0;n<s.docTypes.length;n++)0==n?s.companyLogoDocumentType=s.docTypes[n]:1==n?s.pictureOneDocumentType=s.docTypes[n]:2==n?s.pictureTwoDocumentType=s.docTypes[n]:3==n&&(s.pictureThreeDocumentType=s.docTypes[n]),5<n&&(s.docDescs[o+1]=s.docTypes[n].descriptionTxt,o++)}),c.GetCompanyProfile(s.company.companyId).then(function(e){if(s.company=e,s.pod=!1,console.log("POD ",s.company.hasPod),void 0!==s.company.hasPod&&("true"==new Boolean(s.company.hasPod).toString()||1==s.company.hasPod||1==s.company.hasPod?s.pod="Y":s.pod="N"),s.setTabEnabledStatus(),angular.isObject(s.company.clients)&&0!=s.company.clients.length?s.clients=s.company.clients:(s.clients=[],s.clients.push({companyClientId:-1,clientName:""})),angular.isObject(s.company.fileDocTypes)&&0!=s.company.fileDocTypes.length){for(var n=0;n<s.company.fileDocTypes.length;n++)angular.isObject(s.company.fileDocTypes[n].documentType)&&0!=s.company.fileDocTypes[n].documentType.length&&s.docs.push(s.company.fileDocTypes[n]);angular.isObject(s.docs)&&0!=s.docs.length||s.docs.push({fileDocumentTypeId:-1,documentType:{descriptionTxt:"Select One"},companyFile:{companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0}})}else s.docs.push({fileDocumentTypeId:-1,documentType:{descriptionTxt:"Select One"},companyFile:{companyFileId:-1,documentName:"",relativePath:void 0,isLegalDocument:!1,documentIndicator:0}})})}function l(){c.GetCompanyAddress(s.company.corporateAddressId).then(function(e){angular.isObject(e)&&(s.company.corporateAddress=e,console.log("load corporate company address",s.company),s.mapCorporateAddressLoad())})}function e(){s.clients=[],s.fileDocTypes=[],s.company.fileDocTypes=[],s.docs=[],s.docDescs=[],s.docTypes=[],s.finalDocuments=[],s.files=[]}function y(){s.equipmenttypes=[],s.equipmentTypeObject=[],s.numberOfTrucks="",c.GetEquipmentTypes().then(function(e){s.equipments=[],s.equipments[0]={equipmentTypeName:"Select One",equipmentTypeId:-1};for(var n=0;n<e.length;n++)s.equipments[n+1]=e[n];s.mainEquipmentTypeSelection=s.equipments[0],s.company.companyEquipments=[],c.GetCompanyEquipment(s.company.companyId).then(function(e){s.company.companyEquipments=e,console.log("current equipment",s.company.companyEquipments)})})}function n(){s.transportServices=[],s.otherServices=[],s.availableTransportServices=[],s.availableOtherServices=[],s.serviceAreas=[],s.currentServices=[],s.currentServiceAreas=[],s.allServices=[],s.availableTransportServices=[],s.availableOtherServices=[],c.GetServices(s.company.companyId).then(function(e){console.log("srvcs...",e);for(var n=0;n<e.length;n++)(1==e[n].isTransportation||1==e[n].isTransportation?s.transportServices:s.otherServices).push(e[n]);c.GetServiceArea(s.company.companyId).then(function(e){console.log("service",e),s.serviceAreaIds=e})})}function T(e){for(var n=0;n<s.countryList.length;n++)if(s.countryList[n].countryName==e)return s.countryList[n].countryId;return-1}function g(e){for(var n=0;n<s.company.fileDocTypes.length;n++)if(e.fileDocumentTypeId==s.company.fileDocTypes[n].fileDocumentTypeId)return s.company.fileDocTypes[n]=e,s.company.fileDocTypes[n]}s.company=a.currentUser.company,s.userId=a.currentUser.userId,s.btntabshprprev=!1,s.btntabshprnext=!1,s.btntabshprsubmit=!1,s.maxTab=6,s.successchange=!1,s.load=function(){"carrier.profile"==o.current.name&&void 0===s.profileTab?(s.currentTab=0,d(),s.addressTab=!0,s.profileTab=!0,s.btntabshprsubmit=!0):"carrier.address"==o.current.name&&void 0===s.addressTab?(s.btntabshprsubmit=!1,l(),s.addressTab=!0):"carrier.address"==o.current.name&&!0===s.addressTab?s.createProfile("address"):"carrier.photos"==o.current.name&&!0===s.photosTab?s.createCompanyAddress("photos"):"carrier.photos"==o.current.name&&void 0===s.photosTab?(m(),s.photosTab=!0):"carrier.users"==o.current.name&&!0===s.userTab?s.uploadPhotos("users"):"carrier.users"==o.current.name&&void 0===s.userTab?(u(),s.userTab=!0):"carrier.services"==o.current.name&&!0===s.serviceTab?n():"carrier.services"==o.current.name&&void 0===s.serviceTab?(n(),s.serviceTab=!0):"carrier.equipments"==o.current.name&&!0===s.eqptTab?s.createServices("equipment"):"carrier.equipments"==o.current.name&&void 0===s.eqptTab?(y(),s.eqptTab=!0):"carrier.pod"==o.current.name&&!0===s.podTab?d():"carrier.pod"==o.current.name&&void 0===s.podTab&&(d(),s.podTab=!0)},s.addTransportService=function(){var e,n=angular.element(document.getElementById("mainTransportServiceInput"))[0].value;1==function(e){for(var n=0;n<s.transportServices.length;n++)if(s.transportServices[n].serviceName==e)return 1;return 0}(n)?(s.dialogMsg="This transport service  "+n+" is already an existing service.",p.open({template:"app/carrier/message.html",className:"ngdialog-theme-default",scope:r,controller:this})):((e={}).serviceName=n,e.isTransportation=!0,e.createUserId=s.userId,e.updateUserId=s.userid,e.companyId=s.company.companyId,e.status=!0,(n=[]).push(e),c.SetServices(n).then(function(e){angular.element(document.getElementById("mainTransportServiceInput"))[0].value="",s.transportServices=[];for(var n=0;n<e.length;n++)1!=e[n].isTransportation&&1!=e[n].isTransportation||s.transportServices.push(e[n])}))},s.closeDialog=function(){p.closeAll()},s.addNewRegion=function(){var e,n=angular.element(document.getElementById("mainServiceAreaInput"))[0].value;1==function(e){for(var n=0;n<s.serviceAreaIds.length;n++)if(s.serviceAreaIds[n].serviceAreaName==e)return 1;return 0}(n)?(s.dialogMsg="This service area "+n+" is already an existing region.",p.open({template:"app/carrier/message.html",className:"ngdialog-theme-default",scope:r,controller:this})):((e={serviceAreaId:-1,carrierRegionId:-1}).serviceAreaName=n,e.createUserId=s.userId,e.companyId=s.company.companyId,e.status=!0,c.CreateCompanyServiceAreas(e).then(function(e){console.log("service",e),s.serviceAreaIds.push(e)}))},s.addOtherService=function(){var e,n=angular.element(document.getElementById("mainOtherServiceInput"))[0].value;1==function(e){for(var n=0;n<s.otherServices.length;n++)if(s.otherServices[n].serviceName==e)return 1;return 0}(n)?(s.dialogMsg="This other service  "+n+" is already an existing service.",p.open({template:"app/carrier/message.html",className:"ngdialog-theme-default",scope:r,controller:this})):((e={}).serviceName=n,e.isTransportation=!1,e.createUserId=s.userId,e.updateUserId=s.userid,e.companyId=s.company.companyId,e.status=!0,(n=[]).push(e),c.SetServices(n).then(function(e){angular.element(document.getElementById("mainOtherServiceInput"))[0].value="",s.otherServices=[];for(var n=0;n<e.length;n++)0!=e[n].isTransportation&&0!=e[n].isTransportation||s.otherServices.push(e[n])}))},s.addUserDialog=function(){s.userModule="Add",s.userTitle="Add New User",s.usr={emailAddress:"",firstName:"",lastName:"",phoneNumber:"",isTechnicalContact:!1,isPrimaryContact:!1,companyId:s.company.companyId,createUserId:s.userId,updateUserId:s.userId,languages:[]},s.usr.languages=[];for(var e=0;e<s.languages.length;e++)s.languages[e].status=!1,s.usr.languages.push(s.languages[e]);p.open({template:"app/carrier/users.add.view.html",className:"ngdialog-theme-default",scope:r,controller:this})},s.editUserDialog=function(e){s.userModule="Edit",s.userTitle="Edit User",s.usr=e;for(var n=[],o=0;o<s.languages.length;o++){var t=function(e){if(angular.isObject(s.usr.languages))for(var n=0;n<s.usr.languages.length;n++)if(s.usr.languages[n].languageId==e)return s.usr.languages[n];return null}(s.languages[o].languageId);angular.isObject(t)?(t.status=!0,n.push(t)):(s.languages[o].status=!1,n.push(s.languages[o]))}s.usr.languages=n,p.open({template:"app/carrier/users.add.view.html",className:"ngdialog-theme-default",scope:r,controller:this})},s.setTabEnabledStatus=function(){s.tabs.forEach(function(e){e.disabled=e.tab>s.company.wizardStepNbr||e.isDisabled})},s.editUser=function(){c.UpdateCompanyUser(s.usr).then(function(e){u(),p.closeAll()})},s.submit=function(){"Y"==s.pod?s.company.hasPod=!0:s.company.hasPod=!1,console.log("company",s.company),c.CreateCompanyProfile(s.company).then(function(e){s.company=e,d(),a.currentUser.company.wizardStepNbr=8,s.company.wizardStepNbr=8;var n=toastr.info("Saving...");c.CreateCompanyProfile(s.company).then(function(e){s.company=e,toastr.success("Saved Successfully!"),toastr.clear(n),o.go("home")})})},s.submitUser=function(){"Edit"==s.userModule?s.editUser():s.addUser()},s.addUser=function(){console.log("users",s.usr),c.InsertCompanyUser(s.usr).then(function(e){u(),p.closeAll()})},s.cancelEdit=function(){s.usr.languages=[],p.closeAll()},s.addClient=function(){s.clients.push({companyClientId:-1,clientName:""})},s.addDocument=function(){s.docs.push({fileDocumentTypeId:-1,documentType:{descriptionTxt:"Select One"},companyFile:{companyFileId:-1,documentName:"",isLegalDocument:!0,documentIndicator:0}})},s.deleteClient=function(e){s.deleteClientInfo(e)},s.deleteDocument=function(e){s.deleteFileDocument(e)},s.legalDocs=[],s.tabs=[{title:"Profile",route:"carrier.profile",tab:0,content:""},{title:"Address",route:"carrier.address",tab:1,content:""},{title:"Photos",route:"carrier.photos",tab:2,content:""},{title:"Users & Contacts",route:"carrier.users",tab:3,content:""},{title:"Services",route:"carrier.services",tab:4,content:""},{title:"Equipment/Assets",route:"carrier.equipments",tab:5,content:""},{title:"Proof Of Delivery",route:"carrier.pod",tab:6,content:"Proof Of Delivery"}],r.uploadFile=function(e,n){var o=n.name,n=new FormData;n.append("file",e[0]),s.docs[o].companyFile.documentName=e[0].name,t.post("/market-api/files/upload",n,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){s.docs[o].companyFile.relativePath=e.fileId,s.docs[o].companyFile.isLegalDocument=!0,s.docs[o].companyFile.documentIndicator=1}).error(function(){})},s.uploadLogo=function(){var e,n=angular.element(document.getElementById("MainContent_UploadedFile"))[0].files[0];void 0!==n&&(void 0===s.companyLogo.companyFile.createUserId&&(s.companyLogo.companyFile.createUserId=s.userId),s.companyLogo.companyFile.updateUserId=s.userId,s.companyLogo.companyFile.documentName=n.name,s.companyLogo.documentType=s.companyLogoDocumentType,s.companyLogo.companyFile.isLegalDocument=!1,s.companyLogo.companyFile.documentIndicator=0,(e=new FormData).append("file",n),t.post("/market-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){s.companyLogo.companyFile.relativePath=e.fileId,i.readAsDataUrl(n,r).then(function(e){s.imageCompanyLogoPreview=e})}).error(function(){}))},s.uploadPic1=function(){var e,n=angular.element(document.getElementById("MainContent_Pic1"))[0].files[0];void 0!==n&&(void 0===s.pictureOne.companyFile.createUserId&&(s.pictureOne.companyFile.createUserId=s.userId),s.pictureOne.companyFile.updateUserId=s.userId,angular.element(document.getElementById("holderPic1"))[0],s.pictureOne.companyFile.documentName=n.name,s.pictureOne.documentType=s.pictureOneDocumentType,s.pictureOne.companyFile.isLegalDocument=!1,s.pictureOne.companyFile.documentIndicator=0,(e=new FormData).append("file",n),t.post("/market-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){s.pictureOne.companyFile.relativePath=e.fileId,i.readAsDataUrl(n,r).then(function(e){s.imagePicture1=e})}).error(function(){}))},s.uploadPic2=function(){var e,n=angular.element(document.getElementById("MainContent_Pic2"))[0].files[0];void 0!==n&&(void 0===s.pictureTwo.companyFile.createUserId&&(s.pictureTwo.companyFile.createUserId=s.userId),s.pictureTwo.companyFile.updateUserId=s.userId,angular.element(document.getElementById("holderPic2"))[0],s.pictureTwo.companyFile.documentName=n.name,s.pictureTwo.documentType=s.pictureTwoDocumentType,s.pictureTwo.companyFile.isLegalDocument=!1,s.pictureTwo.companyFile.documentIndicator=0,(e=new FormData).append("file",n),t.post("/market-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){s.pictureTwo.companyFile.relativePath=e.fileId,i.readAsDataUrl(n,r).then(function(e){s.imagePicture2=e})}).error(function(){}))},s.uploadPic3=function(){var e,n=angular.element(document.getElementById("MainContent_Pic3"))[0].files[0];void 0!==n&&(void 0===s.pictureThree.companyFile.createUserId&&(s.pictureThree.companyFile.createUserId=s.userId),s.pictureThree.companyFile.updateUserId=s.userId,angular.element(document.getElementById("holderPic3"))[0],s.pictureThree.companyFile.documentName=n.name,s.pictureThree.documentType=s.pictureThreeDocumentType,s.pictureThree.companyFile.isLegalDocument=!1,s.pictureThree.companyFile.documentIndicator=0,(e=new FormData).append("file",n),t.post("/market-api/files/upload",e,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){s.pictureThree.companyFile.relativePath=e.fileId,i.readAsDataUrl(n,r).then(function(e){s.imagePicture3=e})}).error(function(){}))},s.setFile=function(n){s.$apply(function(e){s.files.push(n.files[0]),s.docs[n.name].companyFile.documentName=n.files[0].name})},s.go=function(e,n){s.currentTab=n,s.setActionButton(),o.go(e)},r.active=function(e){return o.is(e)},r.$on("$stateChangeSuccess",function(e,n,o,t,a){s.tabs.forEach(function(e){e.disabled=e.tab>s.company.wizardStepNbr||e.isDisabled,e.active=r.active(e.route)}),s.load()}),s.pop=function(){},s.prev=function(){0<s.currentTab&&(s.currentTab=s.currentTab-1,o.go(s.tabs[s.currentTab].route)),s.setActionButton()},s.setActionButton=function(){s.currentTab==s.maxTab?(s.btntabshprprev=!1,s.btntabshprnext=!0):(0==s.currentTab?s.btntabshprprev=!0:s.btntabshprprev=!1,s.btntabshprnext=!1),s.btntabshprsubmit=!0,s.currentTab>=s.maxTab&&(s.btntabshprsubmit=!1)},s.next=function(){if(s.activeRoute=s.tabs[s.currentTab].route,s.wizardStepNbr=s.currentTab,0==s.currentTab){s.profileTab=!0,s.addressTab=!0;var e=angular.element(document.getElementById("profileForm")),e=(console.log(e),angular.element(document.getElementById("businessName"))[0]);if(console.log(e.value),0==e.value)return}else 1==s.currentTab?s.photosTab=!0:2==s.currentTab?s.userTab=!0:3==s.currentTab?s.serviceTab=!0:4==s.currentTab?s.eqptTab=!0:5==s.currentTab?s.podTab=!0:s.currentTab;s.currentTab=s.currentTab+1,s.highTab<s.currentTab&&(s.highTab=s.currentTab),s.wizardLastTab=s.currentTab,s.currentTab>s.company.wizardStepNbr&&(s.company.wizardStepNbr=s.currentTab),o.go(s.tabs[s.currentTab].route,s.company)},s.setCountryCorporateAddress=function(e){e=$filter("filter")(s.countryList,{countryName:e},!0);e.length?s.addressCountry=e[0]:s.addressCountry=s.countryList[0]},s.selectCountryAction=function(e){s.addressCountry=e},s.createCompanyAddress=function(n){angular.isObject(s.company.corporateAddress)&&-1!=s.company.corporateAddressId?(s.company.corporateAddress.countryId=T(s.company.corporateAddress.countryName),console.log("updating company address",s.company),c.UpdateCompanyAddress(s.company.corporateAddress).then(function(e){s.company.companyAddress=e,"photos"==n&&m()})):(s.company.corporateAddress.countryId=T(s.company.corporateAddress.countryName),c.InsertCompanyAddress(s.company).then(function(e){s.company=e}),"photos"==n&&m())},s.deleteCompanyEquipment=function(o){c.DeleteCompanyEquipment(o.companyEquipmentId).then(function(e){var n=s.company.companyEquipments.indexOf(o);s.company.companyEquipments.splice(n,1)})},s.updateCompanyEquipmentOnly=function(e){c.UpdateCompanyEquipmentOnly(e).then(function(e){})},s.carrierRegionChange=function(o){void 0!==o.companyId&&-1!=o.companyId||(o.companyId=s.companyId),"false"==new Boolean(o.status).toString()||0==o.status?(console.log("delete please...",o),c.DeleteCompanyServiceAreas(o).then(function(e){var n=s.serviceAreaIds.indexOf(o);console.log(n)})):(console.log("create service",o),c.CreateCompanyServiceAreas(o).then(function(e){console.log("service",e)}))},s.deleteClientInfo=function(o){console.log("Client",o),c.DeleteClient(o.companyClientId).then(function(e){var n=s.clients.indexOf(o);console.log("console log",n),s.clients.splice(n,1),0==s.clients.length&&s.clients.push({companyClientId:-1,clientName:""})})},s.deleteFileDocument=function(o){c.DeleteDocument(o.fileDocumentTypeId).then(function(e){var n=s.docs.indexOf(o);s.docs.splice(n,1),0==s.docs.length&&s.docs.push({fileDocumentType:{fileDocumentTypeId:-1},documentType:{descriptionTxt:"Select One"},companyFile:{companyFileId:-1,documentName:"",isLegalDocument:!0,documentIndicator:1}})})},s.changeSelectedItem=function(){},s.addEquipment=function(){if(-1==s.mainEquipmentTypeSelection.equipmentTypeId)s.dialogMsg="Please select equipment type to add new equipment",p.open({template:"app/carrier/message.html",className:"ngdialog-theme-default",scope:r,controller:this}),angular.element(document.getElementById("equipmentType"))[0].focus();else{for(var e,n,o=!1,t=0;t<s.company.companyEquipments.length;t++)if(console.log("equipment type:",s.mainEquipmentTypeSelection.equipmentTypeId),console.log("equipment type ID:",s.company.companyEquipments[t].equipmentTypeId),s.mainEquipmentTypeSelection.equipmentTypeId==s.company.companyEquipments[t].equipment.equipmentType.equipmentTypeId){o=!0;break}1==o?(s.dialogMsg="The equipment you are adding is already configured. Please select unique equipment type.",p.open({template:"app/carrier/message.html",className:"ngdialog-theme-default",scope:r,controller:this}),angular.element(document.getElementById("equipmentType"))[0].focus()):(e={},n=angular.element(document.getElementById("mainEquipmentTypeTotalTrucks"))[0].value,e.equipmentCount=parseInt(""+n),e.companyId=s.company.companyId,e.createUserId=s.userId,(n={}).equipmentName="",n.createUserId=a.currentUser.userId,n.equipmentType=s.mainEquipmentTypeSelection,n.equipmentTypeId=s.mainEquipmentTypeSelection.equipmentTypeId,e.equipment=n,c.CreateCompanyEquipment(e).then(function(e){angular.isObject(s.company.companyEquipments)&&angular.isObject(s.company.companyEquipments)&&0<s.company.companyEquipments.length||(s.company.companyEquipments=[]),s.company.companyEquipments.push(e)}))}},s.uploadPhotos=function(n){var e=[];angular.isObject(s.companyLogo)&&(s.companyLogo.companyFile.companyId=s.company.companyId,s.companyLogo.companyFile.updateUserId=s.userId,s.companyLogo.documentType.documentTypeId=0,-1==s.companyLogo.fileDocumentTypeId?void 0!==s.companyLogo.companyFile.relativePath&&e.push(s.companyLogo):e.push(g(s.companyLogo))),angular.isObject(s.pictureOne)&&(s.pictureOne.companyFile.companyId=s.company.companyId,s.pictureOne.companyFile.updateUserId=s.userId,-(s.pictureOne.documentType.documentTypeId=1)==s.pictureOne.fileDocumentTypeId?void 0!==s.pictureOne.companyFile.relativePath&&e.push(s.pictureOne):e.push(g(s.pictureOne))),angular.isObject(s.pictureTwo)&&(s.pictureTwo.companyFile.companyId=s.company.companyId,s.pictureTwo.documentType.documentTypeId=2,s.pictureTwo.companyFile.updateUserId=s.userId,-1==s.pictureTwo.fileDocumentTypeId?void 0!==s.pictureTwo.companyFile.relativePath&&e.push(s.pictureTwo):e.push(g(s.pictureTwo))),angular.isObject(s.pictureThree)&&(s.pictureThree.companyFile.companyId=s.company.companyId,s.pictureThree.documentType.documentTypeId=3,s.pictureThree.companyFile.updateUserId=s.userId,-1==s.pictureThree.fileDocumentTypeId?void 0!==s.pictureThree.companyFile.relativePath&&e.push(s.pictureThree):e.push(g(s.pictureThree))),s.company.fileDocTypes=e,c.CreateFileDocumentType(s.company.fileDocTypes).then(function(e){s.company.fileDocTypes=e,"users"==n&&u()})},s.createServices=function(o){s.allServices=[];for(var e=0;e<s.transportServices.length;e++)s.transportServices[e].createUserId=s.userId,s.transportServices[e].updateUserid=s.userId,s.transportServices[e].companyId=s.company.companyId,s.allServices.push(s.transportServices[e]);for(e=0;e<s.otherServices.length;e++)s.otherServices[e].createUserId=s.userId,s.otherServices[e].updateUserid=s.userId,s.otherServices[e].companyId=s.company.companyId,s.allServices.push(s.otherServices[e]);c.SetServices(s.allServices).then(function(e){s.company.companyServices=e,s.allServiceAreas=[];for(var n=0;n<s.serviceAreaIds.length;n++)s.serviceAreaIds[n].createUserId=s.userId,s.serviceAreaIds[n].updateUserid=s.userId,s.serviceAreaIds[n].companyId=s.company.companyId,s.allServiceAreas.push(s.serviceAreaIds[n]);c.SetServiceAreas(s.allServiceAreas).then(function(e){"equipment"==o&&y()})})},s.createProfile=function(n){var e,o;for(s.fileDocumentTypes=[],s.company.carrierRegions=[],s.company.companyUsers=[],s.company.companyServices=[],s.company.companyEquipments=[],s.company.clients=[],e=0;e<s.docs.length;e++)"undefined"!==s.docs[e].companyFile.relativePath&&void 0!==s.docs[e].companyFile.relativePath&&void 0!==s.docs[e].documentType.descriptionTxt&&"Select One"!=s.docs[e].documentType.descriptionTxt&&"undefined"!=s.docs[e].documentType.descriptionTxt&&(s.fileDocumentTypes.push({fileDocumentTypeId:-1,documentType:{},companyFile:{}}),-1!=(o=function(e){for(var n=0;n<s.docTypes.length;n++)if(e==s.docTypes[n].descriptionTxt)return n;return-1}(s.docs[e].documentType.descriptionTxt))&&(s.fileDocumentTypes[e].documentType=s.docTypes[o]),s.fileDocumentTypes[e].fileDocumentTypeId=s.docs[e].fileDocumentTypeId,(o={}).companyFileId=s.docs[e].companyFile.companyFileId,o.documentName=s.docs[e].companyFile.documentName,o.relativePath=s.docs[e].companyFile.relativePath,o.isLegalDocument=!0,o.documentIndicator=1,s.fileDocumentTypes[e].companyFile=o);s.company.clients=s.clients,s.company.fileDocTypes=s.fileDocumentTypes,angular.isObject(s.company.createUserId)&&"undefined"!==s.company.createUserId||(s.company.createUserId=a.currentUser.userId),s.company.updateUserId=a.currentUser.userId,c.CreateCompanyProfile(s.company).then(function(e){s.clients=e.clients,s.docs=e.fileDocTypes,s.company=e,"address"==n&&l()})};var f=new google.maps.Geocoder,h={zoom:2,scrollwheel:!0,scrollwheelZoom:!1,navigationControl:!0,mapTypeControl:!0,scaleControl:!0,scaleControl:!0,draggable:!0,zoomControl:!0,panControl:!0,fullscreenControl:!0,center:new google.maps.LatLng(31.22011,121.466373),mapTypeId:google.maps.MapTypeId.ROADMAP};s.loadMapCorpAddress=function(a){"Unknown , undefined ,  , Unknown1"==a?r.mapShipperCorp=new google.maps.Map(document.getElementById("mapcarrier"),h):(s.markers=[],f.geocode({address:a},function(e,n){var o,t;n==google.maps.GeocoderStatus.OK?(o={zoom:10,scrollwheel:!0,scrollwheelZoom:!1,navigationControl:!0,mapTypeControl:!0,scaleControl:!0,scaleControl:!0,draggable:!0,zoomControl:!0,panControl:!0,fullscreenControl:!0,center:e[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP},s.mapcarrieraddr=new google.maps.Map(document.getElementById("mapcarrier"),o),(t=new google.maps.Marker({map:s.mapcarrieraddr,position:e[0].geometry.location,title:"Corporate Address"})).content='<div class="infoWindowContent">'+a+"</div>",google.maps.event.addListener(t,"click",function(){infoWindow.setContent("<h2>"+t.title+"</h2>"+t.content),infoWindow.open(s.mapcarrieraddr,t)}),s.markers.push(t),s.openInfoWindow=function(e,n){e.preventDefault(),google.maps.event.trigger(n,"click")}):console.log("Geocode failed "+n)}))},s.mapCorporateAddressReload=function(){var e=s.company.corporateAddress.addressLine1+" , "+s.company.corporateAddress.cityName+" , "+s.company.corporateAddress.provinceName+" , "+s.company.corporateAddress.countryName;s.loadMapCorpAddress(e)},s.mapCorporateAddressLoad=function(){var e;void 0!==s.company.corporateAddress&&(e=s.company.corporateAddress.addressLine1+" , "+s.company.corporateAddress.cityName+" , "+s.company.corporateAddress.provinceName+" , "+s.company.corporateAddress.countryName,s.loadMapCorpAddress(e))}}angular.module("app").controller("CarrierController",e),e.$inject=["UserService","CarrierService","$state","$scope","$http","fileReader","ngDialog"]}();
!function(){"use strict";function e(r,e,i,o){var t=this;console.log("ServiceAreasController UserService.currentUser:",e.currentUser),t.cmpny=e.currentUser.company,t.searchResultsList=[],t.vmServiceAreas=[],t.vmServices=[],t.vmEquipmentTypes=[],t.srvcArea={},t.seqNbr="",t.serviceAreaName="",t.serviceName="",t.ratingValue="",t.equipmentTypeName="",t.serviceAreasList=[],t.serviceList=[],t.equipmentTypeList=[],r.GetAllServiceAreasForDropDownList().then(function(e){console.log("getAllServiceAreasForDropDownList:",e),t.vmServiceAreas=e}),r.GetAllServicesForDropDownList().then(function(e){console.log("getAllServicesForDropDownList:",e),t.vmServices=e}),r.GetAllEquipmentTypesForDropDownList().then(function(e){console.log("GetAllEquipmentTypesForDropDownList:",e),t.vmEquipmentTypes=e}),t.SearchServiceAreas=function(){r.GetAllCarriersForServiceAreaAndService(t.selectedServiceAreas,t.selectedServices,t.selectedEquipmentTypes).then(function(e){console.log(e),void 0!==(t.searchResultsList=e)&&e.length||toastr.warning("No data found")})},t.exit=function(){i.closeAll()},t.carrierInfo=function(e){console.log("carrierCode",e),t.viewCarrier={},r.GetCarrierView(e).then(function(e){angular.isObject(e)&&(t.viewCarrier=e,console.log("vm.viewCarrier:",t.viewCarrier),t.viewCarrier.companyLogoPath="/market-api/files/"+t.viewCarrier.companyLogoPath,i.open({template:"app/carrierInfo/carrierInfo.view.html",className:"ngdialog-theme-default custom-width-800-ht-100 ngdialog-overlay",scope:o,controller:this}))})}}angular.module("app").controller("ServiceAreasController",e),e.$inject=["CarrierServicesService","UserService","ngDialog","$scope"]}();
!function(){"use strict";function e(s,d,n,o,i){var r=this;function c(){r.shipment={},r.pickupDt,r.deliveryDt,r.shipment.shipperId=r.company.companyId,r.shipment.statusId=1,r.shipment.pickupAddress={},r.shipment.deliveryAddress={},r.shipment.requestedEquipmentTypeId=-2,r.shipment.updateUserId=n.currentUser.emailAddress,r.shipment.createUserId=n.currentUser.emailAddress,r.addServiceFlg="N",r.details=[],r.deliveryCountryFlg="N",r.pickupCountryFlg="N",r.paymentFlg="N",r.shipment.pickupAddress.country="XX",r.shipment.deliveryAddress.country="XX",r.getQuoteFlg="N",r.equipmentFlg="N",r.currencyFlg="N",r.mode="N";var e=angular.element(document.getElementById("pickupDt"))[0];angular.element(document.getElementById("deliveryDt"))[0].value=r.defaultDeliveryDt,e.value=r.defaultPickupDt,r.pickupType="X",r.pickupContactName="",r.pickupContactPhoneNbr="",r.pickupContactEmailAddress="",r.deliveryType="X",r.deliveryContactName="",r.deliveryContactPhoneNbr="",r.deliveryContactEmailAddress=""}console.log("ShipmentTendersController UserService.currentUser:",n.currentUser),r.company=n.currentUser.company,r.services=[{serviceId:-5,serviceName:""}],r.equipments=[],r.uom=[],r.defaultCountry,r.defaultPickupDt,r.defaultDeliveryDt,r.country=[],r.currency=[],r.payment=[],c(),angular.element(document.getElementById("uiInputShipmentNbr"))[0].focus(),console.log("get uom..."),s.GetUom().then(function(e){r.uom.push({uomCd:"Select",uomDescriptionTxt:"Select"});for(var t=0;t<e.length;t++)r.uom.push(e[t])}),console.log("get payment term..."),s.GetPaymentTerm().then(function(e){console.log("getPayment",e),r.payment.push({paymentTermId:-1,paymentTermCd:"Select"});for(var t=0;t<e.length;t++)r.payment.push(e[t]);console.log("payment",r.payment)}),console.log("get country..."),s.GetCountry().then(function(e){console.log("getCountry",e),r.country.push({countryId:-2,countryName:"Select",country2Cd:"XX"});for(var t=0;t<e.length;t++)r.country.push(e[t])}),console.log("get currency..."),s.GetCurrency().then(function(e){console.log("getCurrency",e),r.currency.push({currencyCd:"XX",currencyName:"Select"});for(var t=0;t<e.length;t++)r.currency.push(e[t])}),console.log("get equipment..."),s.GetEquipment().then(function(e){r.equipments.push({equipmentTypeId:-2,equipmentTypeName:"Select"});for(var t=0;t<e.length;t++)r.equipments.push(e[t])}),console.log("fetch company country"),s.GetCompanyCountry(r.company.corporateAddressId).then(function(e){angular.isObject(e)&&(r.defaultCountry=e.country2Cd,console.log("default country",r.defaultCountry))}),s.GetDates().then(function(e){var t,s;angular.isObject(e)&&(console.log("dates",e),t=angular.element(document.getElementById("pickupDt"))[0],s=angular.element(document.getElementById("deliveryDt"))[0],r.defaultDeliveryDt=e[1].dt,r.defaultPickupDt=e[0].dt,t.value=e[0].dt,s.value=e[1].dt)}),r.selectAddress=function(e){"Pickup"==r.addressKey?r.shipment.pickupAddress=e:"Delivery"==r.addressKey&&(r.shipment.deliveryAddress=e),o.closeAll()},r.addContactInformation=function(){"P"==r.contactType?(r.pickupType="P",r.pickupContactName=r.contactName,r.pickupContactPhoneNbr=r.contactPhoneNumber,r.pickupContactEmailAddress=r.contactEmailAddress):(r.deliveryType="D",r.deliveryContactName=r.contactName,r.deliveryContactPhoneNbr=r.contactPhoneNumber,r.deliveryContactEmailAddress=r.contactEmailAddress),o.closeAll()},r.pickupLookup=function(){r.addressKey="Pickup",s.SearchAddress(r.shipment.pickupAddress.entityName,r.company.companyId,r.addressKey).then(function(e){console.log("addresss",e),angular.isObject(e)?1==e.length?r.shipment.pickupAddress=e[0]:(r.addresses=e,o.open({template:"app/shipmentTenders/address.view.html",className:"ngdialog-overlay",scope:i,showClose:!1,controller:this})):toastr.error("No address found.")})},r.addressSearch=function(){s.SearchAddress(r.addressSearchKey,r.company.companyId,r.addressKey).then(function(e){r.addresses=[],angular.isObject(e)?r.addresses=e:toastr.error("No address found.")})},r.deliveryLookup=function(){r.addressKey="Delivery",s.SearchAddress(r.shipment.deliveryAddress.entityName,r.company.companyId,r.addressKey).then(function(e){console.log("addresss",e),angular.isObject(e)?1==e.length?r.shipment.deliveryAddress=e[0]:(r.addresses=e,o.open({template:"app/shipmentTenders/address.view.html",className:"ngdialog-overlay",scope:i,showClose:!1,controller:this})):toastr.error("No address found.")})},r.getQuote=function(){r.pickupDt=angular.element(document.getElementById("pickupDt"))[0].value,r.deliveryDt=angular.element(document.getElementById("deliveryDt"))[0].value,console.log("pickup "+r.pickupDt),r.msg=[],r.title="Missing information",void 0!==r.shipment.shipmentNbr&&0!=r.shipment.shipmentNbr.length||r.msg.push("Shipment number is required."),void 0!==r.shipment.pickupAddress.line1&&0!=r.shipment.pickupAddress.line1.length||r.msg.push("Pickup address is required."),void 0!==r.shipment.pickupAddress.cityLocality&&0!=r.shipment.pickupAddress.cityLocality.length||r.msg.push("Pickup city  is required."),void 0!==r.shipment.pickupAddress.country&&"XX"!=r.shipment.pickupAddress.country||r.msg.push("Pickup country is required."),void 0===r.pickupDt&&r.msg.push("Pickup date is required"),void 0!==r.shipment.deliveryAddress.line1&&0!=r.shipment.deliveryAddress.line1.length||r.msg.push("delivery address is required."),void 0!==r.shipment.deliveryAddress.cityLocality&&0!=r.shipment.deliveryAddress.cityLocality.length||r.msg.push("delivery city  is required."),void 0!==r.shipment.deliveryAddress.country&&"XX"!=r.shipment.deliveryAddress.country||r.msg.push("delivery country is required."),void 0===r.deliveryDt&&r.msg.push("Delivery date is required");for(var e,t=0;t<r.details.length;t++)0===r.details[t].qty&&r.msg.push("qty is required for item #"+(t+1)),"Select"===r.details[t].unitOfMeasure&&r.msg.push("Unit of Measure is required for item #"+(t+1)),0==r.details[t].shipmentWt&&0==r.details[t].shipmentVol&&r.msg.push("Weight or Volume is required for item # "+(t+1));angular.isObject(r.msg)&&0<r.msg.length?o.open({template:"app/shipmentTenders/message.html",className:"ngdialog-overlay",scope:i,showClose:!1,controller:this}):(r.shipment.requestedPickupDt=new Date(r.pickupDt),r.shipment.requestedDeliveryDt=new Date(r.deliveryDt),r.shipment.services=r.transportationServices,r.shipment.shipmentDetails=r.details,(e=[]).push({contactTypeCd:r.pickupType,contactName:r.pickupContactName,contactPhoneNbr:r.pickupContactPhoneNbr,contactEmailAddress:r.pickupContactEmailAddress}),e.push({contactTypeCd:r.deliveryType,contactName:r.deliveryContactName,contactPhoneNbr:r.deliveryContactPhoneNbr,contactEmailAddress:r.deliveryContactEmailAddress}),r.shipment.shipmentContacts=e,console.log("before create..",r.shipment),s.CreateShipment(r.shipment).then(function(t){angular.isObject(t)?(console.log("call GetRateShop store proc"),s.GetRateShop(t.shipmentId,r.mode).then(function(e){c(),toastr.success("Saved Successfully."),r.showShipmentRatesDialog(t)})):toastr.error("Failed to create shipment.")}))},r.deleteService=function(e){e=r.transportationServices.indexOf(e);r.transportationServices.splice(e,1)},r.applyServices=function(){r.transportationServices=[];for(var e=0;e<r.services.length;e++)"true"==new Boolean(r.services[e].status).toString()&&r.transportationServices.push({status:!0,serviceName:r.services[e].serviceName,serviceId:r.services[e].serviceId});o.closeAll()},s.GetServices().then(function(e){r.services=e}),r.openAllServices=function(){s.GetServices().then(function(e){if(r.services=e,angular.isObject(r.transportationServices)&&0<r.transportationServices.length)for(var t=0;t<r.transportationServices.length;t++){n=s=void 0;for(var s=r.transportationServices[t].serviceId,n=0;n<r.services.length;n++)r.services[n].serviceId==s&&(r.services[n].status=!0)}o.open({template:"app/shipmentTenders/services.view.html",className:"ngdialog-overlay",scope:i,showClose:!1,controller:this})})},r.openContactInformation=function(e){"P"==e?(console.log("pickup contact",r.pickupContactName),r.contactType="P",r.contactName=r.pickupContactName,r.contactPhoneNumber=r.pickupContactPhoneNbr,r.contactEmailAddress=r.pickupContactEmailAddress):(r.contactType="D",r.contactName=r.deliveryContactName,r.contactPhoneNumber=r.deliveryContactPhoneNbr,r.contactEmailAddress=r.deliveryContactEmailAddress),o.open({template:"app/shipmentTenders/contact.view.html",className:"ngdialog-overlay",scope:i,showClose:!1,controller:this})},r.deleteDetail=function(e){e=r.details.indexOf(e);r.details.splice(e,1),0==r.details.length&&r.details.push({qty:0,unitOfMeasure:"Select",shipmentWt:0,shipmentVol:0,isHazardous:!1})},r.addDetail=function(){r.details.push({qty:0,unitOfMeasure:"Select",shipmentWt:0,shipmentVol:0,isHazardous:!1})},r.closeDialog=function(){o.closeAll(),angular.element(document.getElementById("uiInputShipmentNbr"))[0].focus()},r.validate=function(){var e=angular.element(document.getElementById("uiInputShipmentNbr")),t=angular.element(document.getElementById("uiInputShipmentNbr"))[0].value;console.log("ins",e),t?(console.log("not empty"+t),r.shipment={},r.shipment.shipmentNbr=t,r.shipment.shipperId=r.company.companyId,r.shipment.statusId=1,r.shipment.pickupAddress={},r.shipment.deliveryAddress={},r.shipment.requestedEquipmentTypeId=-2,r.shipment.paymentTermId=-1,r.paymentFlg="Y",r.shipment.updateUserId=n.currentUser.emailAddress,r.shipment.createUserId=n.currentUser.emailAddress,r.shipment.pickupAddress.country="XX",r.shipment.deliveryAddress.country="XX",r.shipment.currencyCd="XX",r.shipment.pickupAddress.line1="",r.shipment.pickupAddress.cityLocality="",r.shipment.pickupAddress.province="",r.shipment.pickupAddress.entityName="",r.pickupDt="",r.shipment.deliveryAddress.line1="",r.shipment.deliveryAddress.cityLocality="",r.shipment.deliveryAddress.province="",r.shipment.deliveryAddress.entityName="",r.deliveryDt="",r.shipment.lowEndBidAmt=0,r.shipment.highEndBidAmt=0,r.shipment.targetRateAmt=0,r.addServiceFlg="Y",r.deliveryCountryFlg="Y",r.currencyFlg="Y",r.getQuoteFlg="Y",r.equipmentFlg="Y",r.details=[{qty:0,unitOfMeasure:"Select",shipmentWt:0,shipmentVol:0,isHazardous:!1}],r.pickupCountryFlg="Y",s.ValidateShipment(r.shipment).then(function(e){if(angular.isObject(e)){r.shipment=e,console.log("DB shipment",r.shipment),void 0===r.shipment.pickupAddress.recipientName&&(r.shipment.pickupAddress.recipientName=""),void 0===r.shipment.pickupAddress.line1&&(r.shipment.pickupAddress.line1=""),void 0===r.shipment.pickupAddress.cityLocality&&(r.shipment.pickupAddress.cityLocality=""),void 0===r.shipment.pickupAddress.province&&(r.shipment.pickupAddress.province=""),void 0===r.shipment.pickupAddress.country&&(r.shipment.pickupAddress.country="XX"),void 0===r.shipment.deliveryAddress.recipientName&&(r.shipment.deliveryAddress.recipientName=""),void 0===r.shipment.deliveryAddress.line1&&(r.shipment.deliveryAddress.line1=""),void 0===r.shipment.deliveryAddress.cityLocality&&(r.shipment.deliveryAddress.cityLocality=""),void 0===r.shipment.deliveryAddress.province&&(r.shipment.deliveryAddress.province=""),void 0===r.shipment.deliveryAddress.country&&(r.shipment.deliveryAddress.country="XX"),r.transportationServices=r.shipment.shipmentServices,r.details=r.shipment.shipmentDetails,r.orderStatus="Edit Order";var e=angular.element(document.getElementById("pickupDt"))[0],t=angular.element(document.getElementById("deliveryDt"))[0],s=(e.value=r.shipment.requestedPickupDt,t.value=r.shipment.requestedDeliveryDt,console.log("",r.shipment.shipmentContacts),r.shipment.shipmentContacts);console.log("contacts",s);for(var n=0;n<s.length;n++)console.log("contacts",s[n]),"P"==s[n].contactTypeCd?(r.pickupType=s[n].contactTypeCd,r.pickupContactName=s[n].contactName,r.pickupContactPhoneNbr=s[n].contactPhoneNbr,r.pickupContactEmailAddress=s[n].contactEmailAddress,console.log("pickup tyoe",r.pickupType)):"D"==s[n].contactTypeCd&&(r.deliveryType=s[n].contactTypeCd,r.deliveryContactName=s[n].contactName,r.deliveryContactPhoneNbr=s[n].contactPhoneNbr,r.deliveryContactEmailAddress=s[n].contactEmailAddress);r.msg=[],r.title="Shipment Validation",5<r.shipment.statusId||20==r.shipment.statusId||15==r.shipment.statusId||10==r.shipment.statusId||30==r.shipment.statusId?(r.getQuoteFlg="N",20==r.shipment.statusId?(r.orderStatus="Bidding Closed",r.msg.push("Shipment is now closed for bidding and cannot be edited at this time.")):10==r.shipment.statusId||15==r.shipment.statusId?(r.orderStatus="Under Bidding",r.msg.push("Shipment is currently under bidding and cannot be edited at this time.")):30==r.shipment.statusId?(r.orderStatus="Booked.",r.msg.push("Shipment has been booked to carrier and cannot be edited at this time.")):(r.orderStatus="In process",r.msg.push("Shipment is in process  and cannot be edited at this time.")),o.open({template:"app/shipmentTenders/shipment.status.html",className:"ngdialog-overlay",scope:i,controller:this})):r.shipment.statusId=2}else r.orderStatus="New Order",r.shipment.deliveryAddress.country=r.defaultCountry,r.shipment.pickupAddress.country=r.defaultCountry})):(console.log("empty"+t),e.focus(),toastr.error("Shipment is required"))},r.showShipmentRatesDialog=function(t){r.selectedShipment=t,r.selectedTenderShipmentId=t.shipmentId,r.selectedBidShipmentNbr=t.shipmentNbr,r.selectedShipmentCarrierBid=[],i.sortType="quoteAmt",r.selectedShipmentTargetRateAmt=t.targetRateAmt,r.selectedShipmentCurrencyCd=t.currencyCd,r.selectedShipmentTargetRateTxt="",null!=r.selectedShipmentTargetRateAmt&&null!=r.selectedShipmentTargetRateAmt&&(r.selectedShipmentTargetRateTxt="Target Rate: "+r.selectedShipmentTargetRateAmt+" "+r.selectedShipmentCurrencyCd),d.GetShipmentCarrierBids(t.shipmentId).then(function(e){console.log("HETO oh:",e),r.selectedShipmentCarrierBid=e,r.shptSlctdBookBtn=!0,0<e.length?o.open({template:"app/shipmentTenders/shipment.tender.rates.view.html",className:"ngdialog-theme-default custom-width-700x500",scope:i,controller:this}):r.startBiddingSelectedShipmentDefault(t)})},r.bookSelectedShipment=function(e,t,s,n,i){var r={};r.shipmentId=e,r.shipmentCarrierBidId=t,r.carrierCd=s,r.assignedProviderId=n,d.BookShipment(r).then(function(e){toastr.success("Selected carrier Successfully"),o.closeAll()})},r.showShipmentBidStartDialog=function(e,t,s){r.bidModule="Bidding Start",r.userTitle="Bidding Start",r.selectedBidShipmentId=e;r.bidSelectedShipmentStartDate=new Date,o.open({template:"app/shipmentTenders/shipment.tender.bid.start.view.html",className:"ngdialog-theme-default custom-width-400x500",scope:i,controller:this})},r.startBiddingSelectedShipmentByDatetime=function(e,t){r.selectedShipment=t,r.bidPostEndDatetimeSlctd=$("#datetimepickertenderbidend").find("input").val();t={};t.shipmentId=e,t.tenderExpirationDt=new Date(r.bidPostEndDatetimeSlctd),d.UpdateShipmentTenderTerminationDate(t).then(function(e){toastr.success("Bid posted Successfully")}),o.closeAll()},r.startBiddingSelectedShipmentDefault=function(e){r.selectedShipment=e;var t={},e=(t.shipmentId=e.shipmentId,new Date);e.setDate(e.getDate()+2),t.tenderExpirationDt=e,d.UpdateShipmentTenderTerminationDate(t).then(function(e){toastr.success("Bid posted Successfully")}),o.closeAll()},r.closeNDialog=function(){o.closeAll()}}angular.module("app").controller("ShipmentTendersController",e),e.$inject=["ShipmentTendersService","ShipperService","UserService","ngDialog","$scope"]}();
!function(){"use strict";function e(e){var o=this;o.cmpny=e,console.log("vm.cmpny:",o.cmpny),o.exit=function(){ngDialog.closeAll()},o.imageCompanyLogoActual="https://assets.openport.com/img/your_logo_here.png";for(var n=0;n<o.cmpny.fileDocTypes.length;n++)0==o.cmpny.fileDocTypes[n].documentType.documentTypeId&&angular.isObject(o.cmpny.fileDocTypes[n].companyFile)&&(o.imageCompanyLogoActual="/market-api/files/"+o.cmpny.fileDocTypes[n].companyFile.relativePath)}angular.module("app").controller("CarrierInfoController",e),e.$inject=["company","CarrierService"]}();
!function(){"use strict";function o(r,n){var t=this;t.user={},t.forgotPassword=function(o){t.loading=!0,toastr.clear(),o?(t.dataLoading=!0,t.user.userApplication="DISPATCHER",console.log("Vm user",t.user),r.ForgotPassword(t.user).then(function(o){t.loading=!1,toastr.warning("If your information match our record, then an email will be sent to your email address"),n.path("/login")})):(t.loading=!1,toastr.error("Form is incomplete or has invalid values"))}}angular.module("app").controller("ForgotController",o),o.$inject=["UserService","$location"]}();
!function(){"use strict";function s(r,e){var o=this;return o.user={},console.log(r.currentUser),o.user.userId=r.currentUser.userId,o.user.emailAddress=r.currentUser.emailAddress,o.user.firstName=r.currentUser.firstName,o.user.lastName=r.currentUser.lastName,o.user.oldPassword="",o.user.newPassword="",o.user.newPassword2="",o.usr=r.currentUser,console.log(o.usr),{Update:function(s){s?(console.log(o.user),o.user.oldPassword===o.user.newPassword?(toastr.error("New password cannot be the same as old password"),$("#newPassword").focus()):o.user.newPassword===o.user.newPassword2?(s=toastr.info("Saving..."),o.dataLoading=!0,o.usr.password=o.user.newPassword,r.UpdatePassword(o.usr).then(function(s){o.dataLoading=!1,o.usr.password="",angular.isObject(s)?(toastr.success("Success"),r.currentUser.isPasswordWeak=!1,e.path("/")):toastr.error("Unable to Change Password")}),toastr.clear(s)):(toastr.error("New password does not match"),$("#newPassword2").focus())):toastr.error("Form is incomplete or has invalid values")},user:o.user}}angular.module("app").controller("PasswordController",s),s.$inject=["UserService","$location"]}();
!function(){"use strict";function e(t,d,e,r,i,o,s,n,a,l){var u=this;function c(){u.orderShipmentNbrDisabled="Y",u.orderCustomerCodeDisabled="Y",u.orderCustomerOrderDisabled="Y",u.orderQtyDisabled="Y",u.orderUomDisabled="Y",u.orderPickupInfoDisabled="Y",u.orderPickupDtDisabled="Y",u.orderPickupTmDisabled="Y",u.orderPickupPostalCdDisabled="Y",u.orderPickupCityDisabled="Y",u.orderPickupStateDisabled="Y",u.orderPickupAddressDisabled="Y",u.orderPickupNameDisabled="Y",u.orderPickupCountryDisabled="Y",u.orderDeliveryInfoDisabled="Y",u.orderDeliveryDtDisabled="Y",u.orderDeliveryTmDisabled="Y",u.orderDeliveryPostalCdDisabled="Y",u.orderDeliveryCityDisabled="Y",u.orderDeliveryStateDisabled="Y",u.orderDeliveryAddressDisabled="Y",u.orderDeliveryNameDisabled="Y",u.orderDeliveryCountryDisabled="Y",u.orderSubmitDisabled="Y",u.s_pickupTm="",u.s_pickupDt="",u.s_requestedDeliveryDt="",u.s_requestedDeliveryTm="",$("#ord_pickupDt").val(""),$("#ord_pickupTm").val(""),$("#ord_requestedDeliveryDt").val(""),$("#ord_requestedDeliveryTm").val("")}function p(e){console.log(e);var r,i=null;for(r of u.assets)if(r.assetId==e){i=r.assetNumber;break}return i}function D(){u.orderShipmentNbrDisabled="N",u.orderCustomerCodeDisabled="N",u.orderCustomerOrderDisabled="N",u.orderQtyDisabled="N",u.orderUomDisabled="N",u.orderPickupInfoDisabled="N",u.orderPickupDtDisabled="N",u.orderPickupTmDisabled="N",u.orderPickupPostalCdDisabled="N",u.orderPickupCityDisabled="N",u.orderPickupStateDisabled="N",u.orderPickupAddressDisabled="N",u.orderPickupNameDisabled="N",u.orderPickupCountryDisabled="N",u.orderDeliveryInfoDisabled="N",u.orderDeliveryDtDisabled="N",u.orderDeliveryTmDisabled="N",u.orderDeliveryPostalCdDisabled="N",u.orderDeliveryCityDisabled="N",u.orderDeliveryStateDisabled="N",u.orderDeliveryAddressDisabled="N",u.orderDeliveryNameDisabled="N",u.orderDeliveryCountryDisabled="N",u.orderSubmitDisabled="N"}function m(){var e,r,i,t;void 0!==u.order.pickupDt?(console.log("pickup",u.order.pickupDt),u.s_pickupTm=b(u.order.pickupDt),u.s_pickupDt=(""+u.order.pickupDt).substring(0,10).replace(/-/g,"/")):(u.s_pickupTm="",u.s_pickupDt=""),void 0!==u.order.pickupDt?(u.order.pickupTm=(e=u.order.pickupDt,e=new Date(e),r=12<=e.getHours()?(t=parseInt(e.getHours())-12,"PM"):(t=e.getHours(),"AM"),1==(i=""+t).length&&(i="0"+t),t=""+e.getMinutes(),i+":"+(t=1==t.length?"0"+t:t)+" "+r),u.order.pickupDt=$.datepicker.formatDate("yy/mm/dd",new Date(u.order.pickupDt))):(u.order.pickupTm="",u.orderpickupDt=""),void 0!==u.order.requestedDeliveryDt?(console.log("requested",u.order.requestedDeliveryDt),u.s_requestedDeliveryTm=b(u.order.requestedDeliveryDt),u.s_requestedDeliveryDt=(""+u.order.requestedDeliveryDt).substring(0,10).replace(/-/g,"/")):(u.s_requestedDeliveryTm="",u.s_requestedDeliveryDt=""),void 0===u.order.sender.country&&(u.order.sender.country="Select"),void 0===u.order.recipient.country&&(u.order.recipient.country="Select")}console.log($.datepicker.formatDate("yymmdd",new Date)),c(),u.filterValue=function(e){console.log(e),isNaN(String.fromCharCode(e.keyCode))&&$event.preventDefault()},u.openPickupAddress=function(){u.addressType="Pickup",t.GetAddresses(u.orderPickupInfoSearch).then(function(e){u.addresses=e,console.log("addresses",u.addresses),a(function(){u.opt=n.open({template:"app/orders/address.html",className:"ngdialog-overlay",scope:s,showClose:!1,modal:!0,controller:this}),u.searchAddress=u.orderPickupInfoSearch,console.log("search Address",u.searchAddress),u.initAddressTable("addresses")},100)})},u.openDeliveryAddress=function(){u.addressType="Consignee",t.GetAddresses(u.orderDeliveryInfoSearch).then(function(e){u.addresses=e,console.log("addresses",u.addresses),a(function(){u.opt=n.open({template:"app/orders/address.html",className:"ngdialog-overlay",scope:s,showClose:!1,modal:!0,controller:this}),u.searchAddress=u.orderDeliveryInfoSearch,console.log("search Address",u.searchAddress),u.initAddressTable("addresses")},100)})},u.setAddress=function(e){"Pickup"==u.addressType?u.order.sender=e:"Consignee"==u.addressType&&(u.order.recipient=e),n.closeAll()},u.closeAddress=function(){n.closeAll()},u.initAddressTable=function(e){a(function(){$("#addresses").DataTable({searching:!0,bDestroy:!0,oSearch:{sSearch:u.searchAddress},displayLength:5,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100)},u.submitOrder=function(){toastr.clear(),void 0===u.order.deliveryNumber||0==u.order.deliveryNumber.trim().length?($("#uiOrderDeliveryNbr").focus(),toastr.error(" shipment number is required.")):void 0===u.order.shipperCd||0==u.order.shipperCd.trim().length?($("#uiOrderShipperCd").focus(),toastr.error(" shipper code is required.")):void 0===u.order.orderNumber||0==u.order.orderNumber.trim().length?($("#uiOrderNumber").focus(),toastr.error(" order number is required.")):isNaN(new Date(angular.element(document.getElementById("ord_pickupDt"))[0].value).getTime())?(toastr.error("Invalid Pickup Date Value"),$("#ord_pickupDt").focus()):g($.datepicker.formatDate("yy/mm/dd "+v($("#ord_pickupTm").val()),new Date($("#ord_pickupDt").val())))?($("#ord_pickupDt").focus(),toastr.error("Pickup Date/Start Time Entered is lesser than Current Date")):void 0===u.order.sender.recipientName||0==u.order.sender.recipientName.trim().length?($("#uiOrderSenderRecipientName").focus(),toastr.error(" Sender pickup name is required.")):void 0===u.order.sender.line1||0==u.order.sender.line1.trim().length?($("#uiOrderSenderLine1").focus(),toastr.error(" Sender pickup address is required.")):void 0===u.order.sender.city||0==u.order.sender.city.trim().length?($("#uiOrderSenderCity").focus(),toastr.error(" Pickup city is required.")):void 0===u.order.sender.country||"Select"==u.order.sender.country?($("#uiOrderSenderCountry").focus(),toastr.error("Pickup Country is required.")):isNaN(new Date(angular.element(document.getElementById("ord_deliveryDt"))[0].value).getTime())?(toastr.error("Invalid Delivery Date Value"),$("#ord_deliveryDt").focus()):g($.datepicker.formatDate("yy/mm/dd "+v($("#ord_deliveryTm").val()),new Date($("#ord_deliveryDt").val())))?($("#ord_deliveryDt").focus(),toastr.error("Delivery Date/Start Time Entered is lesser than Current Date")):void 0===u.order.recipient.recipientName||0==u.order.recipient.recipientName.trim().length?($("#uiOrderRecipientRecipientName").focus(),toastr.error(" Recipient delivery name is required.")):void 0===u.order.recipient.line1||0==u.order.recipient.line1.trim().length?($("#uiOrderRecipientLine1").focus(),toastr.error(" Recipient delivery address is required.")):void 0===u.order.recipient.city||0==u.order.recipient.city.trim().length?($("#uiOrderRecipientCity").focus(),toastr.error(" Recipient delivery city is required.")):void 0===u.order.recipient.country||"Select"==u.order.recipient.country?($("#uiOrderRecipientCountry").focus(),toastr.error("Recipient delivery Country is required.")):void 0===u.order.recipient.recipientName||0==u.order.recipient.recipientName.trim().length?($("#uiOrderRecipientRecipientName").focus(),toastr.error(" Recipient pickup name is required.")):void 0===u.order.recipient.line1||0==u.order.recipient.line1.trim().length?($("#uiOrderRecipientLine1").focus(),toastr.error(" Recipient pickup address is required.")):void 0===u.order.recipient.city||0==u.order.recipient.city.trim().length?($("#uiOrderRecipientCity").focus(),toastr.error(" Pickup city is required.")):void 0===u.order.recipient.country||"Select"==u.order.recipient.country?($("#uiOrderRecipientCountry").focus(),toastr.error("Pickup Country is required.")):(u.dataLoading=!0,void 0!==u.order.originalDeliveryNumber&&u.order.deliveryNumber!=u.order.originalDeliveryNumber?u.order.shipmentType="New":void 0!==u.order.originalOrderNumber&&u.order.orderNumber!=u.order.originalOrderNumber&&(u.order.shipmentType="Replacement"),u.order.assetNumber=p(u.order.assetId),u.order.trailerNbr=p(u.order.trailerId),u.order.chassisNbr=p(u.order.chassisId),console.log("vm order",u.order),u.order.pickupDt=$("#ord_pickupDt").val(),u.order.pickupDt=new Date(u.order.pickupDt),u.order.pickupTm=$("#ord_pickupTm").val(),u.order.requestedDeliveryDt=$("#ord_deliveryDt").val(),u.order.requestedDeliveryDt=new Date(u.order.requestedDeliveryDt),u.order.requestedDeliveryTm=$("#ord_deliveryTm").val(),u.order.createUserId="createorderform-"+d.currentUser.userName,u.order.providerId=d.currentUser.provider.providerId,u.order.timezone=d.currentUser.partner.timezone,u.order.scacCd=d.currentUser.partner.partnerCd,console.log("final vm.order",u.order),t.CreateOrder(u.order).then(function(e){u.dataLoading=!1,angular.isObject(e)?(u.order={},c(),toastr.success("Saved Successfully.")):(u.dataLoading=!1,toastr.error("Failed to save shipment."))}))},t.ListCountries().then(function(e){u.countries=[],u.countries.push({countryCd:"Select",countryName:"Select One"});for(var r=0;r<e.length;r++)u.countries.push(e[r])});var y={};function v(e){var r=e.substring(0,2),i=e.substring(3,5),e=e.substring(6,8);return console.log(" z",e),console.log(" min",i),console.log(" hr",r),"AM"!=e&&("01"==r?r="13":"02"==r?r="14":"03"==r?r="15":"04"==r?r="16":"05"==r?r="17":"06"==r?r="18":"07"==r?r="19":"08"==r?r="20":"09"==r?r="21":"10"==r?r="22":"11"==r&&(r="23")),r+":"+i}function b(e){var r=(e=e.substring(11,16)).substring(0,2),i=e.substring(3,6);return console.log(" time",e),console.log(" min",i),console.log(" hr",r),"00"==r||+r<12?r+":"+i+" AM":("13"==r?r="1":"14"==r?r="2":"15"==r?r="3":"16"==r?r="4":"17"==r?r="5":"18"==r?r="6":"19"==r?r="7":"20"==r?r="8":"21"==r?r="9":"22"==r?r="10":"23"==r&&(r="11"),r+":"+i+" PM")}function g(e){var e=new Date(e),r=new Date;return console.log(" date",e),console.log("current date",r),!(r<=e)}function b(e){var r=(e=e.substring(11,16)).substring(0,2),i=e.substring(3,6);return console.log(" time",e),console.log(" min",i),console.log(" hr",r),"00"==r||+r<12?r+":"+i+" AM":("13"==r?r="1":"14"==r?r="2":"15"==r?r="3":"16"==r?r="4":"17"==r?r="5":"18"==r?r="6":"19"==r?r="7":"20"==r?r="8":"21"==r?r="9":"22"==r?r="10":"23"==r&&(r="11"),r+":"+i+" PM")}y.parent=d.currentUser.parentPartnerCd,y.partner=d.currentUser.partner.partnerCd,t.ListUom(y).then(function(e){if(angular.isObject(e)&&0<e.length){console.log("with UOM"),u.uoms=[],u.uoms.push({uomCd:"Select",uomDescriptionTxt:"Select One"});for(var r=0;r<e.length;r++)u.uoms.push(e[r])}else{var i={};i.parent=d.currentUser.parentPartnerCd,i.partner="-",t.ListUom(i).then(function(e){if(angular.isObject(e)&&0<e.length){u.uoms=[],u.uoms.push({uomCd:"Select",uomDescriptionTxt:"Select One"});for(var r=0;r<e.length;r++)u.uoms.push(e[r])}})}}),u.validateShipment=function(){var e;c(),void 0===u.searchDeliveryNbr||0==u.searchDeliveryNbr.trim().length?($("#uiInputDeliveryNbr").focus(),toastr.error(" input is required for validation")):(u.dataLoading=!0,e={provider:d.currentUser.partnerCd,reference:u.searchDeliveryNbr},t.FetchOrder(e).then(function(e){console.log("return",e),u.originalOrderNumber,u.originalDeliveryNumber,u.dataLoading=!1,(angular.isObject(e)&&0<e.length?"DV"==e[0].statusCd||"Delivered"==e[0].statusCd||"DELIVERED"==e[0].statusCd?($("#uiInputDeliveryNbr").focus(),u.order=e[0],m):(u.order=e[0],u.order.originalOrderNumber=u.order.orderNumber,u.order.originalDeliveryNumber=u.order.deliveryNumber,u.order.shipmentType="Edit",m(),D):(u.order={},u.order.recipient={},u.order.sender={},u.order.recipient.country="Select",u.order.recipient.streetName="",u.order.sender.streetName="",u.order.sender.country="Select",u.order.unitUom="Select",console.log("this is new "),u.order.shipmentType="New",u.order.deliveryNumber=u.searchDeliveryNbr,u.order.pickupDt=$.datepicker.formatDate("yy/mm/dd",new Date),u.order.requestedDeliveryDt=$.datepicker.formatDate("yy/mm/dd",new Date),u.order.pickupTm="09:00 AM",u.s_pickupTm="09:00 AM",u.s_pickupDt=$.datepicker.formatDate("yy/mm/dd",new Date),u.order.requestedDeliveryTm="5:00 PM",u.s_requestedDeliveryDt=$.datepicker.formatDate("yy/mm/dd",new Date),u.s_requestedDeliveryTm="17:00 PM",D))()}))},u.assets=[],u.init=function(){e.GetAssets(d.currentUser.partnerCd).then(function(e){u.assets=[],u.assets=e})},u.init()}angular.module("app").controller("OrdersController",e).directive("validNumber",function(){return{require:"?ngModel",link:function(e,r,i,d){d&&(d.$parsers.push(function(e){var r=(e=angular.isUndefined(e)?"":e).replace(/[^-0-9]/g,""),i=r.split("-"),t=r.split(".");return angular.isUndefined(i[1])||(i[1]=i[1].slice(0,i[1].length),r=i[0]+"-"+i[1],0<i[0].length&&(r=i[0])),angular.isUndefined(t[1])||(t[1]=t[1].slice(0,2),r=t[0]+"."+t[1]),e!==r&&(d.$setViewValue(r),d.$render()),r}),r.bind("keypress",function(e){32===e.keyCode&&e.preventDefault()}))}}}),e.$inject=["OrdersService","UserService","DispatcherService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http"]}();
!function(){"use strict";function r(t,r,o,e,n,c,a,i,s,l){var u=new Date;this.t=u.getTime(),n.trustSrc=function(){t.currentUser.param.country;var r="",r=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/ng-map/?client=dispatcher&"+"&code="+t.currentUser.partnerCd;void 0!==t.currentUser.param.token&&(r=r+"&token="+t.currentUser.param.token),$("#iFrmTracker"),$(window),$("#headerow");return console.log("trust url is ",r),s.trustAsResourceUrl(r)}}angular.module("app").controller("TrackerController",r),r.$inject=["UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$sce","$location"]}();
!function(){"use strict";function r(e,r,t,n,o,u,a,c,s){o.trustSrc=function(){var r=e.currentUser.param.uploadUrl+"?userID="+e.currentUser.userName,r=(r=void 0!==e.currentUser.parentPartnerCd?r+"&parentPartnerCd="+e.currentUser.parentPartnerCd:r)+"&customerCd="+e.currentUser.partnerCd;return s.trustAsResourceUrl(r)}}angular.module("app").controller("UploaderController",r),r.$inject=["UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$sce"]}();
!function(){"use strict";function e(o,l,e,r,a,s,c,u,t,i){var n=this;function d(){n.saveScheduleTrigger,n.reportName="",n.areaRecipients="",$("#scheduleDt").val(""),$("#scheduleTm").val(""),n.scheduleTypeFormat="CSV",n.M_everyWeek="N",n.T_everyWeek="N",n.W_everyWeek="N",n.TH_everyWeek="N",n.F_everyWeek="N",n.S_everyWeek="N",n.Su_everyWeek="N",n.runMonthlyFlg="N",n.runWeeklyFlg="Y",n.dom="",n.specifiedDayFrequency="Select",n.specifiedMonthDay="0",n.everyWeek="Y",n.setEveryWeek(),n.reportFrequency="EW"}function p(e,r){for(var a=0;a<n.selectedcols.length;a++)if(n.selectedcols[a].parameterId==r)return void(n.selectedcols[a].priority=e)}function h(e){for(var r=0;r<n.availablecols.length;r++)if(n.availablecols[r].parameterId==e)return n.availablecols[r];return e}n.withDataSource=!0,n.isSchedule=!0,n.operands=[],n.columnSort=[],n.operands.push({operand:"Not Applicable",value:"NONE"}),n.operands.push({operand:"equal",value:"="}),n.operands.push({operand:"greater than",value:">"}),n.operands.push({operand:"greater or equal",value:">="}),n.operands.push({operand:"is blank/spaces",value:"IS_BLANK"}),n.operands.push({operand:"is not blank/spaces",value:"IS_NOT_BLANK"}),n.operands.push({operand:"is null (no value)",value:"IS NULL"}),n.operands.push({operand:"is not null (has value)",value:"IS NOT NULL"}),n.operands.push({operand:"less than",value:"<"}),n.operands.push({operand:"less or equal",value:"<="}),n.operands.push({operand:"like",value:"LIKE"}),n.operands.push({operand:"values are (use ; to separate each value)",value:"IN"}),n.operands.push({operand:"values are not (use ; to separate each value)",value:"NOT IN"}),n.operands.push({operand:"Number of Days ago (Range))",value:"Number of Days ago"}),n.operands.push({operand:"Day ago (Exact day - Not range))",value:"Day ago"}),n.operands.push({operand:"Today",value:"Today"}),n.operands.push({operand:"Number of Hours ago",value:"Number of Hours ago"}),n.dataTypeFormat="CSV",n.scheduleTypeFormat="CSV",n.everyWeek="Y",n.reportFrequency="EW",n.datasource="XX",n.datasources=[],n.selectedcols=[],n.isWithSchedule=!1,n.reportUrlPath="https://"+i.host()+"/files/report/",n.reportLocalPath="/opt/openport/data/REPORTS/",n.isScheduleCreated=!1,n.datasources.push({reportDbSourceName:"XX",reportDataGroupName:"Select Data Source"}),o.GetDataSources({parent:l.currentUser.parentPartnerCd,partner:l.currentUser.partnerCd}).then(function(e){if(angular.isObject(e))for(var r=0;r<e.length;r++)n.datasources.push(e[r]);else n.withDataSource=!1}),n.setEveryWeek=function(){n.everyWeek="Y",n.M_everyWeek="N",n.T_everyWeek="N",n.W_everyWeek="N",n.TH_everyWeek="N",n.F_everyWeek="N",n.S_everyWeek="N",n.Su_everyWeek="N"},n.deleteSchedule=function(){var e={};void 0===n.availablesource.reportName?toastr.error("report name is required."):(e.reportName=n.availablesource.reportName,e.reportOwnerUserId=l.currentUser.userName,o.DeleteSchedule(e).then(function(e){angular.isObject(e)?(n.userSrc.reportSchedule={},d(),n.reportName=n.availablesource.reportName,n.isWithSchedule=!1,n.isScheduleCreated=!1,$("#uiChkbSchedule")[0].checked=!1,toastr.success("schedule successfully deleted")):toastr.error("failed to delete report schedule")}))},n.createSchedule=function(){1==$("#uiChkbSchedule")[0].checked?(n.isScheduleCreated=!0,console.log("check")):(n.isScheduleCreated=!1,console.log("uncheck"),d(),n.isWithSchedule=!1,n.isScheduleCreated=!1)},n.saveSchedule=function(e){if(1==$("#uiChkbSchedule")[0].checked){if(!n.reportName)return toastr.error("report name is required."),void $("#uiReportName").focus();if(!$("#scheduleDt").val())return $("#scheduleDt").focus(),void toastr.error("schedule date is required.");if(!$("#scheduleTm").val())return $("#scheduleTm").focus(),void toastr.error("schedule time is required.");if("EW"==n.reportFrequency&&"N"==n.M_everyWeek&&"N"==n.T_everyWeek&&"N"==n.W_everyWeek&&"N"==n.TH_everyWeek&&"N"==n.F_everyWeek&&"N"==n.S_everyWeek&&"N"==n.Su_everyWeek)return void toastr.error("No Day of the Week Selected","Please select at least 1 day of the week when this report should run.");if("EM"==n.reportFrequency&&"DOM"==n.specificRunDay&&!n.dom)return toastr.error("Day of the month is required."),void $("#uiInputDOM").focus();if("EM"==n.reportFrequency&&"FOM"==n.specificRunDay&&"Select"==n.specifiedDayFrequency)return $("#uiSelectSpecifiedDayFrequency").focus(),void toastr.error("Specified day frequency.");if("EM"==n.reportFrequency&&"FOM"==n.specificRunDay&&"0"==n.specifiedMonthDay)return $("#uiSelectSpecifiedMonthDay").focus(),void toastr.error("Specified month day");if(!n.areaRecipients)return $("#uiTextAreaRecipients").focus(),void toastr.error("Recipents is required");n.saveScheduleTrigger="Y"}else n.saveScheduleTrigger="N";console.log("type",e),n.availablesource?(console.log("report name",n.availablesource.reportName),void 0===e&&void 0===n.availablesource.value?(console.log("NWE"),n.saveReport("NEW")):void 0===e&&n.availablesource.reportName==n.reportName?n.saveReport("UPDATE"):n.saveReport("NEW")):($("#uiSelectDataSource").focus(),toastr.error("Please select datasource"))},n.setEveryMonth=function(){n.everyWeek="N",n.dom,n.specificRunDay="DOM",n.dayOfMonth()},n.dayOfMonth=function(){n.dayOfMonthFrequency="Y",n.dom},n.frequencyOfMonth=function(){n.dayOfMonthFrequency="N",n.specifiedDayFrequency="Select",n.specifiedMonthDay="0"},n.addToSort=function(e){$("#SORT_"+e.parameterId).prop("disabled",!0);var r=1;0!=n.columnSort.length&&(r=n.columnSort.length+1),n.columnSort.push({priority:r,colName:e.colName,parameterId:e.parameterId})},n.setSchedule=function(){n.isSchedule?(n.isSchedule=!1,$("#uiSched").removeClass("glyphicon-minus").addClass("glyphicon-plus")):(n.isSchedule=!0,$("#uiSched").removeClass("glyphicon-plus").addClass("glyphicon-minus"))},n.deleteReport=function(e){var r;n.reportName?((r={}).dataSource=n.datasource,r.userName=l.currentUser.userName,r.reportName=n.reportName,o.DeleteReport(r).then(function(e){angular.isObject(e)?(toastr.success("Report has been deleted successfully"),n.getAvailableSources(),n.reportName=""):toastr.error("Failed to delete the report.")})):toastr.error("Nothing to delete.")},n.saveReportOnly=function(e){n.saveScheduleTrigger="N",n.saveReport(e)},n.saveReportAndSchedule=function(e){"UPDATE"==e&&n.reportName!=n.availablesource.reportName?(toastr.error("The report name must be the same with your existing report."),$("#uiReportName").focus()):"NEW"==e&&n.reportName==n.availablesource.reportName?(toastr.error("This report name already exists. Please use update to save the report"),$("#uiReportName").focus()):(n.saveScheduleTrigger="Y",n.saveSchedule(e))},n.selectAllColumns=function(){if(void 0!==n.availablecols)for(var e=0;e<n.availablecols.length;e++)$("#"+n.availablecols[e].parameterId).is(":disabled")||(console.log("move ",n.availablecols[e]),n.moveToSelected(n.availablecols[e]))},n.removeAllColumns=function(){if(void 0!==n.selectedcols){for(var e=0;e<n.selectedcols.length;e++){$("#"+n.selectedcols[e].parameterId).removeAttr("disabled");var r=n.columnSort.indexOf(n.selectedcols[e]);void 0!==r&&(n.columnSort.splice(r,1),$("#BTN_DEL_SORT_"+n.selectedcols[e].parameterId).click(),$("#BTN_"+n.selectedcols[e].parameterId).click())}n.selectedcols=[]}},n.saveReport=function(e){if(toastr.clear(),console.log("went here",e),n.reportName)if(void 0===n.selectedcols||0==n.selectedcols.length)toastr.error("No criteria created.Please check your column and operand selection.");else if("NEW"==e&&n.reportName==n.availablesource.reportName)toastr.error("This report name already exists. Please use update to save the report"),$("#uiReportName").focus();else if("UPDATE"==e&&n.reportName!=n.availablesource.reportName)toastr.error("The report name must be the same with your existing report."),$("#uiReportName").focus();else{if("Y"==n.saveScheduleTrigger&&n.areaRecipients){console.log("went here");var r=n.areaRecipients.replace("\n",";").split(";");console.log(r);for(var a=0;a<r.length;a++)if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(r[a]))return toastr.error("invalid email address."),void $("#uiTextAreaRecipients").focus()}$("#sort_list tr").each(function(){var e=$(this).find(".sortid").html(),r=$(this).find(".priority").html();if(void 0!==e)for(var a=r,t=e,o=0;o<n.columnSort.length;o++)if(n.columnSort[o].parameterId==t)return void(n.columnSort[o].priority=a)}),$("#col_list tr").each(function(){var e=$(this).find(".columnid").html(),r=$(this).find(".priority").html();void 0!==e&&p(r,e)});var t={};t.criteriaList=n.selectedcols,t.sortList=n.columnSort,t.reportFormat=n.dataTypeFormat,t.dataSource=n.datasource,t.userName=l.currentUser.userName,t.reportUrlPath=n.reportUrlPath,t.reportLocalPath=n.reportLocalPath,t.reportName=n.reportName,"NEW"==e?t.isNewReport=!0:t.isUpdateReport=!0,"Y"==n.saveScheduleTrigger&&((e={monthlyDayOfWeekValue:0,dateOfMonthValue:0}).reportName=n.reportName,e.reportOwnerUserId=l.currentUser.userName,e.recipientAddr=n.areaRecipients.replace("\n",";"),e.startDt=new Date($("#scheduleDt").val()),e.startTm=$("#scheduleTm").val(),e.timeZoneCountry="Server's Local Time",e.timeZoneOffSet=0,e.lastRunStatusCd="C",e.lastRunStatusTxt="OK",e.deliveryFormatCd="EML",e.reportOutputFormat=n.scheduleTypeFormat,"EW"==n.reportFrequency?(e.runMonFlg=n.M_everyWeek,e.runTueFlg=n.T_everyWeek,e.runWedFlg=n.W_everyWeek,e.runThuFlg=n.TH_everyWeek,e.runFriFlg=n.F_everyWeek,e.runSatFlg=n.S_everyWeek,e.runSunFlg=n.Su_everyWeek,e.runMonthlyFlg="N",e.runWeeklyFlg="Y"):(e.runMonthlyFlg="Y",e.runWeeklyFlg="N",e.runMonFlg="N",e.runTueFlg="N",e.runWedFlg="N",e.runThuFlg="N",e.runFriFlg="N",e.runSatFlg="N",e.runSunFlg="N","DOM"==n.specificRunDay?e.dateOfMonthValue=n.dom:(e.monthlyFreqValue=n.specifiedDayFrequency,e.monthlyDayOfWeekValue=parseInt(n.specifiedMonthDay))),t.reportSchedule=e),console.log("report wizard",t),n.dataLoading=!0,c.open({template:"app/reportwizard/file.view.html",className:"ngdialog-theme-default",scope:s,showClose:!0,controller:this}),o.RunReport(t).then(function(e){n.dataLoading=!1,c.closeAll(),angular.isObject(e)?(toastr.success("Report has been  successfully saved."),n.getAvailableSources(),d()):toastr.success("Failed to process request")})}else toastr.error("report name is required."),$("#uiReportName").focus()},n.runReport=function(){var e;void 0===n.selectedcols?toastr.error("No criteria created.Please check your column and operand selection."):($("#col_list tr").each(function(){var e=$(this).find(".columnid").html(),r=$(this).find(".priority").html();void 0!==e&&p(r,e)}),(e={}).criteriaList=n.selectedcols,e.sortList=n.columnSort,e.reportFormat=n.dataTypeFormat,e.dataSource=n.datasource,e.userName=l.currentUser.userName,e.reportUrlPath=n.reportUrlPath,e.reportLocalPath=n.reportLocalPath,n.dataLoading=!0,c.open({template:"app/reportwizard/file.view.html",className:"ngdialog-theme-default",scope:s,showClose:!0,controller:this}),o.RunReport(e).then(function(e){console.log("report wizard",e),1==e.isFileCreated?(n.fileview=n.reportUrlPath+e.filename,$(location).attr("href",n.fileview),n.dataLoading=!1):(n.dataLoading=!1,c.closeAll(),toastr.error("failed to create report. Please verify your columns and operands"))}))},n.deleteSortRow=function(e){$("#SORT_"+e.parameterId).removeAttr("disabled");var r=n.columnSort.indexOf(e);void 0!==r&&$("#BTN_DEL_SORT_"+e.parameterId).click(),n.columnSort.splice(r,1),$("#BTN_DEL_SORT_"+e.parameterId).click()},n.deleteSelectedCol=function(e){$("#"+e.parameterId).removeAttr("disabled");void 0!==(r=n.columnSort.indexOf(e))&&(n.columnSort.splice(r,1),$("#BTN_DEL_SORT_"+e.parameterId).click());var r=n.selectedcols.indexOf(e);n.selectedcols.splice(r,1),$("#BTN_"+e.parameterId).click()},n.moveToSelected=function(e){var r=1;0!=n.selectedcols.length&&(r=n.selectedcols.length+1),n.selectedcols.push({priority:r,colName:e.parameterName,operand:"NONE",criteria:"",parameterId:e.parameterId,value:e.parameter1Value,datatype:e.parameter2Value})},n.displayUserColumns=function(e){console.log("displayUserColumns",e),d(),r=e.reportSchedule,console.log("show scheduler"),void 0!==r&&(n.isWithSchedule=!0,n.isScheduleCreated=!0,$("#uiChkbSchedule")[0].checked=!0,0==r.dateOfMonthValue||void 0===r.dateOfMonthValue?n.dom=0:n.dom=r.dateOfMonthValue,n.areaRecipients=r.recipientAddr,"Y"==r.runWeeklyFlg?(n.everyWeek,n.reportFrequency="EW",n.setEveryWeek(),"Y"==r.runMonFlg&&(n.M_everyWeek="Y"),"Y"==r.runTueFlg&&(n.T_everyWeek="Y"),"Y"==r.runWedFlg&&(n.W_everyWeek="Y"),"Y"==r.runThuFlg&&(n.TH_everyWeek="Y"),"Y"==r.runFriFlg&&(n.F_everyWeek="Y"),"Y"==r.runSatFlg&&(n.S_everyWeek="Y"),"Y"==r.runSunFlg&&(n.Su_everyWeek="Y")):(n.everyWeek,n.reportFrequency="EM",n.setEveryMonth(),0<n.dom?(n.specificRunDay="DOM",n.dayOfMonth(),n.dom=r.dateOfMonthValue):(n.specificRunDay="FOM",n.frequencyOfMonth(),n.specifiedDayFrequency=r.monthlyFreqValue,n.specifiedMonthDay=""+r.monthlyDayOfWeekValue)),n.scheduleTypeFormat=r.reportOutputFormat,$("#scheduleDt").val($.datepicker.formatDate("yy/mm/dd",new Date(r.startDt))),$("#scheduleTm").val(r.startTm)),n.userSrc=e,n.reportName=e.reportName,n.selectedcols=[],n.columnSort=[];var r,a=e.userColumns;if(void 0===e.userCriteria)for(var t=0;t<a.length;t++){var o=h("COL_PARAM_"+a[t].colName);n.selectedcols.push({priority:t+1,colName:o.parameterName,operand:"NONE",criteria:"",parameterId:"COL_PARAM_"+a[t].colName,value:a[t].colName,datatype:o.parameter2Value})}else{n.userSrcTemp=n.userSrc.userCriteria;for(t=0;t<a.length;t++){var l=function(e){for(var r=0;r<n.userSrcTemp.length;r++)if(n.userSrcTemp[r].colName==e)return n.userSrcTemp[r]}(a[t].colName);void 0!==l?(o=h("COL_PARAM_"+l.colName),n.selectedcols.push({priority:t+1,colName:o.parameterName,operand:l.operand,criteria:l.criteria,parameterId:"COL_PARAM_"+l.colName,value:l.colName,datatype:o.parameter2Value}),n.userSrcTemp.splice(0,1)):(o=h("COL_PARAM_"+a[t].colName),n.selectedcols.push({priority:t+1,colName:o.parameterName,operand:"NONE",criteria:"",parameterId:"COL_PARAM_"+a[t].colName,value:a[t].colName,datatype:o.parameter2Value}))}}var s=e.userSort;n.columnSort=[],u(function(){for(var e=0;e<s.length;e++)$("#SORT_"+s[e].parameterId).prop("disabled",!0),n.columnSort.push({priority:e+1,colName:h(s[e].parameterId).parameterName,parameterId:s[e].parameterId})},500)},n.getAvailableSources=function(){d(),n.isWithSchedule=!1,n.isScheduleCreated=!1,$("#uiChkbSchedule")[0].checked=!1,n.selectedcols=[],n.columnSort=[],n.availablesource={reportName:"None",userId:"XX",value:void 0},n.availablesources=[],n.availablesources.push(n.availablesource),"XX"==n.datasource?(toastr.error("Select Data Source to continue."),$("#uiSelectDataSource").focus()):o.GetAvailableSources({sourcename:n.datasource,userId:l.currentUser.userName}).then(function(a){o.GetAvailableColumns(n.datasource).then(function(e){if(n.availablecols=e,angular.isObject(a))for(var r=0;r<a.length;r++)a[r].value=a[r].reportName,n.availablesources.push(a[r])})})}}angular.module("app").controller("ReportWizardController",e).directive("orderloading",function(){return{restrict:"E",replace:!0,template:'<div class="loading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />LOADING...</div>',link:function(e,r,a){e.$watch("orderloading",function(e){e?$(r).show():$(r).hide()})}}}),e.$inject=["ReportWizardService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$location"]}();
!function(){"use strict";function A(A,i,t,n,a,e,r,o,c,l){var f=this;f.dataLoading=!0;A.Fetch({parent:"openpt",application:"dispatcher"}).then(function(A){f.affiliation=A,f.initTable()}),f.changeAffiliation=function(A){i.currentUser.partner=A.partner,i.currentUser.partnerCd=A.affiliationCd,i.currentUser.parentPartnerCd="OPENPT",i.currentUser.companyName=A.name,i.FetchProvider(A.affiliationCd).then(function(A){angular.isObject(A)?(i.currentUser.provider=A,t.analytics=A.analytics,n.go("home")):toastr.error("Provider ID is not valid for this carrier.Contact Support.")})},f.initTable=function(){$("#affiliations").dataTable().fnDestroy(),o(function(){$("#affiliations").DataTable({searching:!0,bDestroy:!0,displayLength:10,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},200),f.dataLoading=!1}}angular.module("app").controller("AffiliationController",A).directive("affLoading",function(){return{restrict:"E",replace:!0,template:'<div class="affLoading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />loading...</div>',link:function(A,i,t){A.$watch("affLoading",function(A){A?$(i).show():$(i).hide()})}}}),A.$inject=["AffiliationService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$window"]}();
!function(){"use strict";function t(a,t,A,e,o,l,i,s,d,n){var c=this;c.dataLoading=!0,c.vpoPlan=[],c.vpoPlan.push({test:"1"}),c.vpoPlan.push({test:"2"}),a.GetConsolidatedLoads("GLAXO").then(function(t){var A;console.log("return",t),c.vpodata=t,A=$("#vpo").DataTable({data:c.vpodata,columns:[{className:"radio-select",orderable:!1,data:null,defaultContent:'<input type="radio" name="VPO">'},{className:"details-control",orderable:!1,data:null,defaultContent:'<i class="material-icons">expand_more</i>'},{data:"poNbr"},{data:"pickupDt"},{data:"deliveryDt"},{data:"consignee"},{data:"totalVol"},{data:"totalWt"},{className:"popup-info",orderable:!1,data:null,defaultContent:"\t"}],order:[[2,"asc"]],scrollY:"15rem",scrollCollapse:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"]]}),$("#vpo tbody").on("click","td.details-control",function(){var t=$(this).closest("tr"),a=A.row(t);a.child.isShown()?(a.child.hide(),t.removeClass("shown")):(a.child(function(t){console.log("log",t.items);for(var a="<table>",A=0;A<t.items.length;A++)console.log("list",t.items[A]),a=a+'<tr><td></td><td class="details-remove" ng-clicke><i class="material-icons toggle">&#xE15C;</i></td><td>'+t.items[A].poNbr+"</td><td>"+t.items[A].pickupDt+"</td><td>"+t.items[A].deliveryDt+"</td><td>"+t.items[A].consignee+"</td><td>"+t.items[A].totalVol+"</td><td>"+t.items[A].totalWt+'</td><td><i class="material-icons">info_outline</i></td></tr>';return a+"</table>"}(a.data())).show(),t.addClass("shown"))}),a.GetAvailableLoads("GLAXO").then(function(t){var A;console.log("return",t),c.shipmentdata=t,A=$("#lpo").DataTable({data:c.shipmentdata,columns:[{className:"radio-select",orderable:!1,data:null,defaultContent:'<input type="checkbox">'},{className:"details-control",orderable:!1,data:null,defaultContent:'<i class="material-icons">expand_more</i>'},{data:"poNbr"},{data:"pickupDt"},{data:"deliveryDt"},{data:"consignee"},{data:"totalVol"},{data:"totalWt"},{className:"popup-info",orderable:!1,data:null,defaultContent:'<i class="material-icons">info_outline</i>'}],order:[[2,"asc"]],scrollY:"15rem",scrollCollapse:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"]]}),$("#lpo tbody").on("click","td.details-control",function(){var t=$(this).closest("tr"),a=A.row(t);a.child.isShown()?(a.child.hide(),t.removeClass("shown")):(a.child(function(t){console.log("log",t.items);for(var a="<table>",A=0;A<t.items.length;A++)console.log("list",t.items[A]),a=a+'<tr><td></td><td class="details-remove" ng-clicke><i class="material-icons toggle">&#xE15C;</i></td><td>'+t.items[A].poNbr+"</td><td>"+t.items[A].pickupDt+"</td><td>"+t.items[A].deliveryDt+"</td><td>"+t.items[A].consignee+"</td><td>"+t.items[A].totalVol+"</td><td>"+t.items[A].totalWt+'</td><td><i class="material-icons">info_outline</i></td></tr>';return a+"</table>"}(a.data())).show(),t.addClass("shown"))})})})}angular.module("app").controller("ConsolidatorController",t).directive("affLoading",function(){return{restrict:"E",replace:!0,template:'<div class="affLoading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />loading...</div>',link:function(t,a,A){t.$watch("affLoading",function(t){t?$(a).show():$(a).hide()})}}}),t.$inject=["ConsolidatorService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$window"]}();
!function(){"use strict";function e(A,e,s,t,o,a,n,r,i,l){var c=this;c.host=l.host(),c.dataLoading=!0,c.pendingusers=[],c.activeusers,A.PendingUsers().then(function(e){angular.isObject(e)&&(c.pendingusers=e),A.ActiveUsers().then(function(e){angular.isObject(e)&&(c.activeusers=e,c.initActiveUserTable()),c.dataLoading=!1})}),c.initActiveUserTable=function(){$("#activeUsers").DataTable().clear().draw(),$("#activeUsers").dataTable().fnDestroy(),r(function(){$("#activeUsers").DataTable({searching:!0,bDestroy:!0,displayLength:10,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100)},c.openRejectForm=function(e){c.usr=e,n.open({template:"app/approver/reject.user.html",className:"ngdialog-overlay",scope:a,showClose:!1,modal:!0,controller:this})},c.openDeactivatedForm=function(e){c.usr=e,n.open({template:"app/approver/deactivate.user.html",className:"ngdialog-overlay",scope:a,showClose:!1,modal:!0,controller:this})},c.openUserForm=function(e){c.usr=e,n.open({template:"app/approver/edit.user.html",className:"ngdialog-overlay",scope:a,showClose:!1,modal:!0,controller:this})},c.updateUser=function(e){e.enabled=1,e.hostname=c.host,console.log("users",e),A.EditUser(e).then(function(e){angular.isObject(e)?(n.closeAll(),toastr.success("Saved Successfully.")):toastr.error("Failed to edit user.")})},c.approvedUser=function(s){s.enabled=1,s.hostname=c.host,console.log("users",s),A.ApproveUser(s).then(function(e){angular.isObject(e)?(console.log(e),e=c.pendingusers.indexOf(s),c.pendingusers.splice(e,1),toastr.success("Saved Successfully."),A.ActiveUsers().then(function(e){angular.isObject(e)&&(c.activeusers=e,c.initActiveUserTable())})):toastr.error("Failed to approve user.")})},c.closeDialog=function(){n.closeAll()},c.rejectUser=function(){c.usr.enabled=0,c.usr.hostname=c.host,c.usr.rejectReason=c.reason,console.log("vm user",c.usr),A.ApproveUser(c.usr).then(function(e){angular.isObject(e)?(console.log(e),e=c.pendingusers.indexOf(c.usr),c.pendingusers.splice(e,1),n.closeAll(),toastr.success("Saved Successfully.")):toastr.error("Failed to decline user.")})},c.deactivateUser=function(){c.usr.enabled=0,c.usr.hostname=c.host,c.usr.rejectReason=c.reason,console.log("vm user",c.usr),A.ApproveUser(c.usr).then(function(e){angular.isObject(e)?(n.closeAll(),e=c.activeusers.indexOf(c.usr),c.activeusers.splice(e,1),toastr.success("Deactivation Successfully.")):toastr.error("Failed to deactivate user.")})},c.initTable=function(){$("#usrs").dataTable().fnDestroy(),r(function(){$("#usrs").DataTable({searching:!0,bDestroy:!0,displayLength:10,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},200),c.dataLoading=!1}}angular.module("app").controller("ApproverController",e).directive("affLoading",function(){return{restrict:"E",replace:!0,template:'<div class="affLoading" align="center"><img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="  width="25" height="25" />loading...</div>',link:function(e,s,A){e.$watch("affLoading",function(e){e?$(s).show():$(s).hide()})}}}),e.$inject=["ApproverService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$location"]}();
!function(){"use strict";function e(i,c,e,a,t,l,r,s,o,n){var d=this,n=(d.showTable,d.bybatch=!1,d.batchreport="C",d.reportUrlPath="https://"+n.host()+"/files/report/",new Date),g=new Date;g.setDate(g.getDate()+3),n.setDate(n.getDate()-1),n=$.datepicker.formatDate("yy/mm/dd",new Date(n)),g=$.datepicker.formatDate("yy/mm/dd",new Date(g)),$("#fromDt").val(n),$("#toDt").val(g),d.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy/mm/dd",todayHighlight:!0,autoclose:!0})},d.initDataTable=function(e){var a="#"+e;$(a).dataTable().fnDestroy(),s(function(){$(a).DataTable({searching:!0,bDestroy:!0,displayLength:25,aLengthMenu:[[5,10,25,-1],[5,10,25,"All"]]})},100)},d.closeInvoice=function(){r.closeAll()},d.updateCharge=function(){console.log("charge ",d.charges),i.InvoiceCharge(d.charges).then(function(e){if(angular.isObject(e)){console.log("new set charge ",e),d.gl.charges=e;for(var a=0,t=0;t<e.length;t++)a+=e[t].chargeAmt;d.gl.totalCost=a,r.closeAll()}else toastr.error("failed to update invoices")})},d.openCharges=function(e){console.log("select gl model",e),d.gl=e,d.charges=e.charges,r.open({template:"app/gl/charge.view.html",className:"ngdialog-overlay",scope:l,showClose:!1,modal:!0,controller:this})},d.exportInvoice=function(){console.log("Export...",d.gls),i.ExportInvoice(d.gls).then(function(e){var a;angular.isObject(e)?(console.log(e),a=e.batchNbr,d.showTable,d.noRecordFound="N",i.FetchInvoice({chargeType:"R",affiliation:c.currentUser.partnerCd,from:"-",end:"-",batchNbr:a}).then(function(e){console.log(e),d.dataLoading=!1,d.gls=e,$("#invoices").DataTable().clear().draw(),$("#invoices").dataTable().fnDestroy(),angular.isObject(e)&&0<e.length?(d.showTable="Y",d.initDataTable("invoices"),s(function(){l.loading=!1},100)):(l.loading=!1,d.noRecordFound="Y")}),$(location).attr("href",d.reportUrlPath+e.filename),toastr.success("Report successfully generated.")):toastr.error("failed to create report")})},d.deleteCharges=function(e){e=d.charges.indexOf(e);d.charges.splice(e,1)},d.addCharge=function(){var e={};if($("#uiInputChargeDesc").val())if($("#uiInputChargeCode").val())if($("#uiInputChargeAmt").val())if($("#uiInputChargeAmt").val()<=0)toastr.error("Additional charge amt is required."),$("#uiInputChargeAmt").focus();else{e.description=d.addChargeDesc,e.chargeTypeCd=d.addChargeCode,e.chargeAmt=d.addChargeAmt,e.currency=d.charges[0].currency;for(var a=0;a<d.charges.length;a++){if(d.charges[a].description==d.addChargeDesc)return toastr.error("Additional charge description is required."),void $("#uiInputChargeDesc").focus();if(d.charges[a].chargeTypeCd==d.addChargeCode)return toastr.error("Additional charge code is required."),void $("#uiInputChargeCode").focus()}console.log("charge",e),d.charges.push(e),d.addChargeDesc=void 0,d.addChargeCode=void 0,d.addChargeAmt=void 0}else toastr.error("Additional charge amt is required."),$("#uiInputChargeAmt").focus();else toastr.error("Additional charge code is required."),$("#uiInputChargeCode").focus();else toastr.error("Additional charge description is required."),$("#uiInputChargeDesc").focus()},d.changeReport=function(){"BATCH"==d.batchreport?d.bybatch=!0:d.bybatch=!1},d.displayReport=function(){var e=c.currentUser.partnerCd,a=d.batchreport,t=(d.dataLoading=!0,"init"),r="init",o=(d.showTable,d.noRecordFound="N",0);if($("#invoices").DataTable().clear().draw(),$("#invoices").dataTable().fnDestroy(),"BATCH"==d.batchreport){if(!$("#uiInputBatchNbr"))return d.dataLoading=!1,$("#uiInputBatchNbr").focus(),void toastr.error("Batch number is required.");o=$("#uiInputBatchNbr").val(),console.log(o)}else{if(o=-1,isNaN(new Date($("#fromDt").val()).getTime()))return toastr.error("Invalid Date Value"),d.dataLoading=!1,void $("#fromDate1").focus();if(isNaN(new Date($("#toDt").val()).getTime()))return toastr.error("Invalid Date Value"),d.dataLoading=!1,void $("#toDate1").focus();t=n(new Date($("#fromDt").val())),r=n(new Date($("#toDt").val()))}function n(e){var a=e.getDate(),t=(a<10&&(a="0"+a),e.getMonth()+1);return t<10&&(t="0"+t),e.getFullYear()+"-"+t+"-"+a}i.FetchInvoice({chargeType:a,affiliation:e,from:t,end:r,batchNbr:o}).then(function(e){console.log("invoice",e),d.dataLoading=!1,d.gls=e,angular.isObject(e)&&0<e.length?(d.showTable="Y",d.initDataTable("invoices"),s(function(){l.loading=!1},100)):(l.loading=!1,d.noRecordFound="Y")})}}angular.module("app").controller("GLController",e),e.$inject=["GLService","UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$location"]}();
!function(){"use strict";function r(a,c,r,e,t,o,n,s,u,i){t.trustSrc=function(){var r=$("#iFrmAnalytix"),e=$(window),t=$("#headerow"),e=e.height()-t.height()-10,t=(r.css("height",e+"px"),"http:"),r=("https:"==window.location.protocol&&(t="https:"),"");if(0!==Object.keys(a.currentUser).length){if(void 0===c.dashmenu||"ACT"!=c.dashmenu.reportTypeCd)return void 0!==c.dashmenu&&"PBI"==c.dashmenu.reportTypeCd?(r="https://"+i.host()+"/dashboard/?customer="+a.currentUser.partnerCd+"&server="+a.currentUser.param.country+"&token="+a.currentUser.param.token+"&report="+c.dashmenu.reportId,console.log(r),u.trustAsResourceUrl(r)):void 0;console.log("ACT");var r=t+"//portalopenport.cloud.quartetfs.com/index.html",o=a.currentUser.roles,n=!1;if(void 0!==o)for(var s=0;s<o.length;s++)if("TMS_SUPERADMIN"==o[s].role){n=!0;break}e=a.currentUser.partner.country;return r=(r+="&s="+(e=void 0===e?" ":e).toLowerCase())+(n?"?b=ADMIN":"?b="+a.currentUser.partnerCd.toUpperCase()),r=(r=void 0!==a.currentUser.param.token?r+"&t="+a.currentUser.param.token:r)+"&b="+c.dashmenu.bookmarkId,console.log(r),u.trustAsResourceUrl(r)}}}angular.module("app").controller("AnalyticsController",r),r.$inject=["UserService","$rootScope","$state","$log","$scope","ngDialog","$timeout","$http","$sce","$location"]}();
!function(){"use strict";function e(e,r,n,t){var o=this;o.dialogOrderSequence=null,o.driverList=[],o.isProcessing=!1,o.refresh=function(){o.driverList=[],o.getDriverList()},o.getDriverList=function(){o.isProcessing=!0,t.getDriverList().then(function(e){o.isProcessing=!1,e.constructor===Array&&(o.driverList=e)})},o.approveAll=function(e){o.isProcessing=!0,t.getDriverPending(e.mobileUserId).then(function(e){if(e.constructor===Array){var r=e,n=[];if(0<=r.length){for(var i in r)n.push({userPointId:r[i].userPointId});t.approveAll(n).then(function(){t.getDriverList().then(function(e){o.isProcessing=!1,e.constructor===Array&&(o.driverList=e)})})}}else o.isProcessing=!1})},o.pay=function(e){0<e.pointsValue.toFixed(2)&&(o.isProcessing=!0,t.pay(e.mobileUserId).then(function(e){"ACCEPTED"===e.status&&t.getDriverList().then(function(e){o.isProcessing=!1,e.constructor===Array?o.driverList=e:o.driverList=[]})}))},o.toggleDriveRewardModal=function(i){r.open({templateUrl:"app/rewards/md.approval.view.html",controller:function(n,e,r){n.driverInfo=i,n.rewardList=[],n.mdIsProcessing=!1,n.getDriverRewardPending=function(e){n.rewardList=[],n.mdIsProcessing=!0,t.getDriverPending(e).then(function(e){n.mdIsProcessing=!1,e.constructor===Array&&(n.rewardList=e)})},n.approve=function(r){1==confirm("Are you sure you want to approve this item?")&&(n.mdIsProcessing=!0,t.approve(r.userPointId).then(function(e){n.removeItemArray(n.rewardList,r),n.mdIsProcessing=!1}))},n.reject=function(r){1==confirm("Are you sure you want to reject this item?")&&(n.mdIsProcessing=!0,t.reject(r.userPointId).then(function(e){n.removeItemArray(n.rewardList,r),n.mdIsProcessing=!1}))},n.getImagePath=function(e){e="/delivery/shipments/pic/"+e;return e="localhost"===location.hostname?"https://sgp04.openport.com"+e:e},n.closeModal=function(){n.rewardList=[],o.refresh(),e.dismiss("cancel")},n.getDriverRewardPending(i.mobileUserId)},scope:e,size:"lg",backdrop:"static",keyboard:!1,resolve:{options:function(){}}})},o.isApproving=function(){return t.isApproving()},o.isPaying=function(){return t.isPaying()},e.removeItemArray=function(e,r){r=e.indexOf(r);e.splice(r,1)},e.getPendingApproval=function(e){return void 0!==e.pendingCount?e.pendingCount:0},e.toDateFormat=function(e){return new Date(e).toLocaleDateString()},o.testClick=function(){console.log("Welcome to Approval Page")},o.refresh()}angular.module("app").controller("ApprovalController",e),e.$inject=["$scope","$modal","ngDialog","RewardService"]}();
!function(){"use strict";function e(t,e,r,i,n){var p=this;p.shipmentList=[],p.driverList=[],p.isProcessing=!1,p.startDate="",p.endDate="";function s(e){p.isProcessing=!0,i.getShipmentList(e).then(function(e){p.isProcessing=!1,void 0!==e.shipmentList&&e.shipmentList.constructor===Array?(p.shipmentList=e.shipmentList,console.log(t.optable),t.optable.setObjectList(p.shipmentList)):p.shipmentList=[]})}t.optable=n,t.searchDropDownItems=[{value:"searchByDateRange",label:"Search by Requested Delivery Date"},{value:"searchByShipmentNbr",label:"Search by PRO#/BL#/PL#"},{value:"searchByOrderNbr",label:"Search by PO#/Order#/QT#"},{value:"searchByDeliveryNbr",label:"Search by DN#/Shipment#/SO#/RIs#"},{value:"searchByDriver",label:"Search by Driver"},{value:"searchByShipperCd",label:"Search by Shipper"}],p.init=function(){p.refresh()},p.refresh=function(){var e,t,r;p.shipmentList=[],e=new Date,t=e.getFullYear(),e=e.getMonth(),r=new Date(t,e,1),t=new Date(t,e+1,0),p.fromDate=moment(r).format("YYYY/MM/DD"),p.toDate=moment(t).format("YYYY/MM/DD"),$("#op-date-picker-from").val(p.fromDate),$("#op-date-picker-to").val(p.toDate),p.fetchDriverList(),s("?requestedFrom="+p.fromDate+"&requestedTo="+p.toDate)},p.fetchDriverList=function(){p.isProcessing=!0,i.getDriverList().then(function(e){void 0!==e.driver&&e.driver.constructor===Array&&(p.driverList=e.driver)})},p.fetchShipmentList=function(){var e=null;if("searchByDateRange"===t.selectedSearch)p.fromDate=$("#op-date-picker-from").val(),p.toDate=$("#op-date-picker-to").val(),e="?requestedFrom="+p.fromDate+"&requestedTo="+p.toDate;else if("searchByShipmentNbr"===t.selectedSearch){if(void 0===p.inputShipmentNbr||""===p.inputShipmentNbr)return void alert("Please enter a shipment number");e="?shipmentNbr="+p.inputShipmentNbr}else if("searchByOrderNbr"===t.selectedSearch){if(void 0===p.inputOrderNbr||""===p.inputOrderNbr)return void alert("Please enter a PO#/Order#/QT# number");e="?orderNbr="+p.inputOrderNbr}else if("searchByDeliveryNbr"===t.selectedSearch){if(void 0===p.inputDeliveryNbr||""===p.inputDeliveryNbr)return void alert("Please enter a DN#/Shipment#/SO#/RIs# number");e="?deliveryNbr="+p.inputDeliveryNbr}else if("searchByDriver"===t.selectedSearch){if(void 0===p.selectedDriverId||""===p.selectedDriverId||null===p.selectedDriverId)return void alert("Please select a driver");e="?driverId="+p.selectedDriverId}else if("searchByShipperCd"===t.selectedSearch){if(void 0===p.inputShipperCd||""===p.inputShipperCd)return void alert("Please enter a shipper code");e="?shipperCd="+p.inputShipperCd}null!==e&&s(e)},p.refreshFields=function(){p.selectedDriverId=null,p.inputShipmentNbr="",p.inputDeliveryNbr="",p.inputOrderNbr="",p.inputShipperCd=""},p.toggleDriveRewardModal=function(r){e.open({templateUrl:"app/epod/md.review.view.html",controller:function(s,e,t){s.shipmentInfo=r,s.epodList=[],s.mdIsProcessing=!1,s.selectedFilterTab="pending";var o=[];function a(){if(s.epodList=[],"all"===s.selectedFilterTab)s.epodList=o;else for(var e in o)o[e].status.toLowerCase()===s.selectedFilterTab&&s.epodList.push(o[e])}s.allCount=0,s.pendingCount=0,s.approvedCount=0,s.rejectedCount=0,s.dirty=!1,s.isDispatcher=function(){return i.isDispatcher()},s.isAdmin=function(){return i.isAdmin()},s.getShipmentEpods=function(e){s.epodList=[],s.mdIsProcessing=!0,i.getShipmentEpod(e).then(function(e){if(s.mdIsProcessing=!1,void 0!==e.epod&&e.epod.constructor===Array){o=e.epod;var t,r=0,i=0,n=0;for(t in s.allCount=o.length,o)switch(o[t].status.toLowerCase()){case"pending":r++;break;case"approved":i++;break;case"rejected":n++}s.pendingCount=r,s.approvedCount=i,s.rejectedCount=n,a()}})},s.approve=function(e){1==confirm("Are you sure you want to approve this item?")&&(s.mdIsProcessing=!0,i.approve(e.shipmentUserFileId).then(function(e){s.mdIsProcessing=!1,s.getShipmentEpods(s.shipmentInfo.id),s.dirty=!0}))},s.reject=function(e){1==confirm("Are you sure you want to reject this item?")&&(s.mdIsProcessing=!0,i.reject(e.shipmentUserFileId).then(function(e){s.mdIsProcessing=!1,s.getShipmentEpods(s.shipmentInfo.id),s.dirty=!0}))},s.reset=function(e){1==confirm("Are you sure you want to reset this item?")&&(s.mdIsProcessing=!0,i.reset(e.shipmentUserFileId).then(function(e){s.mdIsProcessing=!1,s.getShipmentEpods(s.shipmentInfo.id),s.dirty=!0}))},s.getImagePath=function(e){e="/delivery/shipments/pic/"+e;return e="localhost"===location.hostname?"https://sgp04.openport.com"+e:e},s.closeModal=function(){s.epodList=[],e.dismiss("cancel"),s.dirty&&p.fetchShipmentList()},s.setActiveFilterTab=function(e){s.selectedFilterTab=e,a()},s.getShipmentEpods(r.id)},scope:t,size:"lg",backdrop:"static",resolve:{options:function(){}}})},t.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy/mm/dd",todayHighlight:!0,autoclose:!0})},t.getTotalPhotos=function(e){return parseInt(e.approveCount)+parseInt(e.pendingCount)+parseInt(e.rejectedCount)},t.getTextMinimum=function(e){return void 0!==e&&30<e.length?e.substring(0,58)+"...":e},p.init()}angular.module("app").filter("range",function(){return function(e,t){t=parseInt(t);for(var r=1;r<=t;r++)e.push(r);return e}}).controller("EpodReviewController",e),e.$inject=["$scope","$modal","ngDialog","EpodReviewService","OpTableHelper"]}();
!function(){"use strict";function e(s,e,t,r,n){var o=this,i=(o.shipmentList=[],o.driverList=[],o.isProcessing=!1,o.reportUrlPath="https://"+n.host()+"/files/report/",o.startDate="",!(o.endDate=""));function a(){var e=new Date,t=e.getFullYear(),e=e.getMonth(),r=new Date(t,e,1),t=new Date(t,e+1,0);o.fromDate=moment(r).format("YYYY/MM/DD"),o.toDate=moment(t).format("YYYY/MM/DD"),$("#op-date-picker-from").val(o.fromDate),$("#op-date-picker-to").val(o.toDate)}s.currentPage=1,s.selectedSearch="searchByRequestDateRange",s.numPerPage=5,o.selectedNumPerPage="5",s.searchDropDownItems=[{value:"searchByRequestDateRange",label:"Search by Requested Delivery Date"},{value:"searchByActualDateRange",label:"Search by Actual Delivery Date"},{value:"searchByShipmentNbr",label:"Search by DN#/Shipment#/SO#/Rls#"},{value:"searchByShipperCd",label:"Search by Shipper"}],o.init=function(){o.refresh()},o.refresh=function(){o.shipmentList=[],a(),o.fetchShipmentList()},o.fetchDriverList=function(){o.isProcessing=!0,r.getDriverList().then(function(e){void 0!==e.driver&&e.driver.constructor===Array&&(o.driverList=e.driver)})},o.fetchShipmentList=function(){if(console.log("fetch shipment"),"searchByRequestDateRange"===s.selectedSearch)o.fromDate=$("#op-date-picker-from").val(),o.toDate=$("#op-date-picker-to").val();else if("searchByActualDateRange"===s.selectedSearch)o.fromDate=$("#op-date-picker-from").val(),o.toDate=$("#op-date-picker-to").val();else if("searchByShipmentNbr"===s.selectedSearch){if(void 0===o.inputShipmentNbr||""===o.inputShipmentNbr)return void alert("Please enter a shipment number")}else if("searchByShipperCd"===s.selectedSearch&&(void 0===o.inputShipperCd||""===o.inputShipperCd))return void alert("Please enter a shipper code");o.fromDate||a();var e={criteria:s.selectedSearch,startDt:o.fromDate,endDt:o.toDate,shipper:o.inputShipperCd,reference:o.inputShipmentNbr};e=e,console.log("query param",e),o.isProcessing=!0,r.fetchEpodReportData(e).then(function(e){console.log(e),o.isProcessing=!1,o.shipmentList=e,s.totalPage=Math.ceil(o.shipmentList.length/s.numPerPage),s.currentPage=1,s.selectPage(s.currentPage)})},o.refreshFields=function(){o.selectedDriverId=null,o.inputShipmentNbr="",o.inputShipperCd=""},o.selectRow=function(e){e.isSelected=!e.isSelected},o.downloadReport=function(e){o.isProcessing=!0,r.createSingleReport(e).then(function(e){console.log("response",e.filename),e.filename&&(console.log("response",o.reportUrlPath+e.filename),$(location).attr("href",o.reportUrlPath+e.filename)),o.isProcessing=!1})},o.downloadSelected=function(){var e,t=[];for(e in o.isProcessing=!0,o.shipmentList)o.shipmentList[e].isSelected&&t.push(o.shipmentList[e]);t&&0<t.length?r.createMultipleReport(t).then(function(e){console.log("response",e.filename),e.filename&&(console.log("response",o.reportUrlPath+e.filename),$(location).attr("href",o.reportUrlPath+e.filename)),o.isProcessing=!1}):(o.isProcessing=!1,alert("Please select shipment to download"))},s.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy/mm/dd",todayHighlight:!0,autoclose:!0})},s.sortColumn=function(e){s.orderDirectionAccordingTo=i?"+"+e:"-"+e,i=!i},s.getTextMinimum=function(e){return void 0!==e&&30<e.length?e.substring(0,58)+"...":e},s.changeNumPerPage=function(){s.numPerPage="all"===o.selectedNumPerPage?o.shipmentList.length:parseInt(o.selectedNumPerPage),s.totalPage=Math.ceil(o.shipmentList.length/s.numPerPage),s.currentPage=1,s.selectPage(s.currentPage)},s.selectPage=function(e){var t=(r=e*s.numPerPage)-s.numPerPage,r=r>o.shipmentList.length?o.shipmentList.length:r,t=(o.shipmentList&&0<o.shipmentList.length?s.displayedItems=o.shipmentList.slice(t,r):s.displayedItems=[],s.currentPage=e,s.currentPage),n=s.totalPage,i=[];if(n<=5){if(2<n)for(var a=2;a<n;a++)i.push(a)}else if(t<=4)for(a=2;a<=5;a++)i.push(a);else if(n-4<t)for(a=n-4;a<=n-1;a++)i.push(a);else i.push(t-1),i.push(t),i.push(t+1);s.pageNavArr=i},s.previousPage=function(){s.selectPage(--s.currentPage)},s.nextPage=function(){s.selectPage(++s.currentPage)},s.getDisplayedItemCount=function(){var e=s.currentPage*s.numPerPage;return e-s.numPerPage+1+" to "+(e>o.shipmentList.length?o.shipmentList.length:e)},s.pageNavArr=[],o.init()}angular.module("app").filter("range",function(){return function(e,t){t=parseInt(t);for(var r=1;r<=t;r++)e.push(r);return e}}).controller("EpodReportController",e),e.$inject=["$scope","$modal","ngDialog","EpodReviewService","$location"]}();
!function(){"use strict";angular.module("app").directive("dropzone",function(){return function(r,e,o){o=r[o.dropzone];r.dropzone=new Dropzone(e[0],o.options),o.dropzone&&o.dropzone(r.dropzone),angular.forEach(o.eventHandlers,function(e,o){r.dropzone.on(o,e)})}}),angular.module("app").controller("DataloaderController",["$scope","$modal","$timeout","DataloaderService","UserService",function(r,e,t,o,a){r.isProcessing=!1,r.selectedFileFormat="";r.dataloaderOptions=[],r.dropzoneConfig={options:{url:"/tms-api/dataloader/upload/",maxFiles:1,maxfilesexceeded:function(e){this.removeAllFiles()},autoProcessQueue:!1,headers:{"x-openport-token":a.currentUser.token.accessToken},addRemoveLinks:!0,removedfile:function(e){var o;return null!=(o=e.previewElement)?o.parentNode.removeChild(e.previewElement):void 0}},eventHandlers:{success:function(e,o){t(function(){r.isProcessing=!1},100),this.removeFile(e),void 0!==o.statusCode?alert("Sorry, an error has occured during upload."):"PARSING_SUCCESS"===o.statusName?alert("Successfully uploaded file"):"INVALID_UPLOAD_FILE_FORMAT"===o.statusName?alert("This type of file is not supported"):(e="warning","PARSING_ERROR"===o.statusName&&(e="error"),r.toggleUploadMessageModal(e.toUpperCase(),o.messageTxt))},error:function(e,o){t(function(){r.isProcessing=!1},100),1<this.files.length?alert("You can not upload any more files."):"canceled"!==e.status&&alert("Sorry, an error has occured during upload.")}}},r.getDataloaderOptions=function(){r.isProcessing=!0,o.getDataloaderOptions().then(function(e){void 0!==e&&e.constructor===Array&&(r.dataloaderOptions=e),r.isProcessing=!1})},r.submitUpload=function(){0==r.dropzone.getQueuedFiles().length?alert("Please select a file to upload"):""===r.selectedFileFormat?alert("Please select a file type"):(r.isProcessing=!0,r.dropzone.options.url="/tms-api/dataloader/upload/"+a.currentUser.parentPartnerCd+"/"+a.currentUser.partnerCd+"/"+r.selectedFileFormat,r.dropzone.processQueue())},r.toggleUploadMessageModal=function(t,a){e.open({templateUrl:"app/dataloader/md.dataloader.view.html",controller:function(e,o,r){e.title=t,e.message=a,e.closeModal=function(){o.dismiss("cancel")}},scope:r,size:"md",backdrop:"static",keyboard:!1,resolve:{options:function(){}}})},r.getDataloaderOptions()}])}();
!function(){"use strict";function e(s,e,i,f,t,I,m,b){var P=this,r=(P.isProcessing=!1,P.isFetched=!1,P.isFetchedAdvancedSearch=!1,P.invoiceList=[],P.shipperList=[],P.allSelected=!1,s.acceptAlphaNumericDash=/^[a-zA-Z0-9-]+$/,s.isPublicMessage=!0,s.selectedSearch="searchByInvoiceNbr",s.searchDropDownItems1=[{value:"searchByInvoiceNbr",label:"Finalize / Reprint Invoice"},{value:"searchByShipper",label:"Search by Shipper"}],s.selectedTab="details",P.selectedAdvancedSearchMultipleShipment="searchMultipleShipmentByShipmentNbr",P.advancedSearchMultipleShipmentDropDownItems=[{value:"searchMultipleShipmentByShipmentNbr",label:"Shipment No."},{value:"searchMultipleShipmentByPoNbr",label:"PO# / Order# / QT#"}],P.advancedSearchInput="",P.closeModalAdvancedSearch=function(){},"searchByShipper"),o=null,a=null;function n(){var e=new Date,i=e.getFullYear(),e=e.getMonth(),t=new Date(i,e,1),i=new Date(i,e+1,0);P.fromDate=moment(t).format("YYYY/MM/DD"),P.toDate=moment(i).format("YYYY/MM/DD"),$("#op-date-picker-from").val(P.fromDate),$("#op-date-picker-to").val(P.toDate)}function c(e){P.isProcessing=!0,d(),f.getInvoiceByInvoiceNbr(e).then(function(e){void 0!==e&&(void 0!==e.freightBillingHeaderModel&&(a=e.freightBillingHeaderModel),void 0!==e.freightBillingReportModel&&(o=e.freightBillingReportModel),void 0!==e.listFreightBillingInvoiceModel&&(P.invoiceList=e.listFreightBillingInvoiceModel,s.changeNumPerPage())),P.isProcessing=!1})}function d(){P.invoiceList=[],s.displayedItems=[],a=o=null}P.init=function(){P.getUserShippers()},P.isPageInvoiceDOS=function(){return!1},P.refresh=function(){P.invoiceList=[],n(),P.fetchShipmentList()},P.isReportFinal=function(){return null!=o&&o.statusCd.trim().toUpperCase()==="Final".toUpperCase()},P.getUserShippers=function(){P.isProcessing=!0,f.getUserShippers().then(function(e){void 0!==e&&e.constructor===Array&&(P.shipperList=e),P.isProcessing=!1})},P.basicSearch=function(){P.isFetchedAdvancedSearch=!1,P.fetchInvoiceList()},P.advancedSearch=function(){P.isFetchedAdvancedSearch=!0,P.fetchInvoiceList()},P.fetchInvoiceList=function(){if(P.isFetchedAdvancedSearch){if(P.isProcessing=!0,P.advancedSearchInput=P.advancedSearchInput.trim(),d(),0===P.advancedSearchInput.length)return alert("Please enter values separated by next line."),void(P.isProcessing=!1);var e={valueString:P.selectedAdvancedSearchMultipleShipment,listString:P.advancedSearchInput.split(/\r|\n/)};f.getInvoiceByColumn(e).then(function(e){void 0!==e&&(void 0!==e.freightBillingHeaderModel&&(a=e.freightBillingHeaderModel),void 0!==e.freightBillingReportModel&&(o=e.freightBillingReportModel),void 0!==e.listFreightBillingInvoiceModel&&(P.invoiceList=e.listFreightBillingInvoiceModel,s.changeNumPerPage())),P.isProcessing=!1,P.closeModalAdvancedSearch()})}else if("searchByShipper"===s.selectedSearch){if(void 0===P.inputShipper||""===P.inputShipper)return void alert("Please select a shipper");P.fromDate=$("#op-date-picker-from").val().replace(/\//g,"-"),P.toDate=$("#op-date-picker-to").val().replace(/\//g,"-"),e=P.inputShipper,i=P.fromDate,t=P.toDate,P.isProcessing=!0,d(),f.getInvoiceByShipperCd(e,i,t).then(function(e){void 0!==e&&void 0!==e.listFreightBillingInvoiceModel&&(P.invoiceList=e.listFreightBillingInvoiceModel,s.changeNumPerPage()),P.isProcessing=!1})}else if("searchByInvoiceNbr"===s.selectedSearch){if(void 0===P.inputInvoiceNbr||""===P.inputInvoiceNbr)return void alert("Please enter a valid invoice number. \n(Only accepts alphanumeric and dash characters)");c(P.inputInvoiceNbr)}var i,t;r=s.selectedSearch,P.isFetched=!0},P.refreshFields=function(){P.isFetched=!1,P.inputShipper="",P.inputInvoiceNbr="",n()},P.transitionToFinalizeReprint=function(e){s.selectedSearch="searchByInvoiceNbr",P.inputInvoiceNbr=e,P.fetchInvoiceList()},P.toggleSelection=function(e){var i;P.invoiceList&&(i=P.invoiceList.filter(function(e){return!s.isReportGenerated(e.statusCd)}),e?P.allSelected=e.isSelected&&P.allSelected:i.forEach(function(e){e.isSelected=P.allSelected}))},s.isFetchInvoiceNbr=function(e){return"searchByInvoiceNbr"===r},s.isReportGenerated=function(e){return void 0!==e&&""!==e.trim()},s.checkIfEmpty=function(e){return!e||""===e.trim()?"-":e},s.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy-mm-dd",todayHighlight:!0,autoclose:!0})},s.sortColumn=function(e){s.orderDirectionAccordingTo=l?"+"+e:"-"+e,l=!l};var l=!0;s.currentPage=1,s.numPerPage=5,P.selectedNumPerPage="5",s.changeNumPerPage=function(){s.numPerPage="all"===P.selectedNumPerPage?P.invoiceList.length:parseInt(P.selectedNumPerPage),s.totalPage=Math.ceil(P.invoiceList.length/s.numPerPage),s.currentPage=1,s.selectPage(s.currentPage)},s.isDisplayInvoiceInfo=function(){return"searchByInvoiceNbr"===s.selectedSearch&&0<P.invoiceList.length},s.displayInvoiceInfo=function(){return"searchByInvoiceNbr"===s.selectedSearch&&0<P.invoiceList.length?P.invoiceList[0].reportInvoiceNbr+", "+P.invoiceList[0].batchRunDtFormatted+", "+P.invoiceList[0].statusCd:""},s.selectPage=function(e){var i=(t=e*s.numPerPage)-s.numPerPage,t=t>P.invoiceList.length?P.invoiceList.length:t,i=(P.invoiceList&&0<P.invoiceList.length?s.displayedItems=P.invoiceList.slice(i,t):s.displayedItems=[],s.currentPage=e,s.currentPage),r=s.totalPage,n=[];if(r<=5){if(2<r)for(var o=2;o<r;o++)n.push(o)}else if(i<=4)for(o=2;o<=5;o++)n.push(o);else if(r-4<i)for(o=r-4;o<=r-1;o++)n.push(o);else n.push(i-1),n.push(i),n.push(i+1);s.pageNavArr=n},s.previousPage=function(){s.selectPage(--s.currentPage)},s.nextPage=function(){s.selectPage(++s.currentPage)},s.getDisplayedItemCount=function(){var e=s.currentPage*s.numPerPage;return e-s.numPerPage+1+" to "+(e>P.invoiceList.length?P.invoiceList.length:e)},s.pageNavArr=[],P.generateFreightBillingReport=function(){var e,i,t,r=[];for(e in P.invoiceList)if(P.invoiceList[e].isSelected||s.isFetchInvoiceNbr(e))for(var n in P.invoiceList[e].listCharge)r.push(P.invoiceList[e].listCharge[n].transactionId);0===r.length?alert("Please select an invoice to generate a report"):(i=o&&void 0!==o.statusCd)&&o.statusCd.trim().toUpperCase()==="Final".toUpperCase()?(t={fbrId:o&&void 0!==o.fbrId?o.fbrId:"",reportInvoiceNbr:o.reportInvoiceNbr,fbhId:a.fbhId,taxIdNbr:a.taxIdNbr,reportDt:o.reportDtFormatted,terms:o.terms,poNbr:a.poNbr,drNbr:a.drNbr,oscaPwdNbr:a.oscaPwdNbr,listTransactionId:r,statusCd:o.statusCd,providerCd:o.providerCd},s.mdIsProcessing=!0,f.generateReport(t).then(function(e){void 0!==e&&void 0!==e.fileLocation&&""!==e.fileLocation.trim()&&f.downloadFile(e.fileLocation),s.mdIsProcessing=!1})):null!=o?f.getInvoiceAttachmentList(o.fbrId).then(function(e){void 0!==e?P.toggleInvoiceHeadersModal(o,a,r,i,e.listInvoiceAttachment):toastr.error("Failed to get list invoice attachment.")}):P.toggleInvoiceHeadersModal(o,a,r,i,null)},P.deleteReport=function(){var i;confirm("Are you sure you want to delete Draft FBS report?")&&void 0!==o&&void 0!==o.fbrId&&(s.mdIsProcessing=!0,i={fbrId:o.fbrId},f.deleteAllInvoiceAttachment(o.fbrId).then(function(e){void 0===e||e.success||void 0===e.message?null!==o&&f.deleteReport(i).then(function(e){void 0!==e&&!0===e.success?d():(toastr.error("Failed to delete FBS Invoice "+i.fbrId),f.checkIfInvoiceNbrExist(P.inputInvoiceNbr).then(function(e){e.existsReportInvoiceNbr&&(d(),c(P.inputInvoiceNbr))}))}):toastr.error(e.message)}),s.mdIsProcessing=!1)},P.downloadPdf=function(e){},s.concatAddress=function(e,i){return e+" "+i},s.computeTotalChargeAmt=function(e){var i,t=0;for(i in e.listCharge)t+=e.listCharge[i].chargeAmount;return t},P.toggleChargesModal=function(c){e.open({templateUrl:"app/invoice/md.charges.view.html",controller:function(r,e,i){r.mdIsProcessing=!1,r.chargeList=[],r.isAddNew=!1,r.acceptNumeric=/^[0-9]+(\.[0-9]{1,2})?$/,r.objCharge={inputChargeCd:"",inputChargeDesc:"",inputAmount:0,totalAmt:0};var t,n=[];function o(){r.objCharge.inputChargeCd="",r.objCharge.inputChargeDesc="",r.objCharge.inputAmount=""}function s(e){return void 0===e?(alert("Entered amount value is invalid."),!1):""===e?(alert("Please enter an amount."),!1):e<=0||isNaN(e)?(alert("Entered amount value is invalid."),!1):0!=function(e){e=e.split(".");return 1==e.length||!(2<e.lenghth)&&!(2<e[1].length)}(e)||(alert("Entered amount value is invalid"),!1)}function a(){for(var e in r.objCharge.totalAmt=0,r.chargeList){e=r.chargeList[e];r.objCharge.totalAmt+=parseFloat(e.chargeAmt)}r.objCharge.totalAmt=parseFloat(r.objCharge.totalAmt).toFixed(2)}for(t in r.closeModal=function(){P.fetchInvoiceList(),e.dismiss("cancel")},r.insertCharge=function(){if(""===r.objCharge.inputChargeCd)alert("Please enter Charge code.");else if(""===r.objCharge.inputChargeDesc)alert("Please enter Charge Description.");else if(!1!==s(r.objCharge.inputAmount)){for(var e in r.chargeList)if(void 0===(i=r.chargeList[e]).chargeAmt)return void alert("Entered amount value is invalid.");r.objCharge.inputAmount=parseFloat(r.objCharge.inputAmount);var i={chargeAmt:r.objCharge.inputAmount,chargeTypeCd:r.objCharge.inputChargeCd,description:r.objCharge.inputChargeDesc,transactionId:null,currency:r.chargeList[0].currency,fbrId:c.fbrId,reportInvoiceNbr:c.reportInvoiceNbr,hidden:!1};1===r.chargeList.length&&""===r.chargeList[0].chargeTypeCd&&""===r.chargeList[0].description?(i.transactionId=r.chargeList[0].transactionId,r.chargeList[0]=i):r.chargeList.push(i),r.isAddNew=!1,a(),o()}},r.submitCharges=function(){for(var e in r.chargeList){e=r.chargeList[e];if(""===e.chargeAmt)return void alert("Please enter an amount.");if(void 0===e.chargeAmt)return void alert("Entered amount value is invalid.");if(e.chargeAmt<0)return void alert("Entered negative amount value is invalid.")}r.mdIsProcessing=!0,f.saveInvoiceCharges(r.chargeList.concat(n)).then(function(e){a(),r.mdIsProcessing=!1,r.closeModal()})},r.removeCharge=function(e,i){var t;confirm("Are you sure you want to delete charge {code: '"+i.chargeTypeCd+"', description: '"+i.description+"', amount: '"+i.chargeAmt+"'}?")&&(t={chargeAmt:0,chargeTypeCd:"",description:"",transactionId:null,currency:i.currency,fbrId:i.fbrId,reportInvoiceNbr:i.reportInvoiceNbr,hidden:!1},i.hidden=!0,1<r.chargeList.length?null!==r.chargeList[e].transactionId?(n.push(i),r.chargeList.splice(e,1)):null===r.chargeList[e].transactionId&&r.chargeList.splice(e,1):1===r.chargeList.length?(null!==r.chargeList[0].transactionId&&""!==r.chargeList[0].chargeTypeCd&&""!==r.chargeList[0].description?(n.push(i),r.chargeList.splice(e,1),r.chargeList.push(t)):1===r.chargeList.length&&null!==r.chargeList[0].transactionId&&""===r.chargeList[0].chargeTypeCd&&""===r.chargeList[0].description&&(t.transactionId=r.chargeList[0].transactionId,r.chargeList[0]=t),1===r.chargeList.length&&null===r.chargeList[0].transactionId&&""!==r.chargeList[0].chargeTypeCd&&""!==r.chargeList[0].description&&(r.chargeList[0]=t)):r.chargeList.push(t),a())},r.addOrCancelCharge=function(){r.isAddNew=!r.isAddNew,o()},r.isFinal=function(){return void 0!==c.statusCd&&c.statusCd.trim().toUpperCase()==="Final".toUpperCase()},c.listCharge){t={chargeAmt:c.listCharge[t].chargeAmount,chargeTypeCd:c.listCharge[t].chargeCode,description:c.listCharge[t].chargeDescription,transactionId:c.listCharge[t].transactionId,currency:c.listCharge[t].currencyCd,fbrId:c.fbrId,reportInvoiceNbr:c.reportInvoiceNbr,hidden:!1};r.chargeList.push(t),a()}},scope:s,size:"md",backdrop:"static",resolve:{options:function(){}}})},P.toggleInvoiceAdvancedSearchModal=function(){e.open({templateUrl:"app/invoice/md.advanced.search.html",controller:function(e,i,t,r,n){P.closeModalAdvancedSearch=function(){i.dismiss("cancel")}},scope:s,size:"md",backdrop:"static",resolve:{options:function(){}}})},P.toggleInvoiceHeadersModal=function(u,h,p,g,v){e.open({templateUrl:"app/invoice/md.invoiceheaders.view.html",controller:function(l,e,i,t,r){l.mdIsProcessing=!0,l.hasError=!0,l.errorMessageList=[],l.acceptNumericTerms=/^(\s*|\d+)$/,l.userList=[],l.showEmailNotif=!1,l.programId="LQ_SETTING",l.parameterCd="LQ_EMAIL_SETTING_PARAM",l.parameterName="LQ_EMAIL_SETTING",l.preSetRecipients=[],l.post={},l.post.message="",l.invoiceAttachmentList=v,l.selectLiquidityProviderHelpTexts=[],l.selectLiquidityProviderHelpText="";var n=p,o="",s=!1;function a(){m.getTaggableUsers().then(function(e){l.userList=e||[]})}function c(e,i){return!(e.length>i)&&!!/^[a-zA-Z0-9-_.,\ ()<>\/\][#:]+$/g.test(e)}function d(){l.mdIsProcessing=!0,l.selectedTab="details",l.selectLiquidityProviderHelpTexts=[],l.selectLiquidityProviderHelpText="",l.inputInvoiceNbr="",P.currentDate=moment().format("YYYY/MM/DD"),$("#op-date-picker-invoice-header").val(P.currentDate),null!==u&&null!==h?(l.hasUserTIN=!0,l.inputInvoiceNbr=u.reportInvoiceNbr,l.fbhId=u.fbhId,l.statusCd=void 0===u.statusCd||""===u.statusCd?"Draft":h.statusCd,l.inputTIN=h.taxIdNbr,l.inputTerms=void 0===u.terms||""===u.terms?0:u.terms,l.inputPONbr=h.poNbr,l.inputDRNbr=h.drNbr,l.inputOSCAPWD=h.oscaPwdNbr,l.isFinalized="Final"===u.statusCd,l.selectedProvider=u.providerCd,o=u.reportInvoiceNbr,s=g,l.changeSelectedLiquidityProvider()):(l.mdIsProcessing=!0,f.checkIfTinExist().then(function(e){void 0!==e.taxIdNbr&&(l.inputTIN=e.taxIdNbr,l.hasUserTIN=!0),l.mdIsProcessing=!1})),f.getHeadersByBillerCd().then(function(e){if(void 0!==e&&void 0!==e.listFreightBillingHeaderModel){for(var i in e.listFreightBillingHeaderModel)""!==l.currentHeaderFbhId&&l.currentHeaderFbhId===e.listFreightBillingHeaderModel[i].fbhId&&(l.selectedHeader=i),l.headerDropDownItems.push({value:i,label:e.listFreightBillingHeaderModel[i].fbhId}),l.listHeader.push(e.listFreightBillingHeaderModel[i]);l.changeSelectedLiquidityProvider()}}),P.changeSelectedHeader(),f.getProvidersByBillerCd().then(function(e){if(void 0!==e&&void 0!==e.listFreightBillingProviderModel){for(var i in e.listFreightBillingProviderModel)l.providerListItems.push({value:e.listFreightBillingProviderModel[i].partnerCd,label:e.listFreightBillingProviderModel[i].name}),l.selectLiquidityProviderHelpTexts[e.listFreightBillingProviderModel[i].partnerCd]=e.listFreightBillingProviderModel[i].selectLiquidityProviderHelpText;l.changeSelectedLiquidityProvider()}l.mdIsProcessing=!1}),a(),l.mdIsProcessing=!1,a()}l.hasUserTIN=!1,l.listHeader=[],l.currentHeaderFbhId=h&&void 0!==h.fbhId?h.fbhId:"",l.selectedHeader=-1,l.headerDropDownItems=[{value:-1,label:"New Header"}],l.providerListItems=[],l.selectedProvider="",P.changeSelectedHeader=function(){-1===l.selectedHeader?(l.hasUserTIN||(l.inputTIN=""),l.inputDRNbr="",l.inputPONbr="",l.inputOSCAPWD=""):(l.hasUserTIN||(l.inputTIN=l.listHeader[l.selectedHeader].taxIdNbr),l.inputDRNbr=l.listHeader[l.selectedHeader].drNbr,l.inputPONbr=l.listHeader[l.selectedHeader].poNbr,l.inputOSCAPWD=l.listHeader[l.selectedHeader].oscaPwdNbr),l.changeHeaderValues()},l.changeHeaderValues=function(){for(var e in l.listHeader)if(l.inputTIN===l.listHeader[e].taxIdNbr&&l.inputDRNbr===l.listHeader[e].drNbr&&l.inputPONbr===l.listHeader[e].poNbr&&l.inputOSCAPWD===l.listHeader[e].oscaPwdNbr)return void(l.selectedHeader=e);l.selectedHeader=-1},l.closeModal=function(){P.fetchInvoiceList(),e.dismiss("cancel")},l.selectFinalized=function(){var e;l.selectedProvider?(l.isFinalized=!l.isFinalized,l.showEmailNotif=l.isFinalized,e=l.selectedProvider,f.getDefaultInvoiceHeaderEmailReceivers(l.parameterCd,l.parameterName,l.programId,e).then(function(e){l.preSetRecipients=e||[];var i,t=!1;for(i in e.data)t&&(l.post.message=l.post.message+", "),l.post.message=l.post.message+e.data[i],t=!0}).catch(function(e){toastr.error(e.data)})):(l.isFinalized=!1,toastr.error("Please select Provider First"))},l.closeFinalEmail=function(){l.showEmailNotif=!1},l.back=function(){switch(l.selectedTab){case"liquidity":l.selectedTab="details";break;case"attachments":l.selectedTab="liquidity";break;case"finalize_and_notify":l.selectedTab="attachments"}},l.saveAndProceed=function(){switch(l.hasError=!1,l.errorMessageList=[],l.selectedTab){case"details":l.isInputInvoiceDetailsTabComplete()&&(l.selectedTab="liquidity");break;case"liquidity":l.isInputInvoiceLiquidityTabComplete()&&(l.selectedTab="attachments");break;case"attachments":l.selectedTab="finalize_and_notify";break;default:l.errorMessageList.push("Invalid selectedTab"),l.hasError=!0}},l.isInputInvoiceDetailsTabComplete=function(){return l.isInputTermsInvalid()&&(l.errorMessageList.push("Please enter non-negative integer for Terms."),l.hasError=!0),l.isInputTinInvalid()&&(l.errorMessageList.push("Please enter a TIN"),l.hasError=!0),l.isInputInvoiceInvalid()&&(l.errorMessageList.push("Please enter an Invoice #"),l.hasError=!0),!c(l.inputDRNbr,16)&&0<l.inputDRNbr.length?(l.errorMessageList.push("Invalid entry format for D.R. #."),l.hasError=!0):!c(l.inputPONbr,16)&&0<l.inputPONbr.length?(l.errorMessageList.push("Invalid entry format for P.0. #."),l.hasError=!0):!c(l.inputOSCAPWD,16)&&0<l.inputOSCAPWD.length?(l.errorMessageList.push("Invalid entry format for OSCA/PWD ID No."),l.hasError=!0):c(l.inputTIN,16)?c(l.inputInvoiceNbr,12)||(l.errorMessageList.push("Invalid entry format for Invoice #"),l.hasError=!0):(l.errorMessageList.push("Invalid entry format for TIN #"),l.hasError=!0),!l.hasError},l.isInputInvoiceLiquidityTabComplete=function(){return void 0!==l.selectedProvider&&""!==l.selectedProvider||(l.errorMessageList.push("Please select Provider."),l.hasError=!0),!l.hasError},l.isInputTermsInvalid=function(){return void 0===l.inputTerms||""===l.inputTerms||l.inputTerms<0},l.isInputTinInvalid=function(){return void 0===l.inputTIN||""===l.inputTIN},l.isInputInvoiceInvalid=function(){return void 0===l.inputInvoiceNbr||""===l.inputInvoiceNbr},l.isInputLiquidityProviderInvalid=function(){return void 0===l.selectedProvider||""===l.selectedProvider},l.sendMessage=function(c,d){l.submitInvoiceHeader().then(function(){if(l.isFinalized){var e,i,t=$("#message-content").val(),r="",n=(l.isProcessing=!0,[]);for(e in l.preSetRecipients)l.post.message.contains(l.preSetRecipients[e])&&(n.push(l.preSetRecipients[e]),r+=l.preSetRecipients[e]+" ");for(i in c){n.push(c[i].userName);var o=c[i],s=[];o.emailId&&s.push(o.emailId),r+=s.join(" ")+" "}var t=(r+t).replace(new RegExp("\r?\n","g"),"<br>"),a=function(){l.isProcessing=!1};b.sendMessage(d,n,l.isPublicMessage,t,"https://uat-liquidity.openport.com/liquidity/#/freight-bills?inputInvoiceNbr="+d).then(function(){toastr.success("Message sent."),$("#message-content").val(""),$(".mention-highlight").empty(),l.isPrivateMessage=!1,$("#isPrivateMessage").prop("checked",!1)}).catch(function(e){toastr.error(e.data)}).then(a,a)}})},l.submitInvoiceHeader=function(){return l.mdIsProcessing=!0,r.all([function(e){var i,t;if(!s||o!==e)return i=r.defer(),t=f.checkIfInvoiceNbrExist(e).then(function(e){e.existsReportInvoiceNbr&&(l.errorMessageList.push("Invoice # already exist"),l.hasError=!0),i.resolve(t)}),i.promise}(l.inputInvoiceNbr)]).then(function(e){var i;if(l.hasError=0<l.errorMessageList.length,l.mdIsProcessing=!1,!l.hasError)return i={fbrId:u&&void 0!==u.fbrId?u.fbrId:"",fbhId:h&&void 0!==h.fbhId?h.fbhId:"",reportInvoiceNbr:l.inputInvoiceNbr,taxIdNbr:l.inputTIN,reportDt:$("#op-date-picker-invoice-header").val().replace(/\//g,"-"),terms:void 0===l.inputTerms?"":l.inputTerms,poNbr:void 0===l.inputPONbr?"":l.inputPONbr,drNbr:void 0===l.inputDRNbr?"":l.inputDRNbr,oscaPwdNbr:void 0===l.inputOSCAPWD?"":l.inputOSCAPWD,listTransactionId:n,statusCd:l.isFinalized?"Final":"Draft",providerCd:l.selectedProvider},l.mdIsProcessing=!0,f.getHeaderIdByHeaders(i).then(function(e){if(void 0!==e&&void 0!==e.freightBillingHeaderModel&&void 0!==e.freightBillingHeaderModel.fbhId)for(var i in l.listHeader)void 0!==e.freightBillingHeaderModel.fbhId&&e.freightBillingHeaderModel.fbhId===l.listHeader[i].fbhId&&(l.selectedHeader=i)}),f.generateReport(i).then(function(e){var i;void 0!==e&&(P.transitionToFinalizeReprint(l.inputInvoiceNbr),0<l.dropzone.getQueuedFiles().length&&(l.dropzone.options.url+="/"+l.inputInvoiceNbr,l.dropzone.processQueue()),l.isFinalized&&(i=l.inputInvoiceNbr,f.getInvoiceByInvoiceNbr(i).then(function(e){var n=e.freightBillingReportModel.fbrId;console.log(e),console.log(n),f.getInvoiceTransactionsByFbrid(n).then(function(e){var i,t,r;P.isReportFinal()&&(null==e?toastr.error("Error encountered while generating 'Finalized' events."):(t=e[0].legNbr,i=e[0].invoiceNumber,console.log(e[0]),console.log(t),console.log(i),e=t,t=n,(r={}).shipmentNbr=i,r.comments="Finalized",r.createUserId=m.currentUser.userName,r.scacCd=m.currentUser.partnerCd,r.statusId=60,r.fbrId=t,r.eventDt=new Date,r.legNbr=e,console.log(r),I.UpdateShipment(r),console.log("Added to T&T"),toastr.success("Track and Trace events generated.")))})})),void 0!==e.fileLocation&&""!==e.fileLocation.trim()&&f.downloadFile(e.fileLocation),l.closeModal())})})},l.selectTab=function(e){var i=l.selectedTab;l.selectedTab=e,l.hasError=!1,l.errorMessageList=[],"details"===i||"details"===e?l.isInputInvoiceDetailsTabComplete():(l.isInputInvoiceDetailsTabComplete(),l.isInputInvoiceLiquidityTabComplete()),l.hasError&&(l.selectedTab=i)},l.dropzoneConfig={dropzone:function(e){l.dropzone=e},options:{url:"/tms-api/invoice/freight-billing/invoice-attachment",parallelUploads:80,autoProcessQueue:!1,acceptedFiles:".jpg,.jpeg,.bmp,.png,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.gz,.7z,.s7z,.rar,.zip,.gzip,.tar,.txt,.rtf",thumbnailWidth:50,thumnnailHeight:50,thumbnailMethod:"contain",headers:{"x-openport-token":m.currentUser.token.accessToken},addRemoveLinks:!0,removedfile:function(e){var i;return null!=(i=e.previewElement)?i.parentNode.removeChild(e.previewElement):void 0}},eventHandlers:{success:function(e,i){t(function(){l.mdIsProcessing=!1},100),this.removeFile(e),l.closeModal()},error:function(e,i){t(function(){l.mdIsProcessing=!1},100),"string"==typeof i?toastr.error(i):toastr.error("Sorry, an error has occured during upload.")},maxfilesexceeded:function(e){this.removeFile(e),this.removeEventListeners()},maxfilesreached:function(e){this.removeEventListeners()},removedfile:function(e){this.setupEventListeners()}}},l.deleteAttachment=function(i){confirm("Are you sure you want to delete attachment?")&&(l.mdIsProcessing=!0,f.deleteInvoiceAttachment(i.fbrId,i.uuid).then(function(e){f.getInvoiceAttachmentList(i.fbrId).then(function(e){void 0===e||e.success||void 0===e.message?(l.invoiceAttachmentList=e.listInvoiceAttachment,l.invoiceAttachmentList.length||"attachments"!==l.selectedTab||(l.selectedTab="details")):toastr.error(e.message),l.mdIsProcessing=!1})}).catch(function(){l.mdIsProcessing=!1,toastr.error("Error occurred when trying to delete attachment.")}))},l.downloadAttachment=function(e){l.mdIsProcessing=!0,f.downloadAttachment(e).finally(function(){l.mdIsProcessing=!1})},l.changeSelectedLiquidityProvider=function(){if(void 0!==l.selectLiquidityProviderHelpTexts[l.selectedProvider]){for(var e in l.providerListItems)l.providerListItems[e].value===l.selectedProvider&&(l.selectLiquidityProviderHelpText=l.providerListItems[e].label+" Note: ");l.selectLiquidityProviderHelpText=l.selectLiquidityProviderHelpText+""+l.selectLiquidityProviderHelpTexts[l.selectedProvider]}},t(function(){d()},500)},scope:s,size:"md",backdrop:"static",resolve:{options:function(){}}})},P.init()}angular.module("app").filter("range",function(){return function(e,i){i=parseInt(i);for(var t=1;t<=i;t++)e.push(t);return e}}).directive("mentionUsers",function(){return{require:"uiMention",link:function(i,e,t,r){r.findChoices=function(t,e){return i.userList.filter(function(i){return!e.some(function(e){return e.userId===i.userId})}).filter(function(e){function i(e){return e&&e.toLowerCase().startsWith(t[1].toLowerCase())}return i(e.firstName)||i(e.lastName)||i(e.partnerCd)})},r.label=function(e){return e.emailId}}}}).controller("FreightBillingController",e),e.$inject=["$scope","$modal","ngDialog","InvoiceService","$location","DispatcherService","UserService","FbsDetailService"]}();
!function(){"use strict";function e(l,a,n,e,i,s,r,t,o){l.invoiceNumber=n,l.closeModal=e,l.selectedTab=null,l.tabContent=null,l.buttonLabel="Log",l.invoiceValue=0,l.totalAvailment=0,l.selectedAvailment={},l.isPrivateAttachment=!1,l.currentPage=1,l.numPerPage=5,l.selectedNumPerPage="5",l.isPrivateMessage=!1,l.userList=[],l.messageList=[];var d=this,m=[];function c(){r.getAttachmentList(n).then(function(e){if(void 0!==e.data.length&&0!==e.data.length)for(var t in l.attachmentList=e.data,l.attachmentList)l.attachmentList[t].uploadDate=moment(l.attachmentList[t].uploadDate).format("YYYY-MM-DD");else l.attachmentList=[]})}function u(){r.getAvailmentList(n,i,s).then(function(e){for(var t in l.availmentList=e,l.totalAvailment=0,e){t=e[t];l.totalAvailment+=t.availmentAmount||0}})}d.tab=[{tabName:"shipments",templateUrl:"app/lq2/tab/fbsDetailShipments.view.html"},{tabName:"attachments",templateUrl:"app/lq2/tab/fbsDetailAttachments.view.html"},{tabName:"availments",templateUrl:"app/lq2/tab/fbsAvailment.view.html"},{tabName:"conversations",templateUrl:"app/lq2/tab/fbsDetailConversations.view.html"}],l.selectTab=function(t){l.selectedTab=t;var e=d.tab.filter(function(e){return e.tabName===t})[0];l.tabContent=e.templateUrl,l.isInitAvailment=!1,l.currentPage=1,l.numPerPage=5,l.selectedNumPerPage="5","availments"===t?(l.isInitAvailment=!0,l.selectedAvailment={},l.invalidAmtReleased=!1,l.invalidAmtInterest=!1,l.invalidAvailmentDt=!1,l.invalidRepaymentDt=!1,l.buttonLabel="Log"):"conversations"===t?l.getMessageList():"shipments"===t&&(m=l.shipmentList,l.changeNumPerPage())},l.headerDetails={},l.shipmentList=[],r.getShipmentList(n).then(function(e){if(void 0!==e.data.length&&0!==e.data.length)for(var t in l.shipmentList=e.data,l.shipmentList)l.shipmentList[t].requestDeliveryDt=moment(l.shipmentList[t].requestDeliveryDt).format("YYYY-MM-DD"),l.shipmentList[t].actualDeliveryDt=moment(l.shipmentList[t].actualDeliveryDt).format("YYYY-MM-DD");m=l.shipmentList}).catch(function(){toastr.error("No shipment available for invoice #"+n)}),l.getSelectedItem=function(e){l.isInitAvailment=!1,l.selectedAvailment=l.getSelectedAvailmentFromItemSelected(e),l.buttonLabel="Update"},l.validateAvailmentValue=function(){return l.invoiceValue<l.totalAvailment&&"Log"===l.buttonLabel},l.isDisableAvailmentBtn=function(){return l.invoiceValue<l.totalAvailment&&"Log"===l.buttonLabel||l.selectedAvailment.availmentAmount>l.invoiceValue||null===l.selectedAvailment.availmentAmount},l.getSelectedAvailmentFromItemSelected=function(e){return l.isInitAvailment=!1,l.selectedAvailment={},l.selectedAvailment.allowedAvailmentAmt=e.allowedAvailmentAmt,l.selectedAvailment.availmentAmount=e.availmentAmount,l.selectedAvailment.isExisting=!0,l.selectedAvailment.availmentDt=moment(e.availmentDt).format("YYYY-MM-DD"),l.selectedAvailment.availmentPct=e.availmentPct,l.selectedAvailment.createTstamp=e.createTstamp,l.selectedAvailment.createUserId=e.createUserId,l.selectedAvailment.id=e.id,l.selectedAvailment.invoiceAmount=e.invoiceAmount,l.selectedAvailment.repaymentDt=moment(e.repaymentDt).format("YYYY-MM-DD"),l.selectedAvailment.reportInvoiceNbr=e.reportInvoiceNbr,l.selectedAvailment.statusCd=e.statusCd,l.selectedAvailment.updateTstamp=e.updateTstamp,l.selectedAvailment.updateUserId=e.updateUserId,l.selectedAvailment},l.hideAvailmentErrorMsg=function(e){l.isInitAvailment=!1,"amtReleased"===e?l.invalidAmtReleased=!1:"amtInterest"===e?l.invalidAmtInterest=!1:"releasedDate"===e?l.invalidAvailmentDt=!1:"repaymentDate"===e&&(l.invalidRepaymentDt=!1)},l.executeTransaction=function(){var t,e;l.isProcessing=!0,$.isEmptyObject(l.selectedAvailment)?(toastr.error("No data to save."),l.isProcessing=!1):(e=!1,!isNaN(l.selectedAvailment.availmentAmount)&&""!==l.selectedAvailment.availmentAmount||(l.invalidAmtReleased=!0,l.invalidAvailmentAmtMsg="Please enter valid amount.",e=!0),!isNaN(l.selectedAvailment.availmentPct)&&""!==l.selectedAvailment.availmentPct||(e=l.invalidAmtInterest=!0),l.selectedAvailment.availmentDt||(e=l.invalidAvailmentDt=!0),(e=l.selectedAvailment.repaymentDt?e:l.invalidRepaymentDt=!0)?l.isProcessing=!1:(t=l.selectedAvailment,e=function(e){return t.availmentAmount=parseFloat(t.availmentAmount),t.availmentDt=moment(t.availmentDt,"YYYY-MM-DD").toJSON(),t.repaymentDt=moment(t.repaymentDt,"YYYY-MM-DD").toJSON(),t.isExisting||(t.statusCd="RELEASED",t.reportInvoiceNbr=n),e().then(function(e){if("true"!==e.success)return l.selectedAvailment.availmentDt=moment(t.availmentDt).format("YYYY-MM-DD"),l.selectedAvailment.repaymentDt=moment(t.repaymentDt).format("YYYY-MM-DD"),"EXCEEDING_VALUE"===e.data.message?(l.invalidAmtReleased=!0,void(l.invalidAvailmentAmtMsg="Availment value will exceed due to entered Amount Released value.")):void toastr.error("Error in updating availment data.");toastr.success("Successfully updated data"),l.selectedAvailment={},l.buttonLabel="Log",l.isProcessing=!1,l.isInitAvailment=!0,u()}).catch(function(){l.isProcessing=!1,l.selectedAvailment=t,toastr.error("Something went wrong while updating your data")})},"Update"==l.buttonLabel?e(function(){return r.updateAvailment(t,n,i,s)}):"Log"==l.buttonLabel&&e(function(){return r.insertAvailment(t,n,i,s)})))},l.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy-mm-dd",todayHighlight:!0,autoclose:!0})},l.downloadEpodReport=function(e){l.isProcessing=!0,o.createSingleReportByShipment(e).then(function(e){window.location="/files/report/"+e.filename}).catch(function(){toastr.error("No report available.")}).finally(function(){a(function(){l.isProcessing=!1},100)})},l.changeNumPerPage=function(e){l.numPerPage="All"===e?m.length:e||5,l.totalPage=Math.ceil(m.length/l.numPerPage),l.currentPage=1,l.selectPage(l.currentPage)},l.selectPage=function(e){var t=(a=e*l.numPerPage)-l.numPerPage,a=a>m.length?m.length:a,t=(m&&0<m.length?l.displayedItems=m.slice(t,a):l.displayedItems=[],l.currentPage=e,l.currentPage),i=l.totalPage,n=[];if(i<=5){if(2<i)for(var s=2;s<i;s++)n.push(s)}else if(t<=4)for(s=2;s<=5;s++)n.push(s);else if(i-4<t)for(s=i-4;s<=i-1;s++)n.push(s);else n.push(t-1),n.push(t),n.push(t+1);l.pageNavArr=n},l.previousPage=function(){l.selectPage(--l.currentPage)},l.nextPage=function(){l.selectPage(++l.currentPage)},l.getDisplayedItemCount=function(){var e=l.currentPage*l.numPerPage;return e-l.numPerPage+1+" to "+(e>m.length?m.length:e)},l.pageNavArr=[],l.attachmentList=[],l.dropzoneConfig={dropzone:function(e){l.dropzone=e},options:{url:"/tms-api/liquidity/attachment/"+n,maxFilesize:15,autoProcessQueue:!1,acceptedFiles:".jpg,.jpeg,.bmp,.png,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.gz,.7z,.s7z,.rar,.zip,.gzip,.tar,.txt,.rtf",headers:{"x-openport-token":t.currentUser.token.accessToken},addRemoveLinks:!0,removedfile:function(e){var t;return null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0}},eventHandlers:{success:function(e,t){a(function(){l.isProcessing=!1},100),this.removeFile(e),l.isPrivateAttachment=!1,$("#isPrivateAttachment").prop("checked",!1),$("#message-content").val(""),$(".mention-highlight").empty(),toastr.success("Uploaded attachment."),c()},error:function(e,t){a(function(){l.isProcessing=!1},100),toastr.error("Sorry, an error has occured during upload.")}}},l.submitUpload=function(e){if(0==l.dropzone.getQueuedFiles().length)toastr.error("Please select a file to upload");else if(l.isPrivateAttachment&&e.length<1)toastr.error("No tagged users.");else{l.isProcessing=!0;var t=[];if(l.isPrivateAttachment&&e)for(var a in e)t.push(e[a].userName);l.dropzone.options.params={taggedUsers:t,isPrivateAttachment:l.isPrivateAttachment},l.dropzone.processQueue()}},l.deleteAttachment=function(e){r.deleteAttachment(n,e.uuid).then(function(){toastr.success("Deleted file."),c()}).catch(function(){toastr.error("Error occurred when trying to delete attachment.")})},l.downloadAttachment=function(e){d.isProcessing=!0,r.downloadAttachment(n,e).finally(function(){d.isProcessing=!1})},l.toggleAttachmentPrivacy=function(){l.isPrivateAttachment=!l.isPrivateAttachment},l.sendMessage=function(e){var t=$("#message-content").val();if(t){l.isProcessing=!0;var a=[];for(i in e)a.push(e[i].userName);if(l.isPrivateMessage&&!e.length)toastr.error("No tagged users for private message.");else{var i,a=[];for(i in e)a.push(e[i].emailId);t=t.replace(new RegExp("\r?\n","g"),"<br>");r.sendMessage(n,a,!l.isPrivateMessage,t).then(function(){l.isProcessing=!1,toastr.success("Message sent."),$("#message-content").val(""),$(".mention-highlight").empty(),l.isPrivateMessage=!1,$("#isPrivateMessage").prop("checked",!1),l.getMessageList()}).catch(function(){d.isProcessing=!1,toastr.error("Something went wrong in sending message.")})}}else toastr.error("Empty message.")},l.togglePrivacy=function(){l.isPrivateMessage=!l.isPrivateMessage},l.getMessageList=function(){l.isProcessing=!0,r.getMessageList(n).then(function(e){if(l.isProcessing=!1,e&&0<e.length)for(var t in e)e[t].messageTxt=e[t].messageTxt.replace(new RegExp("<br>","g"),"\n");l.messageList=e||[],m=l.messageList,l.currentPage=1,l.changeNumPerPage(10),$(".op-table").floatThead("reflow")})},r.getUserList().then(function(e){l.userList=e||[]}),l.selectTab("shipments"),r.getHeaderDetails(n).then(function(e){e.data&&(l.headerDetails=e.data[0],l.headerDetails.date=moment(l.headerDetails.report_dt).format("YYYY-MM-DD"),l.headerDetails.soldToAddress=l.headerDetails.sold_to_line3,l.headerDetails.sold_to_line4&&(l.headerDetails.soldToAddress&&(l.headerDetails.soldToAddress+=", "),l.headerDetails.soldToAddress+=l.headerDetails.sold_to_line4),l.headerDetails.sold_to_line5&&(l.headerDetails.soldToAddress&&(l.headerDetails.soldToAddress+=", "),l.headerDetails.soldToAddress+=l.headerDetails.sold_to_line5),l.headerDetails.sold_to_city&&(l.headerDetails.soldToAddress&&(l.headerDetails.soldToAddress+=", "),l.headerDetails.soldToAddress+=l.headerDetails.sold_to_city),l.headerDetails.sold_to_zip&&(l.headerDetails.soldToAddress&&(l.headerDetails.soldToAddress+=", "),l.headerDetails.soldToAddress+=l.headerDetails.sold_to_zip),l.headerDetails.address=l.headerDetails.billing_to_line3,l.headerDetails.billing_to_line4&&(l.headerDetails.address&&(l.headerDetails.address+=", "),l.headerDetails.address+=l.headerDetails.billing_to_line4),l.headerDetails.billing_to_line5&&(l.headerDetails.address&&(l.headerDetails.address+=", "),l.headerDetails.address+=l.headerDetails.billing_to_line5),l.headerDetails.billing_to_city&&(l.headerDetails.address&&(l.headerDetails.address+=", "),l.headerDetails.address+=l.headerDetails.billing_to_city),l.headerDetails.billing_to_zip&&(l.headerDetails.address&&(l.headerDetails.address+=", "),l.headerDetails.address+=l.headerDetails.billing_to_zip))}),c(),u(),r.getTotalInvoiceAmount(n).then(function(e){l.invoiceValue=e.value||0})}angular.module("app").directive("mentionUsers",function(){return{require:"uiMention",link:function(t,e,a,i){i.findChoices=function(a,e){return t.userList.filter(function(t){return!e.some(function(e){return e.userId===t.userId})}).filter(function(e){function t(e){return e&&e.toLowerCase().startsWith(a[1].toLowerCase())}return t(e.firstName)||t(e.lastName)||t(e.partnerCd)})},i.label=function(e){return e.emailId}}}}).directive("opFixedTableHeader",function(){return{restrict:"A",link:function(e,t,a){$(t).floatThead("destroy"),$(t).floatThead({position:"absolute",scrollContainer:!0,autoReflow:!0})}}}).controller("FbsDetailController",e),e.$inject=["$scope","$timeout","invoiceNumber","closeModal","shipperCd","carrier","FbsDetailService","UserService","EpodReviewService"]}();
!function(){"use strict";function e(c,r,n,i){var a=this;a.isProcessing=!1,a.isFetched=!1,a.invoiceList=[],a.shipperList=[],c.selectedSearch="searchByShipper",c.searchDropDownItems1=[{value:"searchByShipper",label:"Search by Shipper"},{value:"searchByInvoiceNbr",label:"Search by Invoice #"}];a.showLinkBC=function(e){var i=["height="+screen.height,"width="+screen.width,"fullscreen=yes"].join(",");window.open("http://explorer.insightscs.com/#/tx/"+e,"popup_window",i).moveTo(0,0)},a.editShipmentDetail=function(e,i,t){var n=r.open({templateUrl:"app/lq2/md.fbsDetailTab.view.html",controller:"FbsDetailController",size:"lg",scope:c,keyboard:!1,resolve:{invoiceNumber:function(){return e},shipperCd:function(){return i},carrier:function(){return t},closeModal:function(){return function(){n.dismiss("cancel")}}}})},a.init=function(){a.getUserShippers()},a.refresh=function(){a.invoiceList=[],i.getDateFirstAndLastDay("op-date-picker-from","op-date-picker-to"),a.fetchShipmentList()},a.getUserShippers=function(){a.isProcessing=!0,n.getUserShippers().then(function(e){void 0!==e&&e.constructor===Array&&(a.shipperList=e),a.isProcessing=!1})},a.fetchInvoiceList=function(){if(a.fromDate=$("#op-date-picker-from").val(),a.toDate=$("#op-date-picker-to").val(),"searchByShipper"===c.selectedSearch){if(void 0===a.inputShipper||""===a.inputShipper)return void alert("Please select a shipper");e=a.inputShipper,i=a.fromDate,t=a.toDate,a.isProcessing=!0,n.getInvoiceByShipperCd(e,i,t).then(function(e){void 0!==e&&void 0!==e.freightBillingSummaryList&&(a.invoiceList=e.freightBillingSummaryList,c.totalPage=Math.ceil(a.invoiceList.length/c.numPerPage),c.currentPage=1,c.selectPage(c.currentPage)),a.isProcessing=!1})}else if("searchByInvoiceNbr"===c.selectedSearch){if(void 0===a.inputInvoiceNbr||""===a.inputInvoiceNbr)return void alert("Please enter an invoice number");e=a.inputInvoiceNbr,a.isProcessing=!0,n.getInvoiceByInvoiceNbr(e).then(function(e){void 0!==e&&void 0!==e.freightBillingSummaryList&&(a.invoiceList=e.freightBillingSummaryList,c.totalPage=Math.ceil(a.invoiceList.length/c.numPerPage),c.currentPage=1,c.selectPage(c.currentPage)),a.isProcessing=!1})}var e,i,t;a.isFetched=!0,c.selectedSearch},a.refreshFields=function(){a.inputShipper="",a.inputInvoiceNbr="",i.getDateFirstAndLastDay("op-date-picker-from","op-date-picker-to")},a.selectRow=function(e){e.isSelected=!e.isSelected},a.downloadPdf=function(e){a.isProcessing=!0,n.generateFreightBillSummaryReport(e).catch(function(){alert("Unable to download pdf.")}).finally(function(){a.isProcessing=!1})},a.generateFreightBillingReport=function(){for(var e in a.invoiceList)a.invoiceList[e].isSelected&&n.generateFreightBillSummaryReport(a.invoiceList[e].invoiceNumber)},c.comingSoon=function(){alert("coming soon")},c.openDatePickerCalendar=function(e){i.initializeDatePicker(e)},c.formatDate=function(e){return void 0===e?"-":i.formatDate(e,"YYYY-MM-DD")},c.sortColumn=function(e){c.orderDirectionAccordingTo=t?"+"+e:"-"+e,t=!t};var t=!0;c.currentPage=1,c.numPerPage=5,a.selectedNumPerPage="5",c.changeNumPerPage=function(){c.numPerPage="all"===a.selectedNumPerPage?a.invoiceList.length:parseInt(a.selectedNumPerPage),c.totalPage=Math.ceil(a.invoiceList.length/c.numPerPage),c.currentPage=1,c.selectPage(c.currentPage)},c.selectPage=function(e){var i=(t=e*c.numPerPage)-c.numPerPage,t=t>a.invoiceList.length?a.invoiceList.length:t,i=(a.invoiceList&&0<a.invoiceList.length?c.displayedItems=a.invoiceList.slice(i,t):c.displayedItems=[],c.currentPage=e,c.currentPage),n=c.totalPage,r=[];if(n<=5){if(2<n)for(var o=2;o<n;o++)r.push(o)}else if(i<=4)for(o=2;o<=5;o++)r.push(o);else if(n-4<i)for(o=n-4;o<=n-1;o++)r.push(o);else r.push(i-1),r.push(i),r.push(i+1);c.pageNavArr=r},c.previousPage=function(){c.selectPage(--c.currentPage)},c.nextPage=function(){c.selectPage(++c.currentPage)},c.getDisplayedItemCount=function(){var e=c.currentPage*c.numPerPage;return e-c.numPerPage+1+" to "+(e>a.invoiceList.length?a.invoiceList.length:e)},c.pageNavArr=[],a.init()}angular.module("app").filter("range",function(){return function(e,i){i=parseInt(i);for(var t=1;t<=i;t++)e.push(t);return e}}).controller("FreightBillingSummariesController",e),e.$inject=["$scope","$modal","LiquidityPortalService","DateHelper"]}();
!function(){"use strict";angular.module("app").controller("VendorsController",["$scope","LiquidityPortalService",function(t,i){var n=this;n.isProcessing=!1,n.vendorList=[],n.init=function(){n.getVendorList()},n.getVendorList=function(){n.isProcessing=!0,i.getVendorList().then(function(t){t.constructor===Array&&(n.vendorList=t),void 0!==t&&void 0!==t.vendorList&&(n.vendorList=t.vendorList),n.isProcessing=!1})},t.getFullAddress=function(t){var i=[];return i.push(t.line1Addr),i.push(t.cityName),i.push(t.stateCd),i.push(t.countryCd),i.push(t.postalCd),i.join(", ")},n.init()}])}();
!function(){"use strict";function e(o,e,t,g,i,m,r){var f=this,n=(f.isProcessing=!1,f.isFetched=!1,f.isFetchedAdvancedSearch=!1,f.invoiceList=[],f.shipperList=[],f.billToList=[],f.allSelected=!1,o.acceptAlphaNumericDash=/^[a-zA-Z0-9-]+$/,o.selectedSearch="searchByInvoiceNbr",o.searchDropDownItems1=[{value:"searchByInvoiceNbr",label:"Finalize / Reprint Invoice"},{value:"searchByShipment",label:"Search by Shipment"}],o.selectedTab="details",f.selectedAdvancedSearchMultipleShipment="searchMultipleShipmentByShipmentNbr",f.advancedSearchMultipleShipmentDropDownItems=[{value:"searchMultipleShipmentByShipmentNbr",label:"Shipment No."},{value:"searchMultipleShipmentByPoNbr",label:"PO# / Order# / QT#"}],f.advancedSearchInput="",f.closeModalAdvancedSearch=function(){},o.selectedSearchShipment="viewAll",o.searchDropDownShipment=[],"searchByShipment"),s=null,a=null;function c(){var e=new Date,t=e.getFullYear(),e=e.getMonth(),i=new Date(t,e,1),t=new Date(t,e+1,0);f.fromDate=moment(i).format("YYYY/MM/DD"),f.toDate=moment(t).format("YYYY/MM/DD"),$("#op-date-picker-from").val(f.fromDate),$("#op-date-picker-to").val(f.toDate)}function d(e){f.isProcessing=!0,u(),g.getInvoiceByInvoiceNbr(e).then(function(e){void 0!==e&&(void 0!==e.freightBillingHeaderModel&&(a=e.freightBillingHeaderModel),void 0!==e.dosSummary&&(s=e.dosSummary),void 0!==e.listDOSDetail&&(f.invoiceList=e.listDOSDetail||[],o.changeNumPerPage())),f.isFetched=!0,f.isProcessing=!1})}function l(e){void 0===e.success||e.success?(f.invoiceList=e.listDOSDetail||[],o.changeNumPerPage()):toastr.error(e.message),f.isFetched=!0,f.isProcessing=!1}function u(){f.invoiceList=[],o.displayedItems=[],a=s=null}f.init=function(){g.getSearchLabels().then(function(e){if(void 0!==e&&void 0!==e.mapKeyStrValStr)for(var t in e.mapKeyStrValStr.entry)o.searchDropDownShipment[t]={label:e.mapKeyStrValStr.entry[t].key,value:e.mapKeyStrValStr.entry[t].value}}),f.billToList=[],g.getBillToList().then(function(e){if(void 0===e.success||e.success)for(var t in e.listString)f.billToList.push({value:t,name:e.listString[t]});else toastr.error(e.message)})},f.isPageInvoiceDOS=function(e){if(!e)for(var t of m.currentUser.roles)if("TMS_DISTRIBUTOR"===t.role||m.currentUser.isSuperAdmin)return!1;return!0},o.ifSearchByBillTo=function(){return"searchByShipment"===o.selectedSearch&&"searchByBillTo"===o.selectedSearchShipment},f.refresh=function(){f.invoiceList=[],c(),f.fetchShipmentList()},f.isReportFinal=function(){return null!=s&&s.statusCd.trim().toUpperCase()==="Final".toUpperCase()},f.getDOSSummaryFilepath=function(){return"searchByInvoiceNbr"===o.selectedSearch&&null!==s&&void 0!==s.fileRelativePathDOSSummary?s.fileRelativePathDOSSummary:""},f.basicSearch=function(){f.isFetchedAdvancedSearch=!1,f.fetchInvoiceList()},f.advancedSearch=function(){f.isFetchedAdvancedSearch=!0,f.fetchInvoiceList()},f.fetchInvoiceList=function(){f.isProcessing=!0;var e,t;if(f.isFetchedAdvancedSearch){if(f.isProcessing=!0,f.advancedSearchInput=f.advancedSearchInput.trim(),u(),0===f.advancedSearchInput.length)return alert("Please enter values separated by next line."),void(f.isProcessing=!1);var i={valueString:f.selectedAdvancedSearchMultipleShipment,listString:f.advancedSearchInput.split(/\r|\n/)};g.getShipmentsByColumn(i).then(function(e){void 0!==e&&(void 0!==e.freightBillingHeaderModel&&(a=e.freightBillingHeaderModel),void 0!==e.dosSummary&&(s=e.dosSummary),void 0!==e.listDOSDetail&&(f.invoiceList=e.listDOSDetail,o.totalPage=Math.ceil(f.invoiceList.length/o.numPerPage),o.currentPage=1,o.selectPage(o.currentPage))),f.isProcessing=!1,f.closeModalAdvancedSearch()})}else if("searchByShipment"===o.selectedSearch){if(f.fromDate=$("#op-date-picker-from").val().replace(/\//g,"-"),f.toDate=$("#op-date-picker-to").val().replace(/\//g,"-"),void 0===o.selectedSearchShipment||""===o.selectedSearchShipment)return toastr.error("Please select filter to fetch"),f.isFetched=!0,void(f.isProcessing=!1);if("searchByBillTo"===o.selectedSearchShipment){if(void 0===f.inputBillTo||""===f.inputBillTo)return toastr.error("Please select from Bill To Party options."),f.isFetched=!0,void(f.isProcessing=!1);i=f.fromDate,e=f.toDate,t=f.inputBillTo.name,u(),g.getShipmentByBillToParty(i,e,t).then(l)}else"viewAll"===o.selectedSearchShipment&&(e=f.fromDate,t=f.toDate,u(),g.getAllShipments(e,t).then(l))}else if("searchByInvoiceNbr"===o.selectedSearch){if(void 0===f.inputInvoiceNbr||""===f.inputInvoiceNbr)return alert("Please enter a valid invoice number. \n(Only accepts alphanumeric and dash characters)"),f.isFetched=!0,void(f.isProcessing=!1);d(f.inputInvoiceNbr)}n=o.selectedSearch},f.refreshFields=function(){f.isFetched=!1,f.inputShipment="",f.inputInvoiceNbr="",f.inputBillTo="",n=o.selectedSearch,c()},f.transitionToFinalizeReprint=function(e){o.selectedSearch="searchByInvoiceNbr",f.inputInvoiceNbr=e,f.fetchInvoiceList()},f.toggleSelection=function(e){if(f.invoiceList){var t,i=f.invoiceList.filter(function(e){return!o.isReportGenerated(e.statusCd)});for(t in e?f.allSelected=e.isSelected&&f.allSelected:i.forEach(function(e){e.isSelected=f.allSelected}),i)i[t].isSelected&&i[t].shipperCd!==e.shipperCd&&(e.isSelected=!1,alert("Please select shipments with the same Shipper Code"))}},o.isFetchInvoiceNbr=function(e){return"searchByInvoiceNbr"===n},o.isReportGenerated=function(e){return void 0!==e&&""!==e.trim()},o.checkIfEmpty=function(e){return!e||""===e.trim()?"-":e},o.openDatePickerCalendar=function(e){$("#"+e).focus(),$("#"+e).datepicker({format:"yyyy-mm-dd",todayHighlight:!0,autoclose:!0})},o.sortColumn=function(e){o.orderDirectionAccordingTo=h?"+"+e:"-"+e,h=!h};var h=!0;o.currentPage=1,o.numPerPage=5,f.selectedNumPerPage="5",o.changeNumPerPage=function(){o.numPerPage="all"===f.selectedNumPerPage?f.invoiceList.length:parseInt(f.selectedNumPerPage),o.totalPage=Math.ceil(f.invoiceList.length/o.numPerPage),o.currentPage=1,o.selectPage(o.currentPage)},o.isDisplayInvoiceInfo=function(){return"searchByInvoiceNbr"===o.selectedSearch&&0<f.invoiceList.length},o.displayInvoiceInfo=function(){return"searchByInvoiceNbr"===o.selectedSearch&&0<f.invoiceList.length?f.invoiceList[0].dosInvoiceNbr+", "+f.invoiceList[0].dosInvoiceDt+", "+f.invoiceList[0].statusCd:""},o.selectPage=function(e){var t=(i=e*o.numPerPage)-o.numPerPage,i=i>f.invoiceList.length?f.invoiceList.length:i,t=(f.invoiceList&&0<f.invoiceList.length?o.displayedItems=f.invoiceList.slice(t,i):o.displayedItems=[],o.currentPage=e,o.currentPage),r=o.totalPage,n=[];if(r<=5){if(2<r)for(var s=2;s<r;s++)n.push(s)}else if(t<=4)for(s=2;s<=5;s++)n.push(s);else if(r-4<t)for(s=r-4;s<=r-1;s++)n.push(s);else n.push(t-1),n.push(t),n.push(t+1);o.pageNavArr=n},o.previousPage=function(){o.selectPage(--o.currentPage)},o.nextPage=function(){o.selectPage(++o.currentPage)},o.getDisplayedItemCount=function(){var e=o.currentPage*o.numPerPage;return e-o.numPerPage+1+" to "+(e>f.invoiceList.length?f.invoiceList.length:e)},o.pageNavArr=[],f.generateFreightBillingReport=function(){var e,t,i,r=[];for(e in f.invoiceList)if(f.invoiceList[e].isSelected||o.isFetchInvoiceNbr(e))for(var n in f.invoiceList[e].listDetailInvoiceAccessorials)r.push(f.invoiceList[e].listDetailInvoiceAccessorials[n].transactionId);0===r.length?alert("Please select an invoice to generate a report"):(t=s&&void 0!==s.statusCd)&&s.statusCd.trim().toUpperCase()==="Final".toUpperCase()?(i={dosInvoiceId:s&&void 0!==s.dosInvoiceId?s.dosInvoiceId:"",dosInvoiceNbr:s.dosInvoiceNbr,fbhId:a.fbhId,taxIdNbr:a.taxIdNbr,dosInvoiceDt:s.dosInvoiceDtFormatted,terms:s.terms,poNbr:a.poNbr,drNbr:a.drNbr,oscaPwdNbr:a.oscaPwdNbr,listTransactionId:r,statusCd:s.statusCd,liquidityProviderCd:s.liquidityProviderCd},o.mdIsProcessing=!0,g.generateReport(i).then(function(e){void 0!==e&&(void 0!==e.fileRelativePath&&""!==e.fileRelativePath.trim()&&g.downloadFile(e.fileRelativePath),f.inputInvoiceNbr=o.inputInvoiceNbr),o.mdIsProcessing=!1})):null!=s?g.getInvoiceAttachmentList(s.dosInvoiceId).then(function(e){void 0!==e?f.toggleInvoiceHeadersModal(s,a,r,t,e.listInvoiceAttachment):toastr.error("Failed to get list invoice attachment.")}):f.toggleInvoiceHeadersModal(s,a,r,t,null)},f.deleteReport=function(){confirm("Are you sure you want to delete Draft FBS report?")&&void 0!==s&&void 0!==s.dosInvoiceNbr&&(o.mdIsProcessing=!0,g.deleteAllInvoiceAttachment(s.dosInvoiceId).then(function(e){void 0===e||e.success||void 0===e.message?null!==s&&g.deleteReport(s.dosInvoiceNbr).then(function(e){void 0!==e&&e.valueBoolean?u():(toastr.error("Failed to delete DOS Invoice "+s.dosInvoiceNbr),g.checkIfInvoiceNbrExist(f.inputInvoiceNbr).then(function(e){void 0!==e&&e.valueBoolean&&d(f.inputInvoiceNbr)}))}):toastr.error(e.message)}),o.mdIsProcessing=!1)},f.downloadPdf=function(e){},f.testingConsole=function(){},o.concatAddress=function(e,t){return e||t?e+" "+t:"-"},f.toggleChargesModal=function(c){e.open({templateUrl:"app/invoice/md.charges.view.html",controller:function(r,e,t){r.mdIsProcessing=!1,r.chargeList=[],r.isAddNew=!1,r.acceptNumeric=/^[0-9]+(\.[0-9]{1,2})?$/,r.objCharge={inputChargeCd:"",inputChargeDesc:"",inputAmount:0,totalAmt:0};var i,n=[];function s(){r.objCharge.inputChargeCd="",r.objCharge.inputChargeDesc="",r.objCharge.inputAmount=""}function o(e){return void 0===e?(alert("Entered amount value is invalid."),!1):""===e?(alert("Please enter an amount."),!1):e<=0||isNaN(e)?(alert("Entered amount value is invalid."),!1):0!=function(e){e=e.split(".");return 1==e.length||!(2<e.lenghth)&&!(2<e[1].length)}(e)||(alert("Entered amount value is invalid"),!1)}function a(){for(var e in r.objCharge.totalAmt=0,r.chargeList){e=r.chargeList[e];r.objCharge.totalAmt+=parseFloat(e.chargeAmt)*e.qty}r.objCharge.totalAmt=parseFloat(r.objCharge.totalAmt).toFixed(2)}for(i in r.closeModal=function(){f.fetchInvoiceList(),e.dismiss("cancel")},r.insertCharge=function(){if(""===r.objCharge.inputChargeCd)alert("Please enter Charge code.");else if(""===r.objCharge.inputChargeDesc)alert("Please enter Charge Description.");else if(!1!==o(r.objCharge.inputAmount)){for(var e in r.chargeList)if(void 0===(t=r.chargeList[e]).chargeAmt)return void alert("Entered amount value is invalid.");r.objCharge.inputAmount=parseFloat(r.objCharge.inputAmount);var t={chargeAmt:r.objCharge.inputAmount,chargeTypeCd:r.objCharge.inputChargeCd,description:r.objCharge.inputChargeDesc,transactionId:null,currency:r.chargeList[0].currency,dosInvoiceId:c.dosInvoiceId,hidden:!1};1===r.chargeList.length&&""===r.chargeList[0].chargeTypeCd&&""===r.chargeList[0].description?(t.transactionId=r.chargeList[0].transactionId,r.chargeList[0]=t):r.chargeList.push(t),r.isAddNew=!1,a(),s()}},r.submitCharges=function(){for(var e in r.chargeList){e=r.chargeList[e];if(""===e.chargeAmt)return void alert("Please enter an amount.");if(void 0===e.chargeAmt)return void alert("Entered amount value is invalid.");if(e.chargeAmt<0)return void alert("Entered negative amount value is invalid.")}r.mdIsProcessing=!0,g.saveInvoiceCharges(r.chargeList.concat(n)).then(function(e){a(),r.mdIsProcessing=!1,r.closeModal()})},r.changeDataInput=function(){a()},r.removeCharge=function(e,t){var i;confirm("Are you sure you want to delete charge {code: '"+t.chargeTypeCd+"', description: '"+t.description+"', amount: '"+t.chargeAmt+"'}?")&&(i={chargeAmt:0,chargeTypeCd:"",description:"",transactionId:null,currency:t.currency,dosInvoiceId:t.dosInvoiceId,hidden:!1},t.hidden=!0,1<r.chargeList.length?null!==r.chargeList[e].transactionId?(n.push(t),r.chargeList.splice(e,1)):null===r.chargeList[e].transactionId&&r.chargeList.splice(e,1):1===r.chargeList.length?(null!==r.chargeList[0].transactionId&&""!==r.chargeList[0].chargeTypeCd&&""!==r.chargeList[0].description?(n.push(t),r.chargeList.splice(e,1),r.chargeList.push(i)):1===r.chargeList.length&&null!==r.chargeList[0].transactionId&&""===r.chargeList[0].chargeTypeCd&&""===r.chargeList[0].description&&(i.transactionId=r.chargeList[0].transactionId,r.chargeList[0]=i),1===r.chargeList.length&&null===r.chargeList[0].transactionId&&""!==r.chargeList[0].chargeTypeCd&&""!==r.chargeList[0].description&&(r.chargeList[0]=i)):r.chargeList.push(i),a())},r.addOrCancelCharge=function(){r.isAddNew=!r.isAddNew,s()},r.isFinal=function(){return void 0!==c.statusCd&&c.statusCd.trim().toUpperCase()==="Final".toUpperCase()},c.listDetailInvoiceAccessorials){i={chargeAmt:c.listDetailInvoiceAccessorials[i].unitPrice,chargeTypeCd:c.listDetailInvoiceAccessorials[i].chargeCd,description:c.listDetailInvoiceAccessorials[i].chargeDescription,transactionId:c.listDetailInvoiceAccessorials[i].transactionId,currency:c.listDetailInvoiceAccessorials[i].currencyCd,dosInvoiceId:c.dosInvoiceId,productCd:c.listDetailInvoiceAccessorials[i].productCd,desc:c.listDetailInvoiceAccessorials[i].desc,qty:c.listDetailInvoiceAccessorials[i].qty,hidden:!1};r.chargeList.push(i)}a()},scope:o,size:"md",backdrop:"static",resolve:{options:function(){}}})},f.toggleInvoiceAdvancedSearchModal=function(){e.open({templateUrl:"app/invoice/md.advanced.search.html",controller:function(e,t,i,r,n){f.closeModalAdvancedSearch=function(){t.dismiss("cancel")}},scope:o,size:"md",backdrop:"static",resolve:{options:function(){}}})},f.toggleInvoiceHeadersModal=function(h,v,c,d,p){e.open({templateUrl:"app/invoice/dos.md.invoiceheaders.view.html",controller:function(l,e,t,i,r){l.mdIsProcessing=!0,l.hasError=!0,l.errorMessageList=[],l.acceptNumericTerms=/^(\s*|\d+)$/,l.userList=[],l.showEmailNotif=!1,l.programId="LQ_SETTING",l.parameterCd="LQ_EMAIL_SETTING_PARAM",l.parameterName="LQ_EMAIL_SETTING",l.preSetRecipients=[],l.post={},l.post.message="",l.invoiceAttachmentList=p,l.selectLiquidityProviderHelpTexts=[],l.selectLiquidityProviderHelpText="",l.senderUserId="";var u=c,n="",s=!1;function o(e,t){return!(e.length>t)&&!!/^[a-zA-Z0-9-_.,\ ()<>\/\][#:]+$/g.test(e)}function a(){l.mdIsProcessing=!0,l.selectedTab="details",l.selectLiquidityProviderHelpTexts=[],l.selectLiquidityProviderHelpText="",l.inputInvoiceNbr="",f.currentDate=moment().format("YYYY/MM/DD"),$("#op-date-picker-invoice-header").val(f.currentDate),null!==h&&null!==v?(l.hasUserTIN=!0,l.inputInvoiceNbr=h.dosInvoiceNbr,l.fbhId=h.fbhId,l.statusCd=void 0===h.statusCd||""===h.statusCd?"Draft":v.statusCd,l.inputTIN=v.taxIdNbr,l.inputTerms=void 0===h.terms||""===h.terms?0:h.terms,l.inputPONbr=v.poNbr,l.inputDRNbr=v.drNbr,l.inputOSCAPWD=v.oscaPwdNbr,l.isFinalized="Final"===h.statusCd,l.selectedProvider=h.liquidityProviderCd,n=h.dosInvoiceNbr,s=d,l.changeSelectedLiquidityProvider()):(l.mdIsProcessing=!0,g.checkIfTinExist().then(function(e){void 0!==e.taxIdNbr&&(l.inputTIN=e.taxIdNbr,l.hasUserTIN=!0),l.mdIsProcessing=!1})),f.changeSelectedHeader(),g.getProvidersByBillerCd().then(function(e){if(void 0!==e&&void 0!==e.listFreightBillingProviderModel){for(var t in e.listFreightBillingProviderModel)l.providerListItems.push({value:e.listFreightBillingProviderModel[t].partnerCd,label:e.listFreightBillingProviderModel[t].name}),l.selectLiquidityProviderHelpTexts[e.listFreightBillingProviderModel[t].partnerCd]=e.listFreightBillingProviderModel[t].selectLiquidityProviderHelpText;l.changeSelectedLiquidityProvider()}}),m.getSystemUser().then(function(e){l.senderUserId=e.userName}),m.getTaggableUsers().then(function(e){l.userList=e||[]}),l.mdIsProcessing=!1}l.hasUserTIN=!1,l.listHeader=[],l.currentHeaderFbhId=v&&void 0!==v.fbhId?v.fbhId:"",l.selectedHeader=-1,l.headerDropDownItems=[{value:-1,label:"New Header"}],l.providerListItems=[],l.selectedProvider="",f.changeSelectedHeader=function(){-1===l.selectedHeader?(l.hasUserTIN||(l.inputTIN=""),l.inputDRNbr="",l.inputPONbr="",l.inputOSCAPWD=""):(l.hasUserTIN||(l.inputTIN=l.listHeader[l.selectedHeader].taxIdNbr),l.inputDRNbr=l.listHeader[l.selectedHeader].drNbr,l.inputPONbr=l.listHeader[l.selectedHeader].poNbr,l.inputOSCAPWD=l.listHeader[l.selectedHeader].oscaPwdNbr),l.changeHeaderValues()},l.changeHeaderValues=function(){for(var e in l.listHeader)if(l.inputTIN===l.listHeader[e].taxIdNbr&&l.inputDRNbr===l.listHeader[e].drNbr&&l.inputPONbr===l.listHeader[e].poNbr&&l.inputOSCAPWD===l.listHeader[e].oscaPwdNbr)return void(l.selectedHeader=e);l.selectedHeader=-1},l.closeModal=function(){f.fetchInvoiceList(),e.dismiss("cancel")},l.selectFinalized=function(){l.selectedProvider?(l.isFinalized=!l.isFinalized,l.showEmailNotif=l.isFinalized,l.selectedProvider,g.getDefaultInvoiceHeaderEmailReceivers(l.parameterCd,l.parameterName,l.programId,l.selectedProvider).then(function(e){l.preSetRecipients=e.data||[];var t,i=!1;for(t in e.data)i&&(l.post.message=l.post.message+", "),l.post.message=l.post.message+e.data[t],i=!0}).catch(function(e){toastr.error(e.data)})):(l.isFinalized=!1,toastr.error("Please select Provider First"))},l.closeFinalEmail=function(){l.showEmailNotif=!1},l.back=function(){switch(l.selectedTab){case"liquidity":l.selectedTab="details";break;case"attachments":l.selectedTab="liquidity";break;case"finalize_and_notify":l.selectedTab="attachments"}},l.saveAndProceed=function(){switch(l.hasError=!1,l.errorMessageList=[],l.selectedTab){case"details":l.isInputInvoiceDetailsTabComplete()&&(l.selectedTab="liquidity");break;case"liquidity":l.isInputInvoiceLiquidityTabComplete()&&(l.selectedTab="attachments");break;case"attachments":l.selectedTab="finalize_and_notify";break;default:l.errorMessageList.push("Invalid selectedTab"),l.hasError=!0}},l.isInputInvoiceDetailsTabComplete=function(){return l.isInputTermsInvalid()&&(l.errorMessageList.push("Please enter non-negative integer for Terms."),l.hasError=!0),l.isInputTinInvalid()&&(l.errorMessageList.push("Please enter a TIN"),l.hasError=!0),l.isInputInvoiceInvalid()&&(l.errorMessageList.push("Please enter an Invoice #"),l.hasError=!0),!o(l.inputDRNbr,16)&&0<l.inputDRNbr.length?(l.errorMessageList.push("Invalid entry format for D.R. #."),l.hasError=!0):!o(l.inputPONbr,16)&&0<l.inputPONbr.length?(l.errorMessageList.push("Invalid entry format for P.0. #."),l.hasError=!0):!o(l.inputOSCAPWD,16)&&0<l.inputOSCAPWD.length?(l.errorMessageList.push("Invalid entry format for OSCA/PWD ID No."),l.hasError=!0):o(l.inputTIN,16)?o(l.inputInvoiceNbr,12)||(l.errorMessageList.push("Invalid entry format for Invoice #"),l.hasError=!0):(l.errorMessageList.push("Invalid entry format for TIN #"),l.hasError=!0),!l.hasError},l.isInputInvoiceLiquidityTabComplete=function(){return void 0!==l.selectedProvider&&""!==l.selectedProvider||(l.errorMessageList.push("Please select Provider."),l.hasError=!0),!l.hasError},l.isInputTermsInvalid=function(){return void 0===l.inputTerms||""===l.inputTerms||l.inputTerms<0},l.isInputTinInvalid=function(){return void 0===l.inputTIN||""===l.inputTIN},l.isInputInvoiceInvalid=function(){return void 0===l.inputInvoiceNbr||""===l.inputInvoiceNbr},l.isInputLiquidityProviderInvalid=function(){return void 0===l.selectedProvider||""===l.selectedProvider},l.sendMessage=function(d){return l.mdIsProcessing=!0,r.all([function(e){var t,i;if(!s||n!==e)return t=r.defer(),i=g.checkIfInvoiceNbrExist(e).then(function(e){e.valueBoolean&&(l.errorMessageList.push("Invoice # already exist"),l.hasError=!0),t.resolve(i)}),t.promise}(l.inputInvoiceNbr)]).then(function(e){if(l.hasError=0<l.errorMessageList.length,l.mdIsProcessing=!1,!l.hasError){var t,i,r=(r=$("#message-content").val())?r.replace(new RegExp("\r?\n","g"),"<br>"):"",n=[],s="";for(t in l.preSetRecipients)l.post.message.contains(l.preSetRecipients[t])&&(n.push(l.preSetRecipients[t]),s+=l.preSetRecipients[t]+" ");for(i in d){n.push(d[i].userName);var o=d[i],a=[];o.emailId&&a.push(o.emailId),s+=a.join(" ")+" "}var c=(s+r).replace(new RegExp("\r?\n","g"),"<br>"),r={dosInvoiceId:h&&void 0!==h.dosInvoiceId?h.dosInvoiceId:"",fbhId:v&&void 0!==v.fbhId?v.fbhId:"",dosInvoiceNbr:l.inputInvoiceNbr,taxIdNbr:l.inputTIN,dosInvoiceDt:$("#op-date-picker-invoice-header").val().replace(/\//g,"-"),terms:void 0===l.inputTerms?"":l.inputTerms,poNbr:void 0===l.inputPONbr?"":l.inputPONbr,drNbr:void 0===l.inputDRNbr?"":l.inputDRNbr,oscaPwdNbr:void 0===l.inputOSCAPWD?"":l.inputOSCAPWD,listTransactionId:u,statusCd:l.isFinalized?"Final":"Draft",liquidityProviderCd:l.selectedProvider,listRecipient:n,message:s+r,publicMessage:!0,senderUserId:l.senderUserId,message:c};return l.mdIsProcessing=!0,g.generateReport(r).then(function(e){f.transitionToFinalizeReprint(l.inputInvoiceNbr),void 0!==e&&(f.inputInvoiceNbr=l.inputInvoiceNbr,0<l.dropzone.getQueuedFiles().length&&(l.dropzone.options.url+="/"+l.inputInvoiceNbr,l.dropzone.processQueue()),void 0!==e.fileRelativePath&&""!==e.fileRelativePath.trim()&&g.downloadFile(e.fileRelativePath)),l.closeModal(),l.mdIsProcessing=!1})}})},l.selectTab=function(e){var t=l.selectedTab;l.selectedTab=e,l.hasError=!1,l.errorMessageList=[],"details"===t||"details"===e?l.isInputInvoiceDetailsTabComplete():(l.isInputInvoiceDetailsTabComplete(),l.isInputInvoiceLiquidityTabComplete()),l.hasError&&(l.selectedTab=t)},l.dropzoneConfig={dropzone:function(e){l.dropzone=e},options:{url:"/tms-api/invoice/dos/invoice-attachment",parallelUploads:80,autoProcessQueue:!1,acceptedFiles:".jpg,.jpeg,.bmp,.png,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.gz,.7z,.s7z,.rar,.zip,.gzip,.tar,.txt,.rtf",thumbnailWidth:50,thumnnailHeight:50,thumbnailMethod:"contain",headers:{"x-openport-token":m.currentUser.token.accessToken},addRemoveLinks:!0,removedfile:function(e){var t;return null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0}},eventHandlers:{success:function(e,t){i(function(){l.mdIsProcessing=!1},100),this.removeFile(e),l.closeModal()},error:function(e,t){i(function(){l.mdIsProcessing=!1},100),"string"==typeof t?toastr.error(t):toastr.error("Sorry, an error has occured during upload.")},maxfilesexceeded:function(e){this.removeFile(e),this.removeEventListeners()},maxfilesreached:function(e){this.removeEventListeners()},removedfile:function(e){this.setupEventListeners()}}},l.deleteAttachment=function(t){confirm("Are you sure you want to delete attachment?")&&(l.mdIsProcessing=!0,g.deleteInvoiceAttachment(t.fbrId,t.uuid).then(function(e){g.getInvoiceAttachmentList(t.fbrId).then(function(e){void 0===e||e.success||void 0===e.message?(l.invoiceAttachmentList=e.listInvoiceAttachment,l.invoiceAttachmentList.length||"attachments"!==l.selectedTab||(l.selectedTab="details")):toastr.error(e.message),l.mdIsProcessing=!1})}).catch(function(){l.mdIsProcessing=!1,toastr.error("Error occurred when trying to delete attachment.")}))},l.downloadAttachment=function(e){l.mdIsProcessing=!0,g.downloadAttachment(e).finally(function(){l.mdIsProcessing=!1})},l.changeSelectedLiquidityProvider=function(){if(void 0!==l.selectLiquidityProviderHelpTexts[l.selectedProvider]){for(var e in l.providerListItems)l.providerListItems[e].value===l.selectedProvider&&(l.selectLiquidityProviderHelpText=l.providerListItems[e].label+" Note: ");l.selectLiquidityProviderHelpText=l.selectLiquidityProviderHelpText+""+l.selectLiquidityProviderHelpTexts[l.selectedProvider]}},i(function(){a()},500)},scope:o,size:"md",backdrop:"static",resolve:{options:function(){}}})},f.downloadFile=function(e){void 0!==e&&""!==e.trim()&&g.downloadFile(e)},f.init()}angular.module("app").filter("range",function(){return function(e,t){t=parseInt(t);for(var i=1;i<=t;i++)e.push(i);return e}}).directive("mentionUsers",function(){return{require:"uiMention",link:function(t,e,i,r){r.findChoices=function(i,e){return t.userList.filter(function(t){return!e.some(function(e){return e.userId===t.userId})}).filter(function(e){function t(e){return e&&e.toLowerCase().startsWith(i[1].toLowerCase())}return t(e.firstName)||t(e.lastName)||t(e.partnerCd)})},r.label=function(e){return e.emailId}}}}).controller("DeliveryOrderSummaryController",e),e.$inject=["$scope","$modal","ngDialog","InvoiceDosService","$location","UserService","FbsDetailService"]}();
!function(){"use strict";angular.module("app").controller("BackhaulController",["BackhaulService","UserService","$interval","$q","$timeout",function(o,i,e,t,n,a){var r,s,c,l,d={DELIVERY_ACTIVE:"https://assets.openport.com/img/icons/backhaul/delivery_active.svg",DELIVERY_BACKHAUL:"https://assets.openport.com/img/icons/backhaul/delivery_backhaul.svg",DELIVERY_SELECT:"https://assets.openport.com/img/icons/backhaul/delivery_select.svg",PICKUP_NEARBY:"https://assets.openport.com/img/icons/backhaul/pickup_nearby.svg",PICKUP_BACKHAUL:"https://assets.openport.com/img/icons/backhaul/pickup_backhaul.svg",PICKUP_SELECT:"https://assets.openport.com/img/icons/backhaul/pickup_select.svg",TRUCK_ACTIVE:"https://assets.openport.com/img/icons/backhaul/truck_active.svg",TRUCK_BACKHAUL:"https://assets.openport.com/img/icons/backhaul/truck_backhaul.svg",TRUCK_SELECT:"https://assets.openport.com/img/icons/backhaul/truck_select.svg"},p=this,h=(p.activeShipmentData=[],p.nearbyShipmentDistance=[{distance:5,name:"5 KM"},{distance:10,name:"10 KM"},{distance:15,name:"15 KM"},{distance:20,name:"20 KM"}],p.driver={},p.gettingNearby=!1,[]),m=[],u=!1,b=0,g=0,v=0,I=0,k=0,y=0;function f(e,t,a,i){var n=T(e,t,a,i);m.push(n),google.maps.event.addListener(n,"click",function(){_(m,n.data.shipmentId),v==n.data.shipmentId&&y%2==0?(y++,$("#nearbyPickupTable tr").removeClass("selected")):(y=0,$("#nearbyPickupTable tr").removeClass("selected"),l.rows().every(function(e,t,a){n.data.shipmentId==this.data().shipmentId&&(l.$("tr.selected").removeClass("selected"),$(this.node()).addClass("selected"))})),v=n.data.shipmentId})}function C(e,t,a,i){var n,s=T(e,t,a,i);h.push(s),google.maps.event.addListener(s,"click",function(){p.gettingNearby||(p.gettingNearby=!0,r.setCenter(s.getPosition()),I=I==g&&g==s.data.shipmentId?0:g,g=b,_(h,s.data.shipmentId),g==s.data.shipmentId&&k%2==0?(k++,$("#activeShipmentTable tr").removeClass("selected"),m.forEach(function(e){e.setMap(null)}),m=[],S(),$("#driverInfo").hide(),$("#nearbyPickupTable").hide(),$("#emptyNearbyPickupTable").show()):(k=0,$("#activeShipmentTable tr").removeClass("selected"),c.rows().every(function(e,t,a){s.data.shipmentId==this.data().shipmentId&&(c.$("tr.selected").removeClass("selected"),$(this.node()).addClass("selected"))})),b==s.data.shipmentId&&I!=s.data.shipmentId||($("#driverInfo").hide(),$("#nearbyPickupTable").hide(),$("#emptyNearbyPickupTable").hide(),$("#loadingNearbyPickupTable").show(),m.forEach(function(e){e.setMap(null)}),m=[],S(),n=o.getNearbyShipments({shipmentId:this.data.shipmentId,distance:p.nearbyShipmentDistanceSelected.distance}).then(function(t){$("#driverInfo").show(),p.driver={name:t.firstName+" "+t.lastName,mobile:t.phoneNbr,truckType:t.truckDescription};var e=t;$("#emptyNearbyPickupTable").hide(),$("#nearbyPickupTable").show(),$.fn.DataTable.isDataTable("#nearbyPickupTable")||(l=null,l=$("#nearbyPickupTable").DataTable({bLengthChange:!1,bInfo:!1,columns:[{data:"shipmentId",visible:!1},{data:"shipmentNumber"},{data:"distance"},{data:"pickupLocation"},{data:"requestedDeliveryDate"},{data:"deliveryLocation"},{data:null,bSortable:!1,mRender:function(e,t,a){return'<a class="btn btn-block btn-outline-primary ng-binding" id="assignBackhaulBtn">Assign</a>'}}]})),void 0!==e.nearbyShipment&&e.nearbyShipment.forEach(function(e){l.row.add({shipmentId:e.shipmentId,shipmentNumber:e.shipmentNbr,distance:e.distance,pickupLocation:e.pickupLine1+" "+e.pickupCityLocality+" "+e.pickupProvince+" "+e.pickupCountry+" "+e.pickupPostalCode,requestedDeliveryDate:moment(e.requestedDeliveryDt).format("YYYY-M-D HH:mm"),deliveryLocation:e.line1+" "+e.cityLocality+" "+e.province+" "+e.country+" "+e.postalCode})}),l.draw(),void 0!==t.nearbyShipment&&t.nearbyShipment.forEach(function(e){e._firstname=t.firstname,e._lastName=t.lastName,e._mobileUserId=t.mobileUserId,e._phoneNbr=t.phoneNbr,0<e.backhaulShipmentId?(f(e.latitudeShipment,e.longitudeShipment,d.PICKUP_BACKHAUL,e),$("#assignBackhaulBtn").hide()):($("#assignBackhaulBtn").show(),f(e.latitudeShipment,e.longitudeShipment,d.PICKUP_NEARBY,e))})}),b=s.data.shipmentId),n?n.then(function(){p.gettingNearby=!1,$("#loadingNearbyPickupTable").hide()}):p.gettingNearby=!1)})}function T(e,t,a,i){return new google.maps.Marker({map:r,position:new google.maps.LatLng(e,t),icon:{url:a,scaledSize:new google.maps.Size(26,26),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)},data:i})}function _(e,a,i){e.forEach(function(t){t.setZIndex(-1);function e(e){t.setIcon({url:e,scaledSize:new google.maps.Size(26,26),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)})}i||t.data.shipmentId!=a?i||t.data.shipmentId==a?i&&t.data.shipmentId==a&&(t.icon.url.contains("truck_active")||t.icon.url.contains("truck_select")?e(d.TRUCK_BACKHAUL):t.icon.url.contains("delivery_active")||t.icon.url.contains("delivery_select")?e(d.DELIVERY_BACKHAUL):t.icon.url.contains("pickup_nearby")&&e(d.PICKUP_BACKHAUL)):t.icon.url.contains("truck_select")?e(d.TRUCK_ACTIVE):t.icon.url.contains("delivery_select")?e(d.DELIVERY_ACTIVE):t.icon.url.contains("pickup_select")&&e(d.PICKUP_NEARBY):(t.icon.url.contains("truck_active")?e(d.TRUCK_SELECT):t.icon.url.contains("delivery_active")?e(d.DELIVERY_SELECT):t.icon.url.contains("pickup_nearby")?e(d.PICKUP_SELECT):t.icon.url.contains("truck_select")?e(d.TRUCK_ACTIVE):t.icon.url.contains("delivery_select")?e(d.DELIVERY_ACTIVE):t.icon.url.contains("pickup_select")&&e(d.PICKUP_NEARBY),t.setZIndex(100))})}function S(){$.fn.DataTable.isDataTable("#nearbyPickupTable")&&(l.clear().draw(),l.destroy())}function D(){var n=moment();s&&e.cancel(s),s=e(function(){var e=moment.duration(moment().add(1,"seconds").diff(n)),t=e.days(),a=e.hours(),i=e.minutes(),e=e.seconds();p.moment="",0!=t&&(p.moment+=t+"d "),0!=a&&(p.moment+=a+"h "),0!=i&&(p.moment+=i+"m "),p.moment+=e+"s ago"},1e3)}p.initialize=function(){var e;$("#driverInfo").hide(),$("#nearbyPickupTable").hide(),$("#emptyNearbyPickupTable").show(),$("#activeShipmentTable").hide(),e=t.defer(),$("#loadingActiveShipmentTable").show(),o.getShipments().then(function(e){angular.copy(e,p.activeShipmentData);$.fn.DataTable.isDataTable("#activeShipmentTable")||(c=null,c=$("#activeShipmentTable").DataTable({bLengthChange:!1,bInfo:!1,language:{zeroRecords:"Shipment is not yet active or outside the configured backhaul time range.",emptyTable:"No active shipments available."},columns:[{data:"shipmentId",visible:!1},{data:"shipmentNumber"},{data:"status"},{data:"deliveryLocation"},{data:"requestedDeliveryDate"},{data:"actualDeliveryDate"},{data:"driver"}]})),void 0!==e&&e.forEach(function(e){var t;void 0!==e.mobileUserId&&0<e.mobileUserId&&(t='<img alt="Status Available" src="https://assets.openport.com/img/icons/backhaul/pickup_nearby.svg" width="15px" height="15px">',("Backhaul"==e.description_Txt||0<e.backhaulShipmentId)&&(t='<img alt="Status Backhaul" src="https://assets.openport.com/img/icons/backhaul/status_backhaul.svg" width="15px" height="15px">'),c.row.add({shipmentId:e.shipmentId,shipmentNumber:e.shipmentNbr,status:t+" "+e.description_Txt,deliveryLocation:e.line1+" "+e.cityLocality+" "+e.province+" "+e.country+" "+e.postalCode,requestedDeliveryDate:moment(e.requestedDeliveryDt).format("YYYY-M-D HH:mm"),actualDeliveryDate:void 0===e.actualDeliveryDt?"":moment(e.actualDeliveryDt).format("YYYY-M-D HH:mm"),driver:e.firstName+" "+e.lastName+" ("+e.phoneNbr+")"}))}),c.draw()}).then(function(){e.resolve()}),e.promise.then(function(){$("#loadingActiveShipmentTable").hide(),$("#activeShipmentTable").show(),D(),r=new google.maps.Map(document.getElementById("map"),{zoom:12,center:new google.maps.LatLng(-6.21462,106.84513),mapTypeId:"roadmap",gestureHandling:"greedy"}),p.activeShipmentData.forEach(function(e){0<e.mobileUserId&&0==e.backhaulShipmentId?(C(e.latitudeDriver,e.longitudeDriver,d.TRUCK_ACTIVE,e),C(e.latitudeShipment,e.longitudeShipment,d.DELIVERY_ACTIVE,e)):0<e.mobileUserId&&0<e.backhaulShipmentId?(C(e.latitudeDriver,e.longitudeDriver,d.TRUCK_BACKHAUL,e),C(e.latitudeShipment,e.longitudeShipment,d.DELIVERY_BACKHAUL,e)):e.mobileUserId<0&&0<e.backhaulShipmentId&&C(e.latitudeShipment,e.longitudeShipment,d.PICKUP_BACKHAUL,e)})})},p.reload=function(){p.activeShipmentData=[],p.gettingNearby=!1,u=!1,y=k=I=v=g=b=0,h.forEach(function(e){e.setMap(null)}),m.forEach(function(e){e.setMap(null)}),h=[],m=[],$.fn.DataTable.isDataTable("#activeShipmentTable")&&(c.clear().draw(),c.destroy()),S(),$("#hideAssignedCheckbox").prop("checked",!1),$("#loadingNearbyPickupTable").hide(),D(),p.initialize()},p.hideBackhual=function(){u?(h.forEach(function(e){0!=e.data.backhaulShipmentId&&e.setMap(r)}),c.rows().every(function(e,t,a){var i=this.node();$(i).hasClass("hide")&&$(i).removeClass("hide")})):(h.forEach(function(e){0!=e.data.backhaulShipmentId&&e.setMap(null)}),c.rows().every(function(e,t,a){for(var i=0;i<p.activeShipmentData.length;i++)if(p.activeShipmentData[i].shipmentId==this.data().shipmentId&&0!=p.activeShipmentData[i].backhaulShipmentId){$(this.node()).addClass("hide");break}})),u=!u},p.initialize(),$("#activeShipmentTable").on("click","tbody tr",function(){if(!p.gettingNearby)for(var e=0;e<h.length;e++)if(h[e].data.shipmentId==c.row(this).data().shipmentId){new google.maps.event.trigger(h[e],"click");break}}),$("#nearbyPickupTable").on("click","tbody>tr>td>a",function(){$($(this).parents("tr.selected")).addClass("selected"),n(function(){l.rows(":not(.selected)").remove().draw()},300).then(function(){$("#assignBackhaulBtn").hide(),p.reload()});for(var e,t=l.row($(this).parents("tr")).data().shipmentId,a=0;a<m.length;a++)if(t==m[a].data.shipmentId){_(m,t,!0),_(h,b,!0),e=m[a],o.assign([{mobileUserId:m[a].data._mobileUserId,firstName:m[a].data._firstname,lastName:m[a].data._lastName,phoneNbr:m[a].data._phoneNbr,legNbr:1,createUserId:i.currentUser.userName,shipmentId:m[a].data.shipmentId,shipmentNbr:m[a].data.shipmentNbr,shipmentUserId:m[a].data.shipmentUserId,shipperCd:i.currentUser.partner.partnerCd,shipperName:i.currentUser.partner.name,status:"Assigned",statusCd:"AS",statusId:3,backhaul:b}]);break}(m=[]).push(e)}),$("#nearbyPickupTable").on("click","tbody > tr",function(){for(var e=0;e<m.length;e++)if(m[e].data.shipmentId==l.row(this).data().shipmentId){new google.maps.event.trigger(m[e],"click");break}})}])}();
!function(){"use strict";function o(o,t,r,e,n,c){o.trustSrc=function(){var o;if(void 0!==e.currentUser.token)return o="https://"+(0<=c.host().indexOf("localhost")?"uat-op2-dispatch.openport.com":c.host())+"/loadconsolidation/#/consolidator"+"?application=dispatcher&token="+e.currentUser.token.accessToken+"&partnerCd="+e.currentUser.partnerCd,n.trustAsResourceUrl(o)}}angular.module("app").controller("TruckloadConsolidatorController",o),o.$inject=["$scope","$modal","ngDialog","UserService","$sce","$location"]}();
!function(){"use strict";function e(s,e,t,r,o){var n=this;s.optable=r,s.optable.selectedNumPerPage="all",s.isProcessing=!1,n.zoomPercent="1rem",n.assets=[],n.refresh=function(){s.isProcessing=!0,o.getAssets().then(function(e){s.isProcessing=!1,n.assets=[],void 0!==e&&e.constructor===Array&&(n.assets=e,s.optable.setObjectList(n.assets),s.optable.changeNumPerPage())})},n.refresh(),t(function(){s.isProcessing||n.refresh()},6e4)}angular.module("app").controller("BayqueueController",e),e.$inject=["$scope","$modal","$interval","OpTableHelper","BayqueueService"]}();
!function(){"use strict";function r(r,t,o,e,n,c){r.trustSrc=function(){var r;if(void 0!==e.currentUser.oauth)return r="https://"+(0<=c.host().indexOf("localhost")?"uat-dispatch.acronize.com":c.host())+"/controltower/#/control-tower"+"?application=dispatcher&token="+e.currentUser.oauth.refresh_token+"&partnerCd="+e.currentUser.partnerCd,n.trustAsResourceUrl(r)}}angular.module("app").controller("ControlTowerController",r),r.$inject=["$scope","$modal","ngDialog","UserService","$sce","$location"]}();
!function(){"use strict";function r(r,t,o,e,n,i){var s=this;r.trustSrc=function(){var r;if(void 0!==e.currentUser.token)return r=("localhost"===s.host?"https://sgp04.openport.com":location.origin)+"/insight-apps/main/#/load-route-optimizer/route-optimizer?application=dispatcher&partnerCd="+e.currentUser.partnerCd+"&token="+e.currentUser.oauth.refresh_token,n.trustAsResourceUrl(r)}}angular.module("app").controller("RouteOptimizerController",r),r.$injext=["$scope","$modal","ngDialog","UserService","$sce","$location"]}();
!function(){"use strict";function t(t,o,r,c,e,n){t.trustSrc=function(){return e.trustAsResourceUrl("https://app.routific.com/#/hud/project/route/dispatch")}}angular.module("app").controller("RoutingController",t),t.$inject=["$scope","$modal","ngDialog","UserService","$sce","$location"]}();
angular.module("app").factory("fileReader",["$q","$log",function(a,r){var u=function(r,e,n){return function(){n.$apply(function(){e.resolve(r.result)})}},l=function(r,e,n){return function(){n.$apply(function(){e.reject(r.result)})}},f=function(r,e){return function(r){e.$broadcast("fileProgress",{total:r.total,loaded:r.loaded})}};return{readAsDataUrl:function(r,e){var n,o,t=a.defer();return n=t,e=e,(o=new FileReader).onload=u(o,n,e),o.onerror=l(o,n,e),o.onprogress=f(o,e),o.readAsDataURL(r),t.promise}}}]);